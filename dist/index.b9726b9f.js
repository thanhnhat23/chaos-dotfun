!function(e,t,a,i,s){var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r="function"==typeof n[i]&&n[i],o=r.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(t,a){if(!o[t]){if(!e[t]){var s="function"==typeof n[i]&&n[i];if(!a&&s)return s(t,!0);if(r)return r(t,!0);if(l&&"string"==typeof t)return l(t);var d=Error("Cannot find module '"+t+"'");throw d.code="MODULE_NOT_FOUND",d}m.resolve=function(a){var i=e[t][1][a];return null!=i?i:a},m.cache={};var h=o[t]=new c.Module(t);e[t][0].call(h.exports,m,h,h.exports,n)}return o[t].exports;function m(e){var t=m.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=e,c.cache=o,c.parent=r,c.register=function(t,a){e[t]=[function(e,t){t.exports=a},{}]},Object.defineProperty(c,"root",{get:function(){return n[i]}}),n[i]=c;for(var d=0;d<t.length;d++)c(t[d]);if(a){var h=c(a);"object"==typeof exports&&"undefined"!=typeof module?module.exports=h:"function"==typeof define&&define.amd&&define(function(){return h})}}({cGIPt:[function(e,t,a,i){var s=e("@parcel/transformer-js/src/esmodule-helpers.js"),n=e("react/jsx-runtime"),r=e("react-dom/client"),o=e("./app/App.jsx"),l=s.interopDefault(o),c=e("../../lib/game/client/game-manager"),d=e("../plugins/client-plugin");let h=new URLSearchParams(window.location.search);window.RELDENS_LOG_LEVEL=h.get("logLevel")||7,window.RELDENS_ENABLE_TRACE_FOR=Number(h.get("traceFor")||"emergency,alert,critical");let m=new(0,c.GameManager);m.setupCustomClientPlugin("customPluginKey",d.ClientPlugin),m.events.on("reldens.afterInitEngineAndStartGame",()=>{let e=m.gameDom.getElement("#current-version");e&&(e.innerHTML=m.config.client.gameEngine.version+" -")}),m.events.on("reldens.startGameAfter",()=>{m.gameDom.getElement(".row-disclaimer")?.remove()}),m.events.on("reldens.activateRoom",e=>{e.onMessage("*",e=>{if("rski.Bc"!==e.act)return;let t=(e.data?.skillKey||"").toString(),a=Number(e.data?.extraData?.sd||0);if(""!==t&&0<a){let e=m.gameDom.getElement(".skill-icon-"+t);if(!e)return;let i=Date.now()+a;e.classList.add("cooldown"),e.style.setProperty("--angle","0deg"),function t(){let s=i-Date.now();if(0>=s){e.style.setProperty("--angle","360deg"),e.classList.remove("cooldown");return}e.style.setProperty("--angle",`${(a-s)/a*360}deg`),requestAnimationFrame(t)}()}})}),window.reldens=m,document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("root");e?(0,r.createRoot)(e).render((0,n.jsx)(l.default,{reldens:m})):console.error("Missing #root element for React mount.")})},{"react/jsx-runtime":"react/jsx-runtime","react-dom/client":"react-dom/client","./app/App.jsx":"1bk6A","../../lib/game/client/game-manager":"a8aUN","../plugins/client-plugin":"jS2AP","@parcel/transformer-js/src/esmodule-helpers.js":"3cktO"}],"1bk6A":[function(e,t,a,i){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(a);var n=e("react/jsx-runtime"),r=e("react");s.interopDefault(r);var o=e("react-router-dom"),l=e("./translations.js"),c=e("./pages/LoginPage.jsx"),d=s.interopDefault(c),h=e("./pages/SignupPage.jsx"),m=s.interopDefault(h),g=e("./pages/GuestPage.jsx"),u=s.interopDefault(g),p=e("./pages/ForgotPasswordPage.jsx"),f=s.interopDefault(p),y=e("./pages/RoleSelectionPage.jsx"),b=s.interopDefault(y),E=e("./pages/ViewerPage.jsx"),S=s.interopDefault(E);let v=({links:e,activeRoute:t,onNavigate:a})=>(0,n.jsx)("div",{className:"flex flex-wrap items-center justify-center gap-3 md:justify-end",children:e.map(({route:e,label:i})=>{let s="inline-flex items-center justify-center rounded-full border px-5 py-2 text-sm font-semibold uppercase tracking-wide transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/70",r=t===e?`${s} border-sky-400 bg-sky-500/80 text-white shadow-lg shadow-sky-500/30`:`${s} border-white/15 bg-white/10 text-slate-200 hover:border-sky-400 hover:bg-sky-500/30 hover:text-white`;return(0,n.jsx)("button",{type:"button",className:r,onClick:()=>a(e),children:i},e)})}),T=({copy:e})=>{var t;let a=(0,o.useLocation)(),i=(0,o.useNavigate)(),s=(t=a.pathname,e.nav?t.startsWith("/streamer")?e.nav.streamer||[]:t.startsWith("/viewer")?e.nav.viewer||[]:t.startsWith("/guest")?e.nav.guest||[]:e.nav.home||[]:[]),l=((e,t)=>{if(!t||0===t.length)return e;let a=t.find(({route:t})=>t===e);if(a)return a.route;let i=t.find(({route:t})=>"/"!==t&&e.startsWith(t));return i?i.route:e})(a.pathname,s),c=e=>{i(e)};return(0,n.jsxs)("div",{className:"wrapper relative min-h-screen overflow-hidden text-slate-100",children:[(0,n.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-br from-slate-950 via-slate-900 to-sky-950 opacity-95"}),(0,n.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(96,165,250,0.18),_transparent_60%)]"}),(0,n.jsxs)("div",{className:"relative z-10 flex min-h-screen flex-col",children:[(0,n.jsxs)("div",{className:"content flex-1 px-4 pb-16",children:[(0,n.jsx)("div",{className:"row row-disclaimer mx-auto mt-10 w-full max-w-4xl !max-w-4xl !bg-white/10 !p-6 !shadow-2xl border border-white/10 text-center text-sm leading-relaxed text-slate-200 backdrop-blur-xl",children:e.disclaimer.map((t,a)=>(0,n.jsxs)(r.Fragment,{children:[t,a<e.disclaimer.length-1&&(0,n.jsx)("br",{})]},t))}),s.length>0&&(0,n.jsx)("div",{className:"mt-8 flex justify-center md:justify-end",children:(0,n.jsx)(v,{links:s,activeRoute:l,onNavigate:c})}),(0,n.jsx)("div",{className:"mt-10 flex w-full justify-center px-2",children:(0,n.jsx)("div",{className:"forms-container flex w-full max-w-5xl flex-col items-center gap-8",children:(0,n.jsxs)(o.Routes,{children:[(0,n.jsx)(o.Route,{path:"/",element:(0,n.jsx)(b.default,{copy:e,onSelect:c})}),(0,n.jsxs)(o.Route,{path:"/streamer",children:[(0,n.jsx)(o.Route,{index:!0,element:(0,n.jsx)(o.Navigate,{to:"/streamer/login",replace:!0})}),(0,n.jsx)(o.Route,{path:"login",element:(0,n.jsx)(d.default,{copy:e,variant:"streamer"})}),(0,n.jsx)(o.Route,{path:"signup",element:(0,n.jsx)(m.default,{copy:e})}),(0,n.jsx)(o.Route,{path:"forgot",element:(0,n.jsx)(f.default,{copy:e})})]}),(0,n.jsx)(o.Route,{path:"/viewer",element:(0,n.jsx)(S.default,{copy:e})}),(0,n.jsx)(o.Route,{path:"/guest",element:(0,n.jsx)(u.default,{copy:e})}),(0,n.jsx)(o.Route,{path:"*",element:(0,n.jsx)(o.Navigate,{to:"/",replace:!0})})]})})}),(0,n.jsx)("div",{className:"selection-container hidden",children:(0,n.jsxs)("div",{className:"selection-forms-container rounded-3xl border border-white/10 bg-slate-900/80 p-8 shadow-2xl backdrop-blur-xl",children:[(0,n.jsx)("div",{className:"player-selection-form-errors"}),(0,n.jsxs)("form",{name:"player-selector-form",id:"player-selector-form",className:"player-selector-form hidden",action:"#",method:"post",children:[(0,n.jsx)("h3",{className:"form-title text-center text-lg font-semibold text-white",children:(0,n.jsx)("label",{htmlFor:"player-select-element",children:e.playerSelection.selectLabel})}),(0,n.jsx)("div",{className:"input-box player-select-box mt-4",children:(0,n.jsx)("select",{className:"input-box select-element w-full rounded-xl border border-white/15 bg-slate-900/50 px-4 py-3 text-sm text-slate-100 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-500/40",id:"player-select-element",name:"player-select-element"})}),(0,n.jsx)("div",{className:"player-selection-additional-info mt-3 text-sm text-slate-300"}),(0,n.jsxs)("div",{className:"input-box submit-container player-select-submit mt-4 flex items-center justify-end gap-3",children:[(0,n.jsx)("div",{className:"loading-container hidden",children:(0,n.jsx)("img",{src:"./assets/web/loading.gif",alt:e.playerSelection.loadingAlt})}),(0,n.jsx)("input",{type:"submit",value:e.playerSelection.selectSubmit})]})]}),(0,n.jsxs)("form",{name:"player-create-form",id:"player-create-form",className:"player-create-form hidden",action:"#",method:"post",children:[(0,n.jsx)("h3",{className:"form-title text-center text-lg font-semibold text-white",children:e.playerSelection.createTitle}),(0,n.jsxs)("div",{className:"input-box player-create-name mt-4",children:[(0,n.jsx)("label",{htmlFor:"new-player-name",children:e.playerSelection.createNameLabel}),(0,n.jsx)("input",{type:"text",name:"new-player-name",id:"new-player-name",className:"required",required:!0})]}),(0,n.jsx)("div",{className:"player-creation-additional-info mt-3 text-sm text-slate-300"}),(0,n.jsxs)("div",{className:"input-box submit-container player-create-submit mt-4 flex items-center justify-end gap-3",children:[(0,n.jsx)("div",{className:"loading-container hidden",children:(0,n.jsx)("img",{src:"./assets/web/loading.gif",alt:e.playerSelection.loadingAlt})}),(0,n.jsx)("input",{type:"submit",value:e.playerSelection.createSubmit})]}),(0,n.jsx)("div",{className:"input-box response-error"})]})]})}),(0,n.jsx)("div",{className:"game-container hidden",children:(0,n.jsx)("div",{id:"reldens"})})]}),(0,n.jsx)("div",{className:"footer mt-auto bg-slate-950/80 py-6 text-center text-sm text-slate-300 backdrop-blur",children:(0,n.jsx)("div",{className:"copyright",children:(0,n.jsxs)("a",{className:"hover:text-white hover:underline",href:"https://www.dwdeveloper.com/",children:["by D",(0,n.jsx)("span",{className:"text-black text-lowercase",children:"w"}),(0,n.jsx)("span",{className:"text-capitalize",children:"Developer"})]})})})]})]})};a.default=({reldens:e})=>{let t="undefined"!=typeof document&&document.documentElement.lang||"en",a=l.translations[t]?t:"en",i=l.translations[a];return(0,r.useEffect)(()=>{e&&"function"==typeof e.clientStart&&e.clientStart()},[e]),(0,n.jsx)(o.BrowserRouter,{children:(0,n.jsx)(T,{copy:i})})}},{"react/jsx-runtime":"react/jsx-runtime",react:"react","react-router-dom":"react-router-dom","./translations.js":"5SqbI","./pages/LoginPage.jsx":"j4JXj","./pages/SignupPage.jsx":"3R0Oi","./pages/GuestPage.jsx":"bHyaL","./pages/ForgotPasswordPage.jsx":"7Dw7O","./pages/RoleSelectionPage.jsx":"j8ZD5","./pages/ViewerPage.jsx":"aKYT5","@parcel/transformer-js/src/esmodule-helpers.js":"3cktO"}],"5SqbI":[function(e,t,a,i){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(a),s.export(a,"translations",()=>n);let n={en:{nav:{home:[],streamer:[{route:"/",label:"Choose role"},{route:"/streamer/login",label:"Login"},{route:"/streamer/signup",label:"Create account"},{route:"/streamer/forgot",label:"Forgot password"}],viewer:[{route:"/",label:"Back to role selection"}],guest:[{route:"/",label:"Back to role selection"}]},disclaimer:["Disclaimer: Reldens is not just a game, is a platform to create games.","This is a demo to show how many features are available on the platform."],roles:{title:"Pick your role",subtitle:"Choose how you want to step into the world of Reldens.",note:"Blockchain interactions are work in progress. Donations are simulated for now.",cards:[{key:"streamer",route:"/streamer/login",title:"Streamer",icon:"S",description:"Broadcast your adventure and receive viewer-triggered buffs or events.",highlights:["Link your YouTube channel to auto-start streaming on login.","Viewers can spend SOL to empower you or unleash challenges.","Access full account progression and management tools."],action:"I am a streamer"},{key:"viewer",route:"/viewer",title:"Viewer",icon:"V",description:"Support your favourite streamer and influence the match in real time.",highlights:["Connect a SOL wallet (demo) through ethers.js.","Trigger buffs or spawn enemies with curated donation options.","Hang out inside the browser player while the action happens."],action:"Enter as viewer"},{key:"guest",route:"/guest",title:"Guest",icon:"G",description:"Jump into the demo map without creating an account or wallet.",highlights:["Create a temporary hero and explore instantly.","Test skills, combat and movement as they are today.","You can upgrade to a full account later without hassle."],action:"Play as guest"}],emptyState:"Roles are loading. Please try again in a moment."},guest:{title:"Play as a Guest",usernameLabel:"Username",submit:"Play",loadingAlt:"Loading..."},register:{title:"Create Account",emailLabel:"Email",usernameLabel:"Username",passwordLabel:"Password",rePasswordLabel:"Re-type password",termsLink:"Accept our Terms and Conditions (click here).",submit:"Register",loadingAlt:"Loading..."},login:{title:"Login",usernameLabel:"Username",passwordLabel:"Password",submit:"Submit",loadingAlt:"Loading..."},streamer:{loginTitle:"Streamer login",loginSubtitle:"Sign in and sync your broadcast tools to go live instantly.",youtube:{heading:"Link your YouTube channel",description:"Provide your channel URL and primary stream key so we can auto-start your broadcast whenever you join the server.",fields:{channelLabel:"Channel URL",streamKeyLabel:"Stream key",autoStartLabel:"Auto-start streaming on login"},linkCta:"Link YouTube",unlinkCta:"Disconnect",connected:"Channel linked. Streaming will start automatically when you enter the world.",disconnected:"Channel disconnected. Auto streaming disabled.",helper:"Your stream key stays in this device only. We do not upload it to our servers.",learnMore:"https://support.google.com/youtube/answer/2474026",learnMoreLabel:"YouTube live help",steps:["Make sure live streaming is enabled on your YouTube studio.","Use the same primary stream key you configured in your encoder.","Keep this browser tab open while broadcasting to maintain the link."],status:{idle:"Not linked yet",linked:"Connected"}}},forgot:{title:"Forgot password",emailLabel:"Email",submit:"Request",loadingAlt:"Loading..."},firebase:{title:"Firebase Registration",usernameLabel:"Username",loadingAlt:"Loading..."},terms:{heading:"Terms and conditions",acceptLabel:"I agree to these Terms and Conditions"},instructions:{heading:"Instructions",steps:["Move with the arrows or using W-A-S-D.","Use left click to follow a path but for now to change to another scene you need to walk through the change point (like the bridge at the top, or the houses doors).","Use right-click or TAB to target near enemies or players.","You must have a target to execute a skill/action.","Use the screen-buttons to activate the different player skills/actions."]},gameOver:["You died!","Just wait...","You will be automatically revived for this demo!"],viewer:{title:"Support a streamer",subtitle:"Pick a channel, watch the show and use SOL donations to influence the battle.",note:"Blockchain integration is coming soon. This flow is a UI prototype.",wallet:{title:"Your wallet",description:"Connect a SOL-compatible wallet through ethers.js to simulate donations.",connectCta:"Connect wallet",disconnectCta:"Disconnect",connected:"Wallet connected. You can pledge SOL donations.",disconnected:"Wallet disconnected.",noProvider:"No Web3 wallet detected. Install Phantom or MetaMask and try again.",error:"Failed to connect the wallet. Please retry.",connectPrompt:"Connect your wallet first to unlock donation options.",status:{idle:"Status: disconnected",connecting:"Status: connecting...",connected:"Status: connected",error:"Status: error"},labels:{address:"Wallet address",network:"Network",balance:"Balance"}},viewerCountLabel:"{count} live viewers",streamListTitle:"Live channels",donations:{buffTitle:"Buff donations",eventTitle:"Event donations",donateCta:"Donate {amount} SOL",requiresWallet:"Connect your wallet to unlock donation actions.",success:"Donation for {option} in {streamer} registered. It will trigger once {amount} SOL arrives.",buffOptions:[{id:"atk-boost",label:"Sunlance Surge",description:"Increase damage by 25% for 3 minutes.",amount:"1"},{id:"heal-pulse",label:"Guardian Pulse",description:"Restore 40% HP and add a protective shield.",amount:"1.5"},{id:"speed",label:"Windwalker Veil",description:"Boost movement speed by 35% for 2 minutes.",amount:"0.8"}],eventOptions:[{id:"spawn-elites",label:"Elite Ambush",description:"Spawn three elite monsters around the streamer.",amount:"2"},{id:"map-swap",label:"Portal Roulette",description:"Teleport the party to a random map.",amount:"3"},{id:"boss-challenge",label:"World Boss Call",description:"Summon a roaming boss with rare loot.",amount:"4.5"}]},streamers:[{id:"luna-fox",name:"LunaFox",activity:"Pushing nightfall raids with guildmates.",viewers:842,tags:["PvE","Speedrun"]},{id:"ember-knight",name:"EmberKnight",activity:"Arena duels and build theorycrafting.",viewers:613,tags:["PvP","Builds"]},{id:"nova-mage",name:"NovaMage",activity:"Triggering chaos events on demand.",viewers:455,tags:["Events","Co-op"]}]},playerSelection:{selectLabel:"Select Player",selectSubmit:"Start",createTitle:"Create Player",createNameLabel:"Player Name",createSubmit:"Create & Start",loadingAlt:"Loading..."},playerCreation:{loadingAlt:"Loading..."},footer:"by DwDeveloper"},es:{nav:{home:[],streamer:[{route:"/",label:"Elegir rol"},{route:"/streamer/login",label:"Iniciar sesion"},{route:"/streamer/signup",label:"Crear cuenta"},{route:"/streamer/forgot",label:"Recuperar clave"}],viewer:[{route:"/",label:"Volver a roles"}],guest:[{route:"/",label:"Volver a roles"}]},disclaimer:["Descargo: Reldens no es solo un juego, es una plataforma para crear juegos.","Esta es una demostracion para mostrar cuantas funciones estan disponibles en la plataforma."],roles:{title:"Elige tu rol",subtitle:"Decide como quieres entrar al mundo de Reldens.",note:"La integracion blockchain esta en desarrollo. Las donaciones son una simulacion.",cards:[{key:"streamer",route:"/streamer/login",title:"Streamer",icon:"S",description:"Transmite tu aventura y recibe mejoras o eventos activados por la comunidad.",highlights:["Vincula tu canal de YouTube y comienza directo al iniciar sesion.","Los espectadores gastan SOL para darte buffs o invocar desafios.","Gestiona tu cuenta completa y el progreso de tus personajes."],action:"Soy streamer"},{key:"viewer",route:"/viewer",title:"Espectador",icon:"V",description:"Apoya a tu streamer favorito e influye en la partida en tiempo real.",highlights:["Conecta una billetera SOL (demo) usando ethers.js.","Lanza buffs o genera enemigos con opciones de donacion.","Mira la accion directamente desde el navegador."],action:"Entrar como espectador"},{key:"guest",route:"/guest",title:"Invitado",icon:"G",description:"Prueba el mapa demo sin crear cuenta ni billetera.",highlights:["Crea un heroe temporal y juega al instante.","Experimenta las habilidades y el combate actual.","Mas adelante puedes pasar a cuenta completa sin perder progreso."],action:"Jugar como invitado"}],emptyState:"Roles en carga. Intenta nuevamente en unos segundos."},guest:{title:"Jugar como invitado",usernameLabel:"Nombre de usuario",submit:"Jugar",loadingAlt:"Cargando..."},register:{title:"Crear Cuenta",emailLabel:"Email",usernameLabel:"Nombre de Usuario",passwordLabel:"Contrasena",rePasswordLabel:"Reescribir contrasena",termsLink:"Aceptar nuestros Terminos y Condiciones (click aqui).",submit:"Registrarse",loadingAlt:"Cargando..."},login:{title:"Login",usernameLabel:"Nombre de Usuario",passwordLabel:"Password",submit:"Entrar",loadingAlt:"Cargando..."},streamer:{loginTitle:"Login de streamer",loginSubtitle:"Inicia sesion y sincroniza tus herramientas de transmision.",youtube:{heading:"Vincula tu canal de YouTube",description:"Ingresa la URL y la clave de transmision para iniciar directo automaticamente cuando entres al servidor.",fields:{channelLabel:"URL del canal",streamKeyLabel:"Clave de transmision",autoStartLabel:"Iniciar directo automaticamente al ingresar"},linkCta:"Vincular YouTube",unlinkCta:"Desconectar",connected:"Canal vinculado. El directo se iniciara automaticamente al ingresar.",disconnected:"Canal desconectado. Auto transmision deshabilitada.",helper:"La clave de transmision queda guardada solo en este dispositivo.",learnMore:"https://support.google.com/youtube/answer/2474026",learnMoreLabel:"Ayuda YouTube Live",steps:["Verifica que tengas habilitadas las transmisiones en YouTube Studio.","Usa la misma clave primaria configurada en tu codificador.","Mantene abierta esta pestaña mientras transmitis para mantener el enlace."],status:{idle:"Sin vincular",linked:"Conectado"}}},forgot:{title:"Olvide mi contrasena",emailLabel:"Email",submit:"Solicitar",loadingAlt:"Cargando..."},firebase:{title:"Firebase Login",usernameLabel:"Usuario",loadingAlt:"Cargando..."},terms:{heading:"Terminos y Condiciones",acceptLabel:"Acepto estos Terminos y Condiciones"},instructions:{heading:"Instrucciones",steps:["Move con las flechas o usando W-A-S-D.","Utiliza clic izquierdo para seguir un camino; para cambiar de escena debes cruzar el punto de cambio.","Utiliza clic derecho o TAB para apuntar a enemigos o jugadores cercanos.","Debes tener un objetivo para ejecutar habilidades.","Utiliza los botones en pantalla para activar las habilidades del personaje."]},gameOver:["Moriste!","Solo espera...","Seras revivido automaticamente para esta demo!"],viewer:{title:"Apoya a un streamer",subtitle:"Elige un canal, mira la partida y usa donaciones SOL para influir en la pelea.",note:"La integracion blockchain llegara pronto. Esta seccion es un prototipo.",wallet:{title:"Tu billetera",description:"Conecta una billetera compatible con SOL mediante ethers.js para simular donaciones.",connectCta:"Conectar billetera",disconnectCta:"Desconectar",connected:"Billetera conectada. Ya puedes prometer donaciones SOL.",disconnected:"Billetera desconectada.",noProvider:"No se detecto una billetera Web3. Instala Phantom o MetaMask.",error:"No se pudo conectar la billetera. Intenta nuevamente.",connectPrompt:"Conecta tu billetera para habilitar las donaciones.",status:{idle:"Estado: desconectado",connecting:"Estado: conectando...",connected:"Estado: conectado",error:"Estado: error"},labels:{address:"Direccion",network:"Red",balance:"Balance"}},viewerCountLabel:"{count} espectadores",streamListTitle:"Canales en vivo",donations:{buffTitle:"Donaciones buff",eventTitle:"Donaciones evento",donateCta:"Donar {amount} SOL",requiresWallet:"Conecta tu billetera para activar las donaciones.",success:"Se registro la donacion {option} para {streamer}. Se ejecutara al recibir {amount} SOL.",buffOptions:[{id:"atk-boost",label:"Impulso Solar",description:"Aumenta el dano 25% por 3 minutos.",amount:"1"},{id:"heal-pulse",label:"Pulso Guardián",description:"Recupera 40% de vida y agrega escudo.",amount:"1.5"},{id:"speed",label:"Velocidad del Viento",description:"Sube la velocidad 35% por 2 minutos.",amount:"0.8"}],eventOptions:[{id:"spawn-elites",label:"Emboscada Elite",description:"Invoca tres elites cerca del streamer.",amount:"2"},{id:"map-swap",label:"Portal Aleatorio",description:"Teletransporta al grupo a un mapa aleatorio.",amount:"3"},{id:"boss-challenge",label:"Llamado del Jefe",description:"Invoca un jefe errante con botin raro.",amount:"4.5"}]},streamers:[{id:"luna-fox",name:"LunaFox",activity:"Progresando incursiones nocturnas con la hermandad.",viewers:842,tags:["PvE","Speedrun"]},{id:"ember-knight",name:"EmberKnight",activity:"Duelos de arena y teoria de builds.",viewers:613,tags:["PvP","Builds"]},{id:"nova-mage",name:"NovaMage",activity:"Desatando eventos de caos a pedido.",viewers:455,tags:["Eventos","Co-op"]}]},playerSelection:{selectLabel:"Seleccionar Personaje",selectSubmit:"Iniciar",createTitle:"Crear Personaje",createNameLabel:"Nombre",createSubmit:"Crear y comenzar",loadingAlt:"Cargando..."},playerCreation:{loadingAlt:"Cargando..."},footer:"by DwDeveloper"},vi:{nav:{home:[],streamer:[{route:"/",label:"Chon vai tro"},{route:"/streamer/login",label:"Dang nhap"},{route:"/streamer/signup",label:"Dang ky"},{route:"/streamer/forgot",label:"Quen mat khau"}],viewer:[{route:"/",label:"Quay lai chon vai tro"}],guest:[{route:"/",label:"Quay lai chon vai tro"}]},disclaimer:["Luu y: Reldens khong chi la mot tro choi, day la nen tang de tao game.","Ban demo nay giup ban kham pha so luong tinh nang hien co tren nen tang."],roles:{title:"Chon vai tro cua ban",subtitle:"Quyet dinh cach ban buoc vao the gioi Reldens.",note:"Tinh nang blockchain dang phat trien. Donates hien chi la mo phong.",cards:[{key:"streamer",route:"/streamer/login",title:"Streamer",icon:"S",description:"Phat truc tiep hanh trinh cua ban va nhan buff tu nguoi xem.",highlights:["Lien ket kenh YouTube de tu dong phat khi dang nhap.","Nguoi xem dung SOL de tang suc manh hoac tao su kien.","Quan ly tai khoan va tien trinh day du."],action:"Toi la streamer"},{key:"viewer",route:"/viewer",title:"Viewer",icon:"V",description:"Theo doi streamer va tac dong tran dau bang donate SOL.",highlights:["Ket noi vi SOL (demo) thong qua ethers.js.","Chon buff hoac su kien tu danh sach goi y.","Xem truc tiep ngay tren trinh duyet."],action:"Vao voi tu cach viewer"},{key:"guest",route:"/guest",title:"Guest",icon:"G",description:"Choi thu ban demo ma khong can tai khoan hay vi.",highlights:["Tao nhan vat tam thoi va vao game ngay.","Thu nghiem he thong chien dau va ky nang.","Co the nang cap len tai khoan day du sau nay."],action:"Choi che do khach"}],emptyState:"Dang tai danh sach vai tro. Vui long cho giay lat."},guest:{title:"Choi voi tu cach Khach",usernameLabel:"Ten nguoi choi",submit:"Bat dau",loadingAlt:"Dang tai..."},register:{title:"Tao tai khoan",emailLabel:"Email",usernameLabel:"Ten nguoi dung",passwordLabel:"Mat khau",rePasswordLabel:"Nhap lai mat khau",termsLink:"Dong y Dieu khoan va Dieu kien (bam vao day).",submit:"Dang ky",loadingAlt:"Dang tai..."},login:{title:"Dang nhap",usernameLabel:"Ten nguoi dung",passwordLabel:"Mat khau",submit:"Xac nhan",loadingAlt:"Dang tai..."},streamer:{loginTitle:"Dang nhap streamer",loginSubtitle:"Dang nhap va dong bo cong cu stream cua ban.",youtube:{heading:"Lien ket kenh YouTube",description:"Nhap URL kenh va stream key de chung toi tu dong bat live khi ban vao game.",fields:{channelLabel:"URL kenh",streamKeyLabel:"Stream key",autoStartLabel:"Tu dong bat stream khi dang nhap"},linkCta:"Lien ket YouTube",unlinkCta:"Ngat ket noi",connected:"Da lien ket kenh. Stream se bat khi ban vao the gioi.",disconnected:"Da huy lien ket. Tu dong stream bi tat.",helper:"Stream key chi duoc luu tren thiet bi nay, khong gui len server.",learnMore:"https://support.google.com/youtube/answer/2474026",learnMoreLabel:"Huong dan YouTube Live",steps:["Kiem tra tai khoan YouTube da bat che do Live.","Su dung stream key giong trong phan mem ma ban cau hinh.","Giu tab nay mo trong luc phat truc tiep de duy tri ket noi."],status:{idle:"Chua lien ket",linked:"Da ket noi"}}},forgot:{title:"Quen mat khau",emailLabel:"Email",submit:"Gui yeu cau",loadingAlt:"Dang tai..."},firebase:{title:"Dang ky qua Firebase",usernameLabel:"Ten nguoi dung",loadingAlt:"Dang tai..."},terms:{heading:"Dieu khoan va Dieu kien",acceptLabel:"Toi dong y voi Dieu khoan nay"},instructions:{heading:"Huong dan",steps:["Di chuyen bang phim mui ten hoac W-A-S-D.","Click chuot trai de di chuyen, di qua diem chuyen map de sang canh khac.","Click chuot phai hoac TAB de chon muc tieu gan.","Can co muc tieu truoc khi tung ky nang.","Dung cac nut tren man hinh de kich hoat ky nang."]},gameOver:["Ban da nga guc!","Hay cho trong giay lat...","Ban se duoc hoi sinh tu dong trong ban demo nay!"],viewer:{title:"Ho tro streamer",subtitle:"Chon kenh, theo doi va dung SOL de tac dong tran dau.",note:"Tinh nang blockchain se som ra mat. Day la giao dien thu nghiem.",wallet:{title:"Vi cua ban",description:"Ket noi vi tuong thich SOL thong qua ethers.js de mo phong donate.",connectCta:"Ket noi vi",disconnectCta:"Ngat ket noi",connected:"Da ket noi vi. Ban co the donate SOL.",disconnected:"Da ngat ket noi vi.",noProvider:"Khong tim thay vi Web3. Hay cai dat Phantom hoac MetaMask.",error:"Khong the ket noi vi. Vui long thu lai.",connectPrompt:"Hay ket noi vi truoc khi donate.",status:{idle:"Trang thai: chua ket noi",connecting:"Trang thai: dang ket noi...",connected:"Trang thai: da ket noi",error:"Trang thai: loi"},labels:{address:"Dia chi vi",network:"Mang",balance:"So du"}},viewerCountLabel:"{count} nguoi dang xem",streamListTitle:"Kenh dang truc tiep",donations:{buffTitle:"Donate buff",eventTitle:"Donate su kien",donateCta:"Donate {amount} SOL",requiresWallet:"Ket noi vi de mo khoa tinh nang donate.",success:"Da ghi nhan goi {option} cho {streamer}. Se kich hoat khi nhan {amount} SOL.",buffOptions:[{id:"atk-boost",label:"Suc manh Mat Troi",description:"Tang sat thuong 25% trong 3 phut.",amount:"1"},{id:"heal-pulse",label:"Xung Ho Ve",description:"Hoi 40% HP va nhan la chan bao ve.",amount:"1.5"},{id:"speed",label:"Cuon Gio",description:"Tang toc do di chuyen 35% trong 2 phut.",amount:"0.8"}],eventOptions:[{id:"spawn-elites",label:"Phuc kich Tinh Anh",description:"Trieu hoi 3 quai tinh anh gan streamer.",amount:"2"},{id:"map-swap",label:"Cong Dich Chuyen",description:"Dua to doi den mot ban do ngau nhien.",amount:"3"},{id:"boss-challenge",label:"Keu goi Tru Boss",description:"Trieu hoi boss lang thang voi nhieu vat pham hiem.",amount:"4.5"}]},streamers:[{id:"luna-fox",name:"LunaFox",activity:"Chinh phuc raid dem cung bang hoi.",viewers:842,tags:["PvE","Speedrun"]},{id:"ember-knight",name:"EmberKnight",activity:"Dau tay doi va phan tich build.",viewers:613,tags:["PvP","Builds"]},{id:"nova-mage",name:"NovaMage",activity:"Gay hon loan voi cac su kien dot xuat.",viewers:455,tags:["Events","Co-op"]}]},playerSelection:{selectLabel:"Chon nhan vat",selectSubmit:"Bat dau",createTitle:"Tao nhan vat",createNameLabel:"Ten nhan vat",createSubmit:"Tao va choi",loadingAlt:"Dang tai..."},playerCreation:{loadingAlt:"Dang tai..."},footer:"by DwDeveloper"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"3cktO"}],"3cktO":[function(e,t,a,i){a.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},a.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.exportAll=function(e,t){return Object.keys(e).forEach(function(a){"default"===a||"__esModule"===a||Object.prototype.hasOwnProperty.call(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:function(){return e[a]}})}),t},a.export=function(e,t,a){Object.defineProperty(e,t,{enumerable:!0,get:a})}},{}],j4JXj:[function(e,t,a,i){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(a);var n=e("react/jsx-runtime"),r=e("react");s.interopDefault(r),a.default=({copy:e,variant:t="default"})=>{let a="text-sm font-semibold text-slate-200 md:w-40",i="required w-full rounded-xl border border-white/15 bg-slate-900/60 px-4 py-3 text-sm text-slate-100 placeholder-slate-400 transition focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-500/40",s="streamer"===t,o=e.streamer||{},l=o.youtube||{},c=s&&Object.keys(l).length>0,d=s&&o.loginTitle?o.loginTitle:e.login.title,h=s?o.loginSubtitle:null,[m,g]=(0,r.useState)("idle"),[u,p]=(0,r.useState)(""),f=(0,r.useMemo)(()=>c&&(l.status?.[m]||l.status?.idle)||"",[c,l.status,m]),y="linked"===m?"inline-flex items-center rounded-full border border-emerald-400/60 bg-emerald-500/20 px-3 py-1 text-xs font-semibold text-emerald-200":"inline-flex items-center rounded-full border border-white/20 bg-white/10 px-3 py-1 text-xs font-semibold text-slate-200",b="linked"===m?l.unlinkCta||"Disconnect":l.linkCta||"Link YouTube";return(0,n.jsx)("div",{className:"row row-1 w-full !max-w-none !bg-transparent !p-0 !shadow-none",children:(0,n.jsxs)("div",{className:"grid w-full gap-6 xl:grid-cols-[1.05fr,_0.95fr]",children:[(0,n.jsxs)("form",{name:"login-form",id:"login-form",className:"login-form space-y-5 rounded-2xl border border-white/10 bg-slate-900/60 p-6 shadow-xl backdrop-blur",action:"#",method:"post",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("h3",{className:"form-title text-left text-2xl font-semibold text-white",children:d}),h&&(0,n.jsx)("p",{className:"text-sm text-slate-300",children:h})]}),(0,n.jsxs)("div",{className:"input-box login-username flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,n.jsx)("label",{htmlFor:"username",className:a,children:e.login.usernameLabel}),(0,n.jsx)("input",{type:"text",name:"username",id:"username",className:i,required:!0,autoComplete:"on"})]}),(0,n.jsxs)("div",{className:"input-box login-password flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,n.jsx)("label",{htmlFor:"password",className:a,children:e.login.passwordLabel}),(0,n.jsx)("input",{type:"password",name:"password",id:"password",className:i,required:!0})]}),(0,n.jsxs)("div",{className:"input-box submit-container login-submit flex items-center justify-end gap-3",children:[(0,n.jsx)("div",{className:"loading-container hidden",children:(0,n.jsx)("img",{src:"./assets/web/loading.gif",alt:e.login.loadingAlt})}),(0,n.jsx)("input",{type:"submit",value:e.login.submit,className:"rounded-full bg-sky-500 px-6 py-2 font-semibold text-white shadow-lg shadow-sky-500/30 transition hover:bg-sky-400"})]}),(0,n.jsx)("div",{className:"input-box response-error text-sm text-rose-400"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[c&&(0,n.jsxs)("section",{className:"space-y-5 rounded-2xl border border-white/10 bg-slate-900/60 p-6 shadow-xl backdrop-blur",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-white",children:l.heading}),f&&(0,n.jsx)("span",{className:y,children:f})]}),l.description&&(0,n.jsx)("p",{className:"text-sm text-slate-300",children:l.description})]}),(0,n.jsxs)("form",{className:"space-y-4",onSubmit:e=>{if(e.preventDefault(),c){if("linked"===m){g("idle"),p(l.disconnected||"YouTube channel disconnected.");return}g("linked"),p(l.connected||"YouTube channel linked. Streaming will auto-start.")}},children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2 text-sm text-slate-200",children:[(0,n.jsx)("label",{htmlFor:"youtube-channel",className:"font-semibold",children:l.fields?.channelLabel}),(0,n.jsx)("input",{type:"url",id:"youtube-channel",name:"youtube-channel",className:i,placeholder:"https://youtube.com/@your-channel",required:!0})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 text-sm text-slate-200",children:[(0,n.jsx)("label",{htmlFor:"youtube-stream-key",className:"font-semibold",children:l.fields?.streamKeyLabel}),(0,n.jsx)("input",{type:"text",id:"youtube-stream-key",name:"youtube-stream-key",className:i,placeholder:"STREAM-XXXX-YYYY-ZZZZ",required:!0})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-200",children:[(0,n.jsx)("input",{type:"checkbox",id:"youtube-auto-start",name:"youtube-auto-start",className:"h-4 w-4 rounded border-white/30 bg-slate-900/70 text-sky-500 focus:ring-sky-500/50",defaultChecked:!0}),(0,n.jsx)("label",{htmlFor:"youtube-auto-start",className:"cursor-pointer select-none",children:l.fields?.autoStartLabel})]}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsx)("button",{type:"submit",className:"inline-flex items-center justify-center rounded-full bg-rose-500 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-rose-500/30 transition hover:bg-rose-400",children:b}),l.learnMore&&(0,n.jsx)("a",{className:"text-xs font-semibold uppercase tracking-wide text-slate-300 hover:text-white hover:underline",href:l.learnMore,target:"_blank",rel:"noreferrer",children:l.learnMoreLabel||"Docs"})]})]}),Array.isArray(l.steps)&&l.steps.length>0&&(0,n.jsx)("ul",{className:"space-y-2 text-xs text-slate-400",children:l.steps.map(e=>(0,n.jsxs)("li",{className:"flex items-start gap-2",children:[(0,n.jsx)("span",{className:"mt-1 inline-block h-2 w-2 rounded-full bg-rose-400"}),(0,n.jsx)("span",{children:e})]},e))}),u&&(0,n.jsx)("div",{className:"rounded-2xl border border-sky-400/40 bg-sky-500/10 p-3 text-xs text-sky-100",children:u}),l.helper&&(0,n.jsx)("p",{className:"text-xs text-slate-400",children:l.helper})]}),(0,n.jsxs)("div",{className:"row row-2 firebase-row-container hidden !max-w-none !bg-slate-900/60 !p-6 !shadow-xl space-y-4 rounded-2xl border border-white/10 backdrop-blur",children:[(0,n.jsxs)("form",{name:"firebase-login",id:"firebase-login",className:"firebase-login space-y-4",action:"#",method:"post",children:[(0,n.jsx)("h3",{className:"form-title text-xl font-semibold text-white",children:e.firebase.title}),(0,n.jsxs)("div",{className:"input-box firebase-username flex flex-col gap-2 text-sm text-slate-200",children:[(0,n.jsx)("label",{htmlFor:"firebase-username",className:"font-semibold",children:e.firebase.usernameLabel}),(0,n.jsx)("input",{type:"text",name:"firebase-username",id:"firebase-username",className:i,required:!0})]}),(0,n.jsx)("div",{className:"input-box response-error text-sm text-rose-400"})]}),(0,n.jsx)("div",{className:"firebase-container flex flex-1 items-center justify-center rounded-xl border border-dashed border-white/20 bg-slate-900/30 p-4",children:(0,n.jsx)("div",{id:"firebaseui-auth-container",className:"w-full"})})]})]})]})})}},{"react/jsx-runtime":"react/jsx-runtime",react:"react","@parcel/transformer-js/src/esmodule-helpers.js":"3cktO"}],"3R0Oi":[function(e,t,a,i){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(a);var n=e("react/jsx-runtime"),r=e("react");s.interopDefault(r),a.default=({copy:e})=>{let t="text-sm font-semibold text-slate-200 md:w-44",a="required w-full rounded-xl border border-white/15 bg-slate-900/60 px-4 py-3 text-sm text-slate-100 placeholder-slate-400 transition focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-500/40";return(0,n.jsx)("div",{className:"row row-1 w-full !max-w-none !bg-transparent !p-0 !shadow-none",children:(0,n.jsxs)("form",{name:"register-form",id:"register-form",className:"register-form mx-auto w-full max-w-3xl space-y-5 rounded-2xl border border-white/10 bg-slate-900/60 p-6 shadow-xl backdrop-blur",action:"#",method:"post",children:[(0,n.jsx)("h3",{className:"form-title text-left text-2xl font-semibold text-white",children:e.register.title}),(0,n.jsxs)("div",{className:"input-box reg-email flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,n.jsx)("label",{htmlFor:"reg-email",className:t,children:e.register.emailLabel}),(0,n.jsx)("input",{type:"email",name:"reg-email",id:"reg-email",className:a,required:!0})]}),(0,n.jsxs)("div",{className:"input-box reg-username flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,n.jsx)("label",{htmlFor:"reg-username",className:t,children:e.register.usernameLabel}),(0,n.jsx)("input",{type:"text",name:"reg-username",id:"reg-username",className:a,required:!0})]}),(0,n.jsxs)("div",{className:"input-box reg-password flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,n.jsx)("label",{htmlFor:"reg-password",className:t,children:e.register.passwordLabel}),(0,n.jsx)("input",{type:"password",name:"reg-password",id:"reg-password",className:a,required:!0})]}),(0,n.jsxs)("div",{className:"input-box reg-re-password flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,n.jsx)("label",{htmlFor:"reg-re-password",className:t,children:e.register.rePasswordLabel}),(0,n.jsx)("input",{type:"password",name:"reg-re-password",id:"reg-re-password",className:a,required:!0})]}),(0,n.jsx)("div",{className:"input-box hidden terms-and-conditions-link-container justify-end",children:(0,n.jsx)("p",{className:"terms-and-conditions-link cursor-pointer text-sm text-slate-300 underline",children:e.register.termsLink})}),(0,n.jsxs)("div",{className:"input-box submit-container reg-submit flex items-center justify-end gap-3",children:[(0,n.jsx)("div",{className:"loading-container hidden",children:(0,n.jsx)("img",{src:"./assets/web/loading.gif",alt:e.register.loadingAlt})}),(0,n.jsx)("input",{type:"submit",value:e.register.submit,className:"rounded-full bg-sky-500 px-6 py-2 font-semibold text-white shadow-lg shadow-sky-500/30 transition hover:bg-sky-400"})]}),(0,n.jsx)("div",{className:"input-box response-error text-sm text-rose-400"})]})})}},{"react/jsx-runtime":"react/jsx-runtime",react:"react","@parcel/transformer-js/src/esmodule-helpers.js":"3cktO"}],bHyaL:[function(e,t,a,i){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(a);var n=e("react/jsx-runtime"),r=e("react");s.interopDefault(r),a.default=({copy:e})=>(0,n.jsx)("div",{className:"row row-0 w-full !max-w-xl !bg-transparent !p-0 !shadow-none",children:(0,n.jsxs)("form",{name:"guest-form",id:"guest-form",className:"guest-form w-full space-y-5 rounded-2xl border border-white/10 bg-slate-900/60 p-6 shadow-xl backdrop-blur",action:"#",method:"post",children:[(0,n.jsx)("h3",{className:"form-title text-center text-2xl font-semibold text-white md:text-left",children:e.guest.title}),(0,n.jsxs)("div",{className:"input-box guest-username flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,n.jsx)("label",{htmlFor:"guest-username",className:"text-sm font-semibold text-slate-200 md:w-48",children:e.guest.usernameLabel}),(0,n.jsx)("input",{type:"text",name:"guest-username",id:"guest-username",className:"required w-full rounded-xl border border-white/15 bg-slate-900/60 px-4 py-3 text-sm text-slate-100 placeholder-slate-400 transition focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-500/40",required:!0})]}),(0,n.jsxs)("div",{className:"input-box submit-container guest-submit flex items-center justify-center gap-3 md:justify-end",children:[(0,n.jsx)("div",{className:"loading-container hidden",children:(0,n.jsx)("img",{src:"./assets/web/loading.gif",alt:e.guest.loadingAlt})}),(0,n.jsx)("input",{type:"submit",value:e.guest.submit,className:"rounded-full bg-sky-500 px-6 py-2 font-semibold text-white shadow-lg shadow-sky-500/30 transition hover:bg-sky-400"})]}),(0,n.jsx)("div",{className:"input-box response-error text-sm text-rose-400"})]})})},{"react/jsx-runtime":"react/jsx-runtime",react:"react","@parcel/transformer-js/src/esmodule-helpers.js":"3cktO"}],"7Dw7O":[function(e,t,a,i){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(a);var n=e("react/jsx-runtime"),r=e("react");s.interopDefault(r),a.default=({copy:e})=>(0,n.jsx)("div",{className:"row row-2 forgot-password-container w-full !max-w-xl !bg-transparent !p-0 !shadow-none",children:(0,n.jsxs)("form",{name:"forgot-form",id:"forgot-form",className:"forgot-form w-full space-y-5 rounded-2xl border border-white/10 bg-slate-900/60 p-6 shadow-xl backdrop-blur",action:"#",method:"post",children:[(0,n.jsx)("h3",{className:"form-title text-center text-2xl font-semibold text-white md:text-left",children:e.forgot.title}),(0,n.jsxs)("div",{className:"input-box forgot-email flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,n.jsx)("label",{htmlFor:"forgot-email",className:"text-sm font-semibold text-slate-200 md:w-44",children:e.forgot.emailLabel}),(0,n.jsx)("input",{type:"email",name:"forgot-email",id:"forgot-email",className:"required w-full rounded-xl border border-white/15 bg-slate-900/60 px-4 py-3 text-sm text-slate-100 placeholder-slate-400 transition focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-500/40",required:!0})]}),(0,n.jsxs)("div",{className:"input-box submit-container forgot-submit flex items-center justify-end gap-3",children:[(0,n.jsx)("div",{className:"loading-container hidden",children:(0,n.jsx)("img",{src:"./assets/web/loading.gif",alt:e.forgot.loadingAlt})}),(0,n.jsx)("input",{type:"submit",value:e.forgot.submit,className:"rounded-full bg-sky-500 px-6 py-2 font-semibold text-white shadow-lg shadow-sky-500/30 transition hover:bg-sky-400"})]}),(0,n.jsx)("div",{className:"input-box response-error text-sm text-rose-400"})]})})},{"react/jsx-runtime":"react/jsx-runtime",react:"react","@parcel/transformer-js/src/esmodule-helpers.js":"3cktO"}],j8ZD5:[function(e,t,a,i){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(a);var n=e("react/jsx-runtime"),r=e("react");s.interopDefault(r),a.default=({copy:e,onSelect:t})=>{let a=e?.roles||{},i=Array.isArray(a.cards)?a.cards:[];return(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsxs)("header",{className:"mx-auto max-w-3xl text-center",children:[(0,n.jsx)("h2",{className:"text-3xl font-semibold text-white md:text-4xl",children:a.title}),a.subtitle&&(0,n.jsx)("p",{className:"mt-3 text-sm text-slate-300 md:text-base",children:a.subtitle})]}),(0,n.jsx)("div",{className:"mt-10 grid w-full gap-6 lg:grid-cols-3",children:i.length>0?i.map(e=>(0,n.jsxs)("article",{className:"flex h-full flex-col justify-between rounded-3xl border border-white/10 bg-slate-900/60 p-6 shadow-xl backdrop-blur transition hover:-translate-y-1 hover:border-sky-400 hover:shadow-sky-500/20",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-sky-500/20 text-sky-300",children:e.icon||"*"}),(0,n.jsx)("h3",{className:"text-xl font-semibold text-white",children:e.title})]}),e.description&&(0,n.jsx)("p",{className:"mt-4 text-sm text-slate-300",children:e.description}),Array.isArray(e.highlights)&&e.highlights.length>0&&(0,n.jsx)("ul",{className:"mt-4 space-y-2 text-sm text-slate-300",children:e.highlights.map(e=>(0,n.jsxs)("li",{className:"flex items-start gap-2",children:[(0,n.jsx)("span",{className:"mt-1 inline-block h-2 w-2 rounded-full bg-sky-400"}),(0,n.jsx)("span",{children:e})]},e))})]}),(0,n.jsx)("button",{type:"button",className:"mt-6 inline-flex items-center justify-center rounded-full bg-sky-500 px-6 py-2 text-sm font-semibold text-white shadow-lg shadow-sky-500/30 transition hover:bg-sky-400",onClick:()=>{var a;return a=e.route||"/streamer/login",void("function"==typeof t&&t(a))},children:e.action})]},e.key||e.route)):(0,n.jsx)("div",{className:"col-span-full rounded-3xl border border-white/10 bg-slate-900/60 p-6 text-center text-sm text-slate-300",children:a.emptyState||"No roles available right now."})}),a.note&&(0,n.jsx)("p",{className:"mt-8 text-center text-xs text-slate-400",children:a.note})]})}},{"react/jsx-runtime":"react/jsx-runtime",react:"react","@parcel/transformer-js/src/esmodule-helpers.js":"3cktO"}],aKYT5:[function(e,t,a,i){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(a);var n=e("react/jsx-runtime"),r=e("react");s.interopDefault(r);var o=e("ethers");a.default=({copy:e})=>{var t;let a=e?.viewer||{},i=a.wallet||{},s=a.donations||{},l=(0,r.useMemo)(()=>Array.isArray(a.streamers)&&a.streamers.length>0?a.streamers:[{id:"luna-fox",name:"LunaFox",activity:"Exploring the Lost Forest",viewers:842,tags:["PvE","Speedrun"]},{id:"ember-knight",name:"EmberKnight",activity:"Arena runs and gear checks",viewers:613,tags:["PvP","Builds"]},{id:"nova-mage",name:"NovaMage",activity:"Summoning chaos events",viewers:455,tags:["Events","Co-op"]}],[a.streamers]),c=Array.isArray(s.buffOptions)?s.buffOptions:[],d=Array.isArray(s.eventOptions)?s.eventOptions:[],h=(0,r.useRef)(null),[m,g]=(0,r.useState)({address:"",balance:"",network:""}),[u,p]=(0,r.useState)("idle"),[f,y]=(0,r.useState)(""),b=e=>(s.donateCta||"Donate {amount} SOL").replace("{amount}",e.amount),E=(e,t)=>{"connected"!==u?y(s.requiresWallet||i.connectPrompt||"Please connect your wallet before donating."):y((s.success||"Request {option} for {streamer} registered. It will trigger once {amount} SOL is received.").replace("{option}",t.label).replace("{streamer}",e.name).replace("{amount}",t.amount))},S=async()=>{if(y(""),"undefined"==typeof window||!window.ethereum)return void y(i.noProvider||"No Web3 wallet detected in your browser.");try{p("connecting");let e=new(0,o.BrowserProvider)(window.ethereum),t=await e.send("eth_requestAccounts",[]),a=t?.[0]||"",s=await e.getNetwork(),n="0";if(a){let t=await e.getBalance(a);n=(0,o.formatEther)(t)}h.current=e,g({address:a,balance:n,network:s?.name||`chain-${s?.chainId??""}`}),p("connected"),y(i.connected||"Wallet connected. You can donate now.")}catch(e){console.error("Wallet connect error:",e),p("error"),y(i.error||"Could not connect wallet. Please try again.")}},v=i.status?.[u]||i.status?.idle||"";return(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsxs)("header",{className:"mx-auto max-w-3xl text-center",children:[(0,n.jsx)("h2",{className:"text-3xl font-semibold text-white md:text-4xl",children:a.title}),a.subtitle&&(0,n.jsx)("p",{className:"mt-3 text-sm text-slate-300 md:text-base",children:a.subtitle}),a.note&&(0,n.jsx)("p",{className:"mt-2 text-xs uppercase tracking-wide text-slate-400",children:a.note})]}),(0,n.jsxs)("section",{className:"mt-8 w-full rounded-3xl border border-white/10 bg-slate-900/60 p-6 shadow-xl backdrop-blur",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-6 md:flex-row md:items-center md:justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-white",children:i.title}),i.description&&(0,n.jsx)("p",{className:"mt-2 text-sm text-slate-300",children:i.description}),v&&(0,n.jsx)("p",{className:"mt-3 text-xs uppercase tracking-wide text-sky-300",children:v})]}),(0,n.jsx)("div",{className:"flex gap-3",children:"connected"===u?(0,n.jsx)("button",{type:"button",className:"rounded-full border border-rose-400/40 bg-rose-500/20 px-5 py-2 text-sm font-semibold text-rose-200 transition hover:bg-rose-500/30",onClick:()=>{h.current=null,g({address:"",balance:"",network:""}),p("idle"),y(i.disconnected||"Wallet disconnected.")},children:i.disconnectCta||"Disconnect"}):(0,n.jsx)("button",{type:"button",className:"rounded-full bg-emerald-500 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-emerald-500/30 transition hover:bg-emerald-400",onClick:S,children:i.connectCta||"Connect wallet"})})]}),m.address&&(0,n.jsxs)("dl",{className:"mt-6 grid gap-4 rounded-2xl border border-white/10 bg-slate-900/80 p-4 text-sm text-slate-200 md:grid-cols-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-400",children:i.labels?.address||"Address"}),(0,n.jsx)("dd",{className:"mt-1 font-mono text-sm",children:(t=m.address)&&!(t.length<=10)?`${t.slice(0,6)}...${t.slice(-4)}`:t||""})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-400",children:i.labels?.network||"Network"}),(0,n.jsx)("dd",{className:"mt-1 text-sm capitalize",children:m.network})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("dt",{className:"text-xs uppercase tracking-wide text-slate-400",children:i.labels?.balance||"Balance"}),(0,n.jsxs)("dd",{className:"mt-1 text-sm",children:[Number(m.balance||0).toFixed(4)," SOL"]})]})]})]}),f&&(0,n.jsx)("div",{className:"mt-6 w-full rounded-3xl border border-sky-400/40 bg-sky-500/10 p-4 text-sm text-sky-100",children:f}),(0,n.jsxs)("section",{className:"mt-8 w-full space-y-6",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-white",children:a.streamListTitle}),(0,n.jsx)("div",{className:"space-y-6",children:l.map(e=>{var t;return(0,n.jsx)("article",{className:"rounded-3xl border border-white/10 bg-slate-900/60 p-6 shadow-xl backdrop-blur",children:(0,n.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-sky-500/20 text-xs font-semibold text-sky-200",children:"LIVE"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-lg font-semibold text-white",children:e.name}),(0,n.jsx)("p",{className:"text-sm text-slate-300",children:e.activity})]})]}),(0,n.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-2 text-xs text-slate-400",children:[(0,n.jsx)("span",{className:"rounded-full bg-white/5 px-3 py-1 text-slate-200",children:(t=e.viewers,(a.viewerCountLabel||"{count} viewers").replace("{count}",Number(t||0).toLocaleString()))}),Array.isArray(e.tags)&&e.tags.map(e=>(0,n.jsxs)("span",{className:"rounded-full bg-white/5 px-3 py-1",children:["#",e]},e))]})]}),(0,n.jsxs)("div",{className:"grid w-full gap-4 md:max-w-md",children:[(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-slate-900/70 p-4",children:[(0,n.jsx)("h5",{className:"text-sm font-semibold text-sky-200",children:s.buffTitle}),c.length>0?(0,n.jsx)("ul",{className:"mt-3 space-y-3 text-sm text-slate-200",children:c.map(t=>(0,n.jsxs)("li",{className:"flex flex-col gap-2 rounded-xl border border-white/10 bg-slate-900/60 p-3 md:flex-row md:items-center md:justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-semibold text-white",children:t.label}),t.description&&(0,n.jsx)("p",{className:"text-xs text-slate-400",children:t.description})]}),(0,n.jsx)("button",{type:"button",className:"inline-flex items-center justify-center rounded-full bg-sky-500 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-white shadow-lg shadow-sky-500/30 transition hover:bg-sky-400",onClick:()=>E(e,t),children:b(t)})]},t.id))}):(0,n.jsx)("p",{className:"mt-3 text-xs text-slate-400",children:s.emptyBuffs||"Buff options will appear here soon."})]}),(0,n.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-slate-900/70 p-4",children:[(0,n.jsx)("h5",{className:"text-sm font-semibold text-amber-200",children:s.eventTitle}),d.length>0?(0,n.jsx)("ul",{className:"mt-3 space-y-3 text-sm text-slate-200",children:d.map(t=>(0,n.jsxs)("li",{className:"flex flex-col gap-2 rounded-xl border border-white/10 bg-slate-900/60 p-3 md:flex-row md:items-center md:justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-semibold text-white",children:t.label}),t.description&&(0,n.jsx)("p",{className:"text-xs text-slate-400",children:t.description})]}),(0,n.jsx)("button",{type:"button",className:"inline-flex items-center justify-center rounded-full bg-amber-500 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-slate-900 shadow-lg shadow-amber-500/30 transition hover:bg-amber-400",onClick:()=>E(e,t),children:b(t)})]},t.id))}):(0,n.jsx)("p",{className:"mt-3 text-xs text-slate-400",children:s.emptyEvents||"Event options will appear here soon."})]})]})]})},e.id)})})]})]})}},{"react/jsx-runtime":"react/jsx-runtime",react:"react",ethers:"ethers","@parcel/transformer-js/src/esmodule-helpers.js":"3cktO"}],a8aUN:[function(e,t,a,i){let{GameClient:s}=e("55a74e494f90a4c8"),{GameEngine:n}=e("e1659045719735fa"),{RoomEvents:r}=e("7e070495419bfe5"),{ClientStartHandler:o}=e("e83aa34e2b827fc2"),{FeaturesManager:l}=e("322c8efc1623d443"),{FirebaseConnector:c}=e("8f517454d27b0a77"),{ConfigManager:d}=e("ff73fbcc32d6158e"),{TranslationsMapper:h}=e("81f43a8bd60c202e"),m=e("7e64e865feb030ac"),{GameDom:g}=e("4386d0f131680f0c"),{RoomsConst:u}=e("7625764d2a36d26c"),{GameConst:p}=e("cdbc04050856a902"),{ErrorManager:f,EventsManagerSingleton:y,Logger:b,sc:E}=e("aa292ffa814895ee"),S=e("258c9fd5a0d6d180");t.exports.GameManager=class{constructor(){this.gameEngine=!1,this.activeRoomEvents=null,this.events=y,this.gameDom=g,this.config=new d;let e=this.gameDom.getWindow()?.reldensInitialConfig||{};E.deepMergeProperties(this.config,e),this.features=new l({gameManager:this,events:this.events}),this.firebase=new c(this),this.joinedRooms={},this.userData={},this.plugins={},this.services={},this.elements={},this.playerData=!1,this.gameOver=!1,this.forcedDisconnection=!1,this.isChangingScene=!1,this.canInitEngine=!0,this.appServerUrl="",this.gameServerUrl="",this.locale="",h.forConfig(this.config.client,m,p.MESSAGE.DATA_VALUES)}setupCustomClientPlugin(e,t){this.plugins[e]=new t,this.plugins[e].setup({gameManager:this,events:this.events})}clientStart(){this.events.emitSync("reldens.clientStartBefore",this),this.startHandler=new o(this),this.startHandler.clientStart()}async startGame(e,t){return(this.events.emitSync("reldens.startGameBefore",this),await this.joinGame(e,t))?(this.handleLoginSuccess(),!0):(this.handleLoginError(e),!1)}handleLoginSuccess(){let e=this.gameDom.getElement(p.SELECTORS.BODY);e.classList.add(p.CLASSES.GAME_STARTED),e.classList.remove(p.CLASSES.GAME_ERROR),this.gameDom.getElement(p.SELECTORS.FORMS_CONTAINER).remove(),this.events.emitSync("reldens.startGameAfter",this)}handleLoginError(e){let t=this.gameDom.getElement(p.SELECTORS.BODY);t.classList.remove(p.CLASSES.GAME_STARTED),t.classList.add(p.CLASSES.GAME_ERROR),this.submitedForm=!1,this.events.emitSync("reldens.gameRoomError",this),this.firebase&&"firebase-login"===e.formId&&this.firebase.app.auth().signOut()}async joinGame(e,t=!1){return(this.userData={},await this.events.emit("reldens.beforeJoinGame",{gameManager:this,formData:e,isNewUser:t}),this.mapFormDataToUserData(e,t),this.gameRoom=await this.gameClient.joinOrCreate(p.ROOM_GAME,this.userData),this.gameRoom)?(await this.events.emit("reldens.beforeJoinGameRoom",this.gameRoom),this.handleGameRoomMessages(),this.activateResponsiveBehavior(),this.gameRoom):(this.displayFormError("#"+e.formId,this.gameClient.lastErrorMessage),!1)}mapFormDataToUserData(e,t){E.hasOwn(e,"forgot")&&(this.userData.forgot=1,this.userData.email=e.email),this.initializeClient(),this.userData.clientVersion||(this.userData.clientVersion=S&&S.version?S.version:"0.0.0"),e.isGuest&&(this.userData.isGuest=!0,this.userData.isNewUser=!0),t&&(this.userData.isNewUser=!0,this.userData.email=e.email),this.userData.username=e.username,this.userData.password=e.password}handleGameRoomMessages(){this.gameRoom.onMessage("*",async e=>{if(e.error)return b.error("Game Room message error.",e.message),this.displayFormError(p.SELECTORS.PLAYER_CREATE_FORM,e.message),!1;if(p.START_GAME===e.act)return this.initialGameData=e,await this.beforeStartGame();if(p.CREATE_PLAYER_RESULT!==e.act)return!1;this.initialGameData.player=e.player;let t=this.gameDom.getElement(p.SELECTORS.PLAYER_SELECTION);t&&t.classList.add("hidden"),await this.initEngine()})}activateResponsiveBehavior(){this.events.on("reldens.afterSceneDynamicCreate",async()=>{this.config.getWithoutLogs("client/ui/screen/responsive",!0)&&(this.gameEngine.updateGameSize(this),this.gameDom.getWindow().addEventListener("resize",()=>{this.gameEngine.updateGameSize(this)}))})}displayFormError(e,t){let a=this.gameDom.getElement(e+" "+p.SELECTORS.RESPONSE_ERROR);if(!a)return!1;a.innerHTML=t;let i=this.gameDom.getElement(e+" "+p.SELECTORS.LOADING_CONTAINER);return i&&i?.classList.add(p.CLASSES.HIDDEN),!0}initializeClient(){this.appServerUrl=this.getAppServerUrl(),this.gameServerUrl=this.getGameServerUrl(),this.gameClient=new s(this.gameServerUrl,this.config)}async beforeStartGame(){return await this.events.emit("reldens.beforeInitEngineAndStartGame",this.initialGameData,this),E.hasOwn(this.initialGameData,"gameConfig")||f.error("Missing game configuration."),E.deepMergeProperties(this.config,this.initialGameData?.gameConfig||{}),this.userData.clientVersion=this.config.getWithoutLogs("client/gameEngine/version",this.userData.clientVersion),await this.features.loadFeatures(this.initialGameData?.features||{}),await this.events.emit("reldens.beforeCreateEngine",this.initialGameData,this),!!this.canInitEngine&&await this.initEngine()}async initEngine(){if(this.playerData=this.initialGameData?.player||!1,!this.playerData||!this.playerData.state)return this.gameDom.alertReload(this.services?.translator.t("game.errors.missingPlayerData"));this.userData.selectedPlayer=this.playerData.id;let e=this.initialGameData?.selectedScene||"";this.userData.selectedScene=e;let t=this.initialGameData?.gameConfig||{};this.gameEngine=new n({config:t.client.gameEngine,events:this.events}),this.userData.isNewUser=!1,this.userData.isGuest&&(this.initialGameData?.guestPassword&&(this.userData.password=this.initialGameData.guestPassword),this.initialGameData?.userName&&(this.userData.username=this.initialGameData.userName)),await this.joinFeaturesRooms();let a=""!==e&&e!==u.ROOM_LAST_LOCATION_KEY?e:this.playerData.state.scene;this.playerData.state.scene=a;let i=await this.gameClient.joinOrCreate(a,this.userData);if(!i)return this.gameDom.alertReload(this.services?.translator.t("game.errors.joiningRoom",{joinRoomName:a}));this.gameDom.getElement(p.SELECTORS.BODY).classList.add(p.CLASSES.GAME_ENGINE_STARTED),this.gameDom.getElement(p.SELECTORS.GAME_CONTAINER).classList.remove(p.CLASSES.HIDDEN);let s=this.gameDom.getElement(p.SELECTORS.PLAYER_SELECTION);return s&&s.classList.add(p.CLASSES.HIDDEN),delete this.initialGameData.selectedScene,delete this.userData.selectedScene,await this.emitJoinedRoom(i,a),this.activeRoomEvents=this.createRoomEventsInstance(a),await this.events.emit("reldens.createdRoomsEventsInstance",i,this),await this.activeRoomEvents.activateRoom(i),await this.emitActivatedRoom(i,a),await this.events.emit("reldens.afterInitEngineAndStartGame",this.initialGameData,i),i}async joinFeaturesRooms(){let e=Object.keys(this.features.featuresList);if(0===e.length)return;let t=[];for(let a of e){let e=this.features.featuresList[a];if(E.hasOwn(e,"joinRooms"))for(let a of e.joinRooms){let e=await this.gameClient.joinOrCreate(a,this.userData);if(!e)return this.gameDom.alertReload(this.services.translator.t("game.errors.joiningFeatureRoom",{joinRoomName:a}));this.joinedRooms[a]=e,await this.emitJoinedRoom(e,a),t.push(a)}}E.deepMergeProperties(this.config,{client:{rooms:{featuresRoomsNames:t}}})}async reconnectGameClient(e,t){this.isChangingScene=!0;let a=this.createRoomEventsInstance(e.player.state.scene);this.gameClient.joinOrCreate(a.roomName,this.userData).then(async i=>{t.leave(),this.activeRoomEvents=a,this.room=i,await this.emitJoinedRoom(i,e.player.state.scene),await a.activateRoom(i,e.prev),await this.emitActivatedRoom(i,e.player.state.scene)}).catch(a=>{b.error("Reconnect Game Client error.",{error:a,message:e,previousRoom:t}),this.gameDom.alertReload(this.services.translator.t("game.errors.reconnectClient"))})}async emitActivatedRoom(e,t){await this.events.emit("reldens.activatedRoom",e,this),await this.events.emit("reldens.activatedRoom_"+t,e,this)}async emitJoinedRoom(e,t){await this.events.emit("reldens.joinedRoom",e,this),await this.events.emit("reldens.joinedRoom_"+t,e,this)}createRoomEventsInstance(e){return new r(e,this)}getAppServerUrl(){return""===this.appServerUrl&&(this.appServerUrl=this.getUrlFromCurrentReferer()),this.appServerUrl}getGameServerUrl(){return""===this.gameServerUrl&&(this.gameServerUrl=this.getUrlFromCurrentReferer(!0)),this.gameServerUrl}getUrlFromCurrentReferer(e=!1){let t=this.gameDom.getWindow().location,a=t.protocol;return e&&(a=0===a.indexOf("https")?"wss:":"ws:"),a+"//"+t.hostname+(t.port?":"+t.port:"")}getActiveScene(){return this.activeRoomEvents.getActiveScene()}getActiveScenePreloader(){return this.gameEngine.scene.getScene(p.SCENE_PRELOADER+this.getActiveScene().key)}getCurrentPlayer(){let e=this.getActiveScene();return!!e&&e.player}currentPlayerName(){let e=this.getCurrentPlayer();return e?e.player_id+" - "+e.playerName:""}getCurrentPlayerAnimation(){let e=this.getCurrentPlayer();return e.players[e.playerId]}getUiElement(e,t=!0){let a=E.get(this.gameEngine,"uiScene",!1);return a?a.getUiElement(e,t):(t&&b.error("UI Scene not defined."),!1)}getFeature(e){let t=this.features.featuresList;return E.hasOwn(t,e)?t[e]:(b.error("Feature key not defined.",e),!1)}getAnimationByKey(e){return this.getActiveScene().getAnimationByKey(e)}}},{"55a74e494f90a4c8":"5eeNH",e1659045719735fa:"5Vbkl","7e070495419bfe5":"cjq4I",e83aa34e2b827fc2:"fvIMo","322c8efc1623d443":"axBi7","8f517454d27b0a77":"iWTai",ff73fbcc32d6158e:"hfv3q","81f43a8bd60c202e":"bJxKc","7e64e865feb030ac":"wD4bz","4386d0f131680f0c":"kdE6H","7625764d2a36d26c":"4NiBt",cdbc04050856a902:"52yv8",aa292ffa814895ee:"@reldens/utils","258c9fd5a0d6d180":"8V4ag"}],"5eeNH":[function(e,t,a,i){let{Client:s}=e("2be262c20fafb9eb"),{RoomsConst:n}=e("9f899cb0243e6afa"),{GameConst:r}=e("ae102ff36b5bc113"),{Logger:o}=e("63836a3e936888c1");t.exports.GameClient=class{constructor(e,t){this.serverUrl=e,this.config=t,this.autoConnectServerGameRoom=this.config.getWithoutLogs("client/rooms/autoConnectServerGameRoom",!0),this.autoConnectServerFeatureRooms=this.config.getWithoutLogs("client/rooms/autoConnectServerFeatureRooms",!0),this.roomsUrls={},this.roomClients={},this.gameRoomsByServer={},this.featuresByServerFlag={},this.featuresRoomsByServer={},this.lastErrorMessage=""}async joinOrCreate(e,t){this.lastErrorMessage="";try{let a=this.roomClient(e);if(!a)return o.error('Client not found for room name "'+e+'".'),!1;let i=this.roomsUrls[e];return await this.connectToGlobalGameRoom(i,a,t),await this.connectToGlobalFeaturesRooms(i,a,t),await a.joinOrCreate(e,t)}catch(a){if(n.ERRORS.CREATING_ROOM_AWAIT===a.message)return await new Promise(e=>setTimeout(e,500)),await this.joinOrCreate(e,t);this.lastErrorMessage=a.message,o.error("Joining room error: "+a.message)}return!1}async connectToGlobalGameRoom(e,t,a){!this.autoConnectServerGameRoom||(""===e||this.serverUrl===e?o.debug("Avoid connect to global game room.",this.serverUrl,e):this.gameRoomsByServer[e]||(o.debug("Registering GameRoom for server: "+e),this.gameRoomsByServer[e]=await t.joinOrCreate(r.ROOM_GAME,a),this.gameRoomsByServer[e].onMessage("*",()=>{})))}async connectToGlobalFeaturesRooms(e,t,a){if(!this.autoConnectServerFeatureRooms)return;if(""===e||this.serverUrl===e)return void o.debug("Avoid connect to features rooms.",this.serverUrl,e);if(this.featuresByServerFlag[e])return;o.debug("Registering features rooms for server: "+e),this.featuresByServerFlag[e]=!0;let i=this.config.getWithoutLogs("client/rooms/featuresRoomsNames",[]);if(!(0<i.length))for(let s of(this.featuresRoomsByServer[e]={},i))this.featuresRoomsByServer[e][s]=await t.joinOrCreate(s,a)}roomClient(e){return this.roomClients[e]||(this.roomsUrls[e]=this.config.getWithoutLogs("client/rooms/servers/"+e,this.serverUrl),o.debug('Creating client with URL "'+this.roomsUrls[e]+'" for room "'+e+'".'),this.roomClients[e]=new s(this.roomsUrls[e])),this.roomClients[e]}}},{"2be262c20fafb9eb":"colyseus.js","9f899cb0243e6afa":"4NiBt",ae102ff36b5bc113:"52yv8","63836a3e936888c1":"@reldens/utils"}],"4NiBt":[function(e,t,a,i){t.exports.RoomsConst={ROOM_TYPE_SCENE:"scene",ROOM_TYPE_LOGIN:"login",ROOM_TYPE_GAME:"game",TILE_INDEX:"i",NEXT_SCENE:"n",MAPS_BUCKET:"/assets/maps",ROOM_LAST_LOCATION_KEY:"@lastLocation",RETURN_POINT_KEYS:{DIRECTION:"d",X:"x",Y:"y",DEFAULT:"de",PREVIOUS:"p"},ERRORS:{CREATING_ROOM_AWAIT:"CREATING-ROOM-AWAIT"}}},{}],"52yv8":[function(e,t,a,i){t.exports.GameConst={START_GAME:"s",ACTION_KEY:"act",CREATE_PLAYER:"cp",CREATE_PLAYER_RESULT:"cps",CHANGING_SCENE:"cgs",CHANGED_SCENE:"cs",RECONNECT:"r",ROOM_GAME:"room_game",ROOM_NAME_MAP:"Map",SCENE_PRELOADER:"ScenePreloader",PLAYER_STATS:"ps",ICON_STATS:"player-stats",CLIENT_JOINED:"cj",UI:"ui",CLOSE_UI_ACTION:"closeUi",TYPE_PLAYER:"pj",GAME_OVER:"go",REVIVED:"rv",BUTTON_OPTION:"btn-opt",UI_BOX:"box",UI_CLOSE:"-close",UI_OPEN:"-open",UP:"up",LEFT:"left",DOWN:"down",RIGHT:"right",STOP:"stop",POINTER:"mp",ARROW_DOWN:"ard",IMAGE_PLAYER:"player",ACTIONS:{LOGIN_UPDATE_ERROR:"luer"},STATUS:{ACTIVE:1,DISABLED:2,DEATH:3,AVOID_INTERPOLATION:4},STRUCTURE:{DEFAULT:"default",ASSETS:"assets",CSS:"css",DIST:"dist",THEME:"theme",LIB:"lib",SERVER:"server",CLIENT:"client",PLUGINS:"plugins",INDEX:"index.html",SCSS_FILE:"styles.scss",CSS_FILE:"styles.css",ADMIN:"admin",TEMPLATES:"templates",ADMIN_JS_FILE:"reldens-admin-client.js",ADMIN_SCSS_FILE:"reldens-admin-client.scss",ADMIN_CSS_FILE:"reldens-admin-client.css",INSTALLER_FOLDER:"install",INSTALL_LOCK:"install.lock"},ROUTE_PATHS:{DISCONNECT_USER:"/reldens-disconnect-user",TERMS_AND_CONDITIONS:"/terms-and-conditions",MAILER:"/reldens-mailer-enabled",FIREBASE:"/reldens-firebase"},SELECTORS:{BODY:"body",CANVAS:"CANVAS",INPUT:"input",FORMS_CONTAINER:".forms-container",REGISTER_FORM:"#register-form",GUEST_FORM:"#guest-form",LOGIN_FORM:"#login-form",FORGOT_PASSWORD_FORM:"#forgot-form",PLAYER_CREATE_FORM:".player-create-form",PLAYER_SELECTION:"#player-selection",PLAYER_SELECTION_FORM:"#player-selector-form",PLAYER_SELECT_ELEMENT:"#player-select-element",PLAYER_SELECTION_ADDITIONAL_INFO:".player-selection-additional-info",FULL_SCREEN_BUTTON:".full-screen-btn",RESPONSE_ERROR:".response-error",LOADING_CONTAINER:".loading-container",REGISTRATION:{PASSWORD:"#reg-password",RE_PASSWORD:"#reg-re-password",EMAIL:"#reg-email",USERNAME:"#reg-username"},GUEST:{USERNAME:"#guest-username"},LOGIN:{USERNAME:"#username",PASSWORD:"#password"},FORGOT_PASSWORD:{EMAIL:"#forgot-email",CONTAINER:".forgot-password-container"},TERMS:{BOX:"#terms-and-conditions",CONTAINER:".terms-and-conditions-container",LINK_CONTAINER:".terms-and-conditions-link-container",LINK:".terms-and-conditions-link",ACCEPT:"#accept-terms-and-conditions",ACCEPT_LABEL:".accept-terms-and-conditions-label",HEADING:".terms-heading",BODY:".terms-body",CLOSE:"#terms-and-conditions-close"},GAME_CONTAINER:".game-container",BUTTONS_CLOSE:".box-close"},CLASSES:{HIDDEN:"hidden",GAME_STARTED:"game-started",GAME_ERROR:"game-error",GAME_ENGINE_STARTED:"game-engine-started",FULL_SCREEN_ON:"full-screen-on"},MESSAGE:{DATA_VALUES:{NAMESPACE:"game"}},LABELS:{YES:"Yes",NO:"No"},ANIMATIONS_TYPE:{SPRITESHEET:"spritesheet"},FILES:{EXTENSIONS:{PNG:".png"}},GRAPHICS:{FRAME_WIDTH:32,FRAME_HEIGHT:32},SHOW_PLAYER_TIME:{NONE:-1,ONLY_OWN_PLAYER:0,ALL_PLAYERS:2}}},{}],"5Vbkl":[function(e,t,a,i){let s=e("406accd1d723903a"),{Game:n,Input:r}=e("99076ac36cb74ece"),{FPSCounter:o}=e("4ae19ba325f82162"),{GameConst:l}=e("70f28ffbc8fc65ca"),{ObjectsConst:c}=e("5d4105d801ec7f71"),{Logger:d,sc:h}=e("7d2d4851ffb4e4ae");t.exports.GameEngine=class extends n{constructor(e){super(e.config),d.debug("Game Engine configuration.",e.config),this.uiScene=!1,this.TemplateEngine=s,this.eventsManager=e.events,this.eventsManager.on("reldens.beforeReconnectGameClient",()=>{this.clearTarget()}),this.eventsManager.on("reldens.beforeSceneDynamicCreate",e=>{this.setupTabTarget(e)})}parseTemplate(e,t,a,i){return this.TemplateEngine.render(e,t,a,i)}updateGameSize(e){let{newWidth:t,newHeight:a}=this.getCurrentScreenSize(e);setTimeout(()=>{for(let e of(this.eventsManager.emit("reldens.updateGameSizeBefore",this,t,a),this.scale.setGameSize(t,a),Object.keys(this.uiScene.elementsUi))){let i=this.uiScene.elementsUi[e],s=h.get(this.uiScene.userInterfaces[e],"uiPositionKey",e),{uiX:n,uiY:r}=this.uiScene.getUiConfig(s,t,a);i.x=n,i.y=r}this.eventsManager.emit("reldens.updateGameSizeAfter",this,t,a)},e.config.getWithoutLogs("client/general/gameEngine/updateGameSizeTimeOut",500))}getCurrentScreenSize(e){let t=e.gameDom.getElement(l.SELECTORS.GAME_CONTAINER),a=t.offsetWidth,i=t.offsetHeight,s=a,n=i,r=e.getActiveScene();return r&&r.map&&(s=Math.min(a,r.map.width*r.map.tileWidth),n=Math.min(i,r.map.height*r.map.tileHeight)),{newWidth:s=Math.min(s,Number(e.config.get("client/ui/maximum/x"))),newHeight:n=Math.min(n,Number(e.config.get("client/ui/maximum/y")))}}showTarget(e,t,a){h.hasOwn(this.uiScene,"uiTarget")&&(this.uiScene.uiTarget.getChildByID("box-target").style.display="block",this.uiScene.uiTarget.getChildByID("target-container").innerHTML=this.targetDisplay(e,t)),this.eventsManager.emit("reldens.gameEngineShowTarget",this,t,a,e)}targetDisplay(e,t){let a=e;return l.TYPE_PLAYER===t.type&&(a+=this.generateTargetPlayedTime(t)),a}generateTargetPlayedTime(e){let t="",a=this.uiScene.gameManager.config.getWithoutLogs("client/players/playedTime/show",l.SHOW_PLAYER_TIME.ONLY_OWN_PLAYER);if(l.SHOW_PLAYER_TIME.NONE===a)return t;let i=this.uiScene.gameManager.getCurrentPlayer();if(l.SHOW_PLAYER_TIME.ALL_PLAYERS===a||i.playerId===e.id){let a=this.obtainPlayedTime(e,i);t+=this.createPlayedTimeLabel(a)}return t}createPlayedTimeLabel(e){let t=this.uiScene.gameManager.gameDom.createElement("p");return t.innerHTML=this.uiScene.gameManager.config.get("client/players/playedTime/label").replace("%playedTimeInHs",e),t.outerHTML}obtainPlayedTime(e,t){return(t.players[e.id].playedTime/60/60).toFixed(1)}clearTarget(){let e=this.uiScene.gameManager.activeRoomEvents.getActiveScene(),t=Object.assign({},e.player.currentTarget);h.hasOwn(this.uiScene,"uiTarget")&&(e.player.currentTarget=!1,this.uiScene.uiTarget.getChildByID("box-target").style.display="none",this.uiScene.uiTarget.getChildByID("target-container").innerHTML=""),this.eventsManager.emit("reldens.gameEngineClearTarget",this,t)}setupTabTarget(e){e.keyTab=e.input.keyboard.addKey(r.Keyboard.KeyCodes.TAB),e.input.keyboard.addCapture(r.Keyboard.KeyCodes.TAB),e.input.keyboard.on("keydown",e=>{9===e.keyCode&&this.tabTarget()})}tabTarget(){let e=this.uiScene.gameManager.getCurrentPlayer(),t=this.uiScene.gameManager.getActiveScene().objectsAnimations,a=e.players,i=!1,s="",n=!!e.currentTarget&&Object.assign({},e.currentTarget);for(let a of Object.keys(t)){if(!t[a].targetName)continue;let n=Math.hypot(t[a].x-e.state.x,t[a].y-e.state.y);e.currentTarget.id!==t[a].key&&(!i||i.dist>n)&&(i={id:t[a].key,type:c.TYPE_OBJECT,dist:n},s=t[a].targetName)}for(let t of Object.keys(a)){if(e.playerName===a[t].playerName)continue;let n=Math.hypot(a[t].x-e.state.x,a[t].y-e.state.y);e.currentTarget.id!==a[t].id&&(!i||i.dist>n)&&(i={id:t,type:l.TYPE_PLAYER,dist:n},s=a[t].playerName)}e.currentTarget=i,this.showTarget(s,i,n),this.eventsManager.emit("reldens.gameEngineTabTarget",this,i,n)}showFPS(){this.fpsCounter=new o(this.uiScene.gameManager.gameDom),this.fpsCounter.start()}}},{"406accd1d723903a":"mustache","99076ac36cb74ece":"phaser","4ae19ba325f82162":"d2HPk","70f28ffbc8fc65ca":"52yv8","5d4105d801ec7f71":"fEftg","7d2d4851ffb4e4ae":"@reldens/utils"}],d2HPk:[function(e,t,a,i){t.exports.FPSCounter=class{constructor(e){this.lastFrameTime=performance.now(),this.frameCount=0,this.fpsDisplay=e.createElementWithStyles("div","fps-counter",{padding:"0 20px",background:"#000",color:"#00ff00"}),e.getElement(".header").appendChild(this.fpsDisplay)}updateFPS(){let e=performance.now(),t=e-this.lastFrameTime;this.lastFrameTime=e;let a=Math.round(1e3/t);this.frameCount++,0==this.frameCount%60&&(this.fpsDisplay.textContent="FPS: "+a),requestAnimationFrame(this.updateFPS.bind(this))}start(){this.updateFPS()}}},{}],fEftg:[function(e,t,a,i){let s="objects.";t.exports.ObjectsConst={OBJECT_ANIMATION:"oa",OBJECT_INTERACTION:"oi",TYPE_OBJECT:"obj",TYPE_ANIMATION:"anim",TYPE_NPC:"npc",TYPE_ENEMY:"enemy",TYPE_TRADER:"trader",TYPE_DROP:"drop",DYNAMIC_ANIMATION:"dyn",MESSAGE:{DATA_VALUES:{NAMESPACE:"objects"}},EVENT_PREFIX:{BASE:"bo",ANIMATION:"ao",DROP:"dep",ENEMY:"eo",NPC:"npc",TRADER:"tnpc"},SNIPPETS:{PREFIX:s,NPC_INVALID:s+"npcInvalid",TRADER:{CONTENT:s+"trader.content",OPTIONS:{BUY:s+"trader.options.buy",SELL:s+"trader.options.sell"},BUY_CONFIRMED:s+"trader.buyConfirmed",SELL_CONFIRMED:s+"trader.sellConfirmed"}},DEFAULTS:{BASE_OBJECT:{CONTENT:"",OPTIONS:{}},TRADER_OBJECT:{INVENTORY_MAP:{buy:"A",sell:"B"},OPTIONS:{BUY:"buy",SELL:"sell"}},TARGETS:{OBJECT:0,PLAYER:1}},TRADE_ACTIONS_FUNCTION_NAME:{ADD:"add",REMOVE:"remove",CONFIRM:"confirm",DISCONFIRM:"disconfirm",CANCEL:"cancel"},TRADE_ACTIONS:{SUB_ACTION:"sub",ADD:"ta",REMOVE:"tr",CONFIRM:"tc",DISCONFIRM:"td"},DROPS:{KEY:"drp",REMOVE:"drmv",PARAMS:"drpp",ASSET_KEY:"dk",PICK_UP_ACT:"rpu",ASSETS_PATH:"/assets/custom/sprites/",FILE:"df",TYPE:"dt"}}},{}],cjq4I:[function(e,t,a,i){let{PlayerEngine:s}=e("5dadcfc2f4ec048c"),{SceneDynamic:n}=e("5ea13611f87f0f9f"),{ScenePreloader:r}=e("171055bce58a5ac9"),{GameConst:o}=e("e471cce0414cdafb"),{ErrorManager:l,Logger:c,sc:d}=e("9055603bf8657355");t.exports.RoomEvents=class{constructor(e,t){this.room=!1,this.roomData={},this.scenePreloader=!1,this.playersOnAddCallback=!1,this.playersOnRemoveCallback=!1,this.playersQueue={},this.gameManager=t,this.gameEngine=t.gameEngine,this.gameDom=t.gameDom,this.roomName=e,this.events=t.events,this.objectsUi={},this.tradeUi={},this.gameOverRetries=0,this.gameOverMaxRetries=0,this.gameOverRetryTime=200,this.automaticallyCloseAllDialogsOnSceneChange=t.config.getWithoutLogs("client/rooms/automaticallyCloseAllDialogsOnSceneChange",!0)}async activateRoom(e,t=!1){await this.events.emit("reldens.activateRoom",e,this.gameManager),this.room=e,this.playersOnAddCallback=this.room.state.players.onAdd((e,a)=>{this.checkAndCreateScene(),this.playersOnAdd(e,a,t),this.listenPlayerAndStateChanges(e,a)}),this.playersOnRemoveCallback=this.room.state.players.onRemove((e,t)=>{this.playersOnRemove(e,t)}),this.room.onMessage("*",async e=>{await this.roomOnMessage(e)}),this.room.onLeave(e=>{this.roomOnLeave(e)})}listenPlayerAndStateChanges(e,t){let a=this.gameManager.getCurrentPlayer().player_id,i=Object.keys(e),s=Object.keys(e.state);for(let a of i)e.listen(a,a=>{this.playersOnChange(e,t,"playerChange")});for(let i of s)e.state.listen(i,s=>{if(e.state[i]=s,this.playersOnChange(e,t,"playerChange"),"inState"===i&&e.player_id===a){if(o.STATUS.DEATH===s)return this.showGameOverBox();this.hideGameOverBox()}})}checkAndCreateScene(){if(!this.room.state)return c.warning("Room state is not ready."),!1;if(0===Object.keys(this.roomData).length&&(this.roomData=d.toJson(this.room.state.sceneData)),this.gameEngine.scene.getScene(this.roomName))return!1;let e=this.createSceneInstance(this.roomName,this.roomData,this.gameManager);this.gameEngine.scene.add(this.roomName,e,!1)}async playersOnAdd(e,t,a){await this.events.emit("reldens.playersOnAdd",e,t,a,this);let i={x:e.state.x,y:e.state.y,dir:e.state.dir,playerName:e.playerName,avatarKey:e.avatarKey,playedTime:e.playedTime,player_id:e.player_id};if(this.isCurrentPlayer(t))return await this.createCurrentPlayer(e,a,t);this.addOtherPlayers(e,t,i)}isCurrentPlayer(e){return e===this.room.sessionId}addOtherPlayers(e,t,a){if(!this.engineStarted)return this.playersQueue[t]=a,!1;let i=this.getActiveScene();if(!this.isValidScene(i,e))return!1;i.player.addPlayer(t,a)}async createCurrentPlayer(e,t,a){this.engineStarted=!0,await this.startEngineScene(e,this.room,t);let i=this.getActiveScene();if(!this.isValidScene(i,e))return!1;for(let s of(await this.events.emit("reldens.playersQueueBefore",e,a,t,this),Object.keys(this.playersQueue)))i.player.addPlayer(s,this.playersQueue[s]);let s={player:e,key:a,previousScene:t,roomEvents:this};return await this.events.emit("reldens.createCurrentPlayer",s),s}isValidScene(e,t){return e.key===t.state.scene&&e.player&&e.player.players}playersOnChange(e,t,a){if(e.state.scene!==this.roomName){e.player_id!==this.gameManager.getCurrentPlayer().player_id||this.gameManager.isChangingScene||c.info("Player scene miss match.",{currentScene:this.roomName,playerSceneOnState:e?.state.scene,player:e?.sessionId,currentPlayer:this.gameManager.getCurrentPlayer()?.playerId,isChangingScene:this.gameManager.isChangingScene});return}let i=this.getActiveScene();this.playerExists(i,t)&&i.player.updatePlayer(t,e)}playersOnRemove(e,t){return(this.events.emitSync("reldens.playersOnRemove",e,t,this),t===this.room.sessionId)?this.gameOverReload():this.removePlayerByKey(t)}removePlayerByKey(e){let t=this.getActiveScene();this.playerExists(t,e)&&(t.player.removePlayer(e),t.player.currentTarget?.id===e&&this.gameEngine.clearTarget())}gameOverReload(){let e={confirmed:!0};this.events.emitSync("reldens.gameOverReload",this,e),!this.gameManager.gameOver&&e.confirmed&&this.gameDom.alertReload(this.gameManager.services.translator.t("game.errors.sessionEnded"))}playerExists(e,t){return e.player&&d.hasOwn(e.player.players,t)}async roomOnMessage(e){await this.runGameOver(e),await this.runRevived(e),await this.runChangingScene(e),await this.runChangedScene(e),await this.runReconnect(e),await this.runUpdateStats(e),await this.runInitUi(e),await this.closeBox(e),await this.runCustomMessageListener(e)}async runInitUi(e){if(e.act!==o.UI||!e.id)return!1;await this.events.emit("reldens.initUiBefore",e,this),this.initUi(e),await this.events.emit("reldens.initUiAfter",e,this)}async closeBox(e){if(o.CLOSE_UI_ACTION!==e.act||!e.id)return!1;let t=this.gameDom.getElement("#box-"+e.id+" .box-close");return t?(t.click(),!0):(c.error('Box could not be closed ID "'+e.id+'".'),!1)}async runCustomMessageListener(e){let t=d.get(e,"listener","");if(""===t)return!1;let a=this.gameManager.config.get("client/message/listeners",{}),i=this.gameManager.config.get("client/customClasses/message/listeners",{}),s=d.get(i,t,!1);return(s||(s=d.get(a,t,!1)),s)?d.isFunction(s.executeClientMessageActions)?void s.executeClientMessageActions({message:e,roomEvents:this}):(c.error('Listener is missing "executeClientMessageActions" method.',s),!1):(c.error('Listener "'+t+'" is missing.'),!1)}async runUpdateStats(e){return e.act===o.PLAYER_STATS&&(await this.events.emit("reldens.playerStatsUpdateBefore",e,this),await this.updatePlayerStats(e))}async runReconnect(e){if(e.act!==o.RECONNECT)return!1;await this.events.emit("reldens.beforeReconnectGameClient",e,this),await this.gameManager.reconnectGameClient(e,this.room)}async runChangingScene(e){if(e.act!==o.CHANGING_SCENE||this.room.sessionId!==e.id)return!1;this.gameManager.isChangingScene=!0,this.closeAllActiveDialogs(),this.gameManager.getActiveScene().scene.setVisible(!1)}async runChangedScene(e){if(e.act!==o.CHANGED_SCENE||e.scene!==this.room.name||this.room.sessionId===e.id)return!1;await this.events.emit("reldens.startChangedScene",{message:e,roomEvents:this});let t=this.getActiveScene(),{id:a,x:i,y:s,dir:n,playerName:r,playedTime:l,avatarKey:c,player_id:d}=e,h=this.gameManager.config.get("client/players/size/topOffset"),m=this.gameManager.config.get("client/players/size/leftOffset");t.player.addPlayer(a,{x:i-m,y:s-h,dir:n,playerName:r,playedTime:l,avatarKey:c,player_id:d}),this.gameManager.isChangingScene=!1,await this.events.emit("reldens.endChangedScene",{message:e,roomEvents:this})}closeAllActiveDialogs(){if(!this.automaticallyCloseAllDialogsOnSceneChange)return;let e=this.gameDom.getElements(o.SELECTORS.BUTTONS_CLOSE);if(0!==e.length)for(let t of e)t.click()}async runRevived(e){if(e.act!==o.REVIVED)return!1;this.gameDom.getElement("#game-over").classList.add("hidden");let t=this.gameManager.getCurrentPlayer(),a=d.get(t.players,e.t,!1);if(!a)return!1;a.visible=!0,d.hasOwn(a,"nameSprite")&&a.nameSprite&&(a.nameSprite.visible=!0),this.getActiveScene().stopOnDeathOrDisabledSent=!1}async runGameOver(e){if(e.act!==o.GAME_OVER)return!1;try{await this.events.emit("reldens.runGameOver",{message:e,defaultBehavior:!0,roomEvents:this}),await this.events.emit("reldens.gameOver",e,this),this.gameManager.gameOver=!0;let t=this.gameManager.getCurrentPlayer();if(!t)return this.gameOverRetries<this.gameOverMaxRetries&&(setTimeout(()=>this.runGameOver(e),this.gameOverRetryTime),this.gameOverRetries++),!1;t.players[t.playerId].visible=!1,this.showGameOverBox()}catch(t){return setTimeout(()=>this.runGameOver(e),200),this.gameOverRetries++,!1}}showGameOverBox(){return this.displayGameOverBox(!0)}hideGameOverBox(){return this.displayGameOverBox(!1)}displayGameOverBox(e){c.debug("Display game over box: "+(e?"yes":"no")+".");let t=this.gameDom.getElement("#game-over");return t?e?(t.classList.remove("hidden"),!0):(t.classList.add("hidden"),!1):(c.debug("GameOver box element not found."),!1)}async roomOnLeave(e){!this.isAbnormalShutdown(e)||this.gameManager.gameOver||this.gameManager.forcedDisconnection||(c.error("There was a connection error.",{code:e,isGameOver:this.gameManager.gameOver,isForcedDisconnection:this.gameManager.forcedDisconnection}),this.gameDom.alertReload(this.gameManager.services.translator.t("game.errors.serverDown"))),await this.events.emit("reldens.playerLeftScene",{code:e,roomEvents:this})}isAbnormalShutdown(e){return 1001<=e&&1015>=e}async updatePlayerStats(e){if(!d.hasOwn(e,"stats")||!e.stats)return!1;let t=this.getActiveScene();if(!t.player||!d.hasOwn(t.player.players,this.room.sessionId))return c.error("Player not available.",this.room,t),!1;t.player.players[this.room.sessionId].stats=e.stats,this.gameManager.playerData.stats=e.stats,this.gameManager.playerData.statsBase=e.statsBase;let a=this.gameManager.getUiElement("playerStats");if(!a)return!1;let i=a.getChildByProperty("id","player-stats-container");if(!i)return!1;let s=this.gameEngine.uiScene.cache.html.get("playerStat");for(let t of(i.innerHTML="",Object.keys(e.stats))){let a=d.get(this.gameManager.config.client.players.initialStats[t],"data",!1),n=a&&d.get(a,"showBase",!1)?" / "+e.statsBase[t]:"",r=this.gameManager.gameEngine.parseTemplate(s,{statLabel:t,statValue:e.stats[t]+n});i.innerHTML=i.innerHTML+r}await this.events.emit("reldens.playerStatsUpdateAfter",e,this)}initUi(e){let t=this.gameEngine.uiScene;if(!t||!d.hasOwn(t.elementsUi,e.id))return c.error("User interface not found on UI Scene: "+e.id),!1;let a=t.elementsUi[e.id];this.uiSetTitle(a,e),this.uiSetContent(a,e,t);let i=a.getChildByID("box-"+e.id),s=e.keepCurrentDisplay&&"none"===i.style.display;i.style.display=s?"none":"block",a.setDepth(2),this.gameManager.config.get("client/ui/uiTarget/hideOnDialog")&&this.gameEngine.clearTarget()}uiSetTitleAndContent(e,t,a){this.uiSetTitle(e,t),this.uiSetContent(e,t,a)}uiSetTitle(e,t){let a=d.get(t,"title",!1);if(!1===a)return!1;let i=e.getChildByProperty("className","box-title");if(!i)return!1;i.innerHTML=a}uiSetContent(e,t,a){let i=d.get(t,"content",!1);if(!1===i)return!1;let s=e.getChildByProperty("className","box-content");if(!s)return!1;s.innerHTML=i,this.uiSetContentOptions(a,t,s)}uiSetContentOptions(e,t,a){if(!t.options)return!1;let i=e.cache.html.get("uiOptionsContainer"),s=this.gameManager.gameEngine.parseTemplate(i,{id:"ui-"+t.id});a.innerHTML+=s;let n=Object.keys(t.options);if(0===n.length)return!1;for(let a of n){let{label:i,value:s,icon:n}=t.options[a],r=n?"Icon":"Button",l=e.cache.html.get("uiOption"+r),c={id:a,object_id:t.id,label:i,value:s,icon:"/assets/custom/items/"+n+o.FILES.EXTENSIONS.PNG},h=this.gameManager.gameEngine.parseTemplate(l,c);this.gameDom.appendToElement("#ui-"+t.id,h);let m="#opt-"+a+"-"+t.id;this.gameDom.getElement(m)?.addEventListener("click",e=>{let a={id:t.id,act:o.BUTTON_OPTION,value:e.target.getAttribute("data-option-value")};Object.assign(a,d.get(t,"overrideSendOptions",{})),this.send(a)})}}async startEngineScene(e,t,a=!1){await this.events.emit("reldens.startEngineScene",this,e,t,a);let i=!1;this.gameEngine.uiScene||(i=!0);let s=o.SCENE_PRELOADER+this.roomName;this.gameEngine.scene.getScene(s)?await this.createEngineOnScene(s,e,t,a):await this.createPreloaderAndScene(s,i,e,t,a)}async createEngineOnScene(e,t,a,i){this.getActiveScene().objectsAnimationsData=this.roomData.objectsAnimationsData,this.scenePreloader=this.gameEngine.scene.getScene(e),await this.events.emit("reldens.createdPreloaderRecurring",this,this.scenePreloader),await this.createEngineScene(t,a,i)}async createPreloaderAndScene(e,t,a,i,s){this.scenePreloader=this.createPreloaderInstance({name:e,map:this.roomData.roomMap,images:this.roomData.sceneImages,uiScene:t,gameManager:this.gameManager,preloadAssets:this.roomData.preloadAssets,objectsAnimationsData:this.roomData.objectsAnimationsData}),this.gameEngine.scene.add(e,this.scenePreloader,!0),await this.events.emit("reldens.createdPreloaderInstance",this,this.scenePreloader);let n=this.gameEngine.scene.getScene(e);n.load.on("complete",async()=>{this.gameEngine.uiScene||(this.gameEngine.uiScene=n,this.showPlayerName(this.gameManager.playerData.id+" - "+this.gameManager.playerData.name)),await this.createEngineScene(a,i,s)})}showPlayerName(e){let t=this.gameManager.getUiElement("playerBox");if(!t)return!1;let a=t.getChildByProperty("className","player-name");if(!a)return!1;a.innerHTML=e}async createEngineScene(e,t,a){let i=this.gameEngine.scene.getScene(a);i&&i.scene.setVisible(!1),await this.events.emit("reldens.createEngineScene",e,t,a,this),this.gameManager.room?await this.destroyPreviousScene(a,e):this.gameEngine.scene.start(e.state.scene),this.gameManager.room=t;let s=this.gameEngine.scene.getScene(e.state.scene);s.player=this.createPlayerEngineInstance(s,e,this.gameManager,t),s.player.create(),this.addExistentPlayers(t,s),this.updateSceneLabel(this.roomData.roomTitle),this.send({act:o.PLAYER_STATS}),this.send({act:o.CLIENT_JOINED});let n={player:s.player,previousScene:a,roomEvents:this};await this.events.emit("reldens.playersOnAddReady",n);let r={currentScene:s,previousScene:a,roomEvents:this};return await this.events.emit("reldens.createEngineSceneDone",r),r}addExistentPlayers(e,t){if(0===this.playersCountFromState(e))return!1;for(let a of this.playersKeysFromState(e)){let i=this.playerBySessionIdFromState(e,a);if(!i.sessionId||i.sessionId===e.sessionId)continue;let s={x:i.state.x,y:i.state.y,dir:i.state.dir,playerName:i.playerName,playedTime:i.playedTime,avatarKey:i.avatarKey,player_id:i.player_id};t.player.addPlayer(i.sessionId,s)}}playerBySessionIdFromState(e,t){return e.state.players.get(t)}playersCountFromState(e){return e.state.players.size}playersKeysFromState(e){return Array.from(e.state.players.keys())}async destroyPreviousScene(e,t){if(!e)return c.warning("Missing previous scene data.",e),!1;let a=this.gameEngine.scene.getScene(e);if(!a)return c.warning("Missing previous scene instance.",a),!1;await a.changeScene(),this.gameEngine.scene.stop(e),this.gameEngine.scene.start(t.state.scene)}updateSceneLabel(e){let t=this.gameManager.getUiElement("sceneLabel");if(!t)return!1;let a=t.getChildByProperty("className","scene-label");if(!a)return!1;a.innerHTML=e}getActiveScene(){return this.gameEngine.scene.getScene(this.roomName)}createSceneInstance(e,t,a){return new n(e,t,a)}createPlayerEngineInstance(e,t,a,i){return new s({scene:e,playerData:t,gameManager:a,room:i,roomEvents:this})}createPreloaderInstance(e){return new r(e)}send(e,t){try{if(this.room.connection.transport.ws.readyState===this.room.connection.transport.ws.CLOSED&&l.error("Connection lost."),this.room.connection.transport.ws.readyState===this.room.connection.transport.ws.CLOSING)return!1;return t||(t="*"),this.room.send(t,e),!0}catch(t){c.critical(t.message,e)}this.gameDom.alertReload(this.gameManager.services.translator.t("game.errors.connectionLost"))}}},{"5dadcfc2f4ec048c":"4CLBQ","5ea13611f87f0f9f":"7VRPQ","171055bce58a5ac9":"hvzDh",e471cce0414cdafb:"52yv8","9055603bf8657355":"@reldens/utils"}],"4CLBQ":[function(e,t,a,i){let{SpriteTextFactory:s}=e("6963bf9442f4e594"),{GameConst:n}=e("39d7aae435f21d2a"),{ActionsConst:r}=e("728f6282fc7a7dc2"),{Logger:o,sc:l}=e("e1020565cb5e4c52");t.exports.PlayerEngine=class{constructor(e){let{scene:t,playerData:a,gameManager:i,room:s,roomEvents:n}=e;this.scene=t,this.config=i.config,this.gameManager=i,this.events=i.events,this.playerName=a.playerName,this.avatarKey=a.avatarKey,this.roomName=a.state.scene,this.state=a.state,this.room=s,this.roomEvents=n,this.playerId=s.sessionId,this.player_id=a.player_id,this.players={},this.playedTime=a.playedTime,this.mov=!1,this.dir=!1,this.currentTarget=!1,this.pointsValidator=!1,this.animationBasedOnPress=this.config.get("client/players/animations/basedOnPress"),this.topOff=this.config.get("client/players/size/topOffset"),this.leftOff=this.config.get("client/players/size/leftOffset"),this.collideWorldBounds=this.config.get("client/players/animations/collideWorldBounds"),this.fadeDuration=Number(this.config.get("client/players/animations/fadeDuration")),this.cameraRoundPixels=!!this.config.getWithoutLogs("client/general/engine/cameraRoundPixels",!0),this.cameraInterpolationX=Number(this.config.getWithoutLogs("client/general/engine/cameraInterpolationX",.02)),this.cameraInterpolationY=Number(this.config.getWithoutLogs("client/general/engine/cameraInterpolationY",.02)),this.globalConfigNameText=this.config.get("client/ui/players/nameText"),this.globalConfigShowNames=!!this.config.get("client/ui/players/showNames"),this.globalConfigShowNamesLimit=this.config.getWithoutLogs("client/ui/players/showNamesLimit",10),this.defaultActionKeyConfig=this.config.get("client/ui/controls/defaultActionKey"),this.highlightOnOver=!!this.config.getWithoutLogs("client/ui/players/highlightOnOver",!0),this.highlightColor=this.config.getWithoutLogs("client/ui/players/highlightColor","0x00ff00"),this.lastKeyState={}}create(){let e={x:this.state.x,y:this.state.y,dir:this.state.dir,playerName:this.playerName,avatarKey:this.avatarKey,playedTime:this.playedTime,player_id:this.player_id};this.addPlayer(this.playerId,e),this.scene.cameras.main.startFollow(this.players[this.playerId]),this.scene.scene.setVisible(!0,this.roomName),this.scene.cameras.main.fadeFrom(this.fadeDuration),this.scene.physics.world.fixedStep=!1,this.scene.physics.world.setBounds(0,0,this.scene.map.widthInPixels,this.scene.map.heightInPixels),this.scene.cameras.main.setBounds(0,0,this.scene.map.widthInPixels,this.scene.map.heightInPixels),this.scene.cameras.main.setIsSceneCamera(!0),this.scene.cameras.main.on("camerafadeincomplete",()=>{this.scene.cameras.main.startFollow(this.players[this.playerId]),this.scene.cameras.main.setLerp(this.cameraInterpolationX,this.cameraInterpolationY),this.scene.cameras.main.setRoundPixels(this.cameraRoundPixels)})}addPlayer(e,t){if(l.hasOwn(this.players,e))return this.players[e];let{x:a,y:i,dir:s,playerName:n,avatarKey:r,playedTime:o,player_id:c}=t,d=this.gameManager.mappedAvatars[r];return this.players[e]=this.scene.physics.add.sprite(a,i-this.topOff,d),this.players[e].playerName=n,this.players[e].playedTime=o,this.players[e].avatarKey=r,this.players[e].playerId=e,this.players[e].player_id=c,this.players[e].anims.play(d+"_"+s),this.players[e].anims.stop(),this.showPlayerName(e),this.makePlayerInteractive(e),this.players[e].moveSprites={},this.players[e].setDepth(this.players[e].y+this.players[e].body.height),this.players[e].setCollideWorldBounds(this.collideWorldBounds),this.events.emitSync("reldens.playerEngineAddPlayer",this,e,t),this.players[e]}makePlayerInteractive(e){this.players[e].setInteractive({useHandCursor:!0}).on("pointerdown",t=>{if(n.SELECTORS.CANVAS!==t.downElement.nodeName)return!1;this.setTargetPlayerById(e)}),this.highlightOnOver&&(this.players[e].on("pointerover",()=>{this.players[e].setTint(this.highlightColor)}),this.players[e].on("pointerout",()=>{this.players[e].clearTint()}))}setTargetPlayerById(e){if(!l.get(this.players,e,!1))return o.info('Target player ID "'+e+'" was not found.'),this.gameManager.gameEngine.clearTarget(),!1;let t=Object.assign({},this.currentTarget);this.currentTarget={id:e,type:n.TYPE_PLAYER,player_id:this.players[e].player_id},this.gameManager.gameEngine.showTarget(this.players[e].playerName,this.currentTarget,t)}showPlayerName(e){if(!this.globalConfigShowNames)return!1;if(!this.players[e])return o.critical('Player ID "'+e+'" not found.',this.players),!1;let t=this.players[e].playerName;if(!t)return o.critical('Player name not found on player ID "'+e+'".',this.players[e]),!1;s.attachTextToSprite(this.players[e],this.applyNameLengthLimit(t),this.globalConfigNameText,this.topOff,"nameSprite",this.scene)}applyNameLengthLimit(e){return 0<this.globalConfigShowNamesLimit&&e.length>this.globalConfigShowNamesLimit&&(e=e.slice(0,this.globalConfigShowNamesLimit)+"..."),e}updatePlayer(e,t){let a=this.players[e];if(!a)return void o.error("PlayerSprite not defined.",this.players,e);if(o.debug('Updating player ID "'+e+'". - Current player ID "'+this.player_id+'".'),this.scene.clientInterpolation){this.scene.interpolatePlayersPosition[e]=t.state;return}this.processPlayerPositionAnimationUpdate(a,t.state,e,t.state.x-this.leftOff,t.state.y-this.topOff)}processPlayerPositionAnimationUpdate(e,t,a,i=0,s=0){if(o.debug("Process player position animation update.",{playerSprite:e,playerState:t,playerId:a,newX:i,newY:s}),!e)return void o.error("Missing player sprite to process animation update.",e,t,a);if(!t)return void o.error("Missing player state to process animation update.",e,t,a);if(!a)return void o.error("Missing player ID to process animation update.",e,t,a);if(0!==Object.keys(this.scene.interpolatePlayersPosition).length){if(n.STATUS.DEATH===t.inState||n.STATUS.DISABLED===t.inState)return void delete this.scene.interpolatePlayersPosition[a];this.playPlayerAnimation(e,t,a),this.stopPlayerAnimation(e,t),this.updateSpritePosition(e,i,s),this.updatePlayerState(e,t,a)}}updatePlayerState(e,t,a){let i=e.y+e.body.height;e.depth!==i&&e.setDepth(i),this.events.emitSync("reldens.runPlayerAnimation",this,a,t,e),this.updateNamePosition(e),this.moveAttachedSprites(e,i)}updateSpritePosition(e,t,a){e.x!==t&&(e.x=t),e.y!==a&&(e.y=a)}updateNamePosition(e){if(!this.globalConfigShowNames||!e.nameSprite)return!1;let t=s.getTextPosition(e,this.applyNameLengthLimit(e.playerName),this.globalConfigNameText,this.topOff);e.nameSprite.x=t.x,e.nameSprite.y=t.y}moveAttachedSprites(e,t){let a=Object.keys(e.moveSprites);if(0===a.length)return!1;for(let i of a){let a=e.moveSprites[i];if(a.x===e.x&&a.y===e.y)continue;a.x=e.x,a.y=e.y;let s=t+("above"===l.get(a,"depthByPlayer","")?1:-.1);o.debug('Sprite "'+i+'" new depth: '+s+".",a),a.setDepth(s)}}playPlayerAnimation(e,t,a){if(this.isDeath(t)||this.isDisabled(t))return o.debug('Player with ID "'+a+'" is disabled to play the animation.',t),!1;o.debug("Play player animation.",e.avatarKey,t);let i=this.gameManager.mappedAvatars[e.avatarKey];if(this.animationBasedOnPress){let a=i+"_"+t.dir;return t.x===e.x&&t.y===e.y?(o.debug('Player has not changed, skipped animation "'+a+'".'),!1):(o.debug("Animation played based on press active.",i,{x:t.x+" / "+e.x,y:t.y+" / "+e.y}),void e.anims.play(a,!0))}if(t.x!==e.x){let a=t.x<e.x?i+"_"+n.LEFT:i+"_"+n.RIGHT;e.anims.play(a,!0)}if(t.y!==e.y){let a=t.y<e.y?i+"_"+n.UP:i+"_"+n.DOWN;e.anims.play(a,!0)}}stopPlayerAnimation(e,t){t.mov||(e.anims.stop(),e.mov=t.mov)}removePlayer(e){l.hasOwn(this.players,e)&&l.hasOwn(this.players[e],"nameSprite")&&(this.players[e].nameSprite.destroy(),this.players[e].destroy(),delete this.players[e])}left(){"pressed"!==this.lastKeyState[n.LEFT]&&(this.lastKeyState[n.LEFT]="pressed",this.roomEvents.send({dir:n.LEFT}))}right(){"pressed"!==this.lastKeyState[n.RIGHT]&&(this.lastKeyState[n.RIGHT]="pressed",this.roomEvents.send({dir:n.RIGHT}))}up(){"pressed"!==this.lastKeyState[n.UP]&&(this.lastKeyState[n.UP]="pressed",this.roomEvents.send({dir:n.UP}))}down(){"pressed"!==this.lastKeyState[n.DOWN]&&(this.lastKeyState[n.DOWN]="pressed",this.roomEvents.send({dir:n.DOWN}))}stop(){this.lastKeyState[n.LEFT]="",this.lastKeyState[n.RIGHT]="",this.lastKeyState[n.UP]="",this.lastKeyState[n.DOWN]="",this.roomEvents.send({act:n.STOP})}runActions(){let e=this.defaultActionKeyConfig||"physical_attack";this.roomEvents.send({act:r.ACTION,type:e,target:this.currentTarget})}moveToPointer(e){if(this.isDeath()||this.isDisabled())return this.fullStop(),!1;this.lastKeyState[n.LEFT]="",this.lastKeyState[n.RIGHT]="",this.lastKeyState[n.UP]="",this.lastKeyState[n.DOWN]="",this.roomEvents.send({act:n.POINTER,column:e.worldColumn,row:e.worldRow,x:e.worldX-this.leftOff,y:e.worldY-this.topOff})}isDisabled(e){return e||(e=this.state),n.STATUS.DISABLED===e.inState}isDeath(e){return e||(e=this.state),n.STATUS.DEATH===e.inState}fullStop(){delete this.scene.interpolatePlayersPosition[this.player_id],this.stop()}getPosition(){return{x:this.players[this.playerId].x,y:this.players[this.playerId].y}}}},{"6963bf9442f4e594":"8erjr","39d7aae435f21d2a":"52yv8","728f6282fc7a7dc2":"hmzhe",e1020565cb5e4c52:"@reldens/utils"}],"8erjr":[function(e,t,a,i){let{sc:s}=e("76fa5b97e5b08abb");t.exports.SpriteTextFactory=class{static attachTextToSprite(e,t,a,i,n,r){let o=this.getTextPosition(e,t,a,i),l=r.add.text(o.x,o.y,t,{fontFamily:s.get(a,"fontFamily","sans-serif"),fontSize:s.get(a,"fontSize","12px")});return l.style.setFill(s.get(a,"fill","#ffffff")),l.style.setAlign(s.get(a,"align","center")),l.style.setStroke(s.get(a,"stroke","#000000"),s.get(a,"strokeThickness",4)),l.style.setShadow(s.get(a,"shadowX",5),s.get(a,"shadowY",5),s.get(a,"shadowColor","rgba(0,0,0,0.7)"),s.get(a,"shadowBlur",5)),l.setDepth(s.get(a,"depth",2e5)),e[n]=l,l}static getTextPosition(e,t,a,i=0){if(!e)return{x:0,y:0};let n=s.get(a,"height",18);return{x:e.x-t.length*s.get(a,"textLength",4),y:e.y-n-e.height+i}}}},{"76fa5b97e5b08abb":"@reldens/utils"}],hmzhe:[function(e,t,a,i){let s="actions.";t.exports.ActionsConst={BATTLE_TYPE_PER_TARGET:"bt",BATTLE_TYPE_GENERAL:"bg",BATTLE_ENDED:"bend",TARGET_POSITION:"tgp",TARGET_PLAYER:"tga",TARGET_OBJECT:"tgo",FULL_SKILLS_LIST:"fkl",ACTION:"action",DATA_OBJECT_KEY_TARGET:"t",DATA_OBJECT_KEY_OWNER:"o",DATA_TARGET_TYPE:"tT",DATA_TARGET_KEY:"tK",DATA_OWNER_TYPE:"oT",DATA_OWNER_KEY:"oK",DATA_TYPE_VALUE_ENEMY:"e",DATA_TYPE_VALUE_PLAYER:"p",DATA_TYPE_VALUE_OBJECT:"o",EXTRA_DATA:{KEY:"sked",SKILL_DELAY:"sd"},DEFAULT_HIT_ANIMATION_KEY:"default_hit",ACTIONS:{SUFFIX:{ATTACK:"_atk",EFFECT:"_eff",HIT:"_hit"}},MESSAGE:{DATA:{LEVEL:"lvl",EXPERIENCE:"exp",CLASS_PATH_LABEL:"lab",NEXT_LEVEL_EXPERIENCE:"ne",SKILL_LEVEL:"skl",LAST_ATTACK_KEY:"k"},DATA_VALUES:{NAMESPACE:"actions",lvl:"level",exp:"experience",lab:"classPathLabel",ne:"nextLevelExperience",skl:"skillLevel"}},SELECTORS:{LEVEL_LABEL:".level-container .level-label",CURRENT_EXPERIENCE:".experience-container .current-experience",NEXT_LEVEL_EXPERIENCE:".experience-container .next-level-experience",PLAYER_CREATE_FORM:"#player-create-form",UI_PLAYER_EXTRAS:"#ui-player-extras",PLAYER_CREATION_ADDITIONAL_INFO:".player-creation-additional-info",PLAYER_SELECTION_ADDITIONAL_INFO:".player-selection-additional-info",CLASS_PATH_LABEL:".class-path-container .class-path-label",SKILLS_CONTAINER:".skills-container"},SNIPPETS:{PREFIX:s,SELECT_CLASS_PATH:s+"selectClassPath",EXPERIENCE_LABEL:s+"experienceLabel",LEVEL:s+"currentLevel",CLASS_PATH_LABEL:s+"classPathLabel",NEXT_LEVEL_EXPERIENCE:s+"nextLevelExperience",EXPERIENCE:s+"experience"}}},{}],"7VRPQ":[function(e,t,a,i){let{Scene:s,Input:n}=e("56de17c4ccf45c73"),{TileSetAnimation:r}=e("b334ee32beb899f2"),{Minimap:o}=e("13bc6189b150e929"),{GameConst:l}=e("c03f8a1b2de25882"),{ActionsConst:c}=e("8ff1637c59b70d9"),{Logger:d,sc:h}=e("bb692a977dadc69f"),{ObjectsConst:m}=e("185341906c7b3aa0");t.exports.SceneDynamic=class extends s{constructor(e,t,a){super({key:e}),this.key=e,this.params=t,this.gameManager=a,this.eventsManager=a.events,this.configManager=a.config,this.layers={},this.transition=!0,this.useTsAnimation=!1,this.arrowSprite=!1,this.objectsAnimationsData=!1,this.objectsAnimations={},this.setPropertiesFromConfig(),this.minimap=this.createMinimapInstance(this.minimapConfig),this.player=!1,this.interpolatePlayersPosition={},this.interpolateObjectsPositions={},this.tilesets=[],this.tilesetAnimations=[],this.stopOnDeathOrDisabledSent=!1}setPropertiesFromConfig(){return this.configManager?(this.configuredFrameRate=this.configManager.getWithoutLogs("client/general/animations/frameRate",10),this.clientInterpolation=this.configManager.getWithoutLogs("client/general/engine/clientInterpolation",!0),this.interpolationSpeed=this.configManager.getWithoutLogs("client/general/engine/interpolationSpeed",.1),this.minimapConfig=this.configManager.getWithoutLogs("client/ui/minimap",{}),!0):(this.configuredFrameRate=10,this.clientInterpolation=!0,this.interpolationSpeed=.1,this.minimapConfig={},!1)}createMinimapInstance(e){return!!this.minimapConfig.enabled&&new o({config:e,events:this.eventsManager})}init(){this.scene.setVisible(!1,this.key),this.input.keyboard.removeAllListeners()}async create(){this.eventsManager.emitSync("reldens.beforeSceneDynamicCreate",this),this.disableContextMenu(),this.createControllerKeys(),this.setupKeyboardAndPointerEvents(),await this.createSceneMap(),this.cameras.main.on("camerafadeincomplete",()=>{this.transition=!1,this.gameManager.gameDom.activeElement().blur(),this.minimap.createMap(this,this.gameManager.getCurrentPlayerAnimation()),this.gameManager.isChangingScene=!1}),this.eventsManager.emitSync("reldens.afterSceneDynamicCreate",this)}update(e,t){this.interpolatePositions(),this.movePlayerByPressedButtons()}disableContextMenu(){if(!this.gameManager.config.get("client/ui/controls/disableContextMenu"))return!1;this.gameManager.gameDom.getDocument().addEventListener("contextmenu",e=>{e.preventDefault(),e.stopPropagation()})}setupKeyboardAndPointerEvents(){this.input.keyboard.on("keydown",e=>this.executeKeyDownBehavior(e)),this.input.keyboard.on("keyup",e=>{this.executeKeyUpBehavior(e)}),this.input.on("pointerdown",(e,t)=>this.executePointerDownAction(e,t))}async createSceneMap(){for(let e of(this.map=this.make.tilemap({key:this.params.roomName}),this.params.sceneImages)){let t=this.map.addTilesetImage(this.params.roomName,e);t||d.critical("Tileset creation error. Check if the tileset name equals the imageKey without the extension.",{roomName:this.params.roomName,imageKeys:this.params.sceneImages,createdTileset:t}),this.tilesets.push(t)}this.registerLayers(),this.registerTilesetAnimation()}registerTilesetAnimation(){for(let e of this.tilesets)if(this.hasTilesetAnimations(e))for(let t of(this.useTsAnimation=!0,Object.keys(this.layers))){let a=this.layers[t],i=new r;i.register(a,e),i.start(),this.tilesetAnimations.push(i)}}hasTilesetAnimations(e){let t=e?.tileData||{},a=Object.keys(t);if(0===a.length)return!1;for(let e of a)if(t[e].animation)return!0;return!1}executeKeyDownBehavior(e){if(this.gameManager.gameDom.insideInput())return!1;if(n.Keyboard.KeyCodes.SPACE===e.keyCode&&!this.gameManager.gameDom.insideInput()){if(!this.player)return;if(!this.player.currentTarget){let e=null,t="",a=this.objectsAnimations||{};for(let i of Object.keys(a)){let s=a[i];if(s.type!==m.TYPE_ENEMY)continue;let n=Math.hypot(s.x-this.player.state.x,s.y-this.player.state.y);(!e||n<e.dist)&&(e={id:s.key,type:m.TYPE_OBJECT,dist:n},t=s.targetName||"")}if(e){let a=!!this.player.currentTarget&&Object.assign({},this.player.currentTarget);this.player.currentTarget={id:e.id,type:m.TYPE_OBJECT},this.gameManager.gameEngine.showTarget(t,this.player.currentTarget,a)}}this.player.runActions()}n.Keyboard.KeyCodes.ESC===e.keyCode&&this.gameManager.gameEngine.clearTarget(),n.Keyboard.KeyCodes.F5===e.keyCode&&(this.gameManager.forcedDisconnection=!0)}executeKeyUpBehavior(e){this.player&&-1!==this.availableControllersKeyCodes().indexOf(e.keyCode)&&this.player.stop()}createControllerKeys(){this.keyLeft=this.input.keyboard.addKey(n.Keyboard.KeyCodes.LEFT),this.keyA=this.input.keyboard.addKey(n.Keyboard.KeyCodes.A),this.keyRight=this.input.keyboard.addKey(n.Keyboard.KeyCodes.RIGHT),this.keyD=this.input.keyboard.addKey(n.Keyboard.KeyCodes.D),this.keyUp=this.input.keyboard.addKey(n.Keyboard.KeyCodes.UP),this.keyW=this.input.keyboard.addKey(n.Keyboard.KeyCodes.W),this.keyDown=this.input.keyboard.addKey(n.Keyboard.KeyCodes.DOWN),this.keyS=this.input.keyboard.addKey(n.Keyboard.KeyCodes.S);let e=this.availableControllersKeyCodes();for(let t of this.gameManager.gameDom.getElements("input"))this.addAndRemoveCapture(e,t)}addAndRemoveCapture(e,t){this.loopKeysAddListenerToElement(e,t,"focusin","removeCapture"),this.loopKeysAddListenerToElement(e,t,"click","removeCapture"),this.loopKeysAddListenerToElement(e,t,"focusout","addCapture"),this.loopKeysAddListenerToElement(e,t,"blur","addCapture")}availableControllersKeyCodes(){return[n.Keyboard.KeyCodes.LEFT,n.Keyboard.KeyCodes.A,n.Keyboard.KeyCodes.RIGHT,n.Keyboard.KeyCodes.D,n.Keyboard.KeyCodes.UP,n.Keyboard.KeyCodes.W,n.Keyboard.KeyCodes.DOWN,n.Keyboard.KeyCodes.S]}executePointerDownAction(e,t){if(0<t.length||!this.gameManager.config.get("client/players/tapMovement/enabled")||this.gameManager.activeRoomEvents.roomData?.worldConfig?.applyGravity)return!1;let a=this.gameManager.config.get("client/ui/controls/primaryMove"),i=this.gameManager.config.get("client/ui/controls/allowPrimaryTouch");return(!!e.wasTouch||!!e.primaryDown||!a)&&(!!e.wasTouch||!e.primaryDown||!!a)&&(!e.wasTouch||!!e.primaryDown||!i)&&(this.gameManager.gameDom.insideInput()&&this.gameManager.gameDom.activeElement().blur(),!!this.appendRowAndColumn(e)&&void(this.player.moveToPointer(e),this.updatePointerObject(e)))}movePlayerByPressedButtons(){if(!this.gameManager.gameDom.insideInput()&&!this.transition&&!this.gameManager.isChangingScene){if(this.player.isDeath()||this.player.isDisabled()){this.stopOnDeathOrDisabledSent||this.player.fullStop(),this.stopOnDeathOrDisabledSent=!0;return}(this.keyRight.isDown||this.keyD.isDown)&&this.player.right(),(this.keyLeft.isDown||this.keyA.isDown)&&this.player.left(),(this.keyDown.isDown||this.keyS.isDown)&&this.player.down(),(this.keyUp.isDown||this.keyW.isDown)&&this.player.up()}}interpolatePositions(){this.clientInterpolation&&(this.processPlayersPositionInterpolation(),this.processObjectsPositionInterpolation())}processPlayersPositionInterpolation(){let e=Object.keys(this.interpolatePlayersPosition);if(0!==e.length&&h.get(this.player,"players"))for(let t of e){let e=this.interpolatePlayersPosition[t];if(!e)continue;let a=this.player.players[t];if(!a)continue;if(this.isCurrentPosition(a,e)){delete this.interpolatePlayersPosition[t];continue}let i=h.roundToPrecision(Phaser.Math.Linear(a.x,e.x-this.player.leftOff,this.interpolationSpeed),2),s=h.roundToPrecision(Phaser.Math.Linear(a.y,e.y-this.player.topOff,this.interpolationSpeed),2);this.player.processPlayerPositionAnimationUpdate(a,e,t,i,s),e.mov||delete this.interpolatePlayersPosition[t]}}processObjectsPositionInterpolation(){let e=Object.keys(this.interpolateObjectsPositions);if(0===e.length)return;let t=this.gameManager.getFeature("objects");for(let a of e)this.interpolateBulletPosition(a,t),this.interpolateObjectAnimationPosition(a,t)}interpolateBulletPosition(e,t){if(!this.isBullet(e))return;let a=h.get(t.bullets,e);if(!a)return;let i=this.interpolateObjectsPositions[e];if(!i)return;if(this.isCurrentPosition(a,i))return void delete this.interpolateObjectsPositions[e];let s=h.roundToPrecision(Phaser.Math.Linear(a.x,i.x,this.interpolationSpeed),0),n=h.roundToPrecision(Phaser.Math.Linear(a.y,i.y,this.interpolationSpeed),0);t.updateBulletBodyPosition(e,{x:s,y:n}),i.mov||delete this.interpolateObjectsPositions[e]}isBullet(e){return -1!==e.indexOf("bullet")}interpolateObjectAnimationPosition(e,t){let a=this.objectsAnimations[e];if(!a)return;let i=this.interpolateObjectsPositions[e];if(!i)return;if(this.isCurrentPosition(a,i))return void delete this.interpolateObjectsPositions[e];let s={x:h.roundToPrecision(Phaser.Math.Linear(a.x,i.x,this.interpolationSpeed),0),y:h.roundToPrecision(Phaser.Math.Linear(a.y,i.y,this.interpolationSpeed),0),inState:i.inState,mov:i.mov};t.updateObjectsAnimations(e,s,this),i.mov||delete this.interpolateObjectsPositions[e]}isCurrentPosition(e,t){return e&&t?Math.round(e.x)===Math.round(t.x)&&Math.round(e.y)===Math.round(t.y):(d.warning("None entity found to compare current entity position."),!1)}async changeScene(){if(this.minimap?.destroyMap(),this.eventsManager.emitSync("reldens.changeSceneDestroyPrevious",this),this.objectsAnimations={},this.objectsAnimationsData=!1,this.useTsAnimation)for(let e of this.tilesetAnimations)e.destroy()}registerLayers(){if(0===this.map.layers.length)return;let e=0,t=this.configManager.get("client/map/layersDepth/belowPlayer"),a=this.configManager.get("client/map/layersDepth/changePoints");for(let i of this.map.layers){if(this.layers[e]=this.map.createLayer(i.name,this.tilesets),!this.layers[e]){d.critical("Map layer could not be created.",i.name,this.key);continue}-1!==i.name.indexOf("below-player")&&this.layers[e].setDepth(t),-1!==i.name.indexOf("over-player")&&this.layers[e].setDepth(e*this.map.height*this.map.tileHeight),-1!==i.name.indexOf("change-points")&&this.layers[e].setDepth(a),e++}}appendRowAndColumn(e){let t=this.map.worldToTileXY(e.worldX,e.worldY),a=this.map.worldToTileXY(this.player.state.x,this.player.state.y);return t&&a?(e.worldColumn=t.x,e.worldRow=t.y,e.playerOriginCol=a.x,e.playerOriginRow=a.y,e):(d.error("Move to pointer error."),!1)}createFloatingText(e,t,a,i,s,n=14,r=600,o=50,l="#000000",c=4,d="rgba(0,0,0,0.7)"){let h=this.add.text(e,t,a,{fontFamily:s,fontSize:n+"px"});h.style.setColor(i),h.style.setAlign("center"),h.style.setStroke(l,c),h.style.setShadow(5,5,d,5),h.setDepth(2e5),this.add.tween({targets:h,duration:r,ease:"Exponential.In",y:t-o,onComplete:()=>{h.destroy()}})}updatePointerObject(e){if(!this.configManager.get("client/ui/pointer/show"))return;this.arrowSprite&&this.arrowSprite.destroy();let t=this.configManager.get("client/ui/pointer/topOffSet",16);this.arrowSprite=this.physics.add.sprite(e.worldX,e.worldY-t,l.ARROW_DOWN),this.arrowSprite.setDepth(5e5),this.arrowSprite.anims.play(l.ARROW_DOWN,!0).on("animationcomplete",()=>{this.arrowSprite.destroy()})}getAnimationByKey(e){return this.anims&&this.anims?.anims&&this.anims?.anims?.entries?h.get(this.anims.anims.entries,e,!1):(d.error("Animations not loaded.",this.anims),!1)}getObjectFromExtraData(e,t,a){let i=!1,s=e+"K",n=t[e+"T"]===c.DATA_TYPE_VALUE_PLAYER;return!n&&h.hasOwn(this.objectsAnimations,t[s])&&(i=this.objectsAnimations[t[s]]),n&&h.hasOwn(a.players,t[s])&&(i=a.players[t[s]]),i}loopKeysAddListenerToElement(e,t,a,i){t.addEventListener(a,()=>{for(let t of e)this.input.keyboard[i](t)})}}},{"56de17c4ccf45c73":"phaser",b334ee32beb899f2:"6eWOm","13bc6189b150e929":"jIqNK",c03f8a1b2de25882:"52yv8","8ff1637c59b70d9":"hmzhe",bb692a977dadc69f:"@reldens/utils","185341906c7b3aa0":"fEftg"}],"6eWOm":[function(e,t,a,i){t.exports.TileSetAnimation=class{constructor(e){this.timer=e?.timer}register(e,t){for(let a of(this.animations=[],this.registered={},this.layer=e,this.tileset=t,Object.keys(t.tileData))){let e=t.tileData[a];if(!e.animation)continue;e.id=a;let i=0;for(let t of e.animation){if(Number(a)===Number(t?.tileid||0)){e.initIndex=i;break}i++}this.animations.push(e)}}start(){for(let e of this.animations){let t=e.animation.length,a=Number(e.initIndex||0),i=Number((a+1)%t);this.repeat(e,a,i)}}repeat(e,t,a){let i=e.id;this.registered[i]&&(this.registered[i]=null);let s=e.animation,n=s.length,r=Number(this.tileset.firstgid),o=Number(e.animation[t].tileid)+r,l=Number(e.animation[a].tileid)+r;this.layer.replaceByIndex(o,l);let c=s[a].duration,d=Number((a+1)%n);this.registered[i]=this.setTimeout(this.repeat.bind(this,e,Number(a),d),c)}destroy(){for(let e of Object.keys(this.registered))this.registered[e]&&this.clearTimeout(this.registered[e])}setTimeout(e,t){return this.timer?this.timer.setTimeout(e,t):setTimeout(e,t)}clearTimeout(e){if(this.timer)return this.timer.clearTimeout(e);clearTimeout(e)}}},{}],jIqNK:[function(e,t,a,i){let{sc:s}=e("c1999f9b5d5e09ce");t.exports.Minimap=class{constructor(e){this.config=e.config,this.events=e.events}createMap(e,t){this.minimapCamera=!1,this.circle=!1,this.scope=!1,this.awaitOnCamera=s.get(this.config,"awaitOnCamera",400),this.autoWidth=e.map.widthInPixels/s.get(this.config,"mapWidthDivisor",1),this.camWidth=s.get(this.config,"fixedWidth",this.autoWidth),this.autoHeight=e.map.heightInPixels/s.get(this.config,"mapHeightDivisor",1),this.camHeight=s.get(this.config,"fixedHeight",this.autoHeight),this.camX=s.get(this.config,"camX",0),this.camY=s.get(this.config,"camY",0),this.camBackgroundColor=s.get(this.config,"camBackgroundColor","rgba(0,0,0,0.6)"),this.camZoom=s.get(this.config,"camZoom",.15),this.roundMap=s.get(this.config,"roundMap",!1),this.addCircle=s.get(this.config,"addCircle",!1),this.createMinimapCamera(e,t),this.createRoundMap(e),this.events.emitSync("reldens.createdMinimap",this)}createMinimapCamera(e,t){this.minimapCamera=e.cameras.add(this.camX,this.camY,this.camWidth,this.camHeight).setName("minimap").setBackgroundColor(this.camBackgroundColor).setZoom(this.camZoom).startFollow(t,s.get(this.config,"mapCameraRoundPixels",!0),s.get(this.config,"mapCameraLerpX",1),s.get(this.config,"mapCameraLerpY",1)).setRoundPixels(!0).setVisible(!1).setOrigin(s.get(this.config,"mapCameraOriginX",.18),s.get(this.config,"mapCameraOriginY",.18))}createRoundMap(e){if(!this.roundMap)return!1;this.addCircle&&this.addMinimapCircle(e),this.createRoundCamera(e)}addMinimapCircle(e){let t=e.gameManager.getActiveScenePreloader();this.circle=t.add.circle(s.get(this.config,"circleX",220),s.get(this.config,"circleY",88),s.get(this.config,"circleRadio",80.35),s.get(this.config,"circleColor","rgb(0,0,0)"),s.get(this.config,"circleAlpha",1)),this.circle.setStrokeStyle(s.get(this.config,"circleStrokeLineWidth",6),s.get(this.config,"circleStrokeColor",0),s.get(this.config,"circleStrokeAlpha",.6)),this.circle.setFillStyle(s.get(this.config,"circleFillColor",1),s.get(this.config,"circleFillAlpha",0)),this.circle.setVisible(!1)}createRoundCamera(e){this.scope=e.add.graphics(),this.scope.fillStyle(0,0).fillCircle(s.get(this.config,"circleX",220),s.get(this.config,"circleY",88),s.get(this.config,"circleRadio",80.35)),this.minimapCamera.setMask(this.scope.createGeometryMask())}destroyMap(){delete this.minimapCamera,delete this.circle,delete this.scope}}},{c1999f9b5d5e09ce:"@reldens/utils"}],hvzDh:[function(e,t,a,i){let{Scene:s,Geom:n}=e("8f766b8f0d7630d6"),{MinimapUi:r}=e("64a334dcd3e65bd4"),{InstructionsUi:o}=e("936bc5003291bd3d"),{SettingsUi:l}=e("c21ef162a4dcfda6"),{Joystick:c}=e("ad6886ec1b7e2757"),{GameConst:d}=e("835464c1daa61ed6"),{ActionsConst:h}=e("eab2c5783e5cea80"),{Logger:m,sc:g}=e("36253877d5e76351");t.exports.ScenePreloader=class extends s{constructor(e){super({key:e.name}),this.relatedSceneKey=e.name.replace(d.SCENE_PRELOADER,""),this.progressBar=null,this.progressCompleteRect=null,this.progressRect=null,this.userInterfaces={},this.preloadMapKey=e.map,this.preloadImages=e.images,this.uiScene=e.uiScene,this.elementsUi={},this.gameManager=e.gameManager,this.eventsManager=e.gameManager.events,this.preloadAssets=e.preloadAssets||{},this.directionalAnimations={},this.objectsAnimations={},this.gameManager.createdAnimations||(this.gameManager.createdAnimations={}),this.gameManager.activeRoomEvents.getActiveScene().objectsAnimationsData=e.objectsAnimationsData,this.playerSpriteSize={frameWidth:this.gameManager.config.get("client/players/size/width",52),frameHeight:this.gameManager.config.get("client/players/size/height",71)},this.useJoystick=this.gameManager.config.getWithoutLogs("client/ui/controls/useJoystick",!1),this.joystick=new c({scenePreloader:this})}preload(){let e=this.uiScene?this:this.gameManager.gameEngine.uiScene;this.eventsManager.emitSync("reldens.beforePreload",this,e),this.preloadUiScene(),this.preloadMapJson(),this.preloadMapImages(),this.preloadValidAssets(),this.preloadPlayerDefaultSprite(),this.preloadArrowPointer(),this.load.image(d.ICON_STATS,this.gameManager.config.get("client/general/assets/statsIconPath","/assets/icons/book.png")),this.load.on("fileprogress",this.onFileProgress,this),this.load.on("progress",this.onLoadProgress,this),this.load.on("complete",this.onLoadComplete,this),this.configuredFrameRate=this.gameManager.config.get("client/general/animations/frameRate",10),this.showLoadingProgressBar()}preloadMapJson(){this.preloadMapKey&&this.load.tilemapTiledJSON(this.preloadMapKey,"/assets/maps/"+this.preloadMapKey+".json")}preloadArrowPointer(){if(!this.gameManager.config.get("client/ui/pointer/show"))return;let e={frameWidth:this.gameManager.config.getWithoutLogs("client/general/assets/arrowDownFrameWidth",32),frameHeight:this.gameManager.config.getWithoutLogs("client/general/assets/arrowDownFrameHeight",32)};this.load.spritesheet(d.ARROW_DOWN,this.gameManager.config.get("client/general/assets/arrowDownPath","/assets/sprites/arrow-down.png"),e)}preloadUiScene(){this.uiScene&&(this.eventsManager.emitSync("reldens.beforePreloadUiScene",this),this.gameManager.config.get("client/ui/playerBox/enabled")&&this.load.html("playerBox","/assets/html/ui-player-box.html"),this.gameManager.config.get("client/ui/controls/enabled")&&this.load.html("controls","/assets/html/ui-controls.html"),this.useJoystick&&this.load.html("joystick","/assets/html/ui-joystick.html"),this.gameManager.config.get("client/ui/sceneLabel/enabled")&&this.load.html("sceneLabel","/assets/html/ui-scene-label.html"),this.gameManager.config.get("client/ui/instructions/enabled")&&this.load.html("instructions","/assets/html/ui-instructions.html"),this.gameManager.config.get("client/ui/minimap/enabled")&&this.load.html("minimap","/assets/html/ui-minimap.html"),this.gameManager.config.get("client/ui/settings/enabled")&&(this.load.html("settings","/assets/html/ui-settings.html"),this.load.html("settings-content","/assets/html/ui-settings-content.html")),this.gameManager.config.getWithoutLogs("client/ui/preloadTarget/enabled",!0)&&this.load.html("uiTarget","/assets/html/ui-target.html"),this.gameManager.config.getWithoutLogs("client/ui/preloadOptionsTemplates/enabled",!0)&&(this.load.html("uiOptionButton","/assets/html/ui-option-button.html"),this.load.html("uiOptionIcon","/assets/html/ui-option-icon.html"),this.load.html("uiOptionsContainer","/assets/html/ui-options-container.html")),this.gameManager.config.getWithoutLogs("client/ui/preloadLoading/enabled",!0)&&this.load.html("uiLoading","/assets/html/ui-loading.html"),this.eventsManager.emitSync("reldens.preloadUiScene",this))}preloadMapImages(){if(this.preloadImages)for(let e of this.preloadImages)this.load.image(e,`/assets/maps/${e}`)}preloadValidAssets(){if(!g.isObject(this.preloadAssets))return void m.info("None assets available for preload.");for(let e of Object.keys(this.preloadAssets)){let t=this.preloadAssets[e];if("spritesheet"!==t.asset_type)continue;let a=g.toJson(t.extra_params);if(!a){m.error("Missing spritesheet params.",t);continue}this.load.spritesheet(t.asset_key,`/assets/custom/sprites/${t.asset_file}`,a)}}create(){let e=this.uiScene?this:this.gameManager.gameEngine.uiScene;this.eventsManager.emitSync("reldens.createPreload",this,e),this.uiScene&&this.createUiScene(),this.createPlayerAnimations(g.get(this.gameManager.playerData,"avatarKey",d.IMAGE_PLAYER)),this.createArrowAnimation()}createUiScene(){this.eventsManager.emitSync("reldens.beforeCreateUiScene",this),this.createPlayerBox(),this.createTargetUi(),this.createSceneLabelBox(),this.createControlsBox(),this.createInstructionsBox(),this.createMiniMap(),this.createSettingsUi(),this.eventsManager.emitSync("reldens.createUiScene",this)}createSettingsUi(){let e=this.getUiConfig("settings");e.enabled&&(this.settingsUi=new l,this.settingsUi.createSettings(e,this))}createMiniMap(){let e=this.getUiConfig("minimap");e.enabled&&(this.minimapUi=new r,this.minimapUi.createMinimap(e,this))}createInstructionsBox(){let e=this.getUiConfig("instructions");e.enabled&&(this.instructionsUi=new o,this.instructionsUi.createInstructions(e,this))}createControlsBox(){let e=this.getUiConfig("controls");if(e.enabled)return this.useJoystick?(this.elementsUi.controls=this.createUi("joystick",e),this.joystick.registerJoystickController()):(this.elementsUi.controls=this.createUi("controls",e),this.registerControllers(this.elementsUi.controls))}createUi(e,t){return this.createContent(e,t.uiX,t.uiY)}createContent(e,t,a){return this.add.dom(t,a).createFromCache(e)}createSceneLabelBox(){let e=this.getUiConfig("sceneLabel");e.enabled&&(this.elementsUi.sceneLabel=this.createUi("sceneLabel",e))}createTargetUi(){let e=this.getUiConfig("uiTarget");e.enabled&&(this.uiTarget=this.createUi("uiTarget",e),this.uiTarget.getChildByProperty("className","close-target").addEventListener("click",()=>{this.gameManager.gameEngine.clearTarget()}))}createPlayerBox(){let e=this.getUiConfig("playerBox");if(!e.enabled)return;this.elementsUi.playerBox=this.createUi("playerBox",e);let t=this.elementsUi.playerBox.getChildByProperty("id","logout");t?.addEventListener("click",()=>{this.gameManager.forcedDisconnection=!0,this.gameManager.firebase.isActive&&this.gameManager.firebase.app.auth().signOut(),this.gameManager.gameDom.getWindow().location.reload()})}getUiConfig(e,t,a){let{uiX:i,uiY:s}=this.getUiPosition(e,t,a);return{enabled:this.gameManager.config.getWithoutLogs("client/ui/"+e+"/enabled"),uiX:i,uiY:s}}getUiPosition(e,t,a){""===e&&(e="default");let i=this.gameManager.config.getWithoutLogs("client/ui/"+e,{}),s=g.get(i,"x",0),n=g.get(i,"y",0);if(this.gameManager.config.get("client/ui/screen/responsive")){let e=g.get(i,"responsiveX",!1),r=g.get(i,"responsiveY",!1),o=this.gameManager.gameDom.getElement(d.SELECTORS.GAME_CONTAINER);t||(t=o.offsetWidth),a||(a=o.offsetHeight),s=!1!==e?e*t/100:0,n=!1!==r?r*a/100:0}return{uiX:s,uiY:n}}preloadPlayerDefaultSprite(){let e=this.gameManager.config.get("client/players/animations/fallbackImage","player-base.png");this.load.spritesheet(d.IMAGE_PLAYER,"/assets/custom/sprites/"+e,this.playerSpriteSize)}createPlayerAnimations(e){let t=this.gameManager.config.getWithoutLogs("client/players/animations/"+e+"Frames",this.gameManager.config.get("client/players/animations/defaultFrames"));for(let a of[{k:e+"_"+d.LEFT,img:e,start:t.left.start||3,end:t.left.end||5,repeat:-1,hide:!1},{k:e+"_"+d.RIGHT,img:e,start:t.right.start||6,end:t.right.end||8,repeat:-1,hide:!1},{k:e+"_"+d.UP,img:e,start:t.up.start||9,end:t.up.end||11,repeat:-1,hide:!1},{k:e+"_"+d.DOWN,img:e,start:t.down.start||0,end:t.down.end||2,repeat:-1,hide:!1}])this.createAnimationWith(a);this.eventsManager.emitSync("reldens.createPlayerAnimations",this,e)}createArrowAnimation(){if(!this.gameManager.config.get("client/ui/pointer/show"))return;let e={k:d.ARROW_DOWN,img:d.ARROW_DOWN,start:0,end:2,repeat:3,rate:6};this.createAnimationWith(e)}createAnimationWith(e){if(this.gameManager.createdAnimations[e.k])return;let t={key:e.k,frames:this.anims.generateFrameNumbers(e.img,{start:e.start,end:e.end}),frameRate:g.get(e,"frameRate",this.configuredFrameRate),repeat:e.repeat,hideOnComplete:g.get(e,"hide",!0)};return this.gameManager.createdAnimations[e.k]=this.anims.create(t),this.gameManager.createdAnimations[e.k]}registerControllers(e){this.setupDirButtonInBox(d.UP,e),this.setupDirButtonInBox(d.DOWN,e),this.setupDirButtonInBox(d.LEFT,e),this.setupDirButtonInBox(d.RIGHT,e),this.setupDefaultActionKey(e)}setupDefaultActionKey(e){let t=this.gameManager.config.get("client/ui/controls/defaultActionKey")||"physical_attack",a=this.createActionBox(t);this.gameManager.gameDom.appendToElement(".action-buttons",a),this.setupActionButtonInBox(t,e)}createActionBox(e){let t=this.cache.html.get("actionBox");return this.gameManager.gameEngine.parseTemplate(t,{key:e,actionName:e})}setupDirButtonInBox(e,t){let a=t.getChildByProperty("id",e);a&&this.hold(a,{dir:e})}setupActionButtonInBox(e,t){let a=t.getChildByProperty("id",e);if(a){if(this.gameManager.config.get("client/general/controls/action_button_hold"))return void this.hold(a,e);a?.addEventListener("click",()=>{let t=this.gameManager.activeRoomEvents.getActiveScene(),a={act:h.ACTION,target:t.player.currentTarget,type:e};this.gameManager.activeRoomEvents.send(a)})}}hold(e,t){e.addEventListener("mousedown",a=>{this.startHold(a,e,t)}),e.addEventListener("mouseup",t=>{this.endHold(t,e)}),e.addEventListener("mouseout",t=>{this.endHold(t,e)}),e.addEventListener("touchstart",a=>{this.startHold(a,e,t)}),e.addEventListener("touchend",t=>{this.endHold(t,e)})}startHold(e,t,a){e.preventDefault(),this.gameManager.config.get("client/ui/controls/opacityEffect")&&t.classList.add("button-opacity-off");let i=this.gameManager.activeRoomEvents.getActiveScene(),s=a;if(!g.hasOwn(a,"dir")){let e="string"==typeof a?a:a?.type;e||(e=this.gameManager.config.get("client/ui/controls/defaultActionKey")||"attack"),s={act:h.ACTION,target:i.player.currentTarget,type:e}}this.gameManager.activeRoomEvents.send(s)}endHold(e,t){e.preventDefault(),this.gameManager.config.get("client/ui/controls/opacityEffect")&&t.classList.remove("button-opacity-off"),this.gameManager.activeRoomEvents.send({act:d.STOP})}showLoadingProgressBar(){if(!this.gameManager.config.getWithoutLogs("client/ui/loading/show",!0))return;let e=n.Rectangle,t=e.Clone(this.cameras.main);this.progressRect=new e(0,0,t.width/2,50),e.CenterOn(this.progressRect,t.centerX,t.centerY),this.progressCompleteRect=n.Rectangle.Clone(this.progressRect),this.progressBar=this.createGraphics();let a=this.cameras.main.width,i=this.cameras.main.height,s=this.gameManager.config.get("client/ui/loading/font"),r=this.gameManager.config.get("client/ui/loading/fontSize"),o=this.gameManager.config.get("client/ui/loading/assetsSize");this.loadingText=this.createText(a/2,i/2-50,"Loading...",{fontFamily:s,fontSize:r}),this.loadingText.setOrigin(.5,.5),this.loadingText.setFill(this.gameManager.config.get("client/ui/loading/loadingColor")),this.percentText=this.createText(a/2,i/2-5,"0%",{fontFamily:s,fontSize:o}),this.percentText.setOrigin(.5,.5),this.percentText.setFill(this.gameManager.config.get("client/ui/loading/percentColor")),this.assetText=this.createText(a/2,i/2+50,"",{fontFamily:s,fontSize:o}),this.assetText.setFill(this.gameManager.config.get("client/ui/loading/assetsColor")),this.assetText.setOrigin(.5,.5)}createText(e,t,a,i){return this.add.text(e,t,a,i)}createGraphics(){return this.add.graphics()}onLoadComplete(){for(let e of this.children.list)e.destroy();this.loadingText.destroy(),this.assetText.destroy(),this.percentText.destroy(),this.scene.shutdown()}onFileProgress(e){this.gameManager.config.get("client/ui/loading/showAssets")&&this.assetText.setText("Loading "+e.key)}onLoadProgress(e){let t=parseInt(100*e)+"%";this.percentText.setText(t),this.progressRect.width=e*this.progressCompleteRect.width,this.progressBar.clear().fillStyle(2236962).fillRectShape(this.progressCompleteRect).fillStyle(0xffffff).fillRectShape(this.progressRect)}getUiElement(e,t=!0){return g.hasOwn(this.elementsUi,e)?this.elementsUi[e]:(t&&m.error("UI not found.",{uiName:e}),!1)}}},{"8f766b8f0d7630d6":"phaser","64a334dcd3e65bd4":"aUEv3","936bc5003291bd3d":"l1cAb",c21ef162a4dcfda6:"4mjLp",ad6886ec1b7e2757:"fqYZO","835464c1daa61ed6":"52yv8",eab2c5783e5cea80:"hmzhe","36253877d5e76351":"@reldens/utils"}],aUEv3:[function(e,t,a,i){let{sc:s}=e("2f2421424d7d7b51");t.exports.MinimapUi=class{createMinimap(e,t){t.elementsUi.minimap=t.add.dom(e.uiX,e.uiY).createFromCache("minimap");let a=t.elementsUi.minimap.getChildByProperty("id","minimap-open"),i=t.elementsUi.minimap.getChildByProperty("id","minimap-close");a?.addEventListener("click",()=>{let e=t.elementsUi.minimap.getChildByProperty("id","minimap-ui");e.classList.remove("hidden"),a.classList.add("hidden");let s=t.gameManager.getActiveScene().minimap;s&&this.showMap(s,t,a,i,e)}),i?.addEventListener("click",()=>{let e=t.elementsUi.minimap.getChildByProperty("id","minimap-ui");e.classList.add("hidden"),a&&a.classList.remove("hidden");let s=t.gameManager.getActiveScene().minimap;s&&this.hideMap(s,t,i,e)})}showMap(e,t,a,i,s){this.awaitForCamera(e)?setTimeout(()=>{this.showMap(e,t,a,i,s)},e.awaitOnCamera):(e.minimapCamera.setVisible(!0),e.circle&&e.circle.setVisible(!0),t.gameManager.events.emit("reldens.openUI",{ui:this,openButton:a,minimap:e,box:s}))}hideMap(e,t,a,i){this.awaitForCamera(e)?setTimeout(()=>{this.hideMap(e,t,a,i)},e.awaitOnCamera):(e.minimapCamera.setVisible(!1),e.circle&&e.circle.setVisible(!1),t.gameManager.events.emit("reldens.closeUI",{ui:this,closeButton:a,minimap:e,box:i}))}awaitForCamera(e){return 0<e.awaitOnCamera&&(!e.minimapCamera||!s.isFunction(e.minimapCamera.setVisible))}}},{"2f2421424d7d7b51":"@reldens/utils"}],l1cAb:[function(e,t,a,i){let{Logger:s}=e("29fc70a7ef91dac7");t.exports.InstructionsUi=class{createInstructions(e,t){let a=t.add.dom(e.uiX,e.uiY).createFromCache("instructions");if(!a)return s.info("Instructions dialog box could not be created."),!1;let i=t.gameManager.gameDom.getElement("#instructions");if(!i)return s.info("Instructions container not found."),!1;let n=a.getChildByProperty("id","instructions-open");n?.addEventListener("click",()=>{i.style.display="block",t.gameManager.events.emit("reldens.openUI",{ui:this,openButton:n,dialogBox:a,dialogContainer:i,uiScene:t})});let r=t.gameManager.gameDom.getElement("#instructions-close");r?.addEventListener("click",()=>{i.style.display="none",t.gameManager.events.emit("reldens.closeUI",{ui:this,closeButton:r,openButton:n,dialogBox:a,dialogContainer:i,uiScene:t})}),t.elementsUi.instructions=a}}},{"29fc70a7ef91dac7":"@reldens/utils"}],"4mjLp":[function(e,t,a,i){let{Logger:s}=e("ef5a8f725428dc7c");t.exports.SettingsUi=class{createSettings(e,t){let a=t.add.dom(e.uiX,e.uiY).createFromCache("settings");if(!a)return s.info("Settings dialog box could not be created."),!1;let i=t.cache.html.get("settings-content");if(!i)return s.info("Settings template not found."),!1;t.gameManager.gameDom.appendToElement(".content",i);let n=t.gameManager.gameDom.getElement("#settings-ui");if(!n)return s.info("Settings container not found."),!1;let r=t.gameManager.gameDom.getElement("#settings-close"),o=a.getChildByProperty("id","settings-open");o?.addEventListener("click",()=>{n.style.display="block",o&&(o.style.display="none"),t.gameManager.events.emit("reldens.openUI",{ui:this,openButton:o,dialogBox:a,dialogContainer:n,uiScene:t})}),r?.addEventListener("click",()=>{n.style.display="none",o&&(o.style.display="block"),t.gameManager.events.emit("reldens.closeUI",{ui:this,closeButton:r,openButton:o,dialogBox:a,dialogContainer:n,uiScene:t})}),t.elementsUi.settings=a}}},{ef5a8f725428dc7c:"@reldens/utils"}],fqYZO:[function(e,t,a,i){let{GameConst:s}=e("9fba4ae732684e48"),{Logger:n}=e("93c2f2af6847956");t.exports.Joystick=class{constructor(e){this.gameManager=e?.scenePreloader?.gameManager,this.scenePreloader=e?.scenePreloader,this.gameDom=this.gameManager?.gameDom,this.isDragging=!1,this.centerX=!1,this.centerY=!1,this.threshold=this.gameManager.config.getWithoutLogs("client/ui/controls/joystickThreshold",20),this.joystickLeft=this.gameManager.config.getWithoutLogs("client/ui/controls/joystickLeft",25),this.joystickTop=this.gameManager.config.getWithoutLogs("client/ui/controls/joystickTop",25),this.positionSufix="px"}registerJoystickController(){if(!this.gameManager)return n.error("GameManager undefined on Joystick."),!1;this.joystick=this.gameDom.getElement("#joystick"),this.joystickThumb=this.gameDom.getElement("#joystick-thumb"),this.joystickThumb.addEventListener("mousedown",e=>{this.applyMovement(e.clientX,e.clientY)}),this.joystickThumb.addEventListener("touchstart",e=>{e.preventDefault();let t=e.touches?.shift();this.applyMovement(t.clientX,t.clientY)}),this.gameDom.getDocument().addEventListener("mousemove",this.handleMouseMove.bind(this)),this.gameDom.getDocument().addEventListener("mouseup",this.handleStop.bind(this)),this.gameDom.getDocument().addEventListener("touchmove",this.handleTouchMove.bind(this)),this.gameDom.getDocument().addEventListener("touchend",this.handleStop.bind(this))}position(e){return e+this.positionSufix}applyMovement(e,t){this.isDragging=!0;let a=this.joystick.getBoundingClientRect();this.centerX=a.width/2,this.centerY=a.height/2,this.updateThumbPosition(e-a.left,t-a.top)}handleStop(){this.isDragging=!1,this.joystickThumb.style.left=this.position(this.joystickLeft),this.joystickThumb.style.top=this.position(this.joystickTop),this.gameManager.getCurrentPlayer().stop()}updateDirection(e,t){let a=e-this.centerX,i=t-this.centerY,n=s.STOP;if(Math.abs(a)>Math.abs(i)&&Math.abs(a)>this.threshold){for(let e of(n=a>0?Math.abs(i)>this.threshold?i>0?"right-down":"right-up":"right":Math.abs(i)>this.threshold?i>0?"left-down":"left-up":"left").split("-"))try{this.gameManager.getCurrentPlayer()[e]()}catch(e){}return n}if(Math.abs(i)>this.threshold){for(let e of(n=i>0?Math.abs(a)>this.threshold?a>0?"down-right":"down-left":"down":Math.abs(a)>this.threshold?a>0?"up-right":"up-left":"up").split("-"))try{this.gameManager.getCurrentPlayer()[e]()}catch(e){}return n}return this.gameManager.getCurrentPlayer().stop(),n}updateThumbPosition(e,t){let a=e-this.centerX,i=t-this.centerY,s=Math.sqrt(a*a+i*i),n=Math.min(this.centerX,this.centerY);if(s>n){let e=Math.atan2(i,a),t=Math.cos(e)*n+this.centerX-this.joystickThumb.offsetWidth/2;this.joystickThumb.style.left=this.position(t);let s=Math.sin(e)*n+this.centerY-this.joystickThumb.offsetHeight/2;this.joystickThumb.style.top=this.position(s);return}let r=e-this.joystickThumb.offsetWidth/2;this.joystickThumb.style.left=this.position(r);let o=t-this.joystickThumb.offsetHeight/2;this.joystickThumb.style.top=this.position(o)}handleMouseMove(e){if(!this.isDragging)return;let t=this.joystick.getBoundingClientRect(),a=e.clientX-t.left,i=e.clientY-t.top;this.updateThumbPosition(a,i),this.updateDirection(a,i)}handleTouchMove(e){if(!this.isDragging)return;let t=e.touches?.shift(),a=this.joystick.getBoundingClientRect(),i=t.clientX-a.left,s=t.clientY-a.top;this.updateThumbPosition(i,s),this.updateDirection(i,s)}}},{"9fba4ae732684e48":"52yv8","93c2f2af6847956":"@reldens/utils"}],fvIMo:[function(e,t,a,i){let{RegistrationFormHandler:s}=e("608d613a940bf253"),{TermsAndConditionsHandler:n}=e("68a30757e194dcbe"),{LoginFormHandler:r}=e("8ae6e016860e3760"),{ForgotPasswordFormHandler:o}=e("88d5365e17c4acaf"),{GuestFormHandler:l}=e("edd6483cd3317d55"),{FullScreenHandler:c}=e("a064b368ba69cc47");t.exports.ClientStartHandler=class{constructor(e){this.gameManager=e}clientStart(){let e=new s(this.gameManager);e.activateRegistration(),new l(this.gameManager).activateGuest();let t=new n(this.gameManager);t.activateTermsAndConditions();let a=new r(this.gameManager);a.activateLogin();let i=new o(this.gameManager);i.activateForgotPassword(),i.displayForgotPassword();let d=new c(this.gameManager);d.activateFullScreen(),this.gameManager.firebase&&this.gameManager.firebase.startFirebase(),Object.assign(this.gameManager.elements,{registrationForm:e,termsAndConditions:t,loginForm:a,forgotPasswordForm:i,fullScreen:d}),this.gameManager.events.emitSync("reldens.clientStartAfter",this)}}},{"608d613a940bf253":"9jjZn","68a30757e194dcbe":"9FgKZ","8ae6e016860e3760":"kE2kf","88d5365e17c4acaf":"50OyY",edd6483cd3317d55:"aYkJC",a064b368ba69cc47:"6NmqT"}],"9jjZn":[function(e,t,a,i){let{ErrorsBlockHandler:s}=e("d85d91b48b2c7edd"),{GameConst:n}=e("90dddfb611375998");t.exports.RegistrationFormHandler=class{constructor(e){this.gameManager=e,this.gameDom=this.gameManager.gameDom,this.form=e.gameDom.getElement(n.SELECTORS.REGISTER_FORM)}activateRegistration(){if(!this.form)return!1;if(!this.gameManager.config.get("client/general/users/allowRegistration"))return this.form.classList.add("hidden"),!0;s.reset(this.form);let e=n.SELECTORS,t=this.gameDom.getElement(e.TERMS.ACCEPT),a=this.gameDom.getElement(e.TERMS.BOX);this.form.addEventListener("submit",i=>{if(i.preventDefault(),!this.form.checkValidity())return!1;let s=this.gameDom.getElement(e.REGISTRATION.PASSWORD).value,r=this.gameDom.getElement(e.REGISTRATION.RE_PASSWORD).value,o=this.form.querySelector(e.RESPONSE_ERROR);if(s!==r&&o)return o.innerHTML="Password and confirmation does not match.",!1;if(!t.checked&&o)return o.innerHTML="Please read and accept the terms and conditions and continue.",!1;a?.classList.add(n.CLASSES.HIDDEN),this.form.querySelector(e.LOADING_CONTAINER).classList.remove(n.CLASSES.HIDDEN);let l={formId:this.form.id,email:this.gameDom.getElement(e.REGISTRATION.EMAIL).value,username:this.gameDom.getElement(e.REGISTRATION.USERNAME).value,password:s,rePassword:r};this.gameManager.startGame(l,!0)})}}},{d85d91b48b2c7edd:"idPEb","90dddfb611375998":"52yv8"}],idPEb:[function(e,t,a,i){let{GameConst:s}=e("e917c2c795f7ff8f");t.exports.ErrorsBlockHandler=class{static reset(e){let t=e.querySelector(s.SELECTORS.RESPONSE_ERROR);e.querySelector(s.SELECTORS.INPUT).addEventListener("focus",()=>{t.innerHTML="";let a=e.querySelector(s.SELECTORS.LOADING_CONTAINER);a&&a?.classList.add(s.CLASSES.HIDDEN)})}}},{e917c2c795f7ff8f:"52yv8"}],"9FgKZ":[function(e,t,a,i){let{GameConst:s}=e("d6063cbabda2e0b9"),{Logger:n}=e("8a5736287636926a");t.exports.TermsAndConditionsHandler=class{constructor(e){this.gameManager=e,this.gameDom=this.gameManager.gameDom,this.linkContainer=this.gameManager.gameDom.getElement(s.SELECTORS.TERMS.LINK_CONTAINER)}activateTermsAndConditions(){if(!this.linkContainer)return!1;let e=this.gameManager.appServerUrl+s.ROUTE_PATHS.TERMS_AND_CONDITIONS,t=new URL(this.gameDom.getDocument().location).searchParams.get("lang","");""!==t&&(e+="?lang="+t),this.gameDom.getJSON(e,(e,t)=>{if(e)return n.error("TermsAndConditionsHandler - request failed.",e),!1;if(!t)return n.error("TermsAndConditionsHandler - empty response."),!1;if(!t.body||!t.heading||!t.checkboxLabel||!t.link)return!1;let a=s.SELECTORS.TERMS;this.gameDom.updateContent(a.HEADING,t.heading),this.gameDom.updateContent(a.BODY,t.body),this.gameDom.updateContent(a.ACCEPT_LABEL,t.checkboxLabel),this.gameDom.updateContent(a.LINK,t.link);let i=this.gameDom.getElement(a.LINK),r=this.gameDom.getElement(a.BOX);i?.addEventListener("click",e=>{e.preventDefault(),r?.classList.remove(s.CLASSES.HIDDEN)}),this.gameDom.getElement(a.CLOSE)?.addEventListener("click",()=>{r?.classList.add(s.CLASSES.HIDDEN)});let o=this.gameDom.getElement(s.SELECTORS.REGISTER_FORM);if(o){let e=this.gameDom.getElement(s.SELECTORS.RESPONSE_ERROR,o),t=this.gameDom.getElement(a.ACCEPT),i=this.gameDom.getElement(a.ACCEPT_LABEL);t&&t.addEventListener("click",()=>{t.checked&&e&&(e.innerHTML="")}),t&&i&&i.addEventListener("click",()=>{t.checked&&e&&(e.innerHTML="")})}this.linkContainer?.classList.remove(s.CLASSES.HIDDEN)})}}},{d6063cbabda2e0b9:"52yv8","8a5736287636926a":"@reldens/utils"}],kE2kf:[function(e,t,a,i){let{ErrorsBlockHandler:s}=e("d5f948fac025cf00"),{GameConst:n}=e("249620b21dc55ebc");t.exports.LoginFormHandler=class{constructor(e){this.gameManager=e,this.form=e.gameDom.getElement(n.SELECTORS.LOGIN_FORM)}activateLogin(){if(!this.form)return!1;s.reset(this.form),this.form.addEventListener("submit",e=>{if(e.preventDefault(),s.reset(this.form),!this.form.checkValidity()||this.gameManager.submitedForm)return!1;this.gameManager.submitedForm=!0,this.form.querySelector(n.SELECTORS.LOADING_CONTAINER).classList.remove(n.CLASSES.HIDDEN);let t={formId:this.form.id,username:this.form.querySelector(n.SELECTORS.LOGIN.USERNAME).value,password:this.form.querySelector(n.SELECTORS.LOGIN.PASSWORD).value};return this.gameManager.startGame(t,!1)})}}},{d5f948fac025cf00:"idPEb","249620b21dc55ebc":"52yv8"}],"50OyY":[function(e,t,a,i){let{ErrorsBlockHandler:s}=e("193981fc3d2d2a4f"),{GameConst:n}=e("efa22c200ffe27c4"),{Logger:r}=e("8b6d6b1a7ced50e6");t.exports.ForgotPasswordFormHandler=class{constructor(e){this.gameManager=e,this.gameDom=this.gameManager.gameDom,this.form=this.gameManager.gameDom.getElement(n.SELECTORS.FORGOT_PASSWORD_FORM)}activateForgotPassword(){return!!this.form&&(this.gameManager.config.get("client/general/users/allowRegistration")?void(s.reset(this.form),this.form.addEventListener("submit",e=>{if(e.preventDefault(),s.reset(this.form),!this.form.checkValidity())return!1;this.form.querySelector(n.SELECTORS.LOADING_CONTAINER).classList.remove(n.CLASSES.HIDDEN);let t={formId:this.form.id,forgot:!0,email:this.form.querySelector(n.SELECTORS.FORGOT_PASSWORD.EMAIL).value};this.gameManager.startGame(t,!1)})):(this.form.classList.add("hidden"),!0))}displayForgotPassword(){this.gameDom.getJSON(this.gameManager.appServerUrl+n.ROUTE_PATHS.MAILER,(e,t)=>{e?r.error("ForgotPasswordFormHandler - mailer check failed.",e):t&&t.enabled&&this.gameDom.getElement(n.SELECTORS.FORGOT_PASSWORD.CONTAINER)?.classList.remove(n.CLASSES.HIDDEN)})}}},{"193981fc3d2d2a4f":"idPEb",efa22c200ffe27c4:"52yv8","8b6d6b1a7ced50e6":"@reldens/utils"}],aYkJC:[function(e,t,a,i){let{ErrorsBlockHandler:s}=e("c149aa2f304f71c9"),{GameConst:n}=e("d0afa55222144fd5"),{sc:r}=e("92bd0e265310931");t.exports.GuestFormHandler=class{constructor(e){this.gameManager=e,this.gameDom=this.gameManager.gameDom,this.form=e.gameDom.getElement(n.SELECTORS.GUEST_FORM)}activateGuest(){if(!this.form)return!1;if(!this.gameManager.config.get("client/general/users/allowGuest"))return this.form.classList.add("hidden"),!0;s.reset(this.form);let e=n.SELECTORS;this.form.addEventListener("submit",t=>{if(t.preventDefault(),!this.form.checkValidity())return!1;this.form.querySelector(e.LOADING_CONTAINER).classList.remove(n.CLASSES.HIDDEN);let a="guest-"+r.randomChars(12),i=this.gameManager.config.getWithoutLogs("client/general/users/allowGuestUserName",!1)?this.gameDom.getElement(e.GUEST.USERNAME).value:a,s={formId:this.form.id,username:i,password:i,rePassword:i,isGuest:!0};this.gameManager.startGame(s,!0)})}}},{c149aa2f304f71c9:"idPEb",d0afa55222144fd5:"52yv8","92bd0e265310931":"@reldens/utils"}],"6NmqT":[function(e,t,a,i){let{GameConst:s}=e("4eab227d1a0a5e15");t.exports.FullScreenHandler=class{constructor(e){this.gameManager=e,this.gameDom=this.gameManager.gameDom,this.body=this.gameDom.getElement(s.SELECTORS.BODY)}activateFullScreen(){this.gameDom.getElement(s.SELECTORS.FULL_SCREEN_BUTTON)?.addEventListener("click",e=>{if(e.preventDefault(),!this.gameDom.getDocument().fullscreenEnabled)return!1;this.body.requestFullscreen(),this.goFullScreen()}),this.gameDom.getWindow().matchMedia("(display-mode: fullscreen)").addEventListener("change",({matches:e})=>{e?this.goFullScreen():this.exitFullScreen()})}goFullScreen(){this.body.classList.add(s.CLASSES.FULL_SCREEN_ON),this.gameManager?.gameEngine&&this.gameManager.gameEngine.updateGameSize(this.gameManager)}exitFullScreen(){this.body.classList.remove(s.CLASSES.FULL_SCREEN_ON),this.gameManager?.gameEngine&&this.gameManager.gameEngine.updateGameSize(this.gameManager)}}},{"4eab227d1a0a5e15":"52yv8"}],axBi7:[function(e,t,a,i){let{ClientCoreFeatures:s}=e("937fbabd544d980a"),{Logger:n,sc:r}=e("6153197f4dcf6984");t.exports.FeaturesManager=class{constructor(e){this.gameManager=r.get(e,"gameManager",!1),this.events=r.get(e,"events",!1)}async loadFeatures(e){if(!this.gameManager)return n.error("Game Manager undefined in FeaturesManager."),!1;if(!this.events)return n.error("EventsManager undefined in FeaturesManager."),!1;this.featuresList={},await this.events.emit("reldens.loadFeatures",this,e);let t=Object.keys(e);if(0===t.length)return this.featuresList;for(let a of t){let t=e[a];r.hasOwn(s,t)&&(this.featuresList[t]=new s[t],"function"==typeof this.featuresList[t].setup&&await this.featuresList[t].setup({gameManager:this.gameManager,events:this.events}),await this.events.emit("reldens.loadFeature_"+t,this.featuresList[t],this))}return this.featuresList}}},{"937fbabd544d980a":"dIuyX","6153197f4dcf6984":"@reldens/utils"}],dIuyX:[function(e,t,a,i){let{ChatPlugin:s}=e("c80cf07351e7933e"),{ObjectsPlugin:n}=e("202c37cfc4f01952"),{InventoryPlugin:r}=e("86e49040e809ec9"),{ActionsPlugin:o}=e("7b4ce1e4916d0d89"),{UsersPlugin:l}=e("f6b714dd3b21c20c"),{AudioPlugin:c}=e("548842b5f4200d4"),{RoomsPlugin:d}=e("f55cb270e23ef32f"),{PredictionPlugin:h}=e("d51d3dd16adea08c"),{TeamsPlugin:m}=e("f9876ae3d71a9760"),{SnippetsPlugin:g}=e("32c4ba6aa423f6a1"),{AdsPlugin:u}=e("a9dc07b8ccee3ac8"),{WorldPlugin:p}=e("b2cf245c110682c9"),{ScoresPlugin:f}=e("766badb4827425d2"),{RewardsPlugin:y}=e("c8ce87b75f2d2d6e");t.exports.ClientCoreFeatures={chat:s,objects:n,inventory:r,actions:o,users:l,audio:c,rooms:d,prediction:h,teams:m,snippets:g,ads:u,world:p,scores:f,rewards:y}},{c80cf07351e7933e:"cqKK8","202c37cfc4f01952":"8R9IZ","86e49040e809ec9":"4eFIJ","7b4ce1e4916d0d89":"6QQl7",f6b714dd3b21c20c:"jNGNC","548842b5f4200d4":"6pVBT",f55cb270e23ef32f:"7x25l",d51d3dd16adea08c:"etSTe",f9876ae3d71a9760:"2op7t","32c4ba6aa423f6a1":"dxWI2",a9dc07b8ccee3ac8:"hjWa4",b2cf245c110682c9:"eX6im","766badb4827425d2":"83Etb",c8ce87b75f2d2d6e:"4Fae6"}],cqKK8:[function(e,t,a,i){let{ChatUi:s}=e("653d21cde32274c8"),{MessagesListener:n}=e("cb116d66f1b17398"),{TemplatesHandler:r}=e("4097a6f796a25dd5"),o=e("c9c24694c3cbf963"),{TranslationsMapper:l}=e("bf04b3fa400750d7"),{PluginInterface:c}=e("d2c4700437670cee"),{ChatConst:d}=e("a7668ee71f7c68d1"),{Logger:h,sc:m}=e("731cc76cccefd84");t.exports.ChatPlugin=class extends c{setup(e){this.gameManager=m.get(e,"gameManager",!1),this.gameManager||h.error("Game Manager undefined in ActionsPlugin."),this.events=m.get(e,"events",!1),this.events||h.error("EventsManager undefined in ChatPlugin."),this.messagesQueu=[],this.uiManager=!1,this.joinRooms=[d.CHAT_GLOBAL],this.setTranslations(),this.listenEvents()}setTranslations(){if(!this.gameManager)return!1;l.forConfig(this.gameManager.config.client,o,d.MESSAGE.DATA_VALUES)}listenEvents(){if(!this.events)return!1;this.events.on("reldens.joinedRoom",async e=>{await n.listenMessages(e,this)}),this.events.on("reldens.preloadUiScene",e=>{r.preloadTemplates(e,this.gameManager.config.get("client/ui/chat/showTabs"))}),this.events.on("reldens.createUiScene",e=>{this.uiManager=new s(e),this.uiManager.createUi(),this.uiManager.createTabs(),this.uiManager.processMessagesQueue(this.messagesQueu)})}}},{"653d21cde32274c8":"6iGhS",cb116d66f1b17398:"4Pmjs","4097a6f796a25dd5":"7omKw",c9c24694c3cbf963:"4L25v",bf04b3fa400750d7:"bJxKc",d2c4700437670cee:"bYb3U",a7668ee71f7c68d1:"7cQyS","731cc76cccefd84":"@reldens/utils"}],"6iGhS":[function(e,t,a,i){let{Input:s}=e("25a87f28fb7e0308"),{SpriteTextFactory:n}=e("9224444cee79f5ae"),{ChatTabs:r}=e("eae9f6a9f3b912be"),{ChatConst:o}=e("e56c6f22335ef248"),{Logger:l,sc:c}=e("3e430b9bcb390349");t.exports.ChatUi=class{constructor(e){this.uiScene=e,this.gameManager=this.uiScene?.gameManager,this.gameDom=this.uiScene?.gameManager?.gameDom,this.setChatTypes(),this.setChatConfiguration(),this.uiChat={},this.messagesQueu=[],this.chatInput=!1,this.chatSendButton=!1,this.chatCloseButton=!1,this.chatOpenButton=!1}setChatConfiguration(){if(!this.gameManager||!this.gameManager.config)return!1;this.uiConfig=this.gameManager.config.get("client/ui/chat"),this.overheadChat=c.get(this.uiConfig,"overheadChat",{}),this.overHeadChatEnabled=c.get(this.overheadChat,"enabled",!1),this.overheadText=c.get(this.uiConfig,"overheadText",{}),this.isDefaultOpen=c.get(this.uiConfig,"defaultOpen",!1),this.isTyping=c.get(this.overheadChat,"isTyping",!1),this.showTabs=c.get(this.uiConfig,"showTabs",!1),this.closeChatBoxAfterSend=c.get(this.closeChatBoxAfterSend,"isTyping",!1),this.messagesConfig=this.gameManager.config.get("client/chat/messages"),this.characterLimit=c.get(this.messagesConfig,"characterLimit",0),this.characterLimitOverhead=c.get(this.messagesConfig,"characterLimitOverhead",0),this.appendErrorTypeOnActiveTab=c.get(this.messagesConfig,"appendErrorTypeOnActiveTab",!0)}setChatTypes(){if(!this.gameManager)return l.warning("Missing GameManager on ChatUI."),!1;if(!this.gameDom)return l.warning("Missing GameDom on ChatUI."),!1;if(!this.gameManager.initialGameData)return l.warning('Missing "initialGameData" on ChatUI.'),!1;if(this.chatTypes=c.get(this.gameManager.initialGameData,"chatTypes",[]),0===this.chatTypes.length)return!1;for(let e of(this.chatTypesById={},this.chatTypes))this.chatTypesById[e.id]=e}createUi(){if(!this.uiScene)return l.warning("Missing UI Scene on ChatUI."),!1;let{uiX:e,uiY:t}=this.uiScene.getUiConfig("chat");if(this.uiChat=this.uiScene.add.dom(e,t).createFromCache("chat"),this.uiScene.elementsUi.chat=this.uiChat,this.chatInput=this.uiChat.getChildByProperty("id",o.CHAT_INPUT),!this.chatInput)return l.info("Missing chat input on ChatUI."),!1;this.setupKeyPressBehaviors(),this.chatInput.addEventListener("onfocusout",()=>{this.hideIsTyping()}),this.setupSendButton(),this.setupOpenCloseButtons(),this.overHeadChatEnabled&&this.setupOverheadChatEvents(),this.isDefaultOpen&&this.showChatBox()}createTabs(){return!!this.showTabs&&(this.tabs=new r(this.gameManager,this.uiScene),!0)}setupOverheadChatEvents(){this.gameManager.events.on("reldens.runPlayerAnimation",(e,t,a,i)=>{this.updateOverheadTextPosition(i)})}setupOpenCloseButtons(){this.chatOpenButton=this.uiChat.getChildByProperty("id",o.CHAT_OPEN_BUTTON),this.chatOpenButton?.addEventListener("click",()=>{this.showChatBox(),this.gameManager.events.emit("reldens.openUI",{ui:this,openButton:this.chatOpenButton,dialogBox:this.uiChat,dialogContainer:this.uiChat.getChildByProperty("id",o.CHAT_UI),uiScene:this.uiScene})}),this.chatCloseButton=this.uiChat.getChildByProperty("id",o.CHAT_CLOSE_BUTTON),this.chatCloseButton?.addEventListener("click",()=>{this.hideChatBox(),this.gameManager.events.emit("reldens.closeUI",{ui:this,closeButton:this.chatCloseButton,openButton:this.chatOpenButton,dialogBox:this.uiChat,dialogContainer:this.uiChat.getChildByProperty("id",o.CHAT_UI),uiScene:this.uiScene})})}setupSendButton(){this.chatSendButton=this.uiChat.getChildByProperty("id",o.CHAT_SEND_BUTTON),this.chatSendButton?.addEventListener("click",e=>{e.preventDefault(),this.sendChatMessage(this.chatInput,this.gameManager.activeRoomEvents),this.chatInput.focus()})}setupKeyPressBehaviors(){this.uiScene.input.keyboard.on("keyup-ENTER",()=>{this.isFocussedOnChatInput()||(this.showChatBox(),this.chatInput.focus())}),this.chatInput.addEventListener("keyup",e=>{if(e.keyCode===s.Keyboard.KeyCodes.ENTER){e.preventDefault(),this.sendChatMessage();return}this.showIsTyping()})}showOverheadChat(e,t){if(!this.overHeadChatEnabled)return!1;e.overheadTextSprite&&this.destroyTextSprite(e),t=this.applyTextLimit(t,this.characterLimitOverhead),e.overheadTextSprite=n.attachTextToSprite(e,t,this.overheadText,c.get(this.overheadText,"topOff",0),"overheadTextSprite",this.gameManager.getActiveScene());let a=c.get(this.overheadText,"timeOut",!1);a&&setTimeout(()=>{this.destroyTextSprite(e)},a)}updateOverheadTextPosition(e){if(!e.overheadTextSprite)return!1;let t=n.getTextPosition(e,e.playerName,this.overheadText,c.get(this.overheadText,"topOff",0));e.overheadTextSprite.x=t.x,e.overheadTextSprite.y=t.y}destroyTextSprite(e){if(!e.overheadTextSprite)return!1;e.overheadTextSprite.destroy(),delete e.overheadTextSprite}showIsTyping(){if(!this.overHeadChatEnabled||!this.isTyping||!this.isFocussedOnChatInput())return!1;this.showOverheadChat(this.gameManager.getCurrentPlayerAnimation(),this.gameManager.config.getWithoutLogs("client/ui/chat/waitingContent",this.t(o.SNIPPETS.WAITING)))}hideIsTyping(){if(!this.isTyping)return!1;this.destroyTextSprite(this.gameManager.getCurrentPlayerAnimation())}isFocussedOnChatInput(){return this.gameManager.gameDom.activeElement()===this.chatInput}showChatBox(){this.uiChat.getChildByProperty("id",o.CHAT_UI).classList.remove("hidden"),this.uiChat.setDepth(4),this.chatOpenButton?.classList.add("hidden");let e=this.gameDom.getElement(o.SELECTORS.CHAT_MESSAGES);e&&(e.parentNode.scrollTop=e.scrollHeight),this.hideNotificationsBalloon()}hideChatBox(){let e=this.uiChat.getChildByProperty("id",o.CHAT_UI);if(!e)return l.info("Chat UI box not found."),!1;e.classList.add("hidden"),this.uiChat.setDepth(1),this.chatOpenButton?.classList.remove("hidden")}showNotificationBalloon(){this.getActiveBalloon()?.classList.remove("hidden")}hideNotificationsBalloon(){this.getActiveBalloon()?.classList.add("hidden")}getActiveBalloon(){if(!c.get(this.uiConfig,"notificationBalloon"))return!1;let e=this.uiChat.getChildByProperty("id",o.CHAT_BALLOON);return!!e&&e}processMessagesQueue(e){if(0===e.length)return!1;for(let t of e)this.attachNewMessage(t)}attachNewMessage(e){if(!this.gameManager.gameEngine.uiScene.cache)return;let t=this.gameManager.gameEngine.uiScene.cache.html.get("chatMessage"),a=this.translateMessage(e),i=this.gameManager.gameEngine.parseTemplate(t,{from:this.translateFrom(e),color:o.TYPE_COLOR[e[o.TYPES.KEY]],message:a}),s=this.showTabs?o.TYPES.MESSAGE:"",n=c.get(e,o.TYPES.KEY,s),r=c.get(this.chatTypesById,n,!1),d=!!(""!==n&&r?.show_tab)&&this.gameManager.gameDom.getElement(o.SELECTORS.TAB_CONTENT_PREFIX+n);d&&this.appendWithScroll(d,i);let h=!!r.also_show_in_type&&this.gameManager.gameDom.getElement(o.SELECTORS.TAB_CONTENT_PREFIX+r.also_show_in_type);h&&h!==d&&this.appendWithScroll(h,i);let m=""===n&&this.gameManager.gameDom.getElement(o.SELECTORS.CHAT_MESSAGES);if(m&&this.appendWithScroll(m,i),this.appendErrorTypeOnActiveTab&&o.TYPES.ERROR===n){let e=this.gameManager.gameDom.getElement(o.SELECTORS.TAB_CONTENT_ACTIVE);e&&e!==d&&e!==h&&this.appendWithScroll(e,i)}if(!d&&!h&&!m){null===d&&l.warning("Element not found for selector: .tab-content-"+n),null===h&&l.warning("Element not found for selector: .tab-content-"+r.also_show_in_type),l.warning("Chat message not attached to any tab or main panel.",{message:e,defaultType:s,messageType:n,chatType:r,appendToMain:m,appendToTab:d});return}if(e[o.MESSAGE.FROM]&&this.isValidMessageType(e[o.TYPES.KEY])){let t=this.fetchPlayerByName(e[o.MESSAGE.FROM]);t&&this.showOverheadChat(t,a)}this.uiChat.getChildByProperty("id",o.CHAT_UI).classList.contains("hidden")&&this.showNotificationBalloon()}appendWithScroll(e,t){e.innerHTML+=t,e.parentNode.scrollTop=e.scrollHeight}translateFrom(e){let t=e[o.TYPES.KEY],a=e[o.MESSAGE.FROM]||o.TYPES.SYSTEM;return this.isValidSnippetFromType(t)?this.t(o.SNIPPETS.PREFIX+o.TYPES.KEY+t):a}translateMessage(e){let t=e[o.TYPES.KEY];if(!this.isValidSnippetType(t))return e[o.MESSAGE.KEY];let a=e[o.MESSAGE.DATA.KEY];if(!a)return this.t(e[o.MESSAGE.KEY]);if(a[o.MESSAGE.DATA.MODIFIERS]){let t="",i=a[o.MESSAGE.DATA.TARGET_LABEL];for(let s of Object.keys(a[o.MESSAGE.DATA.MODIFIERS])){let n=this.t(s),r=a[o.MESSAGE.DATA.MODIFIERS][s];t+=this.t(e[o.MESSAGE.KEY],{propertyValue:r,propertyLabel:n,targetLabel:i})}return t}return this.t(e[o.MESSAGE.KEY],a)}t(e,t={},a=!1){return this.gameManager.services.translator.t(e,t,a)}isValidMessageType(e){return -1===this.validMessageTypes().indexOf(e)}validMessageTypes(){return[Object.values(o.TYPES)]}isValidSnippetType(e){let t=this.snippetsMessageTypes();for(let a of Object.keys(t))if(t[a]===e)return!0;return!1}snippetsMessageTypes(){let e=Object.assign({},o.TYPES);return delete e[o.TYPES.MESSAGE],delete e[o.TYPES.PRIVATE],delete e[o.TYPES.GLOBAL],delete e[o.TYPES.TEAMS],e}isValidSnippetFromType(e){return -1!==[o.TYPES.SYSTEM,o.TYPES.ERROR].indexOf(e)}fetchPlayerByName(e){let t=this.gameManager.getCurrentPlayer().players,a=Object.keys(t);if(1>=a.length)return!1;for(let i of a){let a=t[i];if(a.playerName===e)return a}}sendChatMessage(){if(!this.isValidMessage())return!1;let e=this.applyTextLimit(this.chatInput.value,this.characterLimit),t={act:o.CHAT_ACTION,m:e};this.gameManager.events.emitSync("reldens.chatMessageObjectCreated",this,t),this.useGlobalRoom()?this.useGlobalRoomForMessage(t):this.gameManager.activeRoomEvents.send(t),this.chatInput.value="",this.closeChatBoxAfterSend&&this.hideChatBox()}applyTextLimit(e,t){return 0<t&&t<e.length?e.substring(0,t):e}useGlobalRoom(){return 0===this.chatInput.value.indexOf("#")||0===this.chatInput.value.indexOf("@")}isValidMessage(){return this.chatInput.value&&0<this.chatInput.value.replace("#","").replace("@","").trim().length}useGlobalRoomForMessage(e){let t=c.get(this.gameManager.joinedRooms,o.CHAT_GLOBAL,!1);return t?0===this.chatInput.value.indexOf("@")?void this.sendPrivateMessage(e,t):void this.globalSend(t,e):(l.error("Global chat room not found."),!1)}sendPrivateMessage(e,t){let a=this.chatInput.value.substring(1,this.chatInput.value.indexOf(" "));if("@"===a)return!1;e.t=a,this.globalSend(t,e)}globalSend(e,t){try{e.send("*",t)}catch(e){l.critical(e),this.gameDom.alertReload(this.gameManager.services.translator.t("game.errors.connectionLost"))}}}},{"25a87f28fb7e0308":"phaser","9224444cee79f5ae":"8erjr",eae9f6a9f3b912be:"103xI",e56c6f22335ef248:"7cQyS","3e430b9bcb390349":"@reldens/utils"}],"103xI":[function(e,t,a,i){let{ChatConst:s}=e("d66697f0f021bff3"),{Logger:n,sc:r}=e("603ef3007dd0c7e3");t.exports.ChatTabs=class{constructor(e,t){this.gameManager=e,this.uiScene=t,this.showTabs=this.gameManager.config.get("client/ui/chat/showTabs"),this.containerTemplate=!1,this.headerTemplate=!1,this.contentTemplate=!1,this.createTabs(),this.activateTabs()}createTabs(){if(!this.isReady())return!1;let e=r.get(this.gameManager.initialGameData,"chatTypes",[]);if(0===e.length)return n.info("Chat types empty."),!1;if(!this.gameManager.gameDom.getElement(s.SELECTORS.CONTENTS))return n.info("Chat contents element not found."),!1;if(!this.fetchTemplates())return!1;let t="",a="",i=0;for(let n of e){if(!n.show_tab)continue;let e=n.key,r=n.id,o=Object.assign({},{headerTemplate:this.headerTemplate});t+=this.gameManager.gameEngine.parseTemplate(o.headerTemplate,{tabId:r,tabLabel:this.gameManager.services.translator.t(s.SNIPPETS.PREFIX+s.SNIPPETS.TAB_PREFIX+e),className:0===i?" active":""});let l=Object.assign({},{contentTemplate:this.contentTemplate});a+=this.gameManager.gameEngine.parseTemplate(l.contentTemplate,{tabId:r,tabKey:e,className:0===i?" active":""}),i++}let o=this.gameManager.gameEngine.parseTemplate(this.containerTemplate,{tabsHeaders:t,tabsContents:a});this.gameManager.gameDom.updateContent(s.SELECTORS.CONTENTS,o)}fetchTemplates(){return(this.containerTemplate=this.uiScene.cache.html.get("chatTabsContainer"),this.containerTemplate)?(this.headerTemplate=this.uiScene.cache.html.get("chatTabLabel"),this.headerTemplate)?(this.contentTemplate=this.uiScene.cache.html.get("chatTabContent"),!!this.contentTemplate||(n.info("Chat contentTemplate not found."),!1)):(n.info("Chat headerTemplate not found."),!1):(n.info("Chat containerTemplate not found."),!1)}isReady(){return this.gameManager||n.error("ChatTabs, missing game manager."),this.uiScene||n.error("ChatTabs, missing UI Scene."),!(!this.showTabs||!this.gameManager||!this.uiScene)}activateTabs(){for(let e of this.gameManager.gameDom.getElements(".tab-label"))e.addEventListener("click",e=>{let t=this.gameManager.gameDom.getElement(".tab-label.active");t?.classList.remove("active"),e.target.classList.add("active");let a=this.gameManager.gameDom.getElement(".tab-content.active");a?.classList.remove("active");let i=this.gameManager.gameDom.getElement(".tab-content-"+e.target.dataset.tabId);if(!i)return n.warning("Tab content was not found.",e),!1;i.classList.add("active"),i.parentNode.scrollTop=i.scrollHeight})}}},{d66697f0f021bff3:"7cQyS","603ef3007dd0c7e3":"@reldens/utils"}],"7cQyS":[function(e,t,a,i){let s="chat.",n="player.",r={KEY:"ctk",MESSAGE:1,JOINED:2,SYSTEM:3,PRIVATE:4,DAMAGE:5,REWARD:6,SKILL:7,TEAMS:8,GLOBAL:9,ERROR:10};t.exports.ChatConst={ROOM_TYPE_CHAT:"chat",CHAT_ACTION:"c",TYPES:r,CHAT_FROM:"f",CHAT_TO:"t",CHAT_UI:"chat-ui",CHAT_FORM:"chat-form",CHAT_INPUT:"chat-input",CHAT_SEND_BUTTON:"chat-send",CHAT_CLOSE_BUTTON:"chat-close",CHAT_OPEN_BUTTON:"chat-open",CHAT_BALLOON:"notification-balloon",CHAT_GLOBAL:"chat",MESSAGE:{KEY:"m",FROM:"f",TO:"t",DATA:{KEY:"md",SNIPPET:"sp",PLAYER_NAME:"pn",ROOM_NAME:"rn",DAMAGE:"d",TARGET_LABEL:"tL",SKILL_LABEL:"sk",MODIFIERS:"mfs"},DATA_VALUES:{NAMESPACE:"chat",pn:"playerName",rn:"roomName",d:"damage",tL:"targetLabel",sk:"skillLabel",mfs:"modifiers"}},SNIPPETS:{PREFIX:s,PLAYER_PREFIX:n,TAB_PREFIX:"tabs.",NPC_DAMAGE:s+"npcDamage",NPC_DODGED_SKILL:s+"dodgedSkill",MODIFIERS_APPLY:s+"modifiersApply",JOINED_ROOM:s+"joinedRoom",LEFT_ROOM:s+"leftRoom",PRIVATE_MESSAGE_PLAYER_NOT_FOUND:s+"playerNotFound",GLOBAL_MESSAGE_NOT_ALLOWED:s+"globalMessageNotAllowed",GLOBAL_MESSAGE_PERMISSION_DENIED:s+"globalMessagePermissionDenied",PLAYER:{DAMAGE:s+n+"damage",DODGED_SKILL:s+n+"dodgedSkill"},GUEST_INVALID_CHANGE_POINT:s+"guestInvalidChangePoint",WAITING:"..."},SELECTORS:{CONTENTS:"#chat-contents",CHAT_MESSAGES:"#chat-messages",TAB_CONTENT_PREFIX:".tab-content-",TAB_CONTENT_ACTIVE:".tab-content.active"},TYPE_COLOR:{[r.MESSAGE]:"#ffffff",[r.PRIVATE]:"#f39c12",[r.PRIVATE+".to"]:"#00afff",[r.GLOBAL]:"#ffff00",[r.SYSTEM]:"#2ecc71",[r.ERROR]:"#ff0000",[r.DAMAGE]:"#ff0000",[r.SYSTEM+".modifiers"]:"#0feeff",[r.REWARD]:"#2ecc71",[r.TEAMS]:"#2ecc71"}}},{}],"4Pmjs":[function(e,t,a,i){let{ChatConst:s}=e("1b95421bf98ed257");t.exports.MessagesListener=class{static async listenMessages(e,t){e.onMessage("*",e=>{if(s.CHAT_ACTION===e.act){if(!t.uiManager)return void t.messagesQueu.push(e);t.uiManager.attachNewMessage(e)}})}}},{"1b95421bf98ed257":"7cQyS"}],"7omKw":[function(e,t,a,i){t.exports.TemplatesHandler=class{static preloadTemplates(e,t){let a="/assets/features/chat/templates/";e.load.html("chat",a+"ui-chat.html"),e.load.html("chatMessage",a+"message.html"),t&&(e.load.html("chatTabsContainer",a+"tabs-container.html"),e.load.html("chatTabLabel",a+"tab-label.html"),e.load.html("chatTabContent",a+"tab-content.html"))}}},{}],"4L25v":[function(e,t,a,i){t.exports={chat:{ctk3:"System",ctk10:"System",npcDamage:"%damage damage on %targetLabel",dodgedSkill:"%targetLabel dodged %skill",modifiersApply:"%propertyValue %propertyLabel on %targetLabel",joinedRoom:"%playerName has joined %roomName",leftRoom:"%playerName has left",playerNotFound:'Player "%playerName" not found',globalMessagesNotAllowed:"Global messages not allowed",globalMessagePermissionDenied:"Global message permission denied",guestInvalidChangePoint:"The room is not available for guest users.",player:{damage:"%damage damage on %targetLabel",dodgedSkill:"%targetLabel dodged %skill"},tabs:{message:"General",joined:"Joined",system:"System",private:"Private",damage:"Damage",reward:"Rewards",skill:"Skills",teams:"Teams",global:"Global",error:"Error"}}}},{}],bJxKc:[function(e,t,a,i){let{SnippetsConst:s}=e("f6c7ed16f345c70"),{sc:n}=e("880c1f97a972c80c");t.exports.TranslationsMapper=class{static forConfig(e,t,a=!1,i=s.DEFAULT_LOCALE){e.snippets||(e.snippets={}),e.snippets[i]||(e.snippets[i]={});let r=this.fromObject(t);if(e.snippets[i]=n.deepMergeProperties(r,e.snippets[i]),!a)return;e.snippetsDataValues||(e.snippetsDataValues={});let o=a.NAMESPACE||s.DATA_VALUES_DEFAULT_NAMESPACE;n.deepMergeProperties(e.snippetsDataValues,{[o]:a})}static fromObject(e){let t=Object.keys(e);if(0===t.length)return{};let a={};for(let i of t)this.recursiveMap(i,e[i],a);return a}static recursiveMap(e,t,a){if(!n.isObject(t)){a[e]=t;return}let i=Object.keys(t);if(0!==i.length)for(let n of i)this.recursiveMap(e+s.CONCAT_CHARACTER+n,t[n],a)}}},{f6c7ed16f345c70:"glyi0","880c1f97a972c80c":"@reldens/utils"}],glyi0:[function(e,t,a,i){t.exports.SnippetsConst={KEY:"snippets",DEFAULT_LOCALE:"en_US",CONCAT_CHARACTER:".",DATA_VALUES_DEFAULT_NAMESPACE:"default",ACTIONS:{UPDATE:"sn.Up"}}},{}],bYb3U:[function(e,t,a,i){let{Logger:s}=e("d95174c8984b7bee");t.exports.PluginInterface=class{async setup(e){s.error("Setup plugin not implemented.",e)}}},{d95174c8984b7bee:"@reldens/utils"}],"8R9IZ":[function(e,t,a,i){let{AnimationEngine:s}=e("76742c4fe6325846"),{ObjectsMessageListener:n}=e("207fea1534039900"),{DropsMessageListener:r}=e("e451d827dfc8e765"),o=e("26c9abd8da29d9a1"),{TranslationsMapper:l}=e("eab195a4a5f61629"),{UserInterface:c}=e("33448c271890ad0b"),{ObjectsConst:d}=e("189563d48aace89d"),{ActionsConst:h}=e("e3b259719bc592e2"),{PluginInterface:m}=e("c500b33f3cb14996"),{GameConst:g}=e("f79919fd1915086e"),{Logger:u,sc:p}=e("bea1ea8a6cf570dd");t.exports.ObjectsPlugin=class extends m{setup(e){this.gameManager=p.get(e,"gameManager",!1),this.gameManager||u.error("Game Manager undefined in InventoryPlugin."),this.events=p.get(e,"events",!1),this.events||u.error("EventsManager undefined in InventoryPlugin."),this.bodyOnAddCallBack=!1,this.bodyOnRemoveCallBack=!1,this.bullets={},this.changeBodyVisibilityOnInactiveState=this.gameManager.config.getWithoutLogs("client/objects/animations/changeBodyVisibilityOnInactiveState",!0),this.missingSpritesTimeOut=this.gameManager.config.getWithoutLogs("client/general/animations/missingSpritesTimeOut",200),this.missingSpritesMaxRetries=this.gameManager.config.getWithoutLogs("client/general/animations/missingSpritesMaxRetries",5),this.missingSpriteRetry=0,this.listenEvents(),this.setTranslations(),this.setListener()}setListener(){if(!this.gameManager)return!1;this.gameManager.config.client.message.listeners.traderObject=new n}setTranslations(){if(!this.gameManager)return!1;l.forConfig(this.gameManager.config.client,o,d.MESSAGE.DATA_VALUES)}listenEvents(){if(!this.events)return!1;this.events.on("reldens.startEngineScene",async e=>{await this.prepareObjectsUi(e.gameManager,e.roomData.objectsAnimationsData,e)}),this.events.on("reldens.afterSceneDynamicCreate",async e=>{await this.createDynamicAnimations(e)}),this.events.on("reldens.joinedRoom",(e,t)=>{this.listenMessages(e,t),r.listenMessages(e,t)})}listenMessages(e,t){if(e.onMessage("*",e=>{this.startObjectAnimation(e,t),this.objectBattleEndAnimation(e,t)}),!e.state||!e.state.bodies)return!1;this.setAddBodyCallback(e,t),this.setRemoveBodyCallback(e)}setAddBodyCallback(e,t){this.bodyOnAddCallBack=e.state.bodies.onAdd((a,i)=>{this.setOnChangeBodyCallback(a,i,e,t),this.createBulletSprite(i,t,a)})}createBulletSprite(e,t,a){if(-1===e.indexOf("bullet"))return!1;let i=t.activeRoomEvents.getActiveScene(),s="default_bullet",n=(a.key?a.key+"_":"")+"bullet";p.hasOwn(t.gameEngine.uiScene.directionalAnimations,n)&&(n=n+"_"+a.dir),p.hasOwn(i.anims.anims.entries,n)&&(s=n);let r=i?.physics?.add?.sprite(a.x,a.y,s);if(!r)return u.warning("Could not create bullet sprite.",i),!1;r.setDepth(11e3),this.bullets[e]=r}setOnChangeBodyCallback(e,t,a,i){for(let a of Object.keys(e))e.listen(a,async s=>{await this.events.emit("reldens.objectBodyChange",{body:e,key:t,changes:{[a]:s}});let n=i.activeRoomEvents.getActiveScene();if(this.updateBodyProperties(a,e,s,n,t),!n)return;let r=-1!==t.indexOf("bullet"),o=r?this.bullets[t]:n?.objectsAnimations[t];this.setVisibility(o,g.STATUS.ACTIVE===e.inState),this.logObjectBodyUpdate(t,a,s,o);let l=g.STATUS.AVOID_INTERPOLATION!==e.inState;if(n?.clientInterpolation&&l){n.interpolateObjectsPositions[t]=e;return}return r?this.updateBulletBodyPosition(t,e):this.updateObjectsAnimations(t,e,n)})}logObjectBodyUpdate(e,t,a,i){("x"===t||"y"===t)&&i&&i[t]&&i[t]}setVisibility(e,t){e&&e.sceneSprite&&e.sceneSprite.setVisible(t)}updateBodyProperties(e,t,a,i,s){i.objectsAnimationsData[s]&&("x"===e||"y"===e)&&(i.objectsAnimationsData[s][e]=a),t[e]=a}updateBulletBodyPosition(e,t){this.bullets[e]&&(this.bullets[e].x=t.x,this.bullets[e].y=t.y,this.events.emit("reldens.objectBodyChanged",{body:t,key:e}))}updateObjectsAnimations(e,t,a){let i=p.get(a.objectsAnimations,e);if(!i)return!1;i.updateObjectAndSpritePositions(t.x,t.y),this.events.emit("reldens.objectBodyChanged",{body:t,key:e});let s=i.updateObjectDepth();i.inState=t.inState;let n=this.fetchAvailableAnimationKey(a,i,t);return""!==n&&i.sceneSprite.anims.play(n,!0),this.moveSpritesObjects(i,t.x,t.y,s),!t.mov&&(i.sceneSprite.anims.stop(),i.sceneSprite.mov=t.mov,!!i.autoStart&&(i.sceneSprite.anims.play(this.determineAutoStartAnimation(i,n)),!0))}determineAutoStartAnimation(e,t){return!0===e.autoStart?e.key:e.autoStart===d.DYNAMIC_ANIMATION?t:e.autoStart}fetchAvailableAnimationKey(e,t,a){return p.getByPriority(e.anims.anims.entries,[t.key+"_"+a.dir,t.layerName+"_"+t.id+"_"+a.dir,t.key])||""}setRemoveBodyCallback(e){this.bodyOnRemoveCallBack=e.state.bodies.onRemove((e,t)=>{if(-1===t.indexOf("bullet")||!p.hasOwn(this.bullets,t))return!1;this.bullets[t].destroy(),delete this.bullets[t]})}objectBattleEndAnimation(e,t){if(e.act!==h.BATTLE_ENDED)return!1;let a=p.get(t.config.client.skills.animations,e.k+"_death","default_death"),i=t.activeRoomEvents.getActiveScene();try{this.playDeathAnimation(a,i,e)}catch(e){u.warning('Error on sprite "'+a+'" not available.',e.message)}if(!p.hasOwn(e,h.DATA_OBJECT_KEY_TARGET))return!1;e[h.DATA_OBJECT_KEY_TARGET]===i.player.currentTarget?.id&&t.gameEngine.clearTarget();let s=p.get(i.player.players,e[h.DATA_OBJECT_KEY_TARGET],!1);if(!s)return!1;s.visible=!1,p.hasOwn(s,"nameSprite")&&s.nameSprite&&(s.nameSprite.visible=!1)}playDeathAnimation(e,t,a){if(!t.getAnimationByKey(e))return this.missingSpritesMaxRetries===this.missingSpriteRetry?u.debug('Sprite "'+e+'" not available.',e):(this.missingSpriteRetry++,setTimeout(()=>this.playDeathAnimation(e,t,a),this.missingSpritesTimeOut)),!1;let i=t.physics.add.sprite(a.x,a.y,e);return i.setDepth(10500),i.anims.play(e,!0).on("animationcomplete",()=>{i.destroy()}),!0}startObjectAnimation(e,t){if(e.act!==d.OBJECT_ANIMATION&&e.act!==d.TYPE_ANIMATION)return!1;let a=t.activeRoomEvents.getActiveScene();if(!p.hasOwn(a.objectsAnimations,e.key))return!1;a.objectsAnimations[e.key].runAnimation()}moveSpritesObjects(e,t,a,i){if(!e.moveSprites)return;let s=Object.keys(e.moveSprites);if(0!==s.length)for(let n of s){let s=e.moveSprites[n];s.x=t,s.y=a;let r=i+("above"===p.get(e.animationData,"depthByPlayer","")?1:-.1);s.setDepth(r)}}async prepareObjectsUi(e,t,a){if(!t)return void u.info("None objects animations data.");for(let i of Object.keys(t)){let s=t[i];if(!p.hasOwn(s,"ui"))continue;if(!s.id){u.error(["Object ID not specified. Skipping registry:",s]);continue}let n=p.get(s,"template","/assets/html/dialog-box.html");a.objectsUi[s.id]=new c(e,s,n,"npcDialog"),await e.events.emit("reldens.createdUserInterface",{gameManager:e,id:s.id,userInterface:a.objectsUi[s.id],ObjectsPlugin:this})}}async createDynamicAnimations(e){if(!e.objectsAnimationsData)return void u.info("None animations defined on this scene: "+e.key);for(let t of(await this.events.emit("reldens.createDynamicAnimationsBefore",this,e),Object.keys(e.objectsAnimationsData))){let a=e.objectsAnimationsData[t];await this.createAnimationFromAnimData(a,e)}}async createAnimationFromAnimData(e,t){if(!e.key)return u.error("Animation key not specified. Skipping registry.",e),!1;e.frameRate=t.configuredFrameRate;let a=t.gameManager.activeRoomEvents,i=this.fetchExistentBody(t,a,e);this.updateAnimationPosition(i,e),await this.events.emit("reldens.createDynamicAnimation_"+e.key,this,e);let n=new(t.gameManager.config.getWithoutLogs("client/customClasses/objects/"+e.key,s))(t.gameManager,e,t),r=n.createAnimation();return this.updateAnimationVisibility(i,r),n}updateAnimationPosition(e,t){if(!e)return!1;t.x!==e.x&&(t.x=e.x),t.y!==e.y&&(t.y=e.y)}updateAnimationVisibility(e,t){if(!e||g.STATUS.DEATH!==e.inState&&g.STATUS.DISABLED!==e.inState)return!1;t.visible=!1}fetchExistentBody(e,t,a){return e.key!==t.roomName?(u.warning("Scene key and roomName miss match: "+e.key+" / "+t.roomName+"."),!1):t.room.state.bodies.get(a?.key)}}},{"76742c4fe6325846":"ho7cr","207fea1534039900":"fAjyX",e451d827dfc8e765:"d6leB","26c9abd8da29d9a1":"9Q2Iw",eab195a4a5f61629:"bJxKc","33448c271890ad0b":"e9cEC","189563d48aace89d":"fEftg",e3b259719bc592e2:"hmzhe",c500b33f3cb14996:"bYb3U",f79919fd1915086e:"52yv8",bea1ea8a6cf570dd:"@reldens/utils"}],ho7cr:[function(e,t,a,i){let{Logger:s,sc:n}=e("5045f4b0be8e4d09"),{ObjectsConst:r}=e("5bdcc625cdcbb429"),{GameConst:o}=e("25585b3d2976fa69"),{ActionsConst:l}=e("34b34457c954466");t.exports.AnimationEngine=class{constructor(e,t,a){this.currentPreloader=a,this.currentAnimation=!1,this.gameManager=e,this.enabled=t.enabled||!1,this.key=t.key,this.id=t.id,this.asset_key=t.asset_key||t.key,this.assetPath=t.assetPath||"/assets/custom/sprites/",this.type=t.type||!1,this.ui=t.ui||!1,this.targetName=t.targetName,this.frameRate=t.frameRate||!1,this.frameStart=t.frameStart||0,this.frameEnd=t.frameEnd||0,this.x=t.x||0,this.y=t.y||0,this.repeat=isNaN(t.repeat)?-1:t.repeat,this.hideOnComplete=t.hideOnComplete||!1,this.gameManager.createdAnimations||(this.gameManager.createdAnimations={}),this.destroyOnComplete=t.destroyOnComplete||!1,this.autoStart=t.autoStart||!1,this.layerName=t.layerName||!1,this.positionFix=t.positionFix||!1,this.zeroPad=t.zeroPad||!1,this.prefix=t.prefix||!1,this.isInteractive=t.isInteractive||!1,this.highlightOnOver=!!n.get(t,"highlightOnOver",this.gameManager.config.getWithoutLogs("client/ui/animations/highlightOnOver",!0)),this.highlightColor=n.get(t,"highlightColor",this.gameManager.config.getWithoutLogs("client/ui/animations/highlightColor","0x00ff00")),this.restartTime=n.get(t,"restartTime",!1),this.calculateAnimPosition(),n.hasOwn(t,"animations")&&this.createObjectAnimations(t.animations)}updateObjectAndSpritePositions(e,t){this.sceneSprite.x=e,this.sceneSprite.y=t,this.x=e,this.y=t,this.calculateAnimPosition()}calculateAnimPosition(){this.animPos={x:this.x,y:this.y},this.positionFix&&(n.hasOwn(this.positionFix,"x")&&(this.animPos.x=this.x+this.positionFix.x),n.hasOwn(this.positionFix,"y")&&(this.animPos.y=this.y+this.positionFix.y))}updateObjectDepth(){let e=this.y+this.sceneSprite.height;return this.sceneSprite.setDepth(e),e}createAnimation(){if(!this.enabled)return void s.error("Animation disabled: "+this.key);let e=this.gameManager.activeRoomEvents.getActiveScene();if(!e)return void s.error("Active scene not found.");let t={start:this.frameStart,end:this.frameEnd};if(!1!==this.prefix&&(t.prefix=this.prefix),!1!==this.zeroPad&&(t.zeroPad=this.zeroPad),!this.currentPreloader.anims.textureManager.list[this.asset_key]){s.warning("Asset not found in preloader.",this.asset_key,t),this.currentPreloader.load.spritesheet(this.asset_key,this.assetPath+this.asset_key,t),this.currentPreloader.load.once("complete",async()=>{this.createAnimation()});return}let a=this.currentPreloader.anims.generateFrameNumbers(this.asset_key,t),i={key:this.key,frames:a,frameRate:this.frameRate,repeat:this.repeat,hideOnComplete:this.hideOnComplete};this.currentAnimation=this.gameManager.createdAnimations[this.key],this.currentAnimation||(s.debug("Creating animation: "+this.key),this.currentAnimation=this.currentPreloader.anims.create(i)),this.currentPreloader.objectsAnimations[this.key]=this.currentAnimation,this.gameManager.createdAnimations[this.key]=this.currentAnimation;let n=this.positionFix?this.animPos.x:this.x,r=this.positionFix?this.animPos.y:this.y;return this.sceneSprite=e.physics.add.sprite(n,r,this.asset_key),this.autoStart&&this.sceneSprite.anims.play(this.key,!0),this.enableInteraction(e),this.enableAutoRestart(),this.automaticDestroyOnComplete(),this.sceneSprite.setDepth(this.y+this.sceneSprite.body.height),e.objectsAnimations[this.key]=this,this.gameManager.events.emitSync("reldens.createAnimationAfter",{animationEngine:this}),this.sceneSprite}automaticDestroyOnComplete(){this.destroyOnComplete&&this.sceneSprite.on("animationcomplete",()=>{this.currentAnimation?.destroy(),this.sceneSprite.destroy()},this)}enableAutoRestart(){this.restartTime&&this.sceneSprite.on("animationcomplete",()=>{setTimeout(()=>{this.sceneSprite.anims&&(this.sceneSprite.anims.restart(),this.sceneSprite.anims.pause())},this.restartTime)},this)}enableInteraction(e){this.isInteractive&&(this.sceneSprite.setInteractive({useHandCursor:!0}).on("pointerdown",t=>{if(o.SELECTORS.CANVAS!==t.downElement.nodeName)return!1;let a=this.key===this.asset_key?this.id:this.key,i={act:r.OBJECT_INTERACTION,id:a,type:this.type};if(this.gameManager.activeRoomEvents.send(i),!this.targetName)return!1;let s=Object.assign({},e.player.currentTarget),n={id:a,type:r.TYPE_OBJECT};if(e.player.currentTarget=n,this.gameManager.gameEngine.showTarget(this.targetName,n,s),r.TYPE_ENEMY===this.type){let t=this.gameManager.config.get("client/ui/controls/defaultActionKey")||"physical_attack";this.gameManager.activeRoomEvents.send({act:l.ACTION,target:e.player.currentTarget,type:t})}}),this.highlightOnOver&&(this.sceneSprite.on("pointerover",()=>{this.sceneSprite.setTint(this.highlightColor)}),this.sceneSprite.on("pointerout",()=>{this.sceneSprite.clearTint()})))}runAnimation(){this.sceneSprite?this.sceneSprite.anims.play(this.key,!0):s.error("Current animation not found: "+this.key)}getPosition(){return{x:this.x,y:this.y}}createObjectAnimations(e){if(!e)return;let t=Object.keys(e);if(0!==t.length)for(let a of t){if(this.gameManager.createdAnimations[a]){this.currentPreloader.objectsAnimations[a]=this.gameManager.createdAnimations[a];continue}if(n.hasOwn(this.currentPreloader.objectsAnimations,a))continue;let t=e[a],i={key:a,frames:this.currentPreloader.anims.generateFrameNumbers(t.asset_key||this.asset_key,{start:t.start||this.frameStart,end:t.end||this.frameEnd}),frameRate:t.frameRate||this.frameRate,repeat:t.repeat||this.repeat,hideOnComplete:t.hideOnComplete||this.hideOnComplete,asset_key:t.asset_key||this.asset_key};this.currentPreloader.objectsAnimations[a]=this.currentPreloader.anims.create(i),this.gameManager.createdAnimations[a]=this.currentPreloader.objectsAnimations[a]}}}},{"5045f4b0be8e4d09":"@reldens/utils","5bdcc625cdcbb429":"fEftg","25585b3d2976fa69":"52yv8","34b34457c954466":"hmzhe"}],fAjyX:[function(e,t,a,i){let{TraderObjectUi:s}=e("b14ff574969f05c7"),{Logger:n,sc:r}=e("28c6856f5bee0892");t.exports.ObjectsMessageListener=class{async executeClientMessageActions(e){let t=r.get(e,"message",!1);if(!t)return n.error("Missing message data on ObjectsMessageListener.",e),!1;if(!r.get(t,"result",!1))return n.error("Missing result data on ObjectsMessageListener.",e),!1;if(!r.get(t,"id",!1))return n.error("Missing Object ID on ObjectsMessageListener.",e),!1;let a=r.get(e,"roomEvents",!1);if(!a)return n.error("Missing RoomEvents on ObjectsMessageListener.",e),!1;let i=new s({roomEvents:a,message:t});if(!i.validate())return!1;i.updateContents()}}},{b14ff574969f05c7:"2xs1l","28c6856f5bee0892":"@reldens/utils"}],"2xs1l":[function(e,t,a,i){let{ItemsConst:s}=e("cdac730d5b5ab82a"),{ObjectsConst:n}=e("709ad51a4f52a4c4"),{Logger:r,sc:o}=e("1ac8620591e8ad0f");t.exports.TraderObjectUi=class{constructor(e){this.roomEvents=o.get(e,"roomEvents",!1),this.message=o.get(e,"message",!1),this.gameManager=this.roomEvents?.gameManager,this.gameDom=this.gameManager?.gameDom,this.uiScene=this.gameManager?.gameEngine?.uiScene,this.itemsManager=this.gameManager?.inventory?.manager,this.objectUi=this.roomEvents?.objectsUi[this.message?.id],this.setConfirmMessages()}validate(){return this.roomEvents?this.message?this.gameManager?this.uiScene?this.itemsManager?!!this.objectUi||(r.error("Missing objectUi on TraderObjectUi."),!1):(r.error("Missing ItemsManager on TraderObjectUi."),!1):(r.error("Missing UiScene on TraderObjectUi."),!1):(r.error("Missing GameManager on TraderObjectUi."),!1):(r.error("Missing message on TraderObjectUi."),!1):(r.error("Missing RoomEvents on TraderObjectUi."),!1)}setConfirmMessages(){if(!this.gameManager)return!1;this.confirmMessages={buy:this.gameManager.services.translator.t("objects.trader.buyConfirmed"),sell:this.gameManager.services.translator.t("objects.trader.sellConfirmed")}}updateContents(){let e=this.gameManager.gameDom.getElement("#box-"+this.objectUi.id+" .box-content");if(!e)return r.error('Missing container: "#box-'+this.objectUi.id+' .box-content".'),!1;let t=this.message.result.action;if(n.TRADE_ACTIONS_FUNCTION_NAME.CONFIRM===this.message.result.subAction)return e.innerHTML=this.confirmMessages[t],!0;let a=o.get(this.message.result,"items",!1),i=this.mapInventoryKeyFromAction(t),s=o.get(this.message.result,"exchangeData",!1),l=o.get(s,i,!1),c=this.message.result.exchangeRequirementsA||[],d=this.message.result.exchangeRewardsB||[];this.updateItemsList(a,t,c,d,e,l),this.updateExchangeData(l,t,c,d,a)}updateItemsList(e,t,a,i,s,n){if(!e)return;let r="",l={};for(let s of Object.keys(e)){let c=e[s],d=Object.assign({manager:this.itemsManager},c,{uid:s}),h=o.get(this.itemsManager.itemClasses,d.key,this.itemsManager.types.classByTypeId(d.type));l[s]=new h(d),l[s].quantityDisplay=1,l[s].quantityMaxDisplay=Math.max(l[s].qty_limit,c.qty),l[s].tradeAction=t,l[s].exchangeRequirements=this.fetchItemRequirements(d.key,a),l[s].exchangeRewards=this.fetchItemRewards(d.key,i),r+=this.createTradeItemBox(l[s],o.get(n,l[s].uid,!1))}s.innerHTML=this.createTradeContainer(t,r),this.activateItemsBoxActions(l),this.activateConfirmButtonAction(t)}activateConfirmButtonAction(e){let t=this.gameManager.gameDom.getElement(".confirm-"+e),a={act:n.OBJECT_INTERACTION,id:this.message.id,value:e,sub:n.TRADE_ACTIONS.CONFIRM};t?.addEventListener("click",()=>{this.gameManager.activeRoomEvents.send(a)})}updateExchangeData(e,t,a,i,s){if(!1===e)return!1;let n=this.createConfirmItemsBox(e,s,t),o=null;return("buy"===t&&(o=this.gameDom.getElement(".trade-container-buy .trade-col.trade-col-2")),"sell"===t&&(o=this.gameDom.getElement(".trade-container-sell .trade-col.trade-col-1")),null===o)?(r.error('Missing "'+t+'" items container.',{message:this.message}),!1):(o.innerHTML=n,this.assignRemoveActions(e,s,t),!0)}createConfirmItemsBox(e,t,a){let i=Object.keys(e);if(0===i.length)return this.message.lastErrorMessage||r.info("Undefined exchange items on confirmation trader-object-ui.",{message:this.message}),"";let n="",o=this.uiScene.cache.html.get("inventoryTradeItem");if(!o)return r.error('Missing template "inventoryTradeItem".'),"";for(let r of i){let i=e[r],l=t[r],c=s.TRADE_ACTIONS.BUY===a,d=s.TRADE_ACTIONS.SELL===a;n+=this.gameManager.gameEngine.parseTemplate(o,{key:l.key,label:l.label,description:l.description,id:r,qty:l.qty,hiddenClass:"",tradeRequirements:c?this.createTradeRequirementsContent(l):"",tradeRewards:d?this.createTradeRewardsContent(l):"",tradeAction:this.createTradeActionRemove(l),tradeActionKey:a,tradeQuantityContent:i})}return n}assignRemoveActions(e,t,a){let i=Object.keys(e);if(0===i.length)return this.message.lastErrorMessage||r.info("Undefined exchange items on remove trader-object-ui.",{message:this.message}),!1;for(let e of i){let i=".trade-item-to-be-"+a+".trade-item-"+e,s=this.gameDom.getElement(i);if(!s){r.error('Assign trade item "'+e+'" container not found.',{message:this.message});continue}let o=this.gameDom.getElement(".trade-item-"+a+".trade-item-"+e+" .trade-action-remove");if(!o){r.error('Assign trade item "'+e+'" remove button not found.',{message:this.message});continue}let l=t[e];o.addEventListener("click",()=>{s.classList.remove("hidden");let t={act:n.OBJECT_INTERACTION,id:this.message.id,value:a,itemId:e,itemKey:l.key};t[n.TRADE_ACTIONS.SUB_ACTION]=n.TRADE_ACTIONS.REMOVE,this.gameManager.activeRoomEvents.send(t)})}return!0}createTradeContainer(e,t){let a=this.uiScene.cache.html.get("inventoryTradeContainer");if(!a)return r.error('Missing template "inventoryTradeContainer".'),"";let i=this.message.result.lastErrorData;i?.itemUid&&(i.item=this.fetchItemLabelByUid(i.itemUid)),i?.requiredItemKey&&(i.requiredItem=this.fetchItemLabelByUid(i.requiredItemKey));let o=this.gameManager.services.translator.t(this.message.result.lastErrorMessage,i),l=s.TRADE_ACTIONS.BUY===e?t:"",c=s.TRADE_ACTIONS.SELL===e?t:"";return this.gameManager.gameEngine.parseTemplate(a,{tradeActionKey:e,confirmRequirements:"",lastErrorMessage:o,tradeActionLabel:n.TRADE_ACTIONS_FUNCTION_NAME.CONFIRM,tradeItemsBuy:l,tradeItemsSell:c})}fetchItemLabelByUid(e){return this.gameManager?.inventory?.manager?.items[e]?.label||this.message?.result?.items[e]?.label||""}fetchItemRequirements(e,t){if(0===t.length)return!1;let a={};for(let i of t)e===i.itemKey&&(a[i.itemKey]=i);return a}fetchItemRewards(e,t){if(0===t.length)return!1;let a={};for(let i of t)e===i.itemKey&&(a[i.itemKey]=i);return a}createTradeItemBox(e,t){let a=this.uiScene.cache.html.get("inventoryTradeItem");if(!a)return r.error('Missing template "inventoryTradeItem".'),"";let i=this.uiScene.cache.html.get("inventoryTradeItemQuantity");if(!i)return r.error('Missing template "inventoryTradeItemQuantity".'),"";let n=s.TRADE_ACTIONS.BUY===e.tradeAction,o=s.TRADE_ACTIONS.SELL===e.tradeAction,l=t||0;return this.gameManager.gameEngine.parseTemplate(a,{key:e.key,label:e.label,description:e.description,id:e.getInventoryId(),qty:e.qty,hiddenClass:0<l&&e.qty===l?" hidden":"",tradeRequirements:n?this.createTradeRequirementsContent(e):"",tradeRewards:o?this.createTradeRewardsContent(e):"",tradeAction:this.createTradeActionContent(e),tradeActionKey:"to-be-"+e.tradeAction,tradeQuantityContent:this.gameManager.gameEngine.parseTemplate(i,{quantityDisplay:e.quantityDisplay||1,quantityMaxDisplay:0<e.quantityMaxDisplay?'max="'+e.quantityMaxDisplay+'"':""})})}createTradeRequirementsContent(e){if(!e.exchangeRequirements)return"";let t=Object.keys(e.exchangeRequirements);if(0===t.length)return"";let a=this.uiScene.cache.html.get("inventoryTradeRequirements");if(!a)return r.error('Missing template "inventoryTradeRequirements".'),"";let i="";for(let s of t){let t=e.exchangeRequirements[s];i+=this.gameManager.gameEngine.parseTemplate(a,{itemKey:e.key,requiredItemKey:t.requiredItemKey,requiredQuantity:t.requiredQuantity})}return i}createTradeRewardsContent(e){if(!e.exchangeRewards)return"";let t=Object.keys(e.exchangeRewards);if(0===t.length)return"";let a=this.uiScene.cache.html.get("inventoryTradeRewards");if(!a)return r.error('Missing template "inventoryTradeRewards".'),"";let i="";for(let s of t){let t=e.exchangeRewards[s];i+=this.gameManager.gameEngine.parseTemplate(a,{itemKey:e.key,rewardItemKey:t.rewardItemKey,rewardQuantity:t.rewardQuantity})}return i}createTradeActionContent(e,t){let a=this.uiScene.cache.html.get("inventoryTradeAction");return a?this.gameManager.gameEngine.parseTemplate(a,{key:e.key,id:e.getInventoryId(),tradeAction:t||o.get(e,"tradeAction","")}):(r.error('Missing template "inventoryTradeAction".'),"")}createTradeActionRemove(e){let t=this.uiScene.cache.html.get("inventoryTradeActionRemove");return t?this.gameManager.gameEngine.parseTemplate(t,{key:e.key,id:e.uid,tradeAction:"remove"}):(r.error('Missing template "inventoryTradeActionRemove".'),"")}activateItemsBoxActions(e){for(let t of Object.keys(e)){let a=e[t],i=".trade-item-to-be-"+a.tradeAction+".trade-item-"+a.uid+" .trade-action-"+a.tradeAction+" button",s=this.gameDom.getElement(i);if(!s){r.error('Activate trade item "'+a.uid+'" action button not found.');continue}s.addEventListener("click",()=>{let e=this.gameDom.getElement(".trade-item-"+a.getInventoryId()+" .item-qty input"),t=e?.value||1,i={act:n.OBJECT_INTERACTION,id:this.message.id,value:a.tradeAction,itemId:a.getInventoryId(),itemKey:a.key,qty:Number(t)};i[n.TRADE_ACTIONS.SUB_ACTION]=n.TRADE_ACTIONS.ADD,this.gameManager.activeRoomEvents.send(i)})}}mapInventoryKeyFromAction(e){return o.get({buy:"A",sell:"B"},e,!1)}}},{cdac730d5b5ab82a:"@reldens/items-system","709ad51a4f52a4c4":"fEftg","1ac8620591e8ad0f":"@reldens/utils"}],d6leB:[function(e,t,a,i){let{ObjectsConst:s}=e("7218290e5fe5ff56"),{Logger:n,sc:r}=e("ed2fa042702eef92");t.exports.DropsMessageListener=class{static listenMessages(e,t){e.onMessage("*",e=>{let a=r.get(e,s.DROPS.KEY,!1);a&&this.loadObjects(a,t),s.DROPS.REMOVE===e.act&&this.removeDropById(e.id,t)})}static loadObjects(e,t){let a=t.getActiveScene(),i=t.config,s=t.getFeature("objects"),n=a.load;if(!this.validateParams({currentScene:a,gameConfig:i,objectPlugin:s,loader:n}))return!1;for(let[t,r]of Object.entries(e))this.loadSpritesheet(r,n,i),n.once("complete",async e=>{await this.createDropAnimation(s,r,t,a)});return n.start(),!0}static async createDropAnimation(e,t,a,i){let n={type:s.DROPS.PICK_UP_ACT,enabled:!0,ui:!0,frameStart:t[s.DROPS.PARAMS].start,frameEnd:t[s.DROPS.PARAMS].end,repeat:t[s.DROPS.PARAMS].repeat,autoStart:!0,key:a,id:a,targetName:"",layerName:a,isInteractive:!0,asset_key:t[s.DROPS.ASSET_KEY],x:t.x,y:t.y,yoyo:t[s.DROPS.PARAMS].yoyo};return await e.createAnimationFromAnimData(n,i)}static loadSpritesheet(e,t,a){t.spritesheet(e[s.DROPS.ASSET_KEY],this.getSpritesheetPath(e),this.getRewardFrameConfig(e[s.DROPS.PARAMS],a))}static getRewardFrameConfig(e,t){return{frameWidth:r.get(e,"frameWidth",t.getWithoutLogs("client/map/dropsTile/width",t.get("client/map/tileData/width"))),frameHeight:r.get(e,"frameHeight",t.getWithoutLogs("client/map/dropsTile/height",t.get("client/map/tileData/height")))}}static getSpritesheetPath(e){return s.DROPS.ASSETS_PATH+e[s.DROPS.FILE]}static removeDropById(e,t){if(!e)return!1;let a=t.activeRoomEvents.getActiveScene(),i=r.get(a.objectsAnimations,e,!1);if(!i)return!1;i.sceneSprite.destroy(),delete a.objectsAnimations[e]}static validateParams(e){let t=!0;return r.get(e,"currentScene",!1)||(n.error("Scene is undefined in Rewards Message Listener."),t=!1),r.get(e,"gameConfig",!1)||(n.error("Game Config is undefined in Rewards Message Listener."),t=!1),r.get(e,"objectPlugin",!1)||(n.error("Object Plugin is undefined in Rewards Message Listener."),t=!1),r.get(e,"loader",!1)||(n.error("Loader is undefined in Rewards Message Listener."),t=!1),t}}},{"7218290e5fe5ff56":"fEftg",ed2fa042702eef92:"@reldens/utils"}],"9Q2Iw":[function(e,t,a,i){t.exports={objects:{npcInvalid:"I do not understand.",trader:{content:"Hi there! What would you like to do?",options:{buy:"Buy",sell:"Sell"},buyConfirmed:"Thanks for buying!",sellConfirmed:"Thanks for your products!"}}}},{}],e9cEC:[function(e,t,a,i){let{GameConst:s}=e("9dd5a78a77f1fddd"),{Logger:n,sc:r}=e("46e0fe20c6ebdda0");t.exports.UserInterface=class{constructor(e,t,a="/assets/html/dialog-box.html",i){this.events=e.events,this.gameDom=e.gameDom,this.initialTitle="",this.initialContent="",this.id=t.id,this.animProps=t,this.template=a,this.uiPositionKey=i||"default",this.openButton=null,this.closeButton=null,this.listenEvents()}listenEvents(){if(!this.events)return!1;this.events.on("reldens.beforePreload",e=>{this.preloadUiElement(e)}),this.events.on("reldens.createPreload",(e,t)=>{this.createUiElement(t)})}preloadUiElement(e){this.template&&e.load.html(this.id,this.template)}createUiElement(e,t=""){""===t&&(t=this.id);let a="box-"+this.id;if(r.get(e.elementsUi,this.id))return this;let i=this.createDialogBox(e,t);this.createBoxContent(e,t,i);let s=this.gameDom.getElement(".ui-box.ui-dialog-box",i.node);return s?(s.id=a,s.classList.add("type-"+(this.animProps?.type||"dialog-box")),this.activateOpenButton(i,s,e),this.activateCloseButton(i,s,e),e.userInterfaces[this.id]=this,e.elementsUi[this.id]=i,this):(n.critical('Missing dialog container for template key: "'+t+'".',{dialogBox:i,dialogContainer:s,objectElementId:a}),!1)}createDialogBox(e,t){let{newWidth:a,newHeight:i}=e.gameManager.gameEngine.getCurrentScreenSize(e.gameManager),{uiX:s,uiY:n}=e.getUiPosition(this.uiPositionKey,a,i);return e.add.dom(s,n).createFromCache(t)}createBoxContent(e,t,a){let i=e.cache.html.get(t);a.innerHTML=e.gameManager.gameEngine.parseTemplate(i,{title:this.initialTitle,content:this.initialContent})}activateOpenButton(e,t,a){return this.openButton=this.gameDom.getElement("."+s.UI_BOX+s.UI_OPEN,e.node),!!this.openButton&&(this.openButton.id=s.UI_BOX+s.UI_OPEN+"-"+this.id,this.openButton.addEventListener("click",()=>{r.get(this.animProps,"defaultOpen",!0)&&(t.style.display="block",this.openButton.style.display="none",!1!==r.get(this.animProps,"depth",!1)&&e.setDepth(this.animProps.depth)),r.isFunction(this.animProps.openCallBack)&&this.animProps.openCallBack(),this.events.emit("reldens.openUI",{ui:this,openButton:this.openButton,dialogBox:e,dialogContainer:t,uiScene:a})}),this.openButton)}activateCloseButton(e,t,a){if(this.closeButton=this.gameDom.getElement("."+s.UI_BOX+s.UI_CLOSE,e.node),!this.closeButton)return!1;this.closeButton.id=s.UI_BOX+s.UI_CLOSE+"-"+this.id,this.closeButton.addEventListener("click",()=>{r.hasOwn(this.animProps,"sendCloseMessage")&&!1!==this.animProps.sendCloseMessage||a.gameManager.activeRoomEvents.send({act:s.CLOSE_UI_ACTION,id:this.id}),r.get(this.animProps,"defaultClose",!0)&&(t.style.display="none",this.openButton&&(this.openButton.style.display="block"),!1!==r.get(this.animProps,"depth",!1)&&e.setDepth(1)),r.isFunction(this.animProps.closeCallback)&&this.animProps.closeCallback(),this.events.emit("reldens.closeUI",{ui:this,closeButton:this.closeButton,openButton:this.openButton,dialogBox:e,dialogContainer:t,uiScene:a})})}}},{"9dd5a78a77f1fddd":"52yv8","46e0fe20c6ebdda0":"@reldens/utils"}],"4eFIJ":[function(e,t,a,i){let{InventoryUi:s}=e("93a2698fe17dc4e0"),{InventoryReceiver:n}=e("4ea19e0d8652e572"),{TradeTargetAction:r}=e("c92183e48821b0fc"),{TradeMessageListener:o}=e("38030851510ae93a"),{UserInterface:l}=e("7ae796ce0e1a8f8f"),{PluginInterface:c}=e("373423cdbc6c5da5"),{TemplatesHandler:d}=e("adcbde3f87e2b9a3"),{TranslationsMapper:h}=e("6a97eeb2c282726"),m=e("6b2f7e4678231407"),{InventoryConst:g}=e("2f53dfbd6cac665f"),{ItemsEvents:u,ItemsConst:p}=e("60d2bcd47ae516b6"),{GameConst:f}=e("301626b09cbde5a3"),{Logger:y,sc:b}=e("22940f0bf72eac5a");t.exports.InventoryPlugin=class extends c{setup(e){this.gameManager=b.get(e,"gameManager",!1),this.gameManager||y.error("Game Manager undefined in InventoryPlugin."),this.events=b.get(e,"events",!1),this.events||y.error("EventsManager undefined in InventoryPlugin."),this.tradeTargetAction=new r,this.setTradeUi(),this.listenEvents(),this.setListener(),this.setTranslations()}setTranslations(){if(!this.gameManager)return!1;h.forConfig(this.gameManager.config.client,m,g.MESSAGE.DATA_VALUES)}setTradeUi(){if(!this.gameManager)return!1;this.tradeUi=new l(this.gameManager,{id:"trade",type:"trade"})}setListener(){if(!this.gameManager)return!1;this.gameManager.config.client.message.listeners.trade=new o}listenEvents(){if(!this.events)return!1;this.events.on("reldens.playersOnAdd",(e,t,a,i)=>{this.onPlayerAdd(t,i,e)}),this.events.on("reldens.preloadUiScene",e=>{d.preloadTemplates(e)}),this.events.on("reldens.createUiScene",e=>this.onPreloadUiScene(e)),this.events.on("reldens.gameEngineShowTarget",(e,t,a,i)=>{this.tradeTargetAction.showTargetExchangeAction(this.gameManager,t,a,i)})}onPreloadUiScene(e){this.uiManager=new s(e),this.uiManager.createUi();let t=e.getUiElement("inventory").getChildByProperty("id",g.INVENTORY_ITEMS);if(!t)return y.error("Inventory UI not found.",t),!1;let a=e.getUiElement("equipment").getChildByProperty("id",g.EQUIPMENT_ITEMS);if(!a)return y.error("Equipment UI not found.",a),!1;let i=e.gameManager.inventory.manager,n=b.get(i,"groups",{});if(Object.keys(n).length)for(let t of(e.gameManager.gameDom.getElement("#"+g.EQUIPMENT_ITEMS).innerHTML="",this.sortGroups(n))){let a=this.createGroupBox(n[t],e.gameManager,e);e.gameManager.gameDom.appendToElement("#"+g.EQUIPMENT_ITEMS,a)}let r=b.get(i,"items",{}),o=Object.keys(r);if(0<o.length)for(let i of o){let s=r[i];this.displayItem(s,e,a,t,i)}this.listenInventoryEvents(e,t,a)}onPlayerAdd(e,t,a){if(e!==t.room.sessionId)return!1;t.gameManager.inventory||this.createInventoryInstance(a,t),t.room.onMessage("*",e=>{t.gameManager.inventory.processMessage(e)})}createInventoryInstance(e,t){let a={owner:e,ownerIdProperty:"sessionId",gameManager:t.gameManager},i=t.gameManager.config.getWithoutLogs("client/customClasses/inventory/items",{});i&&0<Object.keys(i).length&&(a.itemClasses=i);let s=t.gameManager.config.getWithoutLogs("client/customClasses/inventory/groups",{});s&&Object.keys(s).length&&(a.groupClasses=s),t.gameManager.inventory=new n(a)}listenInventoryEvents(e,t,a){let i=e.gameManager,s=i.inventory.manager.getOwnerEventKey();i.inventory.manager.listenEvent(u.ADD_ITEM,(a,s)=>{let n=this.createItemBox(s,"inventoryItem",i,e);i.gameDom.appendToElement("#"+g.INVENTORY_ITEMS,n),this.setupButtonsActions(t,s.getInventoryId(),s,e)},i.inventory.manager.getOwnerUniqueEventKey("addItemPack"),s),i.inventory.manager.listenEvent(u.SET_ITEMS,i=>{for(let s of(t.innerHTML="",Object.keys(i.items))){let n=i.items[s];this.displayItem(n,e,a,t,s)}},i.inventory.manager.getOwnerUniqueEventKey("setItemsPack"),s),i.inventory.manager.listenEvent(u.MODIFY_ITEM_QTY,t=>{e.getUiElement("inventory").getChildByID("item-qty-"+t.getInventoryId()).innerHTML=t.qty},i.inventory.manager.getOwnerUniqueEventKey("modifyItemQtyPack"),s),i.inventory.manager.listenEvent(u.REMOVE_ITEM,(t,a)=>{e.getUiElement("inventory").getChildByID("item-"+a).remove()},i.inventory.manager.getOwnerUniqueEventKey("removeItemPack"),s),i.inventory.manager.listenEvent(u.SET_GROUPS,s=>{let n=!1,r=i.gameDom.getElement("#"+g.EQUIPMENT_ITEMS);for(let t of(""!==r.innerHTML&&(n=!0),r.innerHTML="",this.sortGroups(s.groups))){let a=this.createGroupBox(s.groups[t],i,e);i.gameDom.appendToElement("#"+g.EQUIPMENT_ITEMS,a)}n&&this.resetEquippedItemsDisplay(i,e,a,t)},i.inventory.manager.getOwnerUniqueEventKey("setGroupsPack"),s),i.inventory.manager.listenEvent(u.EQUIP_ITEM,i=>{this.displayItem(i,e,a,t,i.getInventoryId())},i.inventory.manager.getOwnerUniqueEventKey("equipItemPack"),s),i.inventory.manager.listenEvent(u.UNEQUIP_ITEM,i=>{this.displayItem(i,e,a,t,i.getInventoryId())},i.inventory.manager.getOwnerUniqueEventKey("unequipItemPack"),s)}resetEquippedItemsDisplay(e,t,a,i){let s=Object.keys(e.inventory.manager.items);if(0===s.length)return!1;for(let n of s){let s=e.inventory.manager.items[n];this.isEquipped(s)&&this.displayItem(s,t,a,i,s.getInventoryId())}}displayItem(e,t,a,i,s){let n=this.createItemBox(e,"inventoryItem",t.gameManager,t),r=t.gameManager.gameDom.getElement("#item-"+e.getInventoryId());if(r&&r.remove(),this.isEquipped(e)){let i=this.getGroupById(e.group_id,t.gameManager.inventory.manager.groups);i&&t.gameManager.gameDom.getElement("#group-item-"+i.key+" .equipped-item")?t.gameManager.gameDom.updateContent("#group-item-"+i.key+" .equipped-item",n):t.gameManager.gameDom.appendToElement("#"+g.EQUIPMENT_ITEMS,n),this.setupButtonsActions(a,s,e,t)}else t.gameManager.gameDom.appendToElement("#"+g.INVENTORY_ITEMS,n),this.setupButtonsActions(i,s,e,t)}updateEquipmentStatus(e,t){t.gameDom.getElement("#item-equip-"+e.idx).src="/assets/features/inventory/assets/"+(e.equipped?"equipped":"unequipped")+f.FILES.EXTENSIONS.PNG}createItemBox(e,t,a,i){let s=i.cache.html.get(t);return a.gameEngine.parseTemplate(s,{key:e.key,label:e.label,description:e.description,id:e.getInventoryId(),qty:e.qty,usable:this.isUsable(e)?this.getUsableContent(e,a,i):"",equipment:this.isEquipment(e)?this.getEquipContent(e,a,i):""})}isEquipment(e){return e.isType(p.TYPES.EQUIPMENT)||e.isType(p.TYPES.SINGLE_EQUIPMENT)}isEquipped(e){return this.isEquipment(e)&&!0===e.equipped}isUsable(e){return e.isType(p.TYPES.USABLE)||e.isType(p.TYPES.SINGLE_USABLE)}sortGroups(e){return Object.keys(e).sort((t,a)=>e[t].sort>e[a].sort?1:-1)}createGroupBox(e,t,a){let i=a.cache.html.get("inventoryGroup");return t.gameEngine.parseTemplate(i,{key:e.key,label:e.label,description:e.description,fileName:e.files_name})}setupButtonsActions(e,t,a,i){let s=i.gameManager.gameDom,n=e.querySelector("#item-"+t+" .image-container img");if(!n)return y.error(["Missing image element.","#item-"+t]),!1;n.addEventListener("click",()=>{let a=e.querySelector("#item-"+t+" .item-data-container"),i=!1;"block"!==a.style.display&&(i=!0),e.querySelectorAll(".item-box .image-container img").forEach(function(e){e.style.border="none"}),e.querySelectorAll(".item-data-container").forEach(function(e){e.style.display="none"}),i&&(n.style.border="1px solid #fff",a.style.display="block")});let r=e.querySelector("#item-trash-"+t+" img");if(!r)return y.error(["Missing button.",r]),!1;r.addEventListener("click",()=>{e.querySelector("#trash-confirm-"+t).style.display="block"}),e.querySelector("#trash-cancel-"+t).addEventListener("click",()=>{e.querySelector("#trash-confirm-"+t).style.display="none"}),e.querySelector("#trash-confirmed-"+t).addEventListener("click",()=>{let e={idx:t,act:g.ACTIONS.REMOVE};i.gameManager.activeRoomEvents.send(e)}),this.isUsable(a)&&s.getElement("#item-use-"+t).addEventListener("click",this.clickedBox.bind(this,t,g.ACTIONS.USE,i)),this.isEquipment(a)&&s.getElement("#item-equip-"+t).addEventListener("click",this.clickedBox.bind(this,t,g.ACTIONS.EQUIP,i))}clickedBox(e,t,a){a.gameManager.activeRoomEvents.send({act:t,idx:e})}getUsableContent(e,t,a){let i=a.cache.html.get("inventoryItemUse");return t.gameEngine.parseTemplate(i,{id:e.getInventoryId()})}getEquipContent(e,t,a){let i=a.cache.html.get("inventoryItemEquip");return t.gameEngine.parseTemplate(i,{id:e.getInventoryId(),equipStatus:e.equipped?"equipped":"unequipped"})}getGroupById(e,t){let a=Object.keys(t);if(0===a.length)return!1;for(let i of a)if(t[i].id===e)return t[i]}}},{"93a2698fe17dc4e0":"cbKwb","4ea19e0d8652e572":"ga9uu",c92183e48821b0fc:"krp4C","38030851510ae93a":"anIx9","7ae796ce0e1a8f8f":"e9cEC","373423cdbc6c5da5":"bYb3U",adcbde3f87e2b9a3:"kPfeK","6a97eeb2c282726":"bJxKc","6b2f7e4678231407":"jDY6s","2f53dfbd6cac665f":"c7Jl5","60d2bcd47ae516b6":"@reldens/items-system","301626b09cbde5a3":"52yv8","22940f0bf72eac5a":"@reldens/utils"}],cbKwb:[function(e,t,a,i){let{UiFactory:s}=e("e75d644c5b28eee5"),{InventoryConst:n}=e("565ca982f9eea32e");t.exports.InventoryUi=class extends s{createUi(){this.create("inventory",5,!0,!0,null,()=>{this.inventoryVisibility("inventory")}),this.create("equipment",4,!0,!0,null,()=>{this.inventoryVisibility("inventory")})}inventoryVisibility(e){let t="#"+n[e+"_ITEMS"];for(let e of this.gameManager.gameDom.getElements(t+" .item-box .image-container img"))e.style.border="none";for(let e of this.gameManager.gameDom.getElements(t+" .item-data-container"))e.style.border="none"}}},{e75d644c5b28eee5:"eleOh","565ca982f9eea32e":"c7Jl5"}],eleOh:[function(e,t,a,i){let{GameConst:s}=e("116a5afefa53e8ad");t.exports.UiFactory=class{constructor(e){this.uiScene=e,this.gameManager=this.uiScene.gameManager}create(e,t,a,i,n,r){let{uiX:o,uiY:l}=this.uiScene.getUiConfig(e),c=this.uiScene.add.dom(o,l).createFromCache(e),d=c.getChildByProperty("id",e+s.UI_OPEN),h=c.getChildByProperty("id",e+s.UI_CLOSE);d?.addEventListener("click",()=>{let i=c.getChildByProperty("id",e+"-ui");a&&(i&&(i.style.display="block"),d.style.display="none",c.setDepth(t)),n&&"function"==typeof n&&n(),this.gameManager.events.emit("reldens.openUI",{ui:this,openButton:d,dialogBox:c,dialogContainer:i,uiScene:this.uiScene})}),h?.addEventListener("click",()=>{let t=c.getChildByProperty("id",e+"-ui");i&&(t&&(t.style.display="none"),c.setDepth(1),d&&(d.style.display="block")),r&&"function"==typeof r&&r(),this.gameManager.events.emit("reldens.closeUI",{ui:this,closeButton:h,openButton:d,dialogBox:c,dialogContainer:t,uiScene:this.uiScene})}),this.uiScene.elementsUi[e]=c}}},{"116a5afefa53e8ad":"52yv8"}],c7Jl5:[function(e,t,a,i){t.exports.InventoryConst={INVENTORY_ITEMS:"inventory-items",INVENTORY_OPEN:"inventory-open",INVENTORY_CLOSE:"inventory-close",EQUIPMENT_ITEMS:"equipment-items",EQUIPMENT_CLOSE:"equipment-close",EQUIPMENT_OPEN:"equipment-open",ANIMATION_KEY_PREFIX:"aK_",GROUP_BUCKET:"/assets/custom/groups",ACTIONS:{PREFIX:"ivp",REMOVE:"ivpRm",USE:"ivpUse",EQUIP:"ivpEqi",TRADE_START:"ivptStart",TRADE_ACCEPTED:"ivptAccepted",TRADE_SHOW:"ivptShow",TRADE_ACTION:"ivptAction"},MESSAGE:{DATA_VALUES:{NAMESPACE:"items"}}}},{}],ga9uu:[function(e,t,a,i){let{InventoryConst:s}=e("b5d0f9ee9d22fb55"),{GameConst:n}=e("92cdba323e44bcec"),{Receiver:r}=e("cb4e0a55d43d72b7"),{ErrorManager:o,Logger:l,sc:c}=e("c6222908b64bdf56");t.exports.InventoryReceiver=class extends r{constructor(e){c.hasOwn(e,"gameManager")||o.error("InventoryReceiver gameManager not specified."),super(e),this.gameManager=e.gameManager,this.itemSprites={},this.itemsAnimations={}}onExecuting(e){let t=e.item;if(!c.hasOwn(t,"animationData"))return l.warning("Item does not contain animation data.",e),!1;let a=s.ANIMATION_KEY_PREFIX+t.key,i=this.gameManager.getActiveScene();if(this.itemSprites[a]&&this.itemSprites[a].anims&&i.anims.get(a))return l.debug("Animation already exists, playing: "+a),this.playSpriteAnimation(a,t),!1;i.load.spritesheet(a,"/assets/custom/sprites/"+t.key+n.FILES.EXTENSIONS.PNG,{frameWidth:t.animationData.frameWidth||64,frameHeight:t.animationData.frameHeight||64}).on("loaderror",e=>{l.error("Sprite load error: "+a,e)}),i.load.on("complete",()=>{l.debug("Scene load complete, playing: "+a),this.createItemSprites(a,t,e,i)}),i.load.start()}createItemSprites(e,t,a,i){let s=this.extractTargetId(t,a,i);if(!s)return l.error("Target ID not found."),!1;let n=c.get(i.player.players,s,!1);if(!n)return l.error("Player sprite not found by target ID."),!1;let r=i.anims.get(e);r||(l.debug("Creating new animation on scene: "+e),r=i.anims.create({key:e,frames:i.anims.generateFrameNumbers(e,{start:t.animationData.start||0,end:t.animationData.end||1}),frameRate:c.get(t.animationData,"frameRate",i.configuredFrameRate),repeat:t.animationData.repeat||3,hideOnComplete:c.get(t.animationData,"hide",!0),showOnStart:c.get(t.animationData,"showOnStart",!0)})),this.itemsAnimations[e]=r;let o=c.get(t.animationData,"fixedX",t.animationData.usePlayerPosition?n.x:0),d=c.get(t.animationData,"fixedY",t.animationData.usePlayerPosition?n.y:0);this.itemSprites[e]=i.physics.add.sprite(o,d,e),this.itemSprites[e]=this.itemSprites[e].setDepth(9e4),this.itemSprites[e].depthByPlayer="above",t.animationData.followPlayer&&(n.moveSprites[e]=this.itemSprites[e]),l.debug("Playing sprite: "+e),this.playSpriteAnimation(e,t).on("animationcomplete",()=>{t.animationData.destroyOnComplete&&this.destroyAnimation(t,e,n)})}playSpriteAnimation(e,t){c.get(t.animationData,"closeInventoryOnUse",!1)&&this.gameManager.gameDom.getElement("#inventory-close")?.click();let a=this.itemSprites[e].anims;return a?(a.visible=!0,a.play(e,c.get(t.animationData,"ignoreIfPlaying",!0))):(l.error("Sprite animation not found: "+e),!1)}destroyAnimation(e,t,a){this.itemSprites[t].destroy(),delete this.itemSprites[t],delete this.itemsAnimations[t],e.animationData.followPlayer&&delete a.moveSprites[t],l.debug("Animation and sprite destroyed: "+t)}extractTargetId(e,t,a){return e.animationData.startsOnTarget&&t.target?.playerId?t.target.playerId:a.player?.playerId||!1}}},{b5d0f9ee9d22fb55:"c7Jl5","92cdba323e44bcec":"52yv8",cb4e0a55d43d72b7:"@reldens/items-system",c6222908b64bdf56:"@reldens/utils"}],krp4C:[function(e,t,a,i){let{InventoryConst:s}=e("94b3a8b907c2a901"),{GameConst:n}=e("2b9434348d7355dc"),{Logger:r,sc:o}=e("d685cc0c689d4ce3");t.exports.TradeTargetAction=class{showTargetExchangeAction(e,t,a,i){if(n.TYPE_PLAYER!==t.type||e.getCurrentPlayer().playerId===t.id)return!1;let l=e.gameEngine.uiScene;if(!1===o.get(l,"uiTarget",!1))return!1;let c=l.cache.html.get("inventoryTradeStart");if(!c)return r.critical('Template "inventoryTradeStart" not found.'),!1;e.gameDom.appendToElement("#target-container",e.gameEngine.parseTemplate(c,{playerName:i,playerId:t.id}));let d=e.gameDom.getElement(".start-trade-"+t.id+" button");if(!d)return r.critical('Trade start button not found for selector: ".start-trade-'+t.id+' button"'),!1;d.addEventListener("click",()=>{let a={act:s.ACTIONS.TRADE_START,id:t.id};e.activeRoomEvents.send(a)})}}},{"94b3a8b907c2a901":"c7Jl5","2b9434348d7355dc":"52yv8",d685cc0c689d4ce3:"@reldens/utils"}],anIx9:[function(e,t,a,i){let{TradeMessageHandler:s}=e("9a19973476c681d5"),{Logger:n,sc:r}=e("165687940d76d60e");t.exports.TradeMessageListener=class{async executeClientMessageActions(e){let t=r.get(e,"message",!1);if(!t)return n.error("Missing message data on TradeMessageListener.",e),!1;let a=r.get(e,"roomEvents",!1);if(!a)return n.error("Missing RoomEvents on TradeMessageListener.",e),!1;new s({roomEvents:a,message:t}).updateContents()}}},{"9a19973476c681d5":"iytbx","165687940d76d60e":"@reldens/utils"}],iytbx:[function(e,t,a,i){let{ErrorManager:s,Logger:n,sc:r}=e("e30448b763daad71"),{InventoryConst:o}=e("279522b619f4737e"),{ObjectsConst:l}=e("1ad3ff060efe34bd"),{UserInterface:c}=e("df59fbf4a3c1f5fe");t.exports.TradeMessageHandler=class{constructor(e){this.roomEvents=r.get(e,"roomEvents",!1),this.message=r.get(e,"message",!1),this.gameManager=this.roomEvents?.gameManager,this.gameDom=this.gameManager?.gameDom,this.uiScene=this.gameManager?.gameEngine?.uiScene,this.itemsManager=this.gameManager?.inventory?.manager,this.validate()}validate(){this.roomEvents||s.error("Missing RoomEvents."),this.message||s.error("Missing message."),this.gameManager||s.error("Missing GameManager."),this.uiScene||s.error("Missing UiScene."),this.itemsManager||s.error("Missing ItemsManager.")}updateContents(){return o.ACTIONS.TRADE_START===this.message.act?this.showTradeRequest():o.ACTIONS.TRADE_SHOW===this.message.act?this.showTradeBox():void 0}showTradeRequest(){let e="trade"+this.message.id;this.createTradeUi(e),this.roomEvents.initUi({id:e,title:this.gameManager.config.getWithoutLogs("client/trade/titles/tradeRequestFromLabel","Trade request from:"),content:this.message.from,options:this.gameManager.config.get("client/ui/options/acceptOrDecline"),overrideSendOptions:{act:o.ACTIONS.TRADE_ACCEPTED,id:this.message.id}}),this.gameDom.getElement("#opt-2-"+e)?.addEventListener("click",()=>{this.gameDom.getElement("#box-close-"+e)?.click()})}showTradeBox(){let e="trade"+this.message.id;this.createTradeUi(e),this.roomEvents.initUi({id:e,title:this.gameManager.services.translator.t("items.tradeWith",{playerName:this.message.with}),content:"",options:{}});let t=this.gameManager.gameDom.getElement("#box-"+e+" .box-content");if(!t)return n.error('Missing container: "#box-'+e+' .box-content".'),!1;if(!0===this.message.isTradeEnd)return this.gameDom.getElement("#box-close-trade"+this.message.id)?.click(),!0;let a=r.get(this.message,"items",!1),i=r.get(this.message,"traderItemsData",{}),s=r.get(this.message,"exchangeData",{}),o=r.get(this.message,"playerToExchangeKey",{}),l="A"===o?"B":"A";this.updateItemsList(a,t,s[l]),this.updateMyExchangeData(s[l]||{},a,l),this.updateTraderExchangeData(s[o]||{},i,o)}createTradeUi(e){let t=r.get(this.roomEvents.tradeUi,e);return t||(this.roomEvents.tradeUi[e]=new c(this.gameManager,{id:e,type:"trade"},"/assets/html/dialog-box.html","trade"),this.roomEvents.tradeUi[e].createUiElement(this.uiScene,"trade")),t}updateItemsList(e,t,a){if(!e)return;let i="",s={};for(let t of Object.keys(e)){let n=e[t],o=Object.assign({manager:this.itemsManager},n,{uid:t}),l=r.get(this.itemsManager.itemClasses,o.key,this.itemsManager.types.classByTypeId(o.type));s[t]=new l(o),s[t].quantityDisplay=1,s[t].quantityMaxDisplay=Math.max(s[t].qty_limit,n.qty),s[t].tradeAction="trade",i+=this.createTradeItemBox(s[t],r.get(a,s[t].uid,!1))}t.innerHTML=this.createTradeContainer(i),this.activateItemsBoxActions(s),this.activateConfirmButtonAction()}activateConfirmButtonAction(){let e=this.gameManager.gameDom.getElement(".confirm-"+this.message.id);e?.addEventListener("click",()=>{this.gameManager.activeRoomEvents.send({act:o.ACTIONS.TRADE_ACTION,id:this.message.id,value:this.message.id,sub:l.TRADE_ACTIONS.CONFIRM})});let t=this.gameManager.gameDom.getElement(".disconfirm-"+this.message.id);t?.addEventListener("click",()=>{this.gameManager.activeRoomEvents.send({act:o.ACTIONS.TRADE_ACTION,id:this.message.id,value:this.message.id,sub:l.TRADE_ACTIONS.DISCONFIRM})});let a=this.gameManager.gameDom.getElement(".cancel-"+this.message.id);a?.addEventListener("click",()=>{this.gameDom.getElement("#box-close-trade"+this.message.id)?.click()})}updateMyExchangeData(e,t,a){if(0===Object.keys(e).length)return!1;let i=this.createConfirmItemsBox(e,t),s=this.gameDom.getElement(".trade-items-boxes .trade-player-col.trade-col-2");return s?(s.innerHTML=i,this.assignRemoveActions(e,t),!0):(n.error('Missing "'+a+'" items container.'),!1)}updateTraderExchangeData(e,t,a){if(0===Object.keys(e).length)return!1;let i=this.createReceivingItemsBox(e,t),s=this.gameDom.getElement(".trade-items-boxes .trade-player-col.trade-col-3");return s?(s.innerHTML=i,!0):(n.error('Missing "'+a+'" items container.'),!1)}createConfirmItemsBox(e,t){let a=Object.keys(e);if(0===a.length)return n.info("Undefined exchange items on confirmation trade-message-handler.",{message:this.message}),"";let i="",s=this.uiScene.cache.html.get("inventoryTradeItem");if(!s)return n.error('Missing template "inventoryTradeItem".'),"";for(let n of a){let a=e[n],r=t[n];i+=this.gameManager.gameEngine.parseTemplate(s,{key:r.key,label:r.label,description:r.description,id:n,qty:r.qty,hiddenClass:"",tradeAction:this.createTradeActionRemove(r),tradeActionKey:this.message.id,tradeQuantityContent:a})}return i}createReceivingItemsBox(e,t){let a=Object.keys(e);if(0===a.length)return n.info("Undefined exchange items on receive trade-message-handler.",{message:this.message}),"";let i="",s=this.uiScene.cache.html.get("inventoryTradeItem");if(!s)return n.error('Missing template "inventoryTradeItem".'),"";for(let n of a){let a=e[n],r=t[n];i+=this.gameManager.gameEngine.parseTemplate(s,{key:r.key,label:r.label,description:r.description,id:n,qty:r.qty,hiddenClass:"",tradeAction:"",tradeActionKey:this.message.id,tradeQuantityContent:a})}return i}assignRemoveActions(e,t){let a=Object.keys(e);if(0===a.length)return n.info("Undefined exchange items on remove trade-message-handler.",{message:this.message}),!1;for(let e of a){let a=".pushed-to-trade .trade-item-"+e,i=this.gameDom.getElement(a);if(!i){n.error('Assign trade item "'+e+'" container not found.');continue}let s=this.gameDom.getElement(".pushed-to-trade .trade-item-"+e+" .trade-action-remove");if(!s){n.error('Assign trade item "'+e+'" remove button not found.');continue}let r=t[e];s.addEventListener("click",()=>{i.classList.remove("hidden");let t={act:o.ACTIONS.TRADE_ACTION,id:this.message.id,value:"remove",itemId:e,itemKey:r.key};t[l.TRADE_ACTIONS.SUB_ACTION]=l.TRADE_ACTIONS.REMOVE,this.gameManager.activeRoomEvents.send(t)})}return!0}createTradeContainer(e){let t=this.uiScene.cache.html.get("inventoryTradePlayerContainer");if(!t)return n.error('Missing template "inventoryTradeContainer".'),"";let a=l.TRADE_ACTIONS_FUNCTION_NAME,i={tradeActionKey:this.message.id,confirmLabel:this.gameManager.config.getWithoutLogs("client/trade/titles/confirmLabel",a.CONFIRM),disconfirmLabel:this.gameManager.config.getWithoutLogs("client/trade/titles/disconfirmLabel",a.DISCONFIRM),cancelLabel:this.gameManager.config.getWithoutLogs("client/trade/titles/cancelLabel",a.CANCEL),myItems:e,myItemsTitle:this.gameManager.config.getWithoutLogs("client/trade/titles/myItems","My Items:"),pushedToTradeTitle:this.gameManager.config.getWithoutLogs("client/trade/titles/pushedToTradeTitle","Sending:"),gotFromTradeTitle:this.gameManager.config.getWithoutLogs("client/trade/titles/gotFromTradeTitle","Receiving:"),playerConfirmedLabel:this.playerConfirmedLabel()};return this.gameManager.gameEngine.parseTemplate(t,i)}playerConfirmedLabel(){return this.message.playerConfirmed?this.gameManager.config.getWithoutLogs("client/trade/titles/playerConfirmedLabel","%playerName CONFIRMED").replace("%playerName",this.message.with):""}createTradeItemBox(e,t){let a=this.uiScene.cache.html.get("inventoryTradeItem");if(!a)return n.error('Missing template "inventoryTradeItem".'),"";let i=this.uiScene.cache.html.get("inventoryTradeItemQuantity");if(!i)return n.error('Missing template "inventoryTradeItemQuantity".'),"";let s=t||0;return this.gameManager.gameEngine.parseTemplate(a,{key:e.key,label:e.label,description:e.description,id:e.getInventoryId(),qty:e.qty,hiddenClass:0<s&&e.qty===s?" hidden":"",tradeAction:this.createTradeActionContent(e),tradeActionKey:"to-be-"+e.tradeAction,tradeQuantityContent:this.gameManager.gameEngine.parseTemplate(i,{quantityDisplay:e.quantityDisplay||1,quantityMaxDisplay:0<e.quantityMaxDisplay?'max="'+e.quantityMaxDisplay+'"':""})})}createTradeActionContent(e,t){let a=this.uiScene.cache.html.get("inventoryTradeAction");return a?this.gameManager.gameEngine.parseTemplate(a,{key:e.key,id:e.getInventoryId(),tradeAction:t||r.get(e,"tradeAction","")}):(n.error('Missing template "inventoryTradeAction".'),"")}createTradeActionRemove(e){let t=this.uiScene.cache.html.get("inventoryTradeActionRemove");return t?this.gameManager.gameEngine.parseTemplate(t,{key:e.key,id:e.uid,tradeAction:"remove"}):(n.error('Missing template "inventoryTradeActionRemove".'),"")}activateItemsBoxActions(e){for(let t of Object.keys(e)){let a=e[t],i=".trade-item-to-be-"+a.tradeAction+".trade-item-"+a.uid+" .trade-action-"+a.tradeAction+" button",s=this.gameDom.getElement(i);if(!s){n.error('Activate trade item "'+a.uid+'" action button not found.');continue}s.addEventListener("click",()=>{let e=this.gameDom.getElement(".trade-item-"+a.getInventoryId()+" .item-qty input"),t=e?.value||1,i={act:o.ACTIONS.TRADE_ACTION,id:this.message.id,value:a.tradeAction,itemId:a.getInventoryId(),itemKey:a.key,qty:Number(t)};i[l.TRADE_ACTIONS.SUB_ACTION]=l.TRADE_ACTIONS.ADD,this.gameManager.activeRoomEvents.send(i)})}}}},{e30448b763daad71:"@reldens/utils","279522b619f4737e":"c7Jl5","1ad3ff060efe34bd":"fEftg",df59fbf4a3c1f5fe:"e9cEC"}],kPfeK:[function(e,t,a,i){t.exports.TemplatesHandler=class{static preloadTemplates(e){let t="/assets/features/inventory/templates/";e.load.html("inventory",t+"ui-inventory.html"),e.load.html("equipment",t+"ui-equipment.html"),e.load.html("inventoryItem",t+"item.html"),e.load.html("inventoryItemUse",t+"usable.html"),e.load.html("inventoryItemEquip",t+"equip.html"),e.load.html("inventoryGroup",t+"group.html"),e.load.html("inventoryTradeContainer",t+"trade-container.html"),e.load.html("inventoryTradePlayerContainer",t+"trade-player-container.html"),e.load.html("inventoryTradeRequirements",t+"trade-requirements.html"),e.load.html("inventoryTradeRewards",t+"trade-rewards.html"),e.load.html("inventoryTradeAction",t+"trade-action.html"),e.load.html("inventoryTradeActionRemove",t+"trade-action-remove.html"),e.load.html("inventoryTradeItem",t+"trade-item.html"),e.load.html("inventoryTradeItemQuantity",t+"trade-item-quantity.html"),e.load.html("inventoryTradeStart",t+"trade-start.html"),e.load.html("inventoryTradeAccept",t+"trade-accept.html")}}},{}],jDY6s:[function(e,t,a,i){t.exports={items:{undefinedItem:"Add item error, undefined item.",undefinedMethodInventoryId:"Add item error, undefined getInventoryId.",undefinedItemKey:"Add item error, undefined item key.",invalidItemInstance:"Invalid item instance.",lockedForAddItem:"Inventory locked, cannot add item: %itemUid",maxTotalReachedForAddItem:"Cannot add item, max total reached.",itemExistsForAddItem:"Cannot add item, item already exists: %itemUid",itemLimitExceededForAddItem:"Cannot add item, item qty limit exceeded.",addItemsError:'Cannot add item "%itemUid".',lockedForSetItem:"Inventory locked, cannot set item: %itemUid.",lockedForRemoveItem:"Inventory locked, cannot remove item: %itemUid.",keyNotFound:"Cannot remove item, key not found: %itemUid.",lockedForModifyItemQty:"Inventory locked, cannot modify item qty: %itemUid.",undefinedItemKeyForOperation:'Cannot "%operation" item qty, undefined item key: %itemUid.',qtyNotANumber:'Cannot "%operation" item qty, quantity is not a number: %qty.',itemQtyLimitExceeded:'Cannot "%operation" item qty, item qty limit exceeded: %qty > %limitPerItem.',lockedForSetItems:"Inventory locked, cannot set items.",tradeWith:"Trading with %playerName",exchange:{missingConfirmation:"Missing confirmation.",invalidPushedQuantity:"Invalid item pushed quantity (%qty), available: %pushedItemQty.",invalidQuantity:"Invalid item quantity 0.",invalidExchange:'Inventories "FROM" and "TO" are the same, exchange cancelled.',decreaseQuantity:"Exchange inventory decrease error.",itemAdd:"Exchange add inventory result error."},requirements:{itemNotPresent:'Required item "%requiredItemKey" is not present.',quantityNotAvailable:'Required item "%requiredItemKey" quantity %totalRequiredQuantity is not available.',itemNotPushed:'Required item "%requiredItemKey" was not pushed for exchange.',itemQuantityNotPushed:'Required item "%requiredItemKey" quantity %totalRequiredQuantity was not pushed for exchange.',itemDoesNotExists:'Requirement error, item "%itemUid" does not exits on inventory.',itemAdd:"Requirement add item error."},reward:{doesNotExists:'Reward error, item "%itemUid" does not exits.',missingItem:'Reward error, item "%itemUid" does not exits.',itemNotPresent:'Reward item "%rewardItemKey" is not present on inventory.',quantityNotAvailable:"Reward item %rewardItemKey reward quantity (%rewardQuantity) is not available.",missingPushed:'Missing pushed for exchange item "%itemUid".',getItemDoesNotExists:'Reward error, item "%itemUid" does not exits on inventory.',processItem:'Process item reward error, item "%itemUid".',processInventory:"Rewards process inventory error.",addItems:"Rewards error on add items: %itemsKeys.",quantityOverload:"Reward quantity (%rewardQuantityTotal) is bigger than the available in the inventory (%rewardInventoryItemQty)."},equipment:{modifiersApply:"Cannot apply modifiers the item is not equipped: %itemUid",modifiersRevert:"Cannot revert modifiers the item is not equipped: %itemUid"}}}},{}],"6QQl7":[function(e,t,a,i){let{SkillsUi:s}=e("36d50050599013b8"),{PluginInterface:n}=e("7c05585b97e53470"),{PlayerSelector:r}=e("77b2515903041d20"),{PreloaderHandler:o}=e("5394030c13db68d9"),{MessagesHandler:l}=e("f5d67620a3caae3e"),{GameManagerEnricher:c}=e("303da725ced69b17"),d=e("8b6b513ca32c8a19"),{TranslationsMapper:h}=e("e0c06d6627a6aa25"),{ActionsConst:m}=e("d6df1efa87716f53"),{Logger:g,sc:u}=e("a4340d9acbcb2d0");t.exports.ActionsPlugin=class extends n{setup(e){this.gameManager=u.get(e,"gameManager",!1),this.gameManager||g.error("Game Manager undefined in ActionsPlugin."),this.events=u.get(e,"events",!1),this.events||g.error("EventsManager undefined in ActionsPlugin."),this.playerSelector=new r(e),this.preloaderHandler=new o(e),this.setTranslations(),this.listenEvents()}setTranslations(){if(!this.gameManager)return!1;h.forConfig(this.gameManager.config.client,d,m.MESSAGE.DATA_VALUES)}listenEvents(){if(!this.events||!this.gameManager)return!1;this.events.on("reldens.preloadUiScene",e=>{this.preloaderHandler.loadContents(e)}),this.events.on("reldens.createPreload",e=>{this.preloaderHandler.createAnimations(e)}),this.events.on("reldens.createUiScene",e=>{this.uiManager=new s(e),this.uiManager.createUi()}),this.events.on("reldens.beforeCreateEngine",e=>{this.playerSelector.populateClassesSelector(u.get(e,"classesData",{}),e.gameConfig.client.players,e.player)}),this.events.on("reldens.activateRoom",e=>{e.onMessage("*",e=>{l.processOrQueueMessage(e,this.gameManager)})}),this.events.on("reldens.playersOnAddReady",e=>{c.withReceiver(e.player,e.roomEvents,this.gameManager)})}}},{"36d50050599013b8":"g8kZP","7c05585b97e53470":"bYb3U","77b2515903041d20":"gBlsc","5394030c13db68d9":"cEgkU",f5d67620a3caae3e:"1izqY","303da725ced69b17":"8auOw","8b6b513ca32c8a19":"jY3FY",e0c06d6627a6aa25:"bJxKc",d6df1efa87716f53:"hmzhe",a4340d9acbcb2d0:"@reldens/utils"}],g8kZP:[function(e,t,a,i){let{ActionsConst:s}=e("a90f454084440f9d");t.exports.SkillsUi=class{constructor(e){this.uiScene=e,this.gameManager=this.uiScene.gameManager,this.defaultAction=this.gameManager.config.get("client/ui/controls/defaultActionKey")}createUi(){let e=s.SELECTORS.UI_PLAYER_EXTRAS;this.appendToUiContainer(e,"skillsClassPath"),this.appendToUiContainer(e,"skillsLevel"),this.appendToUiContainer(e,"skillsExperience",{experienceLabel:this.gameManager.services.translator.t(s.SNIPPETS.EXPERIENCE_LABEL)}),this.createUiBox("skills",7)}appendSkills(e){let t=Object.keys(e);if(0===t.length)return!1;for(let a of t){let t=e[a];t!==this.defaultAction&&this.createSkillBox(t)}}appendToUiContainer(e,t,a={}){let i=this.uiScene.cache.html.get(t);0<Object.keys(a).length&&(i=this.gameManager.gameEngine.parseTemplate(i,a)),this.gameManager.gameDom.appendToElement(e,i)}createUiBox(e,t){let{uiX:a,uiY:i}=this.uiScene.getUiConfig(e),s=this.uiScene.add.dom(a,i).createFromCache(e);s.setDepth(t),this.uiScene.elementsUi[e]=s}createSkillBox(e){let t=this.parseSkillTemplate(e);this.gameManager.gameDom.appendToElement(s.SELECTORS.SKILLS_CONTAINER,t),this.uiScene.setupActionButtonInBox(e,this.uiScene.getUiElement("skills"))}parseSkillTemplate(e){let t=this.uiScene.cache.html.get("skillBox");return this.gameManager.gameEngine.parseTemplate(t,{key:e,skillName:e})}}},{a90f454084440f9d:"hmzhe"}],gBlsc:[function(e,t,a,i){let{ActionsConst:s}=e("cc17d7a08bdc628f"),{GameConst:n}=e("d589586cb2588d99"),{Logger:r,sc:o}=e("3d92707723ab4002");t.exports.PlayerSelector=class{constructor(e){this.gameManager=o.get(e,"gameManager",!1),this.gameManager||r.error("Game Manager undefined in ActionsPlugin PlayerSelector."),this.events=o.get(e,"events",!1),this.events||r.error("EventsManager undefined in ActionsPlugin PlayerSelector."),this.gameDom=this.gameManager.gameDom}populateClassesSelector(e,t,a){if(!o.isObject(e)||0===Object.keys(e).length)return r.error("Classes not defined, can not populate the classes selector."),this.gameDom.getElement(".player-selection-form-errors")?.append(this.gameManager.services?.translator.t("game.errors.missingClasses")),!1;let i=o.get(t,"multiplePlayers",!1);if((!i||!i.enabled)&&a)return!1;let n=this.gameDom.getElement(s.SELECTORS.PLAYER_CREATION_ADDITIONAL_INFO);if(!n)return!1;this.gameDom.getElement(s.SELECTORS.PLAYER_CREATE_FORM)?.classList.remove("hidden");let l=this.gameDom.createElement("div");l.id="class-path-selector-box",l.classList.add("input-box");let c=this.gameDom.createElement("label"),d="class-path-select";c.htmlFor=d,c.innerText=this.gameManager.services.translator.t(s.SNIPPETS.SELECT_CLASS_PATH);let h=this.gameDom.createElement("select");for(let t of(h.id=d,h.name="class_path_select",Object.keys(e))){let a=new Option(e[t].label,t);a.dataset.key=e[t].key,h.append(a)}if(l.append(c),l.append(h),this.gameManager.config.getWithoutLogs("client/players/multiplePlayers/showAvatar",!0)){let e=this.gameDom.createElement("div");e.className="avatar-container",this.appendAvatarOnSelector(h,e,t),l.append(e)}n.append(l)}appendAvatarOnSelector(e,t,a){let i=this.gameDom.createElement("div"),s=e.options[e.selectedIndex].dataset.key;i.classList.add("class-path-select-avatar"),i.style.backgroundImage=`url('/assets/custom/sprites/${s}${n.FILES.EXTENSIONS.PNG}')`;let r=a.size.width+"px";i.style.backgroundPositionX="-"+r,i.style.width=r,i.style.height=a.size.height+"px",e.addEventListener("change",()=>{let t=e.options[e.selectedIndex].dataset.key;i.style.backgroundImage=`url('/assets/custom/sprites/${t}${n.FILES.EXTENSIONS.PNG}')`}),t.append(i)}}},{cc17d7a08bdc628f:"hmzhe",d589586cb2588d99:"52yv8","3d92707723ab4002":"@reldens/utils"}],cEgkU:[function(e,t,a,i){let{Logger:s,sc:n}=e("17d913472ef18f64"),{GameConst:r}=e("3e50345fa8140484");t.exports.PreloaderHandler=class{constructor(e){this.gameManager=n.get(e,"gameManager",!1),this.gameManager||s.error("Game Manager undefined in ActionsPlugin PreloaderHandler."),this.events=n.get(e,"events",!1),this.events||s.error("EventsManager undefined in ActionsPlugin PreloaderHandler."),this.setProperties(e)}setProperties(e){if(!this.gameManager)return!1;this.gameDom=this.gameManager.gameDom,this.initialGameData=this.gameManager.initialGameData,this.levelsAnimConfig=this.gameManager.config.get("client/levels/animations"),this.skillsAnimConfig=this.gameManager.config.get("client/skills/animations"),this.assetsCustomActionsSpritesPath=n.get(e,"assetsCustomActionsSpritesPath","assets/custom/actions/sprites/"),this.gameManager.loadedAssets||(this.gameManager.loadedAssets={}),this.gameManager.createdAnimations||(this.gameManager.createdAnimations={})}loadContents(e){e.load.html("skillsClassPath","/assets/features/skills/templates/ui-class-path.html"),e.load.html("skillsLevel","/assets/features/skills/templates/ui-level.html"),e.load.html("skillsExperience","/assets/features/skills/templates/ui-experience.html"),e.load.html("skills","/assets/features/skills/templates/ui-skills.html"),e.load.html("skillBox","/assets/features/skills/templates/ui-skill-box.html"),e.load.html("actionBox","/assets/html/ui-action-box.html"),this.preloadClassPaths(e),this.loopAnimationsAnd(this.levelsAnimConfig,"preload",e),this.loopAnimationsAnd(this.skillsAnimConfig,"preload",e)}preloadClassPaths(e){let t=n.get(this.initialGameData,"classesData",!1);if(!t)return!1;for(let a of Object.keys(t)){let i=t[a].key;e.load.spritesheet(i,"/assets/custom/sprites/"+i+r.FILES.EXTENSIONS.PNG,e.playerSpriteSize).on("filecomplete",async e=>{this.gameManager.loadedAssets[e]=e})}}createAnimations(e){let t=this.levelsAnimConfig;this.loopAnimationsAnd(t,"create",e);let a=this.skillsAnimConfig;this.loopAnimationsAnd(a,"create",e),this.createAvatarsAnimations(e)}createAvatarsAnimations(e){let t=n.get(this.initialGameData,"classesData",!1);if(!t)return s.debug("Classes data not found. Fallback to player avatar."),!1;for(let a of(this.gameManager.mappedAvatars||(this.gameManager.mappedAvatars={}),s.debug({availableClassesData:t}),Object.keys(t))){let i=t[a].key;this.gameManager.loadedAssets[i]||(i=r.IMAGE_PLAYER,s.info('Avatar for class path "'+i+'" not found in assets. Fallback to player avatar.')),this.gameManager.mappedAvatars[i]=i,e.createPlayerAnimations(i)}return this.gameManager.mappedAvatars}loopAnimationsAnd(e,t,a){if(!e)return s.warning("Animations not found.",e),!1;for(let i of Object.keys(e)){let n=e[i];if(!n.animationData.enabled){s.debug('Animation "'+i+'" not enabled, skipping.',n);continue}s.debug({[t+"Animation"]:n}),this[t+"Animation"](n,a)}}preloadAnimation(e,t){n.hasOwn(e.animationData,["type","img"])&&r.ANIMATIONS_TYPE.SPRITESHEET===e.animationData.type&&this.preloadAnimationsInDirections(e,t),e.classKey&&n.isFunction(e.classKey.prepareAnimation)&&e.classKey.prepareAnimation({data:e,uiScene:t,pack:this})}preloadAnimationsInDirections(e,t){let a=n.get(e.animationData,"dir",0);0===a?t.load.spritesheet(this.getAnimationKey(e),this.assetsCustomActionsSpritesPath+e.animationData.img+r.FILES.EXTENSIONS.PNG,e.animationData):((1===a||2===a)&&(this.preloadSpriteInDirection(t,e,r.UP),this.preloadSpriteInDirection(t,e,r.DOWN)),(1===a||3===a)&&(this.preloadSpriteInDirection(t,e,r.LEFT),this.preloadSpriteInDirection(t,e,r.RIGHT)))}preloadSpriteInDirection(e,t,a){e.load.spritesheet(this.getAnimationKey(t,a),this.assetsCustomActionsSpritesPath+t.animationData.img+"_"+a+r.FILES.EXTENSIONS.PNG,t.animationData)}createAnimation(e,t){if(n.hasOwn(e.animationData,["type","img"])&&e.animationData.type===r.ANIMATIONS_TYPE.SPRITESHEET){let a=n.get(e.animationData,"dir",0);0<a?this.createWithMultipleDirections(t,e,a):this.createWithDirection(e,t)}e.classKey&&n.isFunction(e.classKey.createAnimation)&&e.classKey.createAnimation({data:e,uiScene:t,pack:this})}createWithMultipleDirections(e,t,a){e.directionalAnimations[this.getAnimationKey(t)]=t.animationData.dir,(1===a||2===a)&&(this.createWithDirection(t,e,r.UP),this.createWithDirection(t,e,r.DOWN)),(1===a||3===a)&&(this.createWithDirection(t,e,r.LEFT),this.createWithDirection(t,e,r.RIGHT))}createWithDirection(e,t,a=""){let i=this.prepareAnimationData(e,t,a);if(this.gameManager.createdAnimations[i.key])return this.gameManager.createdAnimations[i.key];let s=t.anims.create(i);return n.hasOwn(e.animationData,"destroyTime")&&(s.destroyTime=e.animationData.destroyTime),n.hasOwn(e.animationData,"depthByPlayer")&&(s.depthByPlayer=e.animationData.depthByPlayer),this.gameManager.createdAnimations[i.key]=s,this.gameManager.createdAnimations[i.key]}prepareAnimationData(e,t,a=""){let i=this.getAnimationKey(e,a),s={key:i,frames:t.anims.generateFrameNumbers(i,e.animationData),hideOnComplete:n.get(e.animationData,"hide",!0)};return n.hasOwn(e.animationData,"duration")?s.duration=e.animationData.duration:s.frameRate=n.get(e.animationData,"frameRate",t.configuredFrameRate),n.hasOwn(e.animationData,"repeat")&&(s.repeat=e.animationData.repeat),s}getAnimationKey(e,t=""){return(e.skillKey?e.skillKey+"_":"")+e.key+(t&&""!==t?"_"+t:"")}}},{"17d913472ef18f64":"@reldens/utils","3e50345fa8140484":"52yv8"}],"1izqY":[function(e,t,a,i){let{MessagesGuard:s}=e("dffe4300e109c38f"),{sc:n}=e("60595e113fc95e4a");t.exports.MessagesHandler=class{static processOrQueueMessage(e,t){if(!s.validate(e))return!1;let a=t.getActiveScene();if(a&&a.player)return t.skills.processMessage(e);n.hasOwn(t,"skillsQueue")||(t.skillsQueue=[]),t.skillsQueue.push(e)}}},{dffe4300e109c38f:"8Uupm","60595e113fc95e4a":"@reldens/utils"}],"8Uupm":[function(e,t,a,i){let{SkillConst:s}=e("16821f133ca8a161"),{ActionsConst:n}=e("41296dc01aea30bf");t.exports.MessagesGuard=class{static validate(e){return!!e.act&&(0===e.act.indexOf(s.ACTIONS_PREF)||-1!==e.act.indexOf(n.ACTIONS.SUFFIX.ATTACK)||-1!==e.act.indexOf(n.ACTIONS.SUFFIX.EFFECT)||-1!==e.act.indexOf(n.ACTIONS.SUFFIX.HIT))}}},{"16821f133ca8a161":"@reldens/skills","41296dc01aea30bf":"hmzhe"}],"8auOw":[function(e,t,a,i){let{ReceiverWrapper:s}=e("ef6a621c01cb83eb"),{Logger:n}=e("98a4859089d226b3");t.exports.GameManagerEnricher=class{static withReceiver(e,t,a){if(!e||!t||!a)return n.error("Invalid input parameters for GameManagerEnricher.withReceiver method."),!1;if(e?.playerId!==t?.room.sessionId||(a.skills||(a.skills=new s({owner:e,roomEvents:t,events:a.events})),!a.skillsQueue?.length))return!1;for(let e of a.skillsQueue)a.skills.processMessage(e);a.skillsQueue=[]}}},{ef6a621c01cb83eb:"4jS6N","98a4859089d226b3":"@reldens/utils"}],"4jS6N":[function(e,t,a,i){let{Receiver:s}=e("85b5f6fb1bc36f5a"),{Logger:n,sc:r}=e("4dcc11df2027f27a"),{GameConst:o}=e("f827a112a3b038fa"),{ActionsConst:l}=e("158b7279cb7b4e52");t.exports.ReceiverWrapper=class extends s{constructor(e){super(e),this.events=r.get(e,"events",!1),this.events||n.error("EventsManager undefined in ReceiverWrapper."),this.gameManager=r.get(e.roomEvents,"gameManager",!1),this.gameManager||n.error("Game Manager undefined in ReceiverWrapper."),this.room=r.get(e.roomEvents,"room",!1),this.room||n.error("Room undefined in ReceiverWrapper."),this.translator=this.gameManager?.services?.translator}processMessage(e){if(!this.gameManager)return!1;let t=this.gameManager.getActiveScene();if(!t||!t.player)return!1;super.processMessage(e),this.playAttackOrEffectAnimation(e,t),this.playHitAnimation(e,t)}playHitAnimation(e,t){-1!==e.act.indexOf("_hit")&&this.runHitAnimation(e.x,e.y,t,e.act)}playAttackOrEffectAnimation(e,t){let a=-1!==e.act.indexOf("_eff");if(-1===e.act.indexOf("_atk")&&!a)return;this.events.emitSync("reldens.playerAttack",e,this.room);let i=a?"_eff":"_atk",s=e.act.substring(0,e.act.indexOf(i)),{ownerSprite:n,targetSprite:o,targetType:l}=this.extractOwnerTargetAndType(t,e),c=r.get(this.gameManager.config.client.skills.animations,s,"default"+i);if(n&&t.getAnimationByKey(c)){let e=t.physics.add.sprite(n.x,n.y,c);e.setDepth(2e5);let a="";r.hasOwn(this.gameManager.gameEngine.uiScene.directionalAnimations,c)&&(a=3===this.gameManager.gameEngine.uiScene.directionalAnimations[c]?n.x<o.x?"_right":"_left":n.y<o.y?"_down":"_up"),e.anims.play(c+a,!0).on("animationcomplete",()=>{e.destroy()})}o&&this.runHitAnimation(o.x,o.y,t,s+"_hit",e.target,l)}extractOwnerTargetAndType(e,t){if(!e)return n.critical("Current scene not found.",e,t),!1;let a=!1,i=!1,s=l.DATA_TYPE_VALUE_PLAYER,o=e.player.players,c=e.objectsAnimations;return r.hasOwn(o,t.owner)&&r.hasOwn(o,t.target)?{ownerSprite:a=o[t.owner],targetSprite:i=o[t.target],targetType:s}:(r.hasOwn(c,t.owner)&&(a=c[t.owner].sceneSprite,i=o[t.target]),r.hasOwn(c,t.target)&&(i=c[t.target].sceneSprite,a=o[t.owner],s=l.DATA_TYPE_VALUE_OBJECT),{ownerSprite:a,targetSprite:i,targetType:s})}runHitAnimation(e,t,a,i,s,n){let o=this.gameManager.config.client.skills.animations,c=r.hasOwn(o,i)?i:l.DEFAULT_HIT_ANIMATION_KEY;if(!a.getAnimationByKey(c)||!r.hasOwn(o,c))return!1;let d=!1,h=!1;n===l.DATA_TYPE_VALUE_PLAYER&&(h=(d=this.gameManager.getCurrentPlayer().players[s]).playerId),n===l.DATA_TYPE_VALUE_OBJECT&&(d=a.objectsAnimations[s],h=s);let m=a.physics.add.sprite(e,t,c);(m=this.setTargetSpriteDepth(d,c,h,m,o)).anims.play(c,!0).on("animationcomplete",()=>{m.destroy(),d&&r.hasOwn(d,"moveSprites")&&delete d.moveSprites[c+"_"+h]})}setTargetSpriteDepth(e,t,a,i,s){if(!e)return i.setDepth(3e5),i;r.hasOwn(e,"targetSprite")&&(e.moveSprites[t+"_"+a]=i);let n=s[t],o=e.depth+("above"===r.get(n.animationData,"depthByPlayer","")?100:-.1);return i.depthByPlayer=n.animationData.depthByPlayer,i.setDepth(o),i}updateLevelAndExperience(e){this.gameManager.gameDom.updateContent(l.SELECTORS.LEVEL_LABEL,this.translator.t(l.SNIPPETS.LEVEL,{currentLevel:e.data[l.MESSAGE.DATA.LEVEL]})),this.onLevelExperienceAdded(e);let t=e.data[l.MESSAGE.DATA.CLASS_PATH_LABEL];t&&this.gameManager.gameDom.updateContent(l.SELECTORS.CLASS_PATH_LABEL,this.translator.t(l.SNIPPETS.CLASS_PATH_LABEL,{classPathLabel:t}));let a=e.data[l.MESSAGE.DATA.NEXT_LEVEL_EXPERIENCE];a&&this.gameManager.gameDom.updateContent(l.SELECTORS.NEXT_LEVEL_EXPERIENCE,this.translator.t(l.SNIPPETS.NEXT_LEVEL_EXPERIENCE,{nextLevelExperience:a}))}onInitClassPathEnd(e){if(this.gameManager.skills&&this.gameManager.skills.uiCreated)return!1;this.gameManager.skills.uiCreated=!0,this.updateLevelAndExperience(e),this.gameManager.skills.skills=e.data[l.MESSAGE.DATA.SKILL_LEVEL],this.gameManager.getFeature("actions").uiManager.appendSkills(e.data.skl)}onLevelUp(e){this.updateLevelAndExperience(e),r.hasOwn(e.data,"skl")&&(Object.assign(this.gameManager.skills.skills,e.data.skl),this.gameManager.getFeature("actions").uiManager.appendSkills(e.data.skl));let t=this.getLevelUpAnimationKey(e.data.skl);t&&this.playSkillPlayerAnimation(this.gameManager.getCurrentPlayer().playerId,t)}getLevelUpAnimationKey(e){let t=this.gameManager.config.client.levels.animations,a="level_"+this.gameManager.playerData.avatarKey+"_"+e;if(r.hasOwn(t,a))return a;let i="level_"+this.gameManager.playerData.avatarKey;if(r.hasOwn(t,i))return i;let s="level_"+e;return r.hasOwn(t,s)?s:!!r.hasOwn(t,"level_default")&&"level_default"}onLevelExperienceAdded(e){this.gameManager.gameDom.updateContent(l.SELECTORS.CURRENT_EXPERIENCE,this.translator.t(l.SNIPPETS.EXPERIENCE,{experience:e.data[l.MESSAGE.DATA.EXPERIENCE]}))}onSkillBeforeCast(e){this.playSkillPlayerAnimation(e.data.extraData[l.DATA_OWNER_KEY],this.determineCastKey(e))}determineCastKey(e){let t=e.data.skillKey+"_cast";return r.hasOwn(this.gameManager.config.client.skills.animations,t)?t:"default_cast"}playSkillPlayerAnimation(e,t){let a=this.gameManager.getActiveScene(),i=a.getAnimationByKey(t);if(!i)return -1===t.indexOf("default")&&n.error('Animation sprite not found for "'+t+'".',this.gameManager.config.client.skills.animations),!1;let s=this.gameManager.getCurrentPlayer().players[e],o=s.x,l=s.y,c=a.physics.add.sprite(o,l,t),d=r.hasOwn(i,"depthByPlayer")&&"above"===i.depthByPlayer?s.depth+1:s.depth-.1;c.depthByPlayer=i.depthByPlayer,c.setDepth(d),r.get(i,"blockMovement",!1)||(s.moveSprites[t+"_"+s.playerId]=c),c.anims.play(t,!0);let h=r.get(i,"destroyTime",!1);h&&setTimeout(()=>{c.destroy(),delete s.moveSprites[t+"_"+s.playerId]},h)}onSkillAfterCast(e){let t=this.gameManager.getCurrentPlayer();if(!r.hasOwn(e.data.extraData,l.DATA_OWNER_TYPE)||!r.hasOwn(e.data.extraData,l.DATA_OWNER_KEY)||e.data.extraData[l.DATA_OWNER_TYPE]!==l.DATA_TYPE_VALUE_PLAYER||!r.hasOwn(t.players,e.data.extraData[l.DATA_OWNER_KEY]))return!1;let a=this.gameManager.getActiveScene(),i=this.gameManager.getCurrentPlayer().players[e.data.extraData[l.DATA_OWNER_KEY]],s=this.getPlayDirection(e.data.extraData,i,t,a);s&&(i.anims.play(i.avatarKey+"_"+s,!0),i.anims.stop())}onSkillAttackApplyDamage(e){let t=this.gameManager.config.get("client/actions/damage");if(!t.enabled)return!1;let a=this.gameManager.getCurrentPlayer();if(!t.showAll&&e.data.extraData[l.DATA_OWNER_KEY]!==a.playerId)return!1;let i=this.gameManager.getActiveScene(),s=i.getObjectFromExtraData(l.DATA_OBJECT_KEY_TARGET,e.data.extraData,a);if(!s)return!1;i.createFloatingText(s.x,s.y,e.data.d,t.color,t.font,t.fontSize,t.duration,t.top,t.stroke,t.strokeThickness,t.shadowColor)}getPlayDirection(e,t,a,i){let s=!1,n=i.getObjectFromExtraData(l.DATA_OBJECT_KEY_TARGET,e,a);if(!n)return!1;let r=n.x-t.x,c=n.y-t.y;return s=r>=0?o.RIGHT:o.LEFT,Math.abs(r)<Math.abs(c)&&(s=c>=0?o.DOWN:o.UP),s}}},{"85b5f6fb1bc36f5a":"@reldens/skills","4dcc11df2027f27a":"@reldens/utils",f827a112a3b038fa:"52yv8","158b7279cb7b4e52":"hmzhe"}],jY3FY:[function(e,t,a,i){t.exports={actions:{selectClassPath:"Select Your Class-Path",currentLevel:"Level %currentLevel",experience:"%experience",experienceLabel:"XP",classPathLabel:"%classPathLabel",nextLevelExperience:"%nextLevelExperience"}}},{}],jNGNC:[function(e,t,a,i){let{LifebarUi:s}=e("4884f11b075b66ea"),{PlayerStatsUi:n}=e("3f79c9046c35f178"),{ActionsConst:r}=e("674e49489e51556c"),{GameConst:o}=e("a2e74f825a350c56"),l=e("13407cdee0cc1fb5"),{TranslationsMapper:c}=e("8132da4e97588b49"),{UsersConst:d}=e("b40b9d44591fbc8d"),{PluginInterface:h}=e("9762c449204f05e7"),{Logger:m,sc:g}=e("b18ec97bd329135d");t.exports.UsersPlugin=class extends h{setup(e){this.gameManager=g.get(e,"gameManager",!1),this.events=g.get(e,"events",!1),this.initialGameData={},this.validateProperties()&&(this.setTranslations(),this.listenEvents(),this.setupPlayerStatsUi())}validateProperties(){return this.gameManager?!!this.events||(m.error("EventsManager undefined in UsersPlugin."),!1):(m.error("Game Manager undefined in UsersPlugin."),!1)}setupPlayerStatsUi(){this.playerStatsUi=new n({events:this.events}),this.playerStatsUi.createPlayerStatsUi()}listenEvents(){this.events.on("reldens.beforeCreateEngine",(e,t)=>{this.initialGameData=e,this.onBeforeCreateEngine(e,t),this.lifeBarUi||(this.lifeBarUi=new s({events:this.events}),this.lifeBarUi.createLifeBarUi(t))})}setTranslations(){if(!this.events||!this.gameManager)return!1;c.forConfig(this.gameManager.config.client,l,d.MESSAGE.DATA_VALUES)}onBeforeCreateEngine(e,t){let a=t.config.get("client/players/multiplePlayers/enabled",!1),i=t.config.get("client/rooms/selection/allowOnLogin",!1),s=g.isTrue(e,"players")?Object.keys(e.players).length:0;if(0<s&&!a&&!i){e.player=e.players[0];return}t.canInitEngine=!1;let n=t.gameDom.getElement(o.SELECTORS.PLAYER_SELECTION);(n.classList.remove("hidden"),a||1!==s)?(a&&0<s&&this.preparePlayerSelector(n,e,t),this.preparePlayerCreator(n,e,t)):this.prepareSinglePlayerInput(n,e,t)}prepareSinglePlayerInput(e,t,a){let i=a.gameDom.getElement(o.SELECTORS.PLAYER_SELECTION_FORM),s=t.player;if(!i||!s)return m.error("Form or player not defined in prepareSinglePlayerInput."),!1;a.gameDom.getElement(o.SELECTORS.PLAYER_SELECT_ELEMENT)?.remove();let n=this.gameManager.services.translator.t(d.SNIPPETS.OPTION_LABEL,{playerName:s.name,currentLevel:s.currentLevel,classPathLabel:s.currentClassPathLabel}),r=a.gameDom.createElement("input");r.type="hidden",r.id=o.SELECTORS.PLAYER_SELECT_ELEMENT,r.value=s.id;let l=a.gameDom.createElement("div");l.innerText=n,i.append(r);let c=a.gameDom.getElement(".player-select-box");c?.append(l),i.addEventListener("submit",t=>(t.preventDefault(),e.classList.add("hidden"),this.submitSelectedPlayer(a,i,r,s),!1)),this.showAvatarContainer(a,t,r),i.classList.remove("hidden")}submitSelectedPlayer(e,t,a,i){e.events.emitSync("reldens.onPrepareSinglePlayerSelectorFormSubmit",{usersPlugin:this,form:t,selectElement:a,player:i,gameManager:e}),e.initEngine().catch(e=>{m.error(e)})}showAvatarContainer(e,t,a){let i=e.gameDom.getElement(o.SELECTORS.PLAYER_SELECTION_ADDITIONAL_INFO);if(!i||!this.gameManager.config.getWithoutLogs("client/players/multiplePlayers/showAvatar",!0))return;let s=e.gameDom.createElement("div");s.className="avatar-container";let n=e.gameDom.createElement("div"),r=t.player.avatarKey;n.classList.add("class-path-select-avatar"),n.style.backgroundImage=`url('/assets/custom/sprites/${r}${o.FILES.EXTENSIONS.PNG}')`;let l=this.gameManager.config.getWithoutLogs("client/players/size/width","0")+"px";n.style.backgroundPositionX="-"+l,n.style.width=l,n.style.height=this.gameManager.config.getWithoutLogs("client/players/size/height","0")+"px",s.append(n),i.append(s)}preparePlayerSelector(e,t,a){let i=a.gameDom.getElement(o.SELECTORS.PLAYER_SELECTION_FORM),s=a.gameDom.getElement(o.SELECTORS.PLAYER_SELECT_ELEMENT);if(!i||!s)return!1;for(let e of(i.addEventListener("submit",e=>{e.preventDefault();let n=s.options[s.selectedIndex].value,r=this.getPlayerById(t.players,Number(n));if(r){let e=i.querySelector(o.SELECTORS.LOADING_CONTAINER);e&&e?.classList.remove(o.CLASSES.HIDDEN),a.initialGameData.player=r,a.events.emitSync("reldens.onPreparePlayerSelectorFormSubmit",{usersPlugin:this,form:i,select:s,selectedPlayer:r,gameManager:a}),a.initEngine().catch(e=>{m.error(e)})}return!1}),Object.keys(t.players))){let a=t.players[e],i=new Option(this.gameManager.services.translator.t(d.SNIPPETS.OPTION_LABEL,{playerName:a.name,currentLevel:a.currentLevel,classPathLabel:a.currentClassPathLabel}),a.id);i.dataset.key=a.avatarKey,s.append(i)}this.showAvatarContainer(a,t,s),i.classList.remove("hidden")}preparePlayerCreator(e,t,a){let i=a.gameDom.getElement(r.SELECTORS.PLAYER_CREATE_FORM);i&&i.addEventListener("submit",e=>{e.preventDefault(),a.gameDom.getElement("#player-create-form .response-error").innerHTML="";let t=new FormData(i),s=g.serializeFormData(t);if(3>s["new-player-name"].toString().length)return!1;a.submitedForm=!0,a.events.emitSync("reldens.onPreparePlayerCreationFormSubmit",{usersPlugin:this,form:i,gameManager:a});try{a.gameRoom.send("*",{act:o.CREATE_PLAYER,formData:s})}catch(e){m.critical("Create player error.",e),a.gameDom.alertReload(a.services.translator.t("game.errors.connectionLost"))}return!1})}getPlayerById(e,t){if(0===e.length)return!1;for(let a of e)if(a.id===t)return a;return!1}}},{"4884f11b075b66ea":"lB6ie","3f79c9046c35f178":"bVooE","674e49489e51556c":"hmzhe",a2e74f825a350c56:"52yv8","13407cdee0cc1fb5":"9ZTeS","8132da4e97588b49":"bJxKc",b40b9d44591fbc8d:"6kkgR","9762c449204f05e7":"bYb3U",b18ec97bd329135d:"@reldens/utils"}],lB6ie:[function(e,t,a,i){let{UsersConst:s}=e("f7fb9e778df1ad65"),{ActionsConst:n}=e("879f80e873cb79af"),{GameConst:r}=e("cd291612d478124"),{ObjectsConst:o}=e("400f53691795e348"),{ObjectsHandler:l}=e("b09b37f3a649897"),{sc:c}=e("852ef9687b71167f");t.exports.LifebarUi=class{constructor(e){this.events=e.events}createLifeBarUi(e){return this.barConfig=e.config.get("client/ui/lifeBar"),!!this.barConfig.enabled&&(this.gameManager=e,this.fixedPositionX=!1,this.fixedPositionY=!1,this.barProperty=this.gameManager.config.get("client/actions/skills/affectedProperty"),this.playerSize=this.gameManager.config.get("client/players/size"),this.lifeBars={},this.lifeDataByKey={},this.listenEvents(),this)}listenEvents(){this.events.on("reldens.playerStatsUpdateAfter",(e,t)=>{this.updatePlayerLifeBar(e,t)}),this.events.on("reldens.joinedRoom",e=>{this.listenMessages(e)}),this.events.on("reldens.runPlayerAnimation",(e,t)=>{this.drawPlayerLifeBar(t)}),this.events.on("reldens.updateGameSizeBefore",(e,t,a)=>{this.drawOnGameResize(t,a)}),this.events.on("reldens.playersOnRemove",(e,t)=>{this.removePlayerLifeBar(t)}),this.events.on("reldens.playerEngineAddPlayer",()=>{this.processLifeBarQueue()}),this.events.on("reldens.createAnimationAfter",()=>{l.drawObjectsLifeBar(this)}),this.events.on("reldens.objectBodyChanged",e=>{l.generateObjectLifeBar(e.key,this)}),this.events.on("reldens.gameEngineShowTarget",(e,t,a)=>{this.showTargetLifeBar(t,a)}),this.events.on("reldens.gameEngineClearTarget",(e,t)=>{this.clearPreviousBar(t)})}drawOnGameResize(e,t){if(!this.barConfig.fixedPosition)return!1;this.setPlayerLifeBarFixedPosition(e,t),this.drawPlayerLifeBar(this.gameManager.getCurrentPlayer().playerId)}clearPreviousBar(e){e&&c.hasOwn(this.lifeBars,e.id)&&this.gameManager.getCurrentPlayer().playerId!==e.id&&this.lifeBars[e.id].destroy()}showTargetLifeBar(e,t){if(!this.barConfig.showOnClick)return!1;this.clearPreviousBar(t),e.type===o.TYPE_OBJECT&&l.generateObjectLifeBar(e.id,this),e.type===r.TYPE_PLAYER&&this.drawPlayerLifeBar(e.id)}barPropertyValue(){return this.barProperty+"Value"}barPropertyTotal(){return this.barProperty+"Total"}setPlayerLifeBarFixedPosition(e,t){if(!e||!t){let a=this.gameManager.gameEngine.getCurrentScreenSize(this.gameManager);e=a.newWidth,t=a.newHeight}let{uiX:a,uiY:i}=this.gameManager.gameEngine.uiScene.getUiConfig("lifeBar",e,t);this.fixedPositionX=a,this.fixedPositionY=i}updatePlayerLifeBar(e,t){let a=t.gameManager.getCurrentPlayer();this.updatePlayerBarData(a.playerId,e.statsBase[this.barProperty],e.stats[this.barProperty]),this.drawPlayerLifeBar(a.playerId)}listenMessages(e){e.onMessage("*",e=>{this.listenBattleEnd(e),this.listenLifeBarUpdates(e)})}listenBattleEnd(e){if(e.act!==n.BATTLE_ENDED||!c.hasOwn(this.lifeBars,e.t))return!1;this.lifeBars[e.t].destroy()}listenLifeBarUpdates(e){if(e.act!==s.ACTION_LIFEBAR_UPDATE)return!1;l.processObjectLifeBarMessage(e,!0,this),this.processPlayerLifeBarMessage(e,!0)}canShowPlayerLifeBar(e){let t=this.gameManager.getCurrentPlayer();if(!c.isFunction(t?.isDeath))return!1;let a=e===t?.playerId;return a&&t&&(t.isDeath()||t.isDisabled())?(this.lifeBars[e]?.setVisible(!1),!1):!!a||!!this.barConfig.showAllPlayers||this.barConfig.showOnClick&&e===this.getCurrentTargetId()}queueLifeBarMessage(e){c.hasOwn(this.gameManager,"lifeBarQueue")||(this.gameManager.lifeBarQueue=[]),this.gameManager.lifeBarQueue.push(e)}processPlayerLifeBarMessage(e,t=!1){if(n.DATA_TYPE_VALUE_PLAYER!==e[n.DATA_OWNER_TYPE])return!1;let a=this.gameManager.getCurrentPlayer(),i=e[n.DATA_OWNER_KEY];return a&&a.players&&a.players[i]?(this.updatePlayerBarData(i,e.totalValue,e.newValue),this.canShowPlayerLifeBar(i)&&this.drawPlayerLifeBar(i),!0):(t&&this.queueLifeBarMessage(e),!1)}updatePlayerBarData(e,t,a){let i=this.gameManager.getCurrentPlayer();i.players[e][this.barPropertyTotal()]=t,i.players[e][this.barPropertyValue()]=a}processLifeBarQueue(){if(0===this.gameManager.lifeBarQueue.length)return!1;let e=[];for(let t of this.gameManager.lifeBarQueue)l.processObjectLifeBarMessage(t,!1,this)&&e.push(t),this.processPlayerLifeBarMessage(t,!1)&&e.push(t);0<e.length&&(this.gameManager.lifeBarQueue=this.gameManager.lifeBarQueue.filter(t=>!e.includes(t)))}drawPlayerLifeBar(e){if(this.destroyByKey(e),!this.canShowPlayerLifeBar(e))return this.lifeBars[e]?.setVisible(!1),!1;let t=this.prepareBarData(e),a=this.barConfig.height,i=this.barConfig.top,s=this.barConfig.width,n=t.player.x-s/2,r=t.player.y-a-i+t.ownerTop/2;return e===this.gameManager.getCurrentPlayer().playerId&&this.barConfig.fixedPosition?(this.lifeBars[e]=this.gameManager.getActiveScenePreloader().add.graphics(),(!1===this.fixedPositionX||!1===this.fixedPositionY)&&this.setPlayerLifeBarFixedPosition(),n=this.fixedPositionX,r=this.fixedPositionY):this.lifeBars[e]=this.gameManager.getActiveScene().add.graphics(),this.drawBar(this.lifeBars[e],t.fullValue,t.filledValue,n,r),this}destroyByKey(e){c.hasOwn(this.lifeBars,e)&&this.lifeBars[e].destroy()}prepareBarData(e){let t=this.gameManager.getCurrentPlayer().players[e],a=t[this.barPropertyTotal()],i=t[this.barPropertyValue()],s=c.get(t,"topOff",0)-this.playerSize.height;return{player:t,fullValue:a,filledValue:i,ownerTop:s}}removePlayerLifeBar(e){if(!c.hasOwn(this.lifeBars,e))return!1;this.lifeBars[e].destroy(),delete this.lifeBars[e]}drawBar(e,t,a,i,s){let n=this.barConfig.height,r=this.barConfig.width;e.clear(),e.fillStyle(parseInt(this.barConfig.fillStyle),1),e.fillRect(i,s,a*r/t,n),e.lineStyle(1,parseInt(this.barConfig.lineStyle)),e.strokeRect(i,s,r,n),e.alpha=.6,e.setDepth(3e5)}getCurrentTargetId(){return c.get(this.gameManager.getCurrentPlayer()?.currentTarget,"id",!1)}getObjectByKey(e){return c.get(this.gameManager.getActiveScene()?.objectsAnimations,e,!1)}}},{f7fb9e778df1ad65:"6kkgR","879f80e873cb79af":"hmzhe",cd291612d478124:"52yv8","400f53691795e348":"fEftg",b09b37f3a649897:"2Qsb6","852ef9687b71167f":"@reldens/utils"}],"6kkgR":[function(e,t,a,i){let s="users.";t.exports.UsersConst={ACTION_LIFEBAR_UPDATE:"alu",SNIPPETS:{PREFIX:s,OPTION_LABEL:s+"optionLabel"},MESSAGE:{DATA_VALUES:{NAMESPACE:"users"}}}},{}],"2Qsb6":[function(e,t,a,i){let{ActionsConst:s}=e("c554ff8c96b8723a"),{GameConst:n}=e("3cad0fd004bd2a29");t.exports.ObjectsHandler=class{static processObjectLifeBarMessage(e,t=!1,a){if(!this.isValidMessage(e,a))return!1;let i=e[s.DATA_OWNER_KEY],n={};n[a.barPropertyTotal()]=e.totalValue,n[a.barPropertyValue()]=e.newValue,a.lifeDataByKey[i]=n;let r=a.getObjectByKey(i);return r?(this.drawObjectLifeBar(r,e[s.DATA_OWNER_KEY],e.totalValue,e.newValue,a),!0):(t&&a.queueLifeBarMessage(e),!1)}static isValidMessage(e,t){return s.DATA_TYPE_VALUE_OBJECT===e[s.DATA_OWNER_TYPE]&&t.barConfig.showEnemies}static drawObjectsLifeBar(e){for(let t of Object.keys(e.lifeDataByKey)){let a=e.getObjectByKey(t);this.drawObjectLifeBar(a,t,e.lifeDataByKey[t][e.barPropertyTotal()],e.lifeDataByKey[t][e.barPropertyValue()],e)}}static isValidToDraw(e,t,a){return!!e&&n.STATUS.DEATH!==e.inState&&n.STATUS.DISABLED!==e.inState&&!(a.barConfig.showOnClick&&t!==a.getCurrentTargetId())}static generateObjectLifeBar(e,t){let a=t.lifeDataByKey[e];if(!a)return!1;let i=t.getObjectByKey(e);this.drawObjectLifeBar(i,e,a[t.barPropertyTotal()],a[t.barPropertyValue()],t)}static drawObjectLifeBar(e,t,a,i,s){if(s.destroyByKey(t),!this.isValidToDraw(e,t,s))return!1;this.drawLifeBarInPosition(s,t,e,a,i)}static drawLifeBarInPosition(e,t,a,i,s){e.lifeBars[t]=e.gameManager.getActiveScene().add.graphics();let{x:n,y:r}=this.calculateObjectLifeBarPosition(a,e);e.drawBar(e.lifeBars[t],i,s,n,r)}static calculateObjectLifeBarPosition(e,t){return{x:e.x-e.sceneSprite.width/2,y:e.y-e.sceneSprite.height/2-t.barConfig.height-t.barConfig.top}}}},{c554ff8c96b8723a:"hmzhe","3cad0fd004bd2a29":"52yv8"}],bVooE:[function(e,t,a,i){t.exports.PlayerStatsUi=class{constructor(e){this.events=e.events}createPlayerStatsUi(){this.events.on("reldens.beforePreloadUiScene",e=>{if(!e.gameManager.config.get("client/ui/playerStats/enabled"))return!1;e.load.html("playerStats","/assets/html/ui-player-stats.html"),e.load.html("playerStat","/assets/html/player-stat.html")}),this.events.on("reldens.beforeCreateUiScene",e=>{let t=e.getUiConfig("playerStats");if(!t.enabled)return!1;let a=e.add.dom(t.uiX,t.uiY).createFromCache("playerStats"),i=a.getChildByProperty("id","player-stats-close"),s=a.getChildByProperty("id","player-stats-open");s?.addEventListener("click",()=>{let t=a.getChildByProperty("id","player-stats-ui");t.style.display="block",s.style.display="none",a.setDepth(4),this.events.emit("reldens.openUI",{ui:this,openButton:s,dialogBox:a,dialogContainer:t,uiScene:e})}),i?.addEventListener("click",()=>{let t=a.getChildByProperty("id","player-stats-ui");t.style.display="none",s&&(s.style.display="block"),a.setDepth(1),this.events.emit("reldens.closeUI",{ui:this,closeButton:i,openButton:s,dialogBox:a,dialogContainer:t,uiScene:e})}),e.elementsUi.playerStats=a})}}},{}],"9ZTeS":[function(e,t,a,i){t.exports={users:{optionLabel:"%playerName - LvL %currentLevel - %classPathLabel"}}},{}],"6pVBT":[function(e,t,a,i){let{AudioManager:s}=e("f0889e1805ac30ae"),{SceneAudioPlayer:n}=e("fa2abd3e6fef423e"),{MessagesListener:r}=e("db53c1900c602955"),{AudioUi:o}=e("2762c14d95e654ec"),{TranslationsMapper:l}=e("e7efea8d47baf6a9"),c=e("11e948f4d8656d91"),{PluginInterface:d}=e("2644ab6cd69ea38d"),{AudioConst:h}=e("b8ecbb176547e3f6"),{Logger:m,sc:g}=e("78fc36a78c9f343a");t.exports.AudioPlugin=class extends d{setup(e){this.events=g.get(e,"events",!1),this.events||m.error("EventsManager undefined in AudioPlugin."),this.gameManager=g.get(e,"gameManager",!1),this.gameManager||m.error("Game Manager undefined in AudioPlugin."),this.setTranslations(),this.messagesListener=new r,this.sceneAudioPlayer=n,this.initialAudiosData={},this.listenEvents()}setTranslations(){if(!this.gameManager)return!1;l.forConfig(this.gameManager.config.client,c,h.MESSAGE.DATA_VALUES)}listenEvents(){if(!this.events)return!1;this.events.on("reldens.joinedRoom",(e,t)=>{this.initializeAudioManager(t),this.messagesListener.listenMessages(e,t)}),this.events.on("reldens.preloadUiScene",async e=>{e.load.html("audio","/assets/html/ui-audio.html"),e.load.html("audio-category","/assets/html/ui-audio-category-row.html")}),this.events.on("reldens.createUiScene",e=>{this.uiManager=new o(e),this.uiManager.createUi()}),this.events.on("reldens.afterSceneDynamicCreate",async e=>{let t=e.gameManager.audioManager;if(!t)return m.warning("Audio manager undefined in AudioPlugin."),!1;let a=g.get(this.initialAudiosData,"globalAudios",{});await t.loadGlobalAudios(a,e),await this.messagesListener.processQueue(),this.sceneAudioPlayer.associateSceneAnimationsAudios(t,e),e.cameras.main.on("camerafadeincomplete",()=>{this.sceneAudioPlayer.playSceneAudio(t,e)})}),this.events.on("reldens.changeSceneDestroyPrevious",e=>{e.gameManager.audioManager.destroySceneAudios()}),this.events.on("reldens.allAudiosLoaded",(e,t,a)=>{this.sceneAudioPlayer.playSceneAudio(e,a,!0)})}initializeAudioManager(e){e.audioManager||(e.initialGameData.player||m.warning("Missing initialGameData.player",e.initialGameData),e.audioManager=new s({events:this.events,currentPlayerData:e.initialGameData.player}),e.audioManager.updateDefaultConfig(e.config.getWithoutLogs("client/general/audio/defaultAudioConfig")),this.initialAudiosData=g.get(e.initialGameData,"audio",{}))}}},{f0889e1805ac30ae:"3OVcJ",fa2abd3e6fef423e:"7p9wC",db53c1900c602955:"e6PtP","2762c14d95e654ec":"48sQN",e7efea8d47baf6a9:"bJxKc","11e948f4d8656d91":"2cBmS","2644ab6cd69ea38d":"bYb3U",b8ecbb176547e3f6:"l17re","78fc36a78c9f343a":"@reldens/utils"}],"3OVcJ":[function(e,t,a,i){let{AudioConst:s}=e("2d414fa7de1cef79"),{Logger:n,sc:r}=e("25bd7cab17919029");t.exports.AudioManager=class{constructor(e){this.events=r.get(e,"events",!1),this.events||n.error("EventsManager undefined in AudioManager."),this.globalAudios=r.get(e,"globalAudios",{}),this.roomsAudios=r.get(e,"roomsAudios",{}),this.categories=r.get(e,"categories",{}),this.playerConfig=r.get(e,"playerConfig",{}),this.currentPlayerData=r.get(e,"currentPlayerData",{}),this.playing={},this.currentMuteState=!1,this.changedMutedState={},this.lockedMuteState=!1,this.defaultAudioConfig={mute:!1,volume:1,rate:1,detune:0,seek:0,loop:!0,delay:0}}async setAudio(e,t){if(this.lockedMuteState)return n.info("Locked mute state to set audio."),!1;await this.events.emit("reldens.setAudio",{audioManager:this,categoryKey:e,enabled:t});let a=this.categories[e];if(this.playerConfig[a.id]=+!!t,!r.hasOwn(this.playing,e))return!0;let i=t?"play":"stop",s=this.playing[e];return a.single_audio&&r.isObjectFunction(s,i)?this.setAudioForSingleEntity(s,i,e,t):this.setAudioForElementChildren(s,a,t)}setAudioForSingleEntity(e,t,a,i){if(!e)return n.error("Missing playingElement.",{audioKey:a,playingElement:e}),!1;if(!e.currentConfig)return!1;if(!r.isObjectFunction(e,t))return n.error("Missing playOrStop method in playingElement.",{audioKey:a,playOrStop:t,playingElement:e}),!1;try{e[t](),e.mute=!i}catch(i){n.error("PlayingElement error.",{audioKey:a,playOrStop:t,playingElement:e,error:i})}return!0}setAudioForElementChildren(e,t,a){if(t.single_audio)return!1;let i=Object.keys(e);if(0===i.length)return!1;for(let t of i)this.setAudioForSingleEntity(e[t],"stop",t,a);return!0}generateAudio(e,t){let a=Object.assign({},this.defaultAudioConfig,t.config||{});if(!r.hasOwn(e.cache.audio.entries.entries,t.audio_key))return n.error("Audio file does not exists. Audio key: "+t.audio_key,e.cache.audio.entries.entries),!1;let i=e.sound.add(t.audio_key,a);if(t.markers&&0<t.markers.length)for(let e of t.markers){let t=Object.assign({},a,e.config||{},{name:e.marker_key,start:e.start,duration:e.duration});i.addMarker(t)}return{data:t,audioInstance:i}}findAudio(e,t){return this.findRoomAudio(e,t)||this.findGlobalAudio(e)}findRoomAudio(e,t){return r.hasOwn(this.roomsAudios,t)||(this.roomsAudios[t]={}),this.findAudioInObjectKey(e,this.roomsAudios[t])}findGlobalAudio(e){return this.findAudioInObjectKey(e,this.globalAudios)}findAudioInObjectKey(e,t){if(r.hasOwn(t,e))return{audio:t[e],marker:!1};let a=Object.keys(t);if(0===a.length)return!1;for(let i of a){let a=t[i];if(r.hasOwn(a.audioInstance.markers,e))return{audio:a,marker:e}}return!1}addCategories(e){for(let t of e)r.hasOwn(this.categories,t.category_key)||(this.categories[t.category_key]=t),r.hasOwn(this.playing,t.category_key)||(this.playing[t.category_key]={})}async loadGlobalAudios(e,t){let a=Object.keys(e);if(0===a.length)return!1;await this.loadByKeys(a,e,t,"globalAudios")}async loadAudiosInScene(e,t){let a=Object.keys(e);if(0===a.length)return!1;r.hasOwn(this.roomsAudios,t.key)||(this.roomsAudios[t.key]={}),await this.loadByKeys(a,e,t,"roomsAudios")}async loadByKeys(e,t,a,i){let s=0;for(let r of e){let e=t[r];this.removeSceneAudioByAudioKey(a,e.audio_key);let o=await this.prepareFiles(e);if(0===o.length)continue;let l=a.load.audio(e.audio_key,o);l.on("filecomplete",async r=>{if(r!==e.audio_key)return!1;let o=this.generateAudio(a,e);if(!1===o)return n.error("AudioLoader can not generate the audio.",{"Audio key:":e.audio_key,"Storage key:":i}),!1;"roomsAudios"===i?this.roomsAudios[a.key][e.audio_key]=o:this.globalAudios[e.audio_key]=o,s++,await this.fireAudioEvents(t,a,e,s)}),l.start()}}async existsFileByXMLHttpRequest(e){try{let t=await fetch(e,{method:"HEAD"});return 404!==t.status}catch(e){return n.error("Error fetching:",e),!1}}async prepareFiles(e){let t=e.files_name.split(","),a=[];for(let e of t){let t=s.AUDIO_BUCKET+"/"+e;!1!==await this.existsFileByXMLHttpRequest(t)&&a.push(t)}return a}async fireAudioEvents(e,t,a,i){await t.gameManager.events.emit("reldens.audioLoaded",this,e,t,a),i===e.length&&await t.gameManager.events.emit("reldens.allAudiosLoaded",this,e,t,a)}removeAudiosFromScene(e,t){if(0===e.length||!t)return!1;for(let a of e)this.removeSceneAudioByAudioKey(t,a.audio_key);return!0}removeSceneAudioByAudioKey(e,t){e.sound.removeByKey(t),r.hasOwn(e.cache.audio.entries.entries,t)&&delete e.cache.audio.entries.entries[t],r.hasOwn(this.roomsAudios[e.key],t)&&delete this.roomsAudios[e.key][t],r.hasOwn(this.globalAudios,t)&&delete this.globalAudios[t]}updateDefaultConfig(e){r.isObject(e)&&Object.assign(this.defaultAudioConfig,e)}async processUpdateData(e,t,a){e.playerConfig&&(this.playerConfig=e.playerConfig),e.categories&&(this.addCategories(e.categories),await this.events.emit("reldens.audioManagerUpdateCategoriesLoaded",this,t,a,e));let i=r.get(e,"audios",{});if(0<Object.keys(i).length){let s=a.gameEngine.scene.getScene(t.name);await this.loadAudiosInScene(i,s),await this.events.emit("reldens.audioManagerUpdateAudiosLoaded",this,t,a,e)}}async processDeleteData(e,t,a){if(0===e.audios.length)return!1;let i=a.gameEngine.scene.getScene(t.name);this.removeAudiosFromScene(e.audios,i),await this.events.emit("reldens.audioManagerDeleteAudios",this,t,a,e)}destroySceneAudios(){let e=Object.keys(this.playing);if(0===e.length)return!1;for(let t of e){let e=this.playing[t],a=this.categories[t];if(a.single_audio&&r.isObjectFunction(e,"stop")){e.stop(),delete this.playing[t];continue}let i=Object.keys(e);if(a.single_audio||0!==i.length)for(let a of i){let i=e[a];r.isObjectFunction(i,"stop")&&(i.stop(),delete i[t])}}}async changeMuteState(e,t){return(!1===t&&(this.lockedMuteState=!1),this.currentMuteState=e,this.lockedMuteState&&!1!==t)?(n.info("Locked mute state from changes."),!1):e?await this.muteCategories(t):await this.restoreMute(t)}async muteCategories(e){let t=Object.keys(this.categories);if(0<t.length)return n.info("Mute categories not found."),!1;for(let e of t)this.changedMutedState[e]=this.currentMuteState,await this.setAudio(e,!1);return this.setMuteLock(e),!0}async restoreMute(e){let t=Object.keys(this.changedMutedState);if(0===t.length)return this.setMuteLock(e),!1;for(let e of t)await this.setAudio(e,!0);return this.setMuteLock(e),this.changedMutedState={},!0}setMuteLock(e){!1===e&&(this.lockedMuteState=!1),!0===e&&(this.lockedMuteState=!0)}}},{"2d414fa7de1cef79":"l17re","25bd7cab17919029":"@reldens/utils"}],l17re:[function(e,t,a,i){t.exports.AudioConst={AUDIO_UPDATE:"ap",AUDIO_DELETE:"ad",AUDIO_ANIMATION_KEY_START:"i_",AUDIO_ANIMATION_KEY_UPDATE:"u_",AUDIO_ANIMATION_KEY_COMPLETE:"c_",AUDIO_ANIMATION_KEY_REPEAT:"r_",AUDIO_ANIMATION_KEY_STOP:"s_",AUDIO_BUCKET:"/assets/audio",MESSAGE:{DATA:{UPDATE_TYPE:"ck",UPDATE_VALUE:"uv"},DATA_VALUES:{NAMESPACE:"audio"}}}},{}],"7p9wC":[function(e,t,a,i){let{AudioConst:s}=e("f731a7f8fab776ad"),{Logger:n,sc:r}=e("a54fcbcc49a76a60");t.exports.SceneAudioPlayer=new class{playSceneAudio(e,t,a){let i=t.associatedAudio;return(!0===a||!1!==i&&(!i||!i.audio.audioInstance.isPlaying))&&(t.associatedAudio=e.findAudio(t.key,t.key),!!t.associatedAudio&&(this.playSpriteAudio(t.associatedAudio,t,!1,e),t.associatedAudio))}associateSceneAnimationsAudios(e,t){t.cameras.main.on("camerafadeincomplete",()=>{if(t.children.list.length<=0)return!1;for(let a of t.children.list)"Sprite"===a.type&&(a.on("animationstart",i=>{let n=s.AUDIO_ANIMATION_KEY_START+i.key,r=this.attachAudioToSprite(a,n,e,t);!1!==r&&this.playSpriteAudio(r,t,a,e)}),a.on("animationupdate",i=>{let n=s.AUDIO_ANIMATION_KEY_UPDATE+i.key,r=this.attachAudioToSprite(a,n,e,t);!1!==r&&this.playSpriteAudio(r,t,a,e)}),a.on("animationcomplete",i=>{let n=s.AUDIO_ANIMATION_KEY_COMPLETE+i.key,r=this.attachAudioToSprite(a,n,e,t);!1!==r&&this.playSpriteAudio(r,t,a,e)}),a.on("animationrepeat",i=>{let n=s.AUDIO_ANIMATION_KEY_REPEAT+i.key,r=this.attachAudioToSprite(a,n,e,t);!1!==r&&this.playSpriteAudio(r,t,a,e)}),a.on("animationstop",i=>{let n=s.AUDIO_ANIMATION_KEY_STOP+i.key,r=this.attachAudioToSprite(a,n,e,t);!1!==r&&this.playSpriteAudio(r,t,a,e)}))})}attachAudioToSprite(e,t,a,i){return r.hasOwn(e.associatedAudio,t)||(r.hasOwn(e,"associatedAudio")||(e.associatedAudio={}),r.hasOwn(e.associatedAudio,t)||(e.associatedAudio[t]=a.findAudio(t,i.key))),e.associatedAudio[t]}playSpriteAudio(e,t,a,i){let s=Number(i.currentPlayerData.id),o=Number(r.get(a,"player_id")),l=this.isCurrentPlayerSprite(o,s);if(e.audio.data.config?.onlyCurrentPlayer&&!l)return!1;let c=t.player;if(l&&c&&(c.isDisabled()||c.isDeath()))return!1;if(!e||!e.audio||!e.audio.data)return n.error("Missing associated audio data.",e),!1;let d=e.audio.data.category.category_key,h=r.get(i.categories,d,!1),m=r.get(i.playerConfig,h.id,h.enabled);if(!h||!m)return!1;let g=e.audio.audioInstance;if(h.single_audio&&r.isObjectFunction(i.playing[h.category_key],"stop")&&i.playing[h.category_key].stop(),h.single_audio)return i.playing[h.category_key]=g,!this.isMutedState(i,h.category_key,g)&&(g.mute=!1,g.play(),!0);if(!h.single_audio){if(!e.marker)return i.playing[h.category_key][e.audio.data.audio_key]=g,!this.isMutedState(i,h.category_key,g)&&(g.mute=!1,g.play(),!0);if(e.marker)return i.playing[h.category_key][e.marker]=g,!this.isMutedState(i,h.category_key,g)&&(g.mute=!1,g.play(e.marker),!0)}}isCurrentPlayerSprite(e,t){return e&&e===t}isMutedState(e,t,a){return!1!==e.currentMuteState&&(n.info("AudioManager in muted state to play audio.",{mutedKey:t,audioInstance:a}),e.changedMutedState[t]=e.currentMuteState,!0)}}},{f731a7f8fab776ad:"l17re",a54fcbcc49a76a60:"@reldens/utils"}],e6PtP:[function(e,t,a,i){let{AudioConst:s}=e("7c37a875a4ede872");t.exports.MessagesListener=class{constructor(){this.queueMessages=[],this.sceneReady=!1}listenMessages(e,t){e.onMessage("*",async a=>{await this.processMessage(a,e,t)})}async processQueue(){if(this.sceneReady=!0,0===this.queueMessages.length)return!1;for(let e of this.queueMessages){let{message:t,room:a,gameManager:i}=e;await this.processMessage(t,a,i)}return!0}async processMessage(e,t,a){!1===this.sceneReady&&this.queueMessages.push({message:e,room:t,gameManager:a}),e.act===s.AUDIO_UPDATE&&await a.audioManager.processUpdateData(e,t,a),e.act===s.AUDIO_DELETE&&await a.audioManager.processDeleteData(e,t,a)}}},{"7c37a875a4ede872":"l17re"}],"48sQN":[function(e,t,a,i){let{SceneAudioPlayer:s}=e("cab4fb9f8a467533"),{AudioUpdate:n}=e("fd2803834723a17f"),{sc:r}=e("a6e36c332d705b7f");t.exports.AudioUi=class{constructor(e){this.uiScene=e,this.gameManager=this.uiScene.gameManager,this.audioManager=this.gameManager.audioManager,this.sceneAudioPlayer=s}createUi(){if(!this.audioManager.categories)return;let e=this.uiScene.cache.html.get("audio"),t=this.uiScene.cache.html.get("audio-category"),a=this.prepareAudioSettingsContent(t,e);this.gameManager.gameDom.appendToElement("#settings-dynamic",a);let i=this.gameManager.gameDom.getElements(".audio-setting");if(0===i.length)return!1;for(let e of i)e.addEventListener("click",async t=>{await this.audioManager.setAudio(t.target.dataset.categoryKey,e.checked),this.gameManager.activeRoomEvents.send(new n(e.value,e.checked)),this.sceneAudioPlayer.playSceneAudio(this.audioManager,this.gameManager.getActiveScene())})}prepareAudioSettingsContent(e,t){let a=this.prepareCategoriesRows(e);return this.gameManager.gameEngine.parseTemplate(t,{audioCategories:a,settingsTitle:this.gameManager.services.translator.t("audio.settingsTitle")})}prepareCategoriesRows(e){let t="";for(let a of Object.keys(this.audioManager.categories)){let i=this.audioManager.categories[a],s=r.get(this.audioManager.playerConfig,i.id,i.enabled);t+=this.gameManager.gameEngine.parseTemplate(e,{categoryId:i.id,categoryLabel:i.category_label,categoryKey:i.category_key,categoryChecked:s?' checked="checked"':""})}return t}}},{cab4fb9f8a467533:"7p9wC",fd2803834723a17f:"eczDI",a6e36c332d705b7f:"@reldens/utils"}],eczDI:[function(e,t,a,i){let{AudioConst:s}=e("c6282358940d3030"),{GameConst:n}=e("f796ac11391ac94f");t.exports.AudioUpdate=class{constructor(e,t){this[n.ACTION_KEY]=s.AUDIO_UPDATE,this[s.MESSAGE.DATA.UPDATE_TYPE]=e,this[s.MESSAGE.DATA.UPDATE_VALUE]=t}}},{c6282358940d3030:"l17re",f796ac11391ac94f:"52yv8"}],"2cBmS":[function(e,t,a,i){t.exports={audio:{settingsTitle:"Audio Settings"}}},{}],"7x25l":[function(e,t,a,i){let{ActionsConst:s}=e("29c0272b4b704e1a"),{RoomsConst:n}=e("3956319db3be63df"),{PluginInterface:r}=e("467a2ea8f06e99ae"),{Logger:o,sc:l}=e("1d01f54fcfe4090e");t.exports.RoomsPlugin=class extends r{setup(e){this.gameManager=l.get(e,"gameManager",!1),this.gameManager||o.error("Game Manager undefined in RoomsPlugin."),this.events=l.get(e,"events",!1),this.events||o.error("EventsManager undefined in RoomsPlugin."),this.events.on("reldens.beforeCreateEngine",(e,t)=>{t.config.get("client/rooms/selection/allowOnLogin",!1)&&e.roomSelection&&this.populateSceneSelector(e.roomSelection,t)}),this.events.on("reldens.onPrepareSinglePlayerSelectorFormSubmit",e=>{this.appendSelectedScene(e.gameManager,e.form)}),this.events.on("reldens.onPreparePlayerSelectorFormSubmit",e=>{this.appendSelectedScene(e.gameManager,e.form)}),this.events.on("reldens.onPreparePlayerCreationFormSubmit",e=>{this.appendSelectedScene(e.gameManager,e.form)})}populateSceneSelector(e,t){let a=t.gameDom.getElement(s.SELECTORS.PLAYER_CREATION_ADDITIONAL_INFO),i=t.gameDom.getElement(s.SELECTORS.PLAYER_SELECTION_ADDITIONAL_INFO);if(!a&&!i)return o.warning("Missing element.",{playerCreationAdditional:a,playerSelectionAdditional:i}),!1;if(a){let i=this.filterCreationRooms(e),s=this.createSelectorElements(t,i,"creation");a.append(s)}if(i){let a=this.createSelectorElements(t,e,"selection");i.append(a)}}filterCreationRooms(e){let t=[];for(let a of e)a.name!==n.ROOM_LAST_LOCATION_KEY&&t.push(a);return t}appendSelectedScene(e,t){let a=e.gameDom.getElement(".scene-select",t);if(!a)return;let i=a.options[a.selectedIndex].value;i&&(e.initialGameData.selectedScene=i)}createSelectorElements(e,t,a){let i=e.gameDom.createElement("div");i.classList.add("input-box");let s=e.gameDom.createElement("label");s.htmlFor=a+"SelectedScene",s.innerText=this.gameManager.services.translator.t("game.pleaseSelectScene");let n=e.gameDom.createElement("select");for(let e of(n.name=a+"SelectedScene",n.id=a+"SelectedScene",n.classList.add("select-element"),n.classList.add("scene-select"),t)){let t=new Option(e.title,e.name);n.append(t)}return i.append(s),i.append(n),i}}},{"29c0272b4b704e1a":"hmzhe","3956319db3be63df":"4NiBt","467a2ea8f06e99ae":"bYb3U","1d01f54fcfe4090e":"@reldens/utils"}],etSTe:[function(e,t,a,i){let{PredictionWorldCreator:s}=e("698b644ff63be292"),{RoomEventsOverride:n}=e("33ce8b7f1eedd7a9"),{PluginInterface:r}=e("c1ea0248987a09b6"),{Logger:o,sc:l}=e("3c592f7740d29ac2");t.exports.PredictionPlugin=class extends r{setup(e){this.gameManager=l.get(e,"gameManager",!1),this.events=l.get(e,"events",!1),this.predictionWorldCreator=new s,this.roomEventsOverride=new n,this.validateProperties()&&this.listenEvents()}validateProperties(){return this.gameManager?!!this.events||(o.error("EventsManager undefined in PredictionPlugin."),!1):(o.error("Game Manager undefined in PredictionPlugin."),!1)}listenEvents(){this.events.on("reldens.createEngineSceneDone",async e=>{await this.predictionWorldCreator.createSceneWorld(e.currentScene)}),this.events.on("reldens.createdRoomsEventsInstance",(e,t)=>{this.roomEventsOverride.createCurrentPlayerOverride(t.activeRoomEvents),this.roomEventsOverride.playerOnChangeOverride(t.activeRoomEvents),this.roomEventsOverride.createPlayerEngineInstanceOverride(t.activeRoomEvents),this.roomEventsOverride.createSceneInstanceOverride(t.activeRoomEvents)})}}},{"698b644ff63be292":"6td1L","33ce8b7f1eedd7a9":"8IuVR",c1ea0248987a09b6:"bYb3U","3c592f7740d29ac2":"@reldens/utils"}],"6td1L":[function(e,t,a,i){let{CollisionsManager:s}=e("81a878d445d114e3"),{P2world:n}=e("a3212e85f9a74e4"),{WorldPointsValidator:r}=e("8c4e487eb60fa4f8"),{WorldTimer:o}=e("50192fe3227e0023"),{Logger:l,sc:c}=e("6f0361e2dca7f7f5");t.exports.PredictionWorldCreator=class{async createSceneWorld(e){if(!e.experimentalClientPrediction)return;let t=this.findValidLayers(e),a=this.cloneMapJson(e,t),i={sceneName:e.key,roomId:e.params.roomId,roomMap:e.params.roomMap,mapJson:a,config:e.configManager,events:e.eventsManager,allowSimultaneous:e.configManager.get("client/general/controls/allowSimultaneousKeys",!0),worldConfig:e.gameManager.activeRoomEvents.roomData?.worldConfig||e.worldConfig};e.worldPrediction=this.createWorldInstance(i),e.worldPrediction.createLimits(),await e.worldPrediction.createWorldContent({});let n=e.gameManager.getCurrentPlayer();if(!n)return void l.error("Current player not present for prediction.");let c={id:n.playerId,width:e.configManager.get("client/players/physicalBody/width"),height:e.configManager.get("client/players/physicalBody/height"),bodyState:n.state},d=e.worldPrediction.createPlayerBody(c);d.updateBodyState=this.updateBodyStateOverride(d,n),n.predictionBody=d,e.worldPredictionTimer=new o({callbacks:[()=>{e.worldPrediction?e.worldPrediction.removeBodiesFromWorld():l.error("Scene World not longer exists.",e.roomWorld)}]}),e.worldPredictionTimer.startWorldSteps(e.worldPrediction),e.collisionsManager=new s({roomWorld:e.worldPrediction}),n.pointsValidator=new r(a.width,a.height)}cloneMapJson(e,t){return Object.assign({},e.cache?.tilemap?.entries?.entries[e.tileset.name]?.data||{},{layers:t})}findValidLayers(e){let t=[];for(let a of e.cache.tilemap.entries.entries[e.tileset.name].data.layers)-1!==a.name.indexOf("collision")&&t.push(a);return t}updateBodyStateOverride(e,t){return()=>{if(!c.hasOwn(e.bodyState,"x")||!c.hasOwn(e.bodyState,"y")||!e.position[0]||!e.position[1])return;if(e.isNotMoving()){e.bodyState.mov=!1;return}e.bodyState.x!==e.position[0]&&(e.bodyState.x=e.position[0]),e.bodyState.y!==e.position[1]&&(e.bodyState.y=e.position[1]);let a=0!==Number(Number(e.velocity[0]).toFixed(2))||0!==Number(e.velocity[1].toFixed(2));e.bodyState.mov!==a&&(e.bodyState.mov=a);let i={x:e.position[0],y:e.position[1],dir:e.bodyState.dir};t.updatePlayer(t.playerId,{state:i})}}createWorldInstance(e){return new n(e)}}},{"81a878d445d114e3":"4PMPm",a3212e85f9a74e4:"jP2Cx","8c4e487eb60fa4f8":"aIwMW","50192fe3227e0023":"93HfN","6f0361e2dca7f7f5":"@reldens/utils"}],"4PMPm":[function(e,t,a,i){let{PhysicalBody:s}=e("2bac9eebd1669ae7"),{ErrorManager:n,Logger:r,sc:o}=e("6df25a7483afe879");t.exports.CollisionsManager=class{constructor(e){this.activateCollisions(e)}activateCollisions(e){e&&(this.room=e,o.hasOwn(this.room,"roomWorld")||n.error("Room world not found."),this.guestEmailDomain=this.room.config.getWithoutLogs("server/players/guestsUser/emailDomain"),this.room.roomWorld.on("postBroadphase",this.onWorldStepStart.bind(this)),this.room.roomWorld.on("preSolve",this.beforeResolveCollision.bind(this)),this.room.roomWorld.on("beginContact",this.onCollisionsBegin.bind(this)),this.room.roomWorld.on("endContact",this.onCollisionsEnd.bind(this)))}onWorldStepStart(e){let{pairs:t}=e;if(1>=t.length)return;let a=!1,i=!1,s=!1,n=!1;for(let e of t)e.playerId&&e.pStop&&e.stopFull(),e.roomObject&&e.pStop&&e.stopFull(),e.playerId&&(s=e),e.isBullet&&(a&&!i&&(i=e),a||(a=e),e.removeInvalidStateBulletBody()),e.isRoomObject&&!e.isBullet&&(n=e);this.room.roomWorld.bulletsStopOnPlayer&&s&&a&&s.stopFull(),this.room.roomWorld.bulletsStopOnObject&&n&&a&&n.stopFull(),this.removeIdleBullets()}removeIdleBullets(){if(0!==this.room.roomWorld.removeBulletsStateIds.length)for(let e of this.room.roomWorld.removeBulletsStateIds)this.room.state.removeBody(e),this.room.roomWorld.removeBulletsStateIds.splice(this.room.roomWorld.removeBulletsStateIds.indexOf(e),1)}beforeResolveCollision(e){if(this.room.roomWorld.allowPassWallsFromBelow)for(let t of e.contactEquations){let e=this.getPlayerBody(t),a=this.getWallBody(t);if(!e||!a||a.isWorldWall)return;e.position[1]>a.position[1]&&(t.enabled=!1)}}onCollisionsBegin(e){let t=e.bodyA,a=e.bodyB,i=!1,s=!1,n=!1;return t.playerId&&a.playerId?this.playerHitPlayerBegin(t,a):(t.playerId&&(i=t,s=a),a.playerId&&(i=a,s=t),i&&s.isRoomObject)?this.playerHitObjectBegin(i,s):i&&s.changeScenePoint?this.playerHitChangePointBegin(i,s):i&&s.isWall?this.playerHitWallBegin(i,s):t.isRoomObject&&a.isRoomObject?this.objectHitObjectBegin(t,a):void(t.isRoomObject&&(n=t,s=a),a.isRoomObject&&(n=a,s=t),n&&s.isWall&&this.objectHitWallBegin(n,s))}onCollisionsEnd(e){let t=e.bodyA,a=e.bodyB,i=!1,s=!1,n=!1;return(e.bodyA.playerId&&e.bodyB.playerId&&this.playerHitPlayerEnd(e.bodyA,e.bodyB),t.playerId&&(i=t,s=a),a.playerId&&(i=a,s=t),i&&s.isRoomObject)?this.playerHitObjectEnd(i,s):i&&s.isWall?this.playerHitWallEnd(i,s):(t.isRoomObject&&a.isRoomObject&&this.objectHitObjectEnd(t,a),t.isRoomObject&&(n=t,s=a),a.isRoomObject&&(n=a,s=t),n&&s.isWall)?this.objectHitWallEnd(n,s):void 0}playerHitPlayerBegin(e,t){this.room.events.emit("reldens.playerHitPlayer",{bodyA:e,bodyB:t})}playerHitPlayerEnd(e,t){e.stopFull(),t.stopFull(),this.room.events.emit("reldens.playerHitPlayerEnd",{bodyA:e,bodyB:t})}playerHitObjectBegin(e,t){this.room.events.emit("reldens.startPlayerHitObjectBegin",{playerBody:e,otherBody:t}),this.findAlternativePath(e),t.roomObject&&o.isFunction(t.roomObject.onHit)&&t.roomObject.onHit({bodyA:e,bodyB:t,room:this.room}),this.room.events.emit("reldens.endPlayerHitObjectBegin",{playerBody:e,otherBody:t})}playerHitObjectEnd(e,t){let a={stopFull:!0,continue:!0};if(this.room.events.emit("reldens.playerHitObjectEnd",{playerBody:e,result:a}),!a.continue)return!1;e.stopFull(a.stopFull)}playerHitWallBegin(e,t){this.room.events.emit("reldens.playerHitWallBegin",{playerBody:e,wallBody:t})}playerHitWallEnd(e,t){if(this.room.events.emit("reldens.startPlayerHitWallEnd",{playerBody:e,wallBody:t}),e.autoMoving&&1<e.autoMoving.length){let t=e.autoMoving.pop();e.moveToPoint({column:t[0],row:t[1]});return}e.world&&!e.world.applyGravity&&e.stopFull(!0),this.room.events.emit("reldens.endPlayerHitWallEnd",{playerBody:e,wallBody:t})}playerHitChangePointBegin(e,t){if(this.room.events.emit("reldens.startPlayerHitChangePoint",{collisionsManager:this,playerBody:e,changePoint:t}),e.resetAuto(),o.get(e,"isChangingScene",!1))return r.info("Player is busy for a change point: "+e.playerId),!1;let a=this.room.playerBySessionIdFromState(e.playerId),i=this.room.getClientById(e.playerId),s=-1!==i.auth.email?.indexOf(this.guestEmailDomain);if(!this.room.validateRoom(t.changeScenePoint,s,!0))return r.info("Guest Player hit change point but is not allowed to the room: "+a.state.scene),this.room.events.emit("reldens.guestInvalidChangePoint",{collisionsManager:this,playerBody:e,changePoint:t,playerSchema:a,contactClient:i,isGuest:s}),!1;let n={x:e.position[0],y:e.position[1]};this.room.state.positionPlayer(e.playerId,n);let l={prev:a.state.scene,next:t.changeScenePoint};e.isChangingScene=!0,this.room.nextSceneInitialPosition(i,l,e).catch(e=>{r.error("There was an error while setting the next scene initial position.",e)}),this.room.events.emit("reldens.endPlayerHitChangePoint",{collisionsManager:this,playerSchema:a,playerBody:e,changePoint:t,changeData:l})}objectHitObjectBegin(e,t){this.room.events.emit("reldens.startObjectHitObject",{bodyA:e,bodyB:t});let a=o.hasOwn(e,"hitPriority"),i=o.hasOwn(t,"hitPriority"),s={bodyA:e,bodyB:t,room:this.room},n=(a||i)&&(!a||i&&!(a>i))?t:e;n.roomObject&&o.isFunction(n.roomObject?.onHit)&&n.roomObject.onHit(s),e.isBullet&&e.roomObject.removeBullet(e),t.isBullet&&t.roomObject.removeBullet(t),this.findAlternativePath(e),this.findAlternativePath(t),this.room.events.emit("reldens.endObjectHitObject",{bodyA:e,bodyB:t,priorityObject:n})}objectHitObjectEnd(e,t){this.bodyFullStop(e),this.bodyFullStop(t),this.room.events.emit("reldens.objectHitObjectEnd",{bodyA:e,bodyB:t})}objectHitWallBegin(e,t){let a={objectBody:e,wall:t,continue:!0};return this.room.events.emit("reldens.objectHitWallBegin",a),a.continue&&e.isBullet&&e.roomObject.removeBullet(e),a}objectHitWallEnd(e){this.room.events.emit("reldens.startObjectHitWall",{objectBody:e}),this.resetObjectAutoMove(e),this.room.events.emit("reldens.endObjectHitWall",{objectBody:e})}bodyFullStop(e){if(!e)return!1;!(e.autoMoving&&0<e.autoMoving.length)&&!e.isBullet&&e.isRoomObject&&e instanceof s&&e.stopFull(!0),e.isBullet&&e.roomObject.removeBullet(e)}findAlternativePath(e){if(!e.autoMoving||0===e.autoMoving.length)return!1;let t=e.autoMoving.shift(),a=e.autoMoving.pop();e.autoMoving=e.getPathFinder().findPath(t,a)}resetObjectAutoMove(e){if(!(e instanceof s)||!e.world)return;let t=!1;if(o.isArray(e.autoMoving)&&0<e.autoMoving.length&&(t=e.autoMoving.pop()),t){if(e.world.applyGravity?e.stopFull(!0):e.stopX(!0),e.autoMovingResetRetries++,e.autoMovingResetMaxRetries===e.autoMovingResetRetries)return e.autoMovingResetRetries=0,e.moveToOriginalPoint();e.moveToPoint({column:t[0],row:t[1]})}}getWallBody(e){let{bodyA:t,bodyB:a}=e;return t&&t.isWall?t:!!a&&!!a.isWall&&a}getObjectBody(e){let{bodyA:t,bodyB:a}=e;return t&&t.isRoomObject?t:!!a&&!!a.isRoomObject&&a}getPlayerBody(e){let{bodyA:t,bodyB:a}=e;return t&&t.playerId?t:!!a&&!!a.playerId&&a}}},{"2bac9eebd1669ae7":"dbAT2","6df25a7483afe879":"@reldens/utils"}],dbAT2:[function(e,t,a,i){let{Body:s,vec2:n}=e("58640466804c3117"),{GameConst:r}=e("7021c6716e058072"),{Logger:o,sc:l}=e("b47ac5fab7662b94");t.exports.PhysicalBody=class extends s{constructor(e){super(e),this.bodyState=null,this.animationBasedOnPress=e.animationBasedOnPress,this.diagonalHorizontal=e.diagonalHorizontal,this.autoMoving=!1,this.pathFinder=!1,this.isChangingScene=!1,this.currentCol=!1,this.currentRow=!1,this.originalCol=!1,this.originalRow=!1,this.jumpSpeed=l.get(e,"jumpSpeed",540),this.jumpTimeMs=l.get(e,"jumpTimeMs",180),this.movementSpeed=l.get(e,"movementSpeed",180),this.speedThreshold=l.get(e,"speedThreshold",.1),this.applySpeedThresholdOnBullets=l.get(e,"applySpeedThresholdOnBullets",!0),this.worldPositionPrecision=l.get(e,"worldPositionPrecision",0),this.worldSpeedPrecision=l.get(e,"worldSpeedPrecision",0),this.autoMovingResetMaxRetries=l.get(e,"autoMovingResetMaxRetries",5),this.autoMovingResetRetries=0,this.moveToOriginalPointWithDelay=l.get(e,"moveToOriginalPointWithDelay",100),this.moveToOriginalPointTimer=!1,this.originalSpeed={x:0,y:0},this.speedToNextMaxRetries=l.get(e,"speedToNextMaxRetries",3),this.speedToNextRetryCounter={col:0,row:0,retries:0},this.lastSetCollisionGroup=!1,this.blockBodyStates=l.get(e,"blockBodyStates",[r.STATUS.DISABLED,r.STATUS.DEATH])}integrate(e){if(-1!==this.blockBodyStates.indexOf(this.bodyState?.inState))return;let t=this.invMass,a=this.force,i=this.position,s=this.velocity;n.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*e);let r=n.create();if(n.scale(r,a,e*t),n.multiply(r,this.massMultiplier,r),n.add(s,r,s),!this.integrateToTimeOfImpact(e)){let t=n.create();n.scale(t,s,e),n.add(i,i,t),this.fixedRotation||(this.angle+=this.angularVelocity*e)}this.speedToNext(),this.aabbNeedsUpdate=!0,this.velocity[0]=1e-4>Math.abs(this.velocity[0])?0:l.roundToPrecision(this.velocity[0],4),this.velocity[1]=1e-4>Math.abs(this.velocity[1])?0:l.roundToPrecision(this.velocity[1],4),.001>Math.abs(this.velocity[0])&&this.stopX(),.001>Math.abs(this.velocity[1])&&this.stopY(),this.updateBodyState()}speedToNext(){if(!this.autoMoving||0===this.autoMoving.length)return void this.setShapesCollisionGroup(this.originalCollisionGroup);if(!this.autoMoving[0]){o.error("Missing autoMoving first index."),this.setShapesCollisionGroup(this.originalCollisionGroup);return}let e=this.autoMoving[0][0],t=this.autoMoving[0][1];if(0!==this.speedToNextRetryCounter.col&&this.speedToNextRetryCounter.col===e&&0!==this.speedToNextRetryCounter.row&&this.speedToNextRetryCounter.row===t&&0!==this.velocity[0]&&0!==this.velocity[1]&&this.speedToNextRetryCounter.retries++,this.speedToNextMaxRetries===this.speedToNextRetryCounter.retries){this.speedToNextRetryCounter.col=0,this.speedToNextRetryCounter.row=0;let e=this.autoMoving.shift(),t=this.autoMoving.pop();this.stopFull(!0),this.alignToTile(),this.autoMoving=this.getPathFinder().findPath(e,t),this.speedToNextRetryCounter.retries=0;return}if(this.speedToNextRetryCounter.col=e,this.speedToNextRetryCounter.row=t,this.currentCol===e&&this.currentRow===t){this.autoMoving.shift(),0===this.autoMoving.length&&this.stopAutoMoving();return}this.currentCol===e&&0!==this.velocity[0]&&(this.stopX(),this.alignToTile()),this.currentCol>e&&this.initMove(r.LEFT,!0),this.currentCol<e&&this.initMove(r.RIGHT,!0),this.currentRow===t&&0!==this.velocity[1]&&(this.stopY(),this.alignToTile()),this.currentRow>t&&this.initMove(r.UP,!0),this.currentRow<t&&this.initMove(r.DOWN,!0),this.updateCurrentPoints()}stopAutoMoving(){this.stopFull(),this.resetAuto(),this.alignToTile(),this.setShapesCollisionGroup(this.originalCollisionGroup)}alignToTile(){this.currentCol&&this.currentRow||this.updateCurrentPoints();let e=this.currentCol*this.worldTileWidth,t=this.currentRow*this.worldTileHeight,a=e-this.position[0],i=t-this.position[1];.01>=Math.abs(a)&&.01>=Math.abs(i)&&(this.position[0]=e,this.position[1]=t)}updateBodyState(){if(!l.hasOwn(this.bodyState,"x")||!l.hasOwn(this.bodyState,"y"))return;if(this.isNotMoving()){this.bodyState.mov=!1;return}let e=l.roundToPrecision(this.position[0],0),t=l.roundToPrecision(this.position[1],0);if(!e||!t)return;this.bodyState.x!==e&&(this.bodyState.x=l.roundToPrecision(e,this.worldPositionPrecision)),this.bodyState.y!==t&&(this.bodyState.y=l.roundToPrecision(t,this.worldPositionPrecision));let a=l.roundToPrecision(this.velocity[0],this.worldSpeedPrecision),i=l.roundToPrecision(this.velocity[1],this.worldSpeedPrecision);this.bodyState.mov=0!==a||0!==i,this.removeInvalidStateBulletBody()}bodyLogKey(){return this.playerId?"PJ-"+this.playerId:this.bodyState?.key}removeInvalidStateBulletBody(){this.isBullet&&(this.isOutOfWorldBounds()||this.hasInvalidSpeed())&&(this.world.removeBodies.push(this),this.bodyStateId&&this.world.removeBulletsStateIds.push(this.bodyStateId))}hasInvalidSpeed(){if(!this.applySpeedThresholdOnBullets&&this.isBullet)return!1;let e=this.isBullet?this.originalSpeed.x:this.movementSpeed,t=this.isBullet?this.originalSpeed.x:this.movementSpeed,a=e*this.speedThreshold,i=t*this.speedThreshold,s=Math.abs(this.velocity[0]);0<s&&s<a&&(o.debug("Invalid speed, stopping X:",{speedX:s,minimumSpeedX:a}),this.stopX(!0));let n=Math.abs(this.velocity[1]);return 0<n&&n<i&&(o.debug("Invalid speed, stopping Y.",{speedY:n,minimumSpeedY:i}),this.stopY(!0)),0===this.velocity[0]&&0===this.velocity[1]}isOutOfWorldBounds(){return 0>this.position[0]||this.position[0]>this.worldWidth*this.worldTileWidth||0>this.position[1]||this.position[1]>this.worldHeight*this.worldTileHeight}isNotMoving(){let e=this.movementSpeed*this.speedThreshold,t=l.roundToPrecision(this.velocity[0]),a=l.roundToPrecision(this.velocity[1]);0!==this.velocity[0]&&Math.abs(t)<e&&(this.position[0]=l.roundToPrecision(this.position[0]+(0<t?1:-1)),this.stopX(!0)),0!==this.velocity[1]&&Math.abs(a)<e&&!this.world.applyGravity&&(this.position[1]=this.position[1]+(0<a?1:-1),this.stopY(!0));let i=l.roundToPrecision(this.position[0],0),s=l.roundToPrecision(this.position[1],0);return this.bodyState.x===i&&this.bodyState.y===s&&0===t&&0===a}resetAuto(){this.autoMoving=!1}initMove(e,t=!1){if(t||this.resetAuto(),this.world)return this.world.allowSimultaneous?void this.simultaneousKeyPressMovement(e):this.singleKeyPressMovement(e)}singleKeyPressMovement(e){e===r.RIGHT&&0===this.velocity[1]&&(this.velocity[0]=this.movementSpeed),e===r.LEFT&&0===this.velocity[1]&&(this.velocity[0]=-this.movementSpeed),e===r.UP&&0===this.velocity[0]&&this.moveUp(this.movementSpeed),e!==r.DOWN||0!==this.velocity[0]||this.world.applyGravity||(this.velocity[1]=this.movementSpeed)}simultaneousKeyPressMovement(e){this.world.applyGravity?(e===r.RIGHT&&(this.validateAndSetDirection(e,this.diagonalHorizontal,this.velocity[1]),this.velocity[0]=this.movementSpeed),e===r.LEFT&&(this.validateAndSetDirection(e,this.diagonalHorizontal,this.velocity[1]),this.velocity[0]=-this.movementSpeed),e===r.UP&&(this.validateAndSetDirection(e,!this.diagonalHorizontal,this.velocity[0]),this.moveUp(this.movementSpeed))):this.simultaneousMovementDiagonalSpeedFix(e,this.movementSpeed)}simultaneousMovementDiagonalSpeedFix(e,t){let a=0===this.velocity[0]?0:0>this.velocity[0]?-1:1,i=0===this.velocity[1]?0:0>this.velocity[1]?-1:1;e===r.RIGHT&&(a=1),e===r.LEFT&&(a=-1),e===r.UP&&(i=-1),e===r.DOWN&&(i=1);let s=this.normalizeSpeed(a,i);this.velocity[0]=t*a*s,this.velocity[1]=t*i*s,(e===r.RIGHT||e===r.LEFT)&&this.validateAndSetDirection(e,this.diagonalHorizontal,this.velocity[1]),(e===r.UP||e===r.DOWN)&&this.validateAndSetDirection(e,!this.diagonalHorizontal,this.velocity[0])}moveUp(e){if(!this.world.applyGravity){this.velocity[1]=-e;return}this.canJump()&&(this.velocity[1]=-this.jumpSpeed,setTimeout(()=>{this.stopY()},this.jumpTimeMs))}calculateMagnitude(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))}checkNonZeroComponents(e,t){return Math.abs(e)>0||Math.abs(t)>0}normalizeSpeed(e,t){return this.checkNonZeroComponents(e,t)?1/this.calculateMagnitude(e,t):0}validateAndSetDirection(e,t,a){(this.animationBasedOnPress||this.bodyState.autoDirection)&&(t||0===a)&&(this.bodyState.dir=e)}stopMove(){this.world&&this.world.applyGravity?this.stopX():this.stopFull()}stopFull(e=!1){this.velocity[0]=0,this.world?.applyGravity||(this.velocity[1]=0),this.angularVelocity=0,this.angularForce=0,this.pStop=e}stopX(e=!1){this.velocity[0]=0,this.angularVelocity=0,this.angularForce=0,this.pStop=e}stopY(e=!1){this.velocity[1]=0,this.angularVelocity=0,this.angularForce=0,this.pStop=e}moveToPoint(e){this.resetAuto(),this.updateCurrentPoints();let t=[this.currentCol,this.currentRow],a=[e.column,e.row],i=this.getPathFinder();return i?(this.autoMoving=i.findPath(t,a),this.autoMoving||(this.setShapesCollisionGroup(this.originalCollisionGroup),this.stopMove()),this.autoMoving):(this.setShapesCollisionGroup(this.originalCollisionGroup),!1)}updateCurrentPoints(){if(!this.world)return;let{currentCol:e,currentRow:t}=this.positionToTiles(this.position[0],this.position[1]);return this.originalCol||(this.originalCol=e),this.originalRow||(this.originalRow=t),this.currentCol=e,this.currentRow=t,this}moveToOriginalPoint(){(this.originalCol&&this.originalRow||this.updateCurrentPoints(),this.disableObjectsCollisionsOnReturn&&this.setShapesCollisionGroup(0),this.stopFull(),0===this.moveToOriginalPointWithDelay)?this.moveToPoint({column:this.originalCol,row:this.originalRow}):this.moveToOriginalPointTimer=setTimeout(()=>{this.moveToPoint({column:this.originalCol,row:this.originalRow})},this.moveToOriginalPointWithDelay)}setShapesCollisionGroup(e){if(this.lastSetCollisionGroup!==e)for(let t of(this.lastSetCollisionGroup=e,this.shapes))t.collisionGroup=e}canJump(){for(let e of this.world.narrowphase.contactEquations){let t=e.bodyA===this?e.bodyA:e.bodyB,a=e.bodyA.isWall?e.bodyA:e.bodyB;if(t.playerId&&0<=Number(Number(t.velocity[1]).toFixed(2))&&a.isWall&&!a.isWorldWall&&t.position[1]<a.position[1])return!0}return!1}positionToTiles(e,t){let a=Math.round((e-this.worldTileWidth/2)/this.worldTileWidth);a=a>=0?a>this.worldWidth?this.worldWidth:a:0;let i=Math.round((t-this.worldTileHeight/2)/this.worldTileHeight);return{currentCol:a,currentRow:i=i>=0?i>this.worldHeight?this.worldHeight:i:0}}getPathFinder(){return this.pathFinder?this.pathFinder:this.world?.pathFinder}get worldTileWidth(){return this.world?.mapJson?.tilewidth}get worldTileHeight(){return this.world?.mapJson?.tileheight}get worldWidth(){return this.world?.mapJson?.width}get worldHeight(){return this.world?.mapJson?.height}}},{"58640466804c3117":"p2","7021c6716e058072":"52yv8",b47ac5fab7662b94:"@reldens/utils"}],jP2Cx:[function(e,t,a,i){let{World:s,Body:n,Box:r}=e("22fc0ec2668b15b0"),{PhysicalBody:o}=e("89b97910eb15282e"),{ObjectBodyState:l}=e("bf8e7d8088ffa02"),{PathFinder:c}=e("ca96e46ea11ece0d"),{TypeDeterminer:d}=e("c264acfd264f5635"),{GameConst:h}=e("c03ca356032f25a2"),{RoomsConst:m}=e("66ecc31a8f2dd920"),{WorldConst:g}=e("2b9afdca425e5d96"),{ErrorManager:u,Logger:p,sc:f}=e("521f0bfcfa0908ee");t.exports.P2world=class extends s{constructor(e){super(e),this.events=f.get(e,"events",!1),this.roomId=f.get(e,"roomId",!1),this.sceneName=f.get(e,"sceneName",!1),this.sceneTiledMapFile=f.get(e,"roomMap",!1),this.config=f.get(e,"config",!1),this.validateRequiredProperties(e),this.saveMapData(e),this.objectsManager=f.get(e,"objectsManager",!1),this.applyGravity=f.get(e.worldConfig,"applyGravity",!1),this.gravity=f.get(e.worldConfig,"gravity",[0,0]),this.globalStiffness=f.get(e.worldConfig,"globalStiffness",1e8),this.globalRelaxation=f.get(e.worldConfig,"globalRelaxation",10),this.useFixedWorldStep=f.get(e.worldConfig,"useFixedWorldStep",!0),this.timeStep=f.get(e.worldConfig,"timeStep",.04),this.maxSubSteps=f.get(e.worldConfig,"maxSubSteps",1),this.movementSpeed=f.get(e.worldConfig,"movementSpeed",180),this.allowPassWallsFromBelow=f.get(e.worldConfig,"allowPassWallsFromBelow",!1),this.jumpSpeed=f.get(e.worldConfig,"jumpSpeed",0),this.jumpTimeMs=f.get(e.worldConfig,"jumpTimeMs",0),this.tryClosestPath=f.get(e.worldConfig,"tryClosestPath",!1),this.onlyWalkable=f.get(e.worldConfig,"onlyWalkable",!1),this.wallsMassValue=f.get(e.worldConfig,"wallsMassValue",1),this.playerMassValue=f.get(e.worldConfig,"playerMassValue",1),this.bulletsStopOnPlayer=f.get(e.worldConfig,"bulletsStopOnPlayer",!0),this.bulletsStopOnObject=f.get(e.worldConfig,"bulletsStopOnObject",!0),this.disableObjectsCollisionsOnChase=f.get(e.worldConfig,"disableObjectsCollisionsOnChase",!1),this.disableObjectsCollisionsOnReturn=f.get(e.worldConfig,"disableObjectsCollisionsOnReturn",!0),this.collisionsGroupsByType=f.get(e.worldConfig,"collisionsGroupsByType",!0),this.groupWallsVertically=f.get(e.worldConfig,"groupWallsVertically",!1),this.groupWallsHorizontally=f.get(e.worldConfig,"groupWallsHorizontally",!1),this.allowSimultaneous=f.get(e,"allowSimultaneous",!1),this.allowChangePoints=f.get(e,"allowChangePoints",!0),this.allowRoomObjectsCreation=f.get(e,"allowRoomObjectsCreation",!0),this.allowBodiesWithState=f.get(e,"allowBodiesWithState",!0),this.usePathFinder=f.get(e,"usePathFinder",!0),this.respawnAreas=!1,this.removeBodies=[],this.removeBulletsStateIds=[],this.type=f.get(e,"type",g.WORLD_TYPES.NO_GRAVITY_2D),this.totalBodiesCount=0,this.totalBodiesCreated=0,this.queueBodies=[],this.enablePathFinder(),this.enableWorldDateTime(),this.worldKey=f.randomChars(16),this.limitsBodyType=f.get(e.worldConfig,"limitsBodyType",n.STATIC),this.wallBodyType=f.get(e.worldConfig,"wallBodyType",n.STATIC),this.changePointsBodyType=f.get(e.worldConfig,"changePointsBodyType",n.STATIC),this.worldObjectBodyType=f.get(e.worldConfig,"worldObjectBodyType",n.DYNAMIC),this.playersBodyType=f.get(e.worldConfig,"playersBodyType",n.DYNAMIC),this.bulletsBodyType=f.get(e.worldConfig,"playersBodyType",n.DYNAMIC),this.bodyTypes={KINEMATIC:n.KINEMATIC,STATIC:n.STATIC,DYNAMIC:n.DYNAMIC},this.typeDeterminer=new d,this.playerAnimationBasedOnPress=this.config.get("client/players/animations/basedOnPress",!1),this.playerAnimationDiagonalHorizontal=this.config.get("client/players/animations/diagonalHorizontal",!1),this.usePlayerSpeedConfig=this.config.get("server/players/physicsBody/usePlayerSpeedConfig",!1)}saveMapData(e){this.mapJson=f.get(e,"mapJson"),!this.mapJson&&f.hasOwn(this.config,"server")&&f.hasOwn(this.config.server,"maps")&&(this.mapJson=f.get(this.config.server.maps,this.sceneTiledMapFile,!1)),this.mapJson||(p.critical('Map "'+this.sceneTiledMapFile+'" not found in server maps.',Object.keys(this.config.server.maps)),u.error('Map "'+this.sceneTiledMapFile+'" not found in server maps.'))}enableWorldDateTime(){this.worldDateTime=new Date,this.worldDateTimeInterval=setInterval(()=>{this.worldDateTime=new Date},1e3)}enablePathFinder(){this.usePathFinder&&(this.pathFinder=new c,this.pathFinder.world=this,this.pathFinder.createGridFromMap())}validateRequiredProperties(e){this.events||u.error("EventsManager undefined in P2world."),this.roomId&&this.sceneName&&this.sceneTiledMapFile||(p.critical("World creation missing data in options.",{roomId:this.roomId,sceneName:this.sceneName,sceneTiledMapFile:this.sceneTiledMapFile}),u.error("World creation missing data in options.")),this.config||u.error("Missing Config Manager.")}async createWorldContent(e){if(!this.validateMapData(this.mapJson))return void p.error("Missing map data.",this.mapJson);this.shouldGroupBodies()||p.warning("Group bodies fully disabled, this can impact performance."),this.changePoints=this.getSceneChangePoints(e);let t=this.mapJson.layers,a=[];for(let e of t){let t={layer:e,world:this};await this.events.emit("reldens.parsingMapLayerBefore",t),a.push(...await this.createLayerContents(t.layer)),await this.events.emit("reldens.parsingMapLayerAfter",t)}for(let e of a){let{layer:t,tileIndex:a,tileW:i,tileH:s,posX:n,posY:r}=e;await this.createRoomObjectBody(t,a,i,s,n,r)}for(let e of(this.processBodiesQueue(),t)){let t={layer:e,world:this};await this.events.emit("reldens.parsingMapLayersAfterBodiesQueue",t)}p.info("Total wall bodies found: "+this.totalBodiesCount,"Total wall bodies created: "+this.totalBodiesCreated)}processBodiesQueue(){for(let e of(this.queueBodies.sort((e,t)=>e.tileIndexes[0]-t.tileIndexes[0]),this.queueBodies))this.addBody(e);this.queueBodies=[]}async createLayerContents(e){let t=this.mapJson.tilewidth,a=this.mapJson.tileheight,i=t/2,s=a/2,n=-1!==e.name.indexOf("change-points"),r=-1!==e.name.indexOf("collisions"),o=[];for(let l=0;l<this.mapJson.width;l++){let c=l*t+i;for(let i=0;i<this.mapJson.height;i++){let d=i*a+s,h=this.tileIndexByRowAndColumn(i,l),m=0===Number(e.data[h]),g=!1,u=!1;!m&&(this.allowChangePoints&&n&&(g=this.createChangePoint(h,t,a,c,d)),r&&(u=this.createWallCollisionBody(h,this.determinePreviousTileIndexFromGroupingType(h,e,i,l),t,a,c,d))),this.usePathFinder&&this.markPathFinderTile(e,m,g,u,l,i),o.push({layer:e,tileIndex:h,tileW:t,tileH:a,posX:c,posY:d})}}return o}determinePreviousTileIndexFromGroupingType(e,t,a,i){return!!this.shouldGroupBodies()&&(this.groupWallsVertically?this.fetchPreviousWallTile(t,a,i):0!==e&&e-1)}fetchPreviousWallTile(e,t,a){if(0===t)return!1;let i=this.tileIndexByRowAndColumn(t-1,a);return 0!==Number(e.data[i])&&i}tileIndexByRowAndColumn(e,t){return e*this.mapJson.width+t}validateMapData(e){return 0<Number(e.width||0)&&0<Number(e.height||0)&&0<Number(e.tilewidth||0)&&0<Number(e.tileheight||0)}async createRoomObjectBody(e,t,a,i,s,n){if(!this.allowRoomObjectsCreation||!this.objectsManager)return;let r=e.name+t,o=this.objectsManager.getObjectData(r);if(o&&!o.multiple)return await this.createWorldObject(o,r,a,i,s,n)}markPathFinderTile(e,t,a,i,s,n){if(!this.pathFinder)return;let r=-1!==e.name.indexOf("pathfinder");(!t&&(a||i)||t&&r)&&this.pathFinder.grid.setWalkableAt(s,n,!1)}createWallCollisionBody(e,t,a,i,s,n){this.totalBodiesCount++;let r=!1!==t&&this.fetchBodyByTileIndexId(t);if(r){let t=r.tileIndexes;if(-1!==t.indexOf(e))return r;t.push(e);let o=this.createWall(this.determineShapeWidth(t,a),this.determineShapeHeight(t,i),this.determineBodyPositionX(r,a,s),this.determineBodyPositionY(r,i,n),this.wallBodyType);return o.tileIndexes=t,o.firstTileIndex=r.firstTileIndex,this.queueBodies.splice(this.queueBodies.indexOf(r),1),this.queueBodies.push(o),o}let o=this.createWall(a,i,s,n,this.wallBodyType);return o.tileIndexes=[e],o.firstTileIndex=e,this.shouldGroupBodies()?this.queueBodies.push(o):this.addBody(o),this.totalBodiesCreated++,o}shouldGroupBodies(){return this.groupWallsVertically||this.groupWallsHorizontally}determineBodyPositionY(e,t,a){return this.groupWallsVertically?e.position[1]+t/2:a}determineBodyPositionX(e,t,a){return this.groupWallsHorizontally?e.position[0]+t/2:a}determineShapeHeight(e,t){return this.groupWallsVertically?e.length*t:t}determineShapeWidth(e,t){return this.groupWallsHorizontally?e.length*t:t}fetchBodyByTileIndexId(e){for(let t of this.queueBodies)if(t.isWall&&t.tileIndexes&&-1!==t.tileIndexes.indexOf(e))return t;return!1}createChangePoint(e,t,a,i,s){let n=f.get(this.changePoints,e,null);if(null===n)return p.error(["Change point data not found in this.changePoints for tileIndex:",e]),!1;let r=this.createCollisionBody(t/2,a/2,i,s,this.changePointsBodyType);return r.changeScenePoint=n,this.addBody(r),p.info("Created change point on tileIndex: "+e),r}async createWorldObject(e,t,a,i,s,n,r=!1){s+=f.get(e,"xFix",0),n+=f.get(e,"yFix",0),e.x=s,e.y=n,this.objectsManager&&f.hasOwn(this.objectsManager.objectsAnimationsData,t)&&(this.objectsManager.objectsAnimationsData[t].x=s,this.objectsManager.objectsAnimationsData[t].y=n),e.interactionArea&&e.setupInteractionArea();let o=f.get(e,"bodyMass",1),l=f.get(e,"collisionResponse",!0),c=!!this.allowBodiesWithState&&f.get(e,"hasState",!1),d=f.get(e,"collisionType",this.worldObjectBodyType),h=f.get(e,"collisionGroup",g.COLLISIONS.OBJECT),m=this.createCollisionBody(a,i,s,n,d,h,o,l,c,t);return m.disableObjectsCollisionsOnChase=this.disableObjectsCollisionsOnChase,m.disableObjectsCollisionsOnReturn=this.disableObjectsCollisionsOnReturn,m.isRoomObject=!0,m.roomObject=e,this.usePathFinder&&r&&(m.pathFinder=r),this.addBody(m),e.state=m.bodyState,e.objectBody=m,p.info("Created object for objectIndex: "+t+" - At x/y: "+s+" / "+n+"."),await this.events.emit("reldens.createdWorldObject",{p2world:this,roomObject:e,bodyObject:m,bodyMass:o,collision:l,hasState:c,objectIndex:t,tileW:a,tileH:i,posX:s,posY:n,pathFinder:r}),e}createLimits(){let e=this.mapJson.tilewidth,t=this.mapJson.tileheight,a=this.mapJson.width*e,i=this.mapJson.height*t,s=a+e,n=i+t,r=this.createWall(s,1,a/2,1,this.limitsBodyType);r.isWorldWall=!0,this.addBody(r);let o=this.createWall(s,1,a/2,i-1,this.limitsBodyType);o.isWorldWall=!0,this.addBody(o);let l=this.createWall(1,n,1,i/2,this.limitsBodyType);l.isWorldWall=!0,this.addBody(l);let c=this.createWall(1,n,a-1,i/2,this.limitsBodyType);c.isWorldWall=!0,this.addBody(c)}createWall(e,t,a,i,s){let n=this.createCollisionBody(e,t,a,i,s,g.COLLISIONS.WALL,this.wallsMassValue);return n.isWall=!0,n}createCollisionBody(e,t,a,i,s,r=g.COLLISIONS.WALL,l=1,c=!0,d=!1,h=!1,m=!1){let u=this.createCollisionShape(e,t,r,c),p=new(d?o:n)({mass:l,position:[a,i],type:s,fixedRotation:!0,movementSpeed:this.movementSpeed,jumpSpeed:this.jumpSpeed,jumpTimeMs:this.jumpTimeMs});return d&&(p.bodyState=this.createBodyState(d,a,i,m,p,h)),p.originalCollisionGroup=r,p.addShape(u),p}createBodyState(e,t,a,i,s,n){return e instanceof o?e:new l({x:t,y:a,dir:i||h.DOWN,scene:this.sceneName,id:s.id,key:n||"",room_id:this.roomId})}createCollisionShape(e,t,a,i=!0,s=0,n=0){let o=new r({width:e,height:t,position:[s,n]});return o.collisionGroup=a,o.collisionMask=this.collisionsGroupsByType[a],o.collisionResponse=i,o}getSceneChangePoints(e){if(!e.changePoints)return{};let t=Object.keys(e.changePoints);if(0===t.length)return{};let a={};for(let i of t){let t=e.changePoints[i];a[t[m.TILE_INDEX]]=t[m.NEXT_SCENE]}return a}createPlayerBody(e){let t=this.createCollisionShape(e.width,e.height,g.COLLISIONS.PLAYER);this.playerMovementSpeed=this.fetchPlayerSpeed(e.speed);let a=new o({mass:this.playerMassValue,position:[e.bodyState.x,e.bodyState.y],type:this.playersBodyType,fixedRotation:!0,animationBasedOnPress:this.playerAnimationBasedOnPress,diagonalHorizontal:this.playerAnimationDiagonalHorizontal,movementSpeed:this.playerMovementSpeed});return a.playerId=e.id,a.collideWorldBounds=!0,a.isChangingScene=!1,a.isBlocked=!1,a.originalCollisionGroup=g.COLLISIONS.PLAYER,a.addShape(t),this.allowBodiesWithState&&(a.bodyState=e.bodyState),this.addBody(a),a}fetchPlayerSpeed(e){let t=this.movementSpeed;if(this.usePlayerSpeedConfig){let a=this.config.get("server/players/physicsBody/speed",e);0<a&&(t=a)}return p.debug("Use movement speed: "+t),t}shootBullet(e,t,a){let{objectWidth:i,objectHeight:s}=a,n=this.mapJson.tileheight/2+s/2,r=this.mapJson.tilewidth/2+i/2,o=e.y+(t.y>e.y?n:-n),l=e.x+(t.x>e.x?r:-r),c=Math.atan2(t.y-o,t.x-l),d=180*c/Math.PI,h=a.key?a.key:"",m=a.magnitude*Math.cos(c),u=a.magnitude*Math.sin(c),f=this.calculateDirection(a,e,t);p.debug('Shooting bullet "'+h+'":',{objectWidth:i,objectHeight:s,bulletY:o,bulletX:l,fromPosition:e,toPosition:t,bulletAngle:d,speedX:m,speedY:u});let y="BULLET_"+this.determineFromType(a),b=this.createCollisionBody(i,s,l,o,this.bulletsBodyType,g.COLLISIONS[y],1,!0,!0,h,f);b.updateMassProperties(),b.roomObject=a,b.hitPriority=a.hitPriority?a.hitPriority:2,b.isRoomObject=!0,b.isBullet=!0,b.key=""===h?"bullet-"+b.id:h,this.addBody(b);let E=h+"_bullet_"+b.id;return b.bodyStateId=E,a.room.state.addBodyToState(b.bodyState,E),b.angle=d,b.originalSpeed={x:m,y:u},b.velocity[0]=m,b.velocity[1]=u,b}determineFromType(e){return this.typeDeterminer.isPlayer(e.owner)?g.FROM_TYPES.PLAYER:this.typeDeterminer.isObject(e.owner)?g.FROM_TYPES.OBJECT:g.FROM_TYPES.OTHER}calculateDirection(e,t,a){return 3===f.get(e,"animDir",!1)?t.x<a.x?h.RIGHT:h.LEFT:t.y<a.y?h.DOWN:h.UP}removeBodiesFromWorld(){if(0!==this.removeBodies.length){for(let e of this.removeBodies)this.removeBody(e);this.removeBodies=[]}}}},{"22fc0ec2668b15b0":"p2","89b97910eb15282e":"dbAT2",bf8e7d8088ffa02:"cXE1L",ca96e46ea11ece0d:"inNP2",c264acfd264f5635:"jouYr",c03ca356032f25a2:"52yv8","66ecc31a8f2dd920":"4NiBt","2b9afdca425e5d96":"94F8H","521f0bfcfa0908ee":"@reldens/utils"}],cXE1L:[function(e,t,a,i){let{type:s}=e("d5ff803566ba0471"),{BodyState:n}=e("f1e1d396ff1578a"),{sc:r}=e("e56fab9f785dc3d1");class o extends n{constructor(e){super(e),this.id=e.id,this.autoDirection=r.get(e,"autoDirection",!0)}}s("number")(o.prototype,"id"),t.exports.ObjectBodyState=o},{d5ff803566ba0471:"@colyseus/schema",f1e1d396ff1578a:"2bHvA",e56fab9f785dc3d1:"@reldens/utils"}],"2bHvA":[function(e,t,a,i){let{Schema:s,type:n}=e("2c66e21e2e92b229"),{GameConst:r}=e("d05ecc5ab6f7e497");class o extends s{constructor(e){super(),this.room_id=e.room_id,this.scene=e.scene,this.key=e.key||"",this.x=parseFloat(e.x),this.y=parseFloat(e.y),this.dir=e.dir,this.mov=!1,this.inState=e.inState||r.STATUS.ACTIVE}sync(e){return this.room_id=e.room_id,this.scene=e.scene,this.key=e.key,this.x=parseFloat(e.x),this.y=parseFloat(e.y),this.dir=e.dir,this.mov=e.mov,this.inState=e.inState,this}}n("number")(o.prototype,"room_id"),n("string")(o.prototype,"scene"),n("string")(o.prototype,"key"),n("number")(o.prototype,"x"),n("number")(o.prototype,"y"),n("string")(o.prototype,"dir"),n("boolean")(o.prototype,"mov"),n("number")(o.prototype,"inState"),t.exports.BodyState=o},{"2c66e21e2e92b229":"@colyseus/schema",d05ecc5ab6f7e497:"52yv8"}],inNP2:[function(e,t,a,i){let{sc:s}=e("33b512ab719d83dc"),{Grid:n,AStarFinder:r}=e("3f2eb1c10ae89300");t.exports.PathFinder=class{constructor(){this.finder=new r,this.world=!1,this.grid=!1,this.bodies={}}createGridFromMap(){this.grid=new n(this.world.mapJson.width+1,this.world.mapJson.height+1)}addBodyToProcess(e){this.bodies[e.id]=e}findPath(e,t){if(this.world.onlyWalkable){let e=!1;try{e=!!s.hasOwn(this.grid,"nodes")&&this.grid.getNodeAt(t[0],t[1])}catch(e){}if(!e||!e.walkable)return!1}let a=this.grid.clone(),i=this.finder.findPath(e[0],e[1],t[0],t[1],a);if(!i.length&&this.world.tryClosestPath){let s=[1,1];e[0]<t[0]&&(s[0]=-1),e[1]<t[1]&&(s[1]=-1);let n=this.world.mapJson.width,r=this.world.mapJson.height,o=t[0]+s[0]>n?t[0]+s[0]:n,l=t[1]+s[1]>r?t[1]+s[1]:r,c=t[0]-s[0]<0?t[0]-s[0]:0,d=t[1]-s[1]<0?t[1]-s[1]:0,h=this.grid.getNodeAt(o,t[1]);h&&!h.walkable&&(h=this.grid.getNodeAt(t[0],l))&&!h.walkable&&(h=this.grid.getNodeAt(o,l))&&!h.walkable&&(h=this.grid.getNodeAt(c,t[1]))&&!h.walkable&&(h=this.grid.getNodeAt(t[0],d))&&!h.walkable&&(h=this.grid.getNodeAt(c,d))&&!h.walkable&&(h=this.grid.getNodeAt(c,l))&&!h.walkable&&(h=this.grid.getNodeAt(o,d)),h&&h.walkable&&(a=this.grid.clone(),i=this.finder.findPath(e[0],e[1],h.x,h.y,a))}return i}}},{"33b512ab719d83dc":"@reldens/utils","3f2eb1c10ae89300":"pathfinding"}],jouYr:[function(e,t,a,i){let{sc:s}=e("3cc70fd383ef5bf2");t.exports.TypeDeterminer=class{isPlayer(e){return s.hasOwn(e,"sessionId")}isObject(e){return s.hasOwn(e,"key")}}},{"3cc70fd383ef5bf2":"@reldens/utils"}],"94F8H":[function(e,t,a,i){t.exports.WorldConst={WORLD_TYPES:{NO_GRAVITY_2D:"NO_GRAVITY_2D",TOP_DOWN_WITH_GRAVITY:"TOP_DOWN_WITH_GRAVITY"},COLLISIONS:{PLAYER:1,OBJECT:2,WALL:4,BULLET_PLAYER:8,BULLET_OBJECT:16,BULLET_OTHER:32,DROP:64},FROM_TYPES:{PLAYER:"PLAYER",OBJECT:"OBJECT",OTHER:"OTHER"}}},{}],aIwMW:[function(e,t,a,i){t.exports.WorldPointsValidator=class{constructor(e,t){this.worldWidth=e,this.worldHeight=t}makeValidPoints(e){return e.column=e.column<0?0:e.column,e.column=e.column>this.worldWidth?this.worldWidth:e.column,e.row=e.row<0?0:e.row,e.row=e.row>this.worldHeight?this.worldHeight:e.row,e}}},{}],"93HfN":[function(e,t,a,i){let{Logger:s,sc:n}=e("a6722c3930f746e5");t.exports.WorldTimer=class{constructor(e){this.clockInstance=n.get(e,"clockInstance",!1),this.callbacks=n.get(e,"callbacks",[]),this.worldTimer={},this.paused=!1,this.lastCallTime=0,this.stepTime=0,this.startedTime=new Date().getTime(),this.currentTime=this.startedTime}startWorldSteps(e){if(!e)return void s.error("World instance invalid.",{world:e});if(this.stepTime=1e3*e.timeStep,this.clockInstance){this.worldTimer=this.clockInstance.setInterval(()=>{this.setIntervalCallback(e)},this.stepTime);return}this.worldTimer=setInterval(()=>{this.setIntervalCallback(e)},this.stepTime)}setIntervalCallback(e){this.paused||(this.currentTime+=this.stepTime,this.stepWorld(e),this.executeCallbacks())}stepWorld(e){e.useFixedWorldStep?e.step(e.timeStep):this.stepWorldWithSubSteps(e)}executeCallbacks(){if(0!==this.callbacks.length)for(let e of this.callbacks)e()}stepWorldWithSubSteps(e){let t=Date.now()/1e3-this.lastCallTime;e.step(e.timeStep,t,e.maxSubSteps)}}},{a6722c3930f746e5:"@reldens/utils"}],"8IuVR":[function(e,t,a,i){let{PlayerEnginePrediction:s}=e("1136bfe444f5b6ae"),{SceneDynamic:n}=e("6c571f7a13283762");t.exports.RoomEventsOverride=class{createCurrentPlayerOverride(e){e.createCurrentPlayer=async(t,a,i)=>{e.engineStarted=!0,await e.startEngineScene(t,e.room,a);let s=e.getActiveScene();if(!e.isValidScene(s,t))return!1;for(let n of(await e.events.emit("reldens.playersQueueBefore",t,i,a,e),Object.keys(e.playersQueue)))s.player.addPlayer(n,e.playersQueue[n]);s.experimentalClientPrediction&&(s.player.positionFromServer=t);let n={player:t,key:i,previousScene:a,roomEvents:e};return await e.events.emit("reldens.createCurrentPlayer",n),n}}playerOnChangeOverride(e){e.playersOnChange=(t,a,i)=>{if(t.state.scene!==e.roomName)return;let s=e.getActiveScene();if(e.playerExists(s,a)){if(s.experimentalClientPrediction&&e.isCurrentPlayer(a)){s.player.positionFromServer=t;return}s.player.updatePlayer(a,t)}}}createSceneInstanceOverride(e){e.createSceneInstance=(e,t,a)=>{let i=new n(e,t,a);return i.experimentalClientPrediction=a.config.get("client/general/engine/experimentalClientPrediction"),i.worldPrediction=!1,i}}createPlayerEngineInstanceOverride(e){e.createPlayerEngineInstance=(e,t,a,i)=>new s({scene:e,playerData:t,gameManager:a,room:i})}}},{"1136bfe444f5b6ae":"fiasS","6c571f7a13283762":"7VRPQ"}],fiasS:[function(e,t,a,i){let{PlayerEngine:s}=e("2d0d26536cbe8ba6"),{GameConst:n}=e("4c7667d873e570ea");t.exports.PlayerEnginePrediction=class extends s{constructor(e){super(e),this.predictionBody=!1,this.positionFromServer=!1;let t=this.gameManager.config.get("client/players/reconciliation/timeOutMs");this.reconciliationTimeOutMs=!1===t?1e3:Number(t)}left(){if("pressed"===this.lastKeyState[n.LEFT])return;let e={dir:n.LEFT};this.lastKeyState[n.LEFT]="pressed",this.predictionBody&&(e.time=this.scene.worldPredictionTimer.currentTime,this.predictionBody.initMove(n.LEFT,!0)),this.roomEvents.send(e)}right(){if("pressed"===this.lastKeyState[n.RIGHT])return;this.lastKeyState[n.RIGHT]="pressed";let e={dir:n.RIGHT};this.predictionBody&&(e.time=this.scene.worldPredictionTimer.currentTime,this.predictionBody.initMove(n.RIGHT,!0)),this.roomEvents.send(e)}up(){if("pressed"===this.lastKeyState[n.UP])return;this.lastKeyState[n.UP]="pressed";let e={dir:n.UP};this.predictionBody&&(e.time=this.scene.worldPredictionTimer.currentTime,this.predictionBody.initMove(n.UP,!0)),this.roomEvents.send(e)}down(){if("pressed"===this.lastKeyState[n.DOWN])return;this.lastKeyState[n.DOWN]="pressed";let e={dir:n.DOWN};this.predictionBody&&(e.time=this.scene.worldPredictionTimer.currentTime,this.predictionBody.initMove(n.DOWN,!0)),this.roomEvents.send(e)}stop(){this.lastKeyState[n.LEFT]="",this.lastKeyState[n.RIGHT]="",this.lastKeyState[n.UP]="",this.lastKeyState[n.DOWN]="";let e={act:n.STOP};this.predictionBody&&(e.time=this.scene.worldPredictionTimer.currentTime,this.reconcilePosition()),this.roomEvents.send(e)}reconcilePosition(){this.predictionBody&&this.positionFromServer&&(this.predictionBody.stopFull(),setTimeout(()=>{this.predictionBody.position[0]=this.positionFromServer.state.x,this.predictionBody.position[1]=this.positionFromServer.state.y,this.predictionBody.dir=this.positionFromServer.state.dir,this.updatePlayer(this.playerId,this.positionFromServer)},this.reconciliationByTimeOutMs()))}reconciliationTimeOutCallBack(){return!1}reconciliationByTimeOutMs(){let e=this.reconciliationTimeOutCallBack();return Number(!1!==e?e:this.reconciliationTimeOutMs)}moveToPointer(e){this.lastKeyState[n.LEFT]="",this.lastKeyState[n.RIGHT]="",this.lastKeyState[n.UP]="",this.lastKeyState[n.DOWN]="";let t={act:n.POINTER,column:e.worldColumn,row:e.worldRow,x:e.worldX-this.leftOff,y:e.worldY-this.topOff};if(this.predictionBody&&this.pointsValidator){this.reconcilePosition();let e=Object.assign({},t);e=this.pointsValidator.makeValidPoints(e),this.predictionBody.moveToPoint(e)}this.roomEvents.send(t)}}},{"2d0d26536cbe8ba6":"4CLBQ","4c7667d873e570ea":"52yv8"}],"2op7t":[function(e,t,a,i){let{PluginInterface:s}=e("3e2556f9927981f8"),{TargetBoxEnricher:n}=e("53d9a911cbdcfbc5"),{TeamMessageListener:r}=e("f6beffb655fa7cb4"),{ClanMessageListener:o}=e("f01b376e357ef11c"),{MessageProcessor:l}=e("a67caf9c691f616d"),{TemplatesHandler:c}=e("caa5a6c6a11fec64"),{TeamsConst:d}=e("54c9661624ae3628"),{Logger:h,sc:m}=e("14e11937ea2c45f4");t.exports.TeamsPlugin=class extends s{setup(e){this.gameManager=m.get(e,"gameManager",!1),this.gameManager||h.error("Game Manager undefined in TeamsPlugin."),this.events=m.get(e,"events",!1),this.events||h.error("EventsManager undefined in TeamsPlugin."),this.teamMessageListener=new r,this.clanMessageListener=new o,this.listenEvents(),this.listenMessages()}listenMessages(){this.gameManager&&this.events&&(this.gameManager.config.client.message.listeners[d.KEY]=this.teamMessageListener,this.gameManager.config.client.message.listeners[d.CLAN_KEY]=this.clanMessageListener)}listenEvents(){this.events&&(this.events.on("reldens.createEngineSceneDone",e=>{let t=e.roomEvents;if(!t)return h.critical("RoomEvents undefined for process Team messages queue on TeamsPlugin.",e),!1;l.processClanMessagesQueue(t,this.clanMessageListener),l.processTeamMessagesQueue(t,this.teamMessageListener)}),this.events.on("reldens.preloadUiScene",e=>{c.preloadTemplates(e)}),this.events.on("reldens.gameEngineShowTarget",(e,t,a,i)=>{n.appendClanInviteButton(this.gameManager,t,a,i),n.appendTeamInviteButton(this.gameManager,t,a,i)}))}fetchTeamPlayerBySessionId(e){let t=this.gameManager.gameEngine.uiScene.currentTeam;if(!t)return!1;for(let a of Object.keys(t)){let i=t[a];if(i.sessionId===e)return i}return!1}}},{"3e2556f9927981f8":"bYb3U","53d9a911cbdcfbc5":"jlWU9",f6beffb655fa7cb4:"7twN9",f01b376e357ef11c:"1qvem",a67caf9c691f616d:"krVsJ",caa5a6c6a11fec64:"PcdGt","54c9661624ae3628":"2XGvU","14e11937ea2c45f4":"@reldens/utils"}],jlWU9:[function(e,t,a,i){let{TeamsConst:s}=e("9a43cebf087570eb"),{GameConst:n}=e("bbfee0e632b58d31"),{Logger:r,sc:o}=e("bd3cd78fd8a3265c");t.exports.TargetBoxEnricher=class{static appendClanInviteButton(e,t,a,i){let s=e?.gameEngine?.uiScene?.currentClan;if(!s)return!1;if(!s.ownerId)return r.error("Current clan missing owner.",s),!1;if(this.playerBySessionId(s,t.id))return!1;let n=e.getCurrentPlayer();if(!this.targetIsValidPlayer(t,n))return!1;let o=e.config.getWithoutLogs("client/clan/general/openInvites",!1);return(e.playerData.id.toString()===s.ownerId.toString()||!!o)&&this.appendInviteButton("clan",t,e,i)}static appendTeamInviteButton(e,t,a,i){return!(!this.targetIsValidPlayer(t,e.getCurrentPlayer())||e.getFeature("teams").fetchTeamPlayerBySessionId(t.id))&&this.appendInviteButton("team",t,e,i)}static appendInviteButton(e,t,a,i){let n=a.gameEngine.uiScene;if(!1===o.get(n,"uiTarget",!1))return r.critical('Missing "uiTarget" on uiScene.'),!1;let l=n.cache.html.get(e+"PlayerInvite");if(!l)return r.critical('Template "'+e+'PlayerInvite" not found.'),!1;a.gameDom.appendToElement("#target-container",a.gameEngine.parseTemplate(l,{playerName:i,playerId:t.player_id,inviteLabel:a.config.getWithoutLogs(e+"/labels/inviteLabel",s.LABELS[e.toUpperCase()].INVITE_BUTTON_LABEL)}));let c=a.gameDom.getElement("."+e+"-invite-"+t.player_id+" button");c?.addEventListener("click",()=>{let i={act:s.ACTIONS[e.toUpperCase()+"_INVITE"],id:t.player_id};a.activeRoomEvents.send(i),c.style.display="none",a.gameEngine.clearTarget()})}static targetIsValidPlayer(e,t){return n.TYPE_PLAYER===e.type&&t.playerId!==e.id}static playerBySessionId(e,t){let a=Object.keys(e.players);if(0===a.length)return!1;for(let i of a)if(e.players[i].sessionId===t)return e.players[i];return!1}}},{"9a43cebf087570eb":"2XGvU",bbfee0e632b58d31:"52yv8",bd3cd78fd8a3265c:"@reldens/utils"}],"2XGvU":[function(e,t,a,i){let s="cln.";t.exports.TeamsConst={KEY:"teams",CLAN_KEY:"clan",TEAM_PREF:"tm.",CLAN_PREF:s,NAME_LIMIT:50,CLAN_STARTING_POINTS:1,VALIDATION:{SUCCESS:1,NAME_EXISTS:2,LEVEL_ISSUE:3,CREATE_ERROR:4,CREATE_OWNER_ERROR:5},ACTIONS:{TEAM_INVITE:"tm.inv",TEAM_ACCEPTED:"tm.acp",TEAM_LEAVE:"tm.lev",TEAM_UPDATE:"tm.upd",TEAM_LEFT:"tm.lef",TEAM_REMOVE:"tm.rem",CLAN_INITIALIZE:s+"ini",CLAN_CREATE:s+"new",CLAN_INVITE:s+"inv",CLAN_ACCEPTED:s+"acp",CLAN_LEAVE:s+"lev",CLAN_UPDATE:s+"upd",CLAN_LEFT:s+"lef",CLAN_REMOVE:s+"rem",CLAN_REMOVED:s+"remd",CLAN_NAME:s+"nam"},LABELS:{TEAM:{INVITE_BUTTON_LABEL:"Team - Invite",REQUEST_FROM:"Accept team request from:",LEADER_NAME_TITLE:"Team leader: %leaderName",DISBAND:"Disband Team",LEAVE:"Leave Team",PROPERTY_MAX_VALUE:"/ %propertyMaxValue"},CLAN:{CREATE_CLAN_TITLE:"Clan - Creation",INVITE_BUTTON_LABEL:"Clan - Invite",REQUEST_FROM:"Accept clan request from:",CLAN_TITLE:"Clan: %clanName - Leader: %leaderName",NAME_PLACEHOLDER:"Choose a clan name...",CREATE:"Create",DISBAND:"Disband Clan",LEAVE:"Leave Clan",PROPERTY_MAX_VALUE:"/ %propertyMaxValue",PLAYERS_TITLE:"Connected Players:",MEMBERS_TITLE:"Clan Members:",NONE_CONNECTED:"None"}},CHAT:{MESSAGE:{INVITE_ACCEPTED:"%playerName has accepted your invitation.",INVITE_REJECTED:"%playerName has rejected your invitation.",DISBANDED:"%playerName has disbanded the %groupName.",LEFT:"You left the %groupName.",LEAVE:"%playerName has left the %groupName.",REMOVED:"%playerName has been removed from the %groupName.",ENTER:"%playerName has enter the %groupName.",NOT_ENOUGH_PLAYERS:"The team was disbanded due to a lack of players."}}}},{}],"7twN9":[function(e,t,a,i){let{TeamMessageHandler:s}=e("701caf09958e43e6"),{TeamsConst:n}=e("c9b7a4a3fab62382"),{Logger:r,sc:o}=e("bd7025df5510cd1f");t.exports.TeamMessageListener=class{async executeClientMessageActions(e){let t=o.get(e,"message",!1);if(!t)return r.error("Missing message data on TeamMessageListener.",e),!1;let a=o.get(e,"roomEvents",!1);if(!a)return r.error("Missing RoomEvents on TeamMessageListener.",e),!1;let i=new s({roomEvents:a,message:t});return i.validate()?!!this.isTeamMessage(t)&&this.handleTeamMessage(t,i):(this.isTeamMessage(t)&&(a.teamMessagesQueue||(a.teamMessagesQueue=[]),a.teamMessagesQueue.push(t)),r.error("Invalid TeamMessageHandler",i),!1)}handleTeamMessage(e,t){return n.ACTIONS.TEAM_INVITE===e.act?t.showTeamRequest():n.ACTIONS.TEAM_UPDATE===e.act?t.showTeamBox():n.ACTIONS.TEAM_LEFT!==e.act||t.removeTeamUi()}isTeamMessage(e){return 0===e.act?.indexOf(n.TEAM_PREF)}}},{"701caf09958e43e6":"7oaOv",c9b7a4a3fab62382:"2XGvU",bd7025df5510cd1f:"@reldens/utils"}],"7oaOv":[function(e,t,a,i){let{UserInterface:s}=e("62989ba9fe821287"),{TeamsConst:n}=e("d105b19ae5b508c7"),{Logger:r,sc:o}=e("77cc951811551deb");t.exports.TeamMessageHandler=class{constructor(e){this.roomEvents=o.get(e,"roomEvents",!1),this.message=o.get(e,"message",!1),this.gameManager=this.roomEvents?.gameManager,this.gameDom=this.gameManager?.gameDom,this.uiScene=this.gameManager?.gameEngine?.uiScene}validate(){return this.roomEvents?this.message?this.gameManager?this.uiScene:(r.info("Missing GameManager on TeamMessageHandler."),!1):(r.info("Missing message on TeamMessageHandler."),!1):(r.info("Missing RoomEvents on TeamMessageHandler."),!1)}showTeamRequest(){this.createTeamUi(this.teamUiKey()),this.roomEvents.initUi({id:this.teamUiKey(),title:this.gameManager.config.getWithoutLogs("client/team/labels/requestFromTitle",n.LABELS.TEAM.REQUEST_FROM),content:this.message.from,options:this.gameManager.config.get("client/ui/options/acceptOrDecline"),overrideSendOptions:{act:n.ACTIONS.TEAM_ACCEPTED,id:this.message.id}}),this.gameDom.getElement("#opt-1-"+this.teamUiKey())?.addEventListener("click",()=>{this.gameDom.removeElement(".team-invite")}),this.gameDom.getElement("#opt-2-"+this.teamUiKey())?.addEventListener("click",()=>{this.removeTeamUi()})}removeTeamUi(){let e=this.gameManager.getUiElement(this.teamUiKey());if(!e)return r.error('UI Element not found by team UI key "'+this.teamUiKey()+'".'),!1;e.removeElement(),delete this.uiScene.userInterfaces[this.teamUiKey()],delete this.uiScene.elementsUi[this.teamUiKey()],this.uiScene.currentTeam=!1}teamUiKey(){return n.KEY+this.message.id}showTeamBox(){let e=this.teamUiKey();this.createTeamUi(e);let t=this.gameManager.config.getWithoutLogs("client/team/labels/leaderNameTitle",n.LABELS.TEAM.LEADER_NAME_TITLE).replace("%leaderName",this.message.leaderName),a=this.gameManager.gameDom.getElement("#box-"+e+" .box-content");if(!a)return r.error('Missing container: "#box-'+e+' .box-content".'),!1;let i=this.uiScene.elementsUi[e];this.roomEvents.uiSetTitle(i,{title:t}),this.roomEvents.uiSetContent(i,{content:""},this.uiScene);let s=o.get(this.message,"players",!1);this.uiScene.currentTeam=s,this.updateTeamBox(s,a)}createTeamUi(e){let t=o.get(this.uiScene.userInterfaces,e);return t||(this.uiScene.userInterfaces||(this.uiScene.userInterfaces={}),this.uiScene.userInterfaces[e]=new s(this.gameManager,{id:e,type:n.KEY,defaultOpen:!0,defaultClose:!0},"/assets/features/teams/templates/ui-teams.html",n.KEY),this.uiScene.userInterfaces[e].createUiElement(this.uiScene,n.KEY),this.uiScene.userInterfaces[e])}updateTeamBox(e,t){if(!e)return void r.error("Players not defined.",e);let a="";for(let t of Object.keys(e))a+=this.createTeamMemberBox(e[t]);t.innerHTML=this.createTeamContainer(a),this.activateTeamPlayerActions(e),this.activateTeamLeaveButtonAction()}createTeamContainer(e){let t=this.uiScene.cache.html.get("teamContainer");if(!t)return r.error('Missing template "teamContainer".'),"";let a=this.gameManager.playerData.id.toString(),i=a===this.message.id.toString(),s="client/team/labels/",o=i?this.gameManager.config.getWithoutLogs(s+"disbandLabel",n.LABELS.TEAM.DISBAND):this.gameManager.config.getWithoutLogs(s+"leaveLabel",n.LABELS.TEAM.LEAVE),l={teamId:this.message.id,playerId:a,leaveActionLabel:o,teamMembers:e};return this.gameManager.gameEngine.parseTemplate(t,l)}activateTeamLeaveButtonAction(){let e=this.gameManager.gameDom.getElement(".leave-"+this.gameManager.playerData.id.toString());e?.addEventListener("click",()=>{this.roomEvents.send({act:n.ACTIONS.TEAM_LEAVE,id:this.message.id})})}createTeamMemberBox(e){let t=this.uiScene.cache.html.get("teamPlayerData");if(!t)return r.error('Missing template "teamPlayerData".'),"";let a=this.gameManager.playerData.id.toString()===this.message.id.toString();return this.gameManager.gameEngine.parseTemplate(t,{playerId:e.player_id,playerName:e.name,playerProperties:this.createSharedPropertiesContent(e.sharedProperties),playerRemove:a?this.createDismissPlayerButton(e):""})}createDismissPlayerButton(e){let t=this.uiScene.cache.html.get("teamRemove");return t?this.gameManager.gameEngine.parseTemplate(t,{playerId:e.player_id}):(r.error('Missing template "teamRemove".'),"")}createSharedPropertiesContent(e){let t=this.uiScene.cache.html.get("teamsSharedProperty");if(!t)return r.error('Missing template "teamsSharedProperty".'),"";let a="";for(let i of Object.keys(e)){t=this.uiScene.cache.html.get("teamsSharedProperty");let s=e[i],r=o.get(s,"max","");""!==r&&(r=this.gameManager.config.getWithoutLogs("client/team/labels/propertyMaxValue",n.LABELS.TEAM.PROPERTY_MAX_VALUE).replace("%propertyMaxValue",r)),a+=this.gameManager.gameEngine.parseTemplate(t,{key:i,label:s.label,value:s.value,max:r})}return a}activateTeamPlayerActions(e){for(let t of Object.keys(e)){let a=e[t],i=".team-player-"+a.player_id+" .player-name";this.gameDom.getElement(i)?.addEventListener("click",()=>{this.gameManager.getCurrentPlayer().setTargetPlayerById(a.sessionId)});let s=".team-player-"+a.player_id+" .properties-list-container";this.gameDom.getElement(s)?.addEventListener("click",()=>{this.gameManager.getCurrentPlayer().setTargetPlayerById(a.sessionId)});let r=".team-player-"+a.player_id+" .team-remove-button";this.gameDom.getElement(r)?.addEventListener("click",()=>{this.roomEvents.send({act:n.ACTIONS.TEAM_REMOVE,id:this.message.id,remove:a.player_id})})}}}},{"62989ba9fe821287":"e9cEC",d105b19ae5b508c7:"2XGvU","77cc951811551deb":"@reldens/utils"}],"1qvem":[function(e,t,a,i){let{ClanMessageHandler:s}=e("59d0db5e0ce1f07e"),{TeamsConst:n}=e("1efeeb2c14500588"),{Logger:r,sc:o}=e("64e6154f69b290dc");t.exports.ClanMessageListener=class{async executeClientMessageActions(e){let t=o.get(e,"message",!1);if(!t)return r.error("Missing message data on ClanMessageListener.",e),!1;let a=o.get(e,"roomEvents",!1);if(!a)return r.error("Missing RoomEvents on ClanMessageListener.",e),!1;let i=new s({roomEvents:a,message:t});return i.validate()?!!this.isClanMessage(t)&&this.handleClanMessage(t,i):(this.isClanMessage(t)&&(a.clanMessagesQueue||(a.clanMessagesQueue=[]),a.clanMessagesQueue.push(t)),!1)}handleClanMessage(e,t){return n.ACTIONS.CLAN_INITIALIZE===e.act?t.initializeClanUi():n.ACTIONS.CLAN_CREATE===e.act?n.VALIDATION.SUCCESS===e.result?t.showNewClan():t.initializeClanUi():n.ACTIONS.CLAN_INVITE===e.act?t.showClanRequest():n.ACTIONS.CLAN_UPDATE===e.act?t.showClanBox():n.ACTIONS.CLAN_LEFT===e.act?t.removeClanUi():!n.ACTIONS.CLAN_REMOVED||(t.removeClanUi(),t.initializeClanUi())}isClanMessage(e){return 0===e.act?.indexOf(n.CLAN_PREF)}}},{"59d0db5e0ce1f07e":"cH3B9","1efeeb2c14500588":"2XGvU","64e6154f69b290dc":"@reldens/utils"}],cH3B9:[function(e,t,a,i){let{UserInterface:s}=e("9d187b52307fde77"),{TeamsConst:n}=e("341f5c6f882a14b2"),{Logger:r,sc:o}=e("e2c8e2f4e3b71ead");t.exports.ClanMessageHandler=class{constructor(e){this.roomEvents=o.get(e,"roomEvents",!1),this.message=o.get(e,"message",!1),this.gameManager=this.roomEvents?.gameManager,this.gameDom=this.gameManager?.gameDom,this.uiScene=this.gameManager?.gameEngine?.uiScene}validate(){return this.roomEvents?this.message?this.gameManager?!!this.uiScene&&this.gameManager.playerData?.id:(r.info("Missing GameManager on ClanMessageHandler."),!1):(r.info("Missing message on ClanMessageHandler."),!1):(r.info("Missing RoomEvents on ClanMessageHandler."),!1)}initializeClanUi(){this.uiScene.currentClan=!1;let e=this.createClanUi(),t=this.gameManager.config.getWithoutLogs("client/clan/labels/createClanTitle",n.LABELS.CLAN.CREATE_CLAN_TITLE),a=this.gameManager.gameDom.getElement(".clan-dialog-box .box-content");if(!a)return r.error('Missing container: "#box-clan .box-content".'),!1;let i=this.uiScene.elementsUi[n.CLAN_KEY];if(!i)return r.error("Clan UI box not found.",{clanUi:e,container:a,uiBox:i}),!1;this.roomEvents.uiSetTitle(i,{title:t}),this.roomEvents.uiSetContent(i,{content:this.createClanContent()},this.uiScene),this.activateCreateButton(),this.addAndRemoveCaptureKeys()}showNewClan(){let e=this.createClanUi(),t=this.gameManager.config.getWithoutLogs("client/clan/labels/clanTitle",n.LABELS.CLAN.CLAN_TITLE).replace("%clanName",this.message.clanName).replace("%leaderName",this.gameManager.currentPlayerName()),a=this.gameManager.gameDom.getElement(".clan-dialog-box .box-content");if(!a)return r.error('Missing container: ".clan-dialog-box .box-content".'),!1;let i=this.uiScene.elementsUi[n.CLAN_KEY];if(!i)return r.error("Clan UI box not found.",{clanUi:e,container:a,uiBox:i}),!1;this.roomEvents.uiSetTitle(i,{title:t}),this.roomEvents.uiSetContent(i,{content:""},this.uiScene),this.updateClanBox(a),this.setClanFromMessage()}showClanRequest(){this.createClanUi(),this.roomEvents.initUi({id:n.CLAN_KEY,title:this.gameManager.config.getWithoutLogs("client/clan/labels/requestFromTitle",n.LABELS.CLAN.REQUEST_FROM),content:this.message.from,options:this.gameManager.config.get("client/ui/options/acceptOrDecline"),overrideSendOptions:{act:n.ACTIONS.CLAN_ACCEPTED,id:this.message.id}}),this.gameDom.getElement("#opt-2-clan")?.addEventListener("click",()=>{this.initializeClanUi()})}showClanBox(){this.createClanUi();let e=this.gameManager.config.getWithoutLogs("client/clan/labels/clanTitle",n.LABELS.CLAN.CLAN_TITLE).replace("%clanName",this.message.clanName).replace("%leaderName",this.message.leaderName),t=this.gameManager.gameDom.getElement("#box-clan .box-content");if(!t)return r.error('Missing container: "#box-clan .box-content".'),!1;let a=this.uiScene.elementsUi[n.CLAN_KEY];this.roomEvents.uiSetTitle(a,{title:e}),this.roomEvents.uiSetContent(a,{content:""},this.uiScene),this.setClanFromMessage(),this.updateClanBox(t)}setClanFromMessage(){let e=o.get(this.message,"players",!1),t=o.get(this.message,"members",!1);this.uiScene.currentClan={id:this.message.id,name:this.message.clanName,leader:this.message.leaderName,ownerId:this.message.ownerId,players:e,members:t}}removeClanUi(){let e=this.gameManager.getUiElement(n.CLAN_KEY);if(!e)return r.error("Clan UI Element not found for remove."),!1;e.removeElement(),delete this.uiScene.userInterfaces[n.CLAN_KEY],delete this.uiScene.elementsUi[n.CLAN_KEY]}createClanUi(){let e=o.get(this.uiScene.userInterfaces,n.CLAN_KEY);return e||(this.uiScene.userInterfaces||(this.uiScene.userInterfaces={}),this.uiScene.userInterfaces[n.CLAN_KEY]=new s(this.gameManager,{id:n.CLAN_KEY,type:n.CLAN_KEY,defaultOpen:!0,defaultClose:!0},"/assets/features/teams/templates/ui-clan.html",n.CLAN_KEY),this.uiScene.userInterfaces[n.CLAN_KEY].createUiElement(this.uiScene,n.CLAN_KEY),this.uiScene.userInterfaces[n.CLAN_KEY])}createClanContent(){let e=this.uiScene.cache.html.get("clanCreate");if(!e)return r.error('Missing template "clanCreate".'),"";let t={playerId:this.gameManager.playerData.id.toString(),createLabel:this.gameManager.config.getWithoutLogs("client/clan/labels/createLabel",n.LABELS.CLAN.CREATE),clanNamePlaceholder:this.gameManager.config.getWithoutLogs("client/clan/labels/namePlaceholder",n.LABELS.CLAN.NAME_PLACEHOLDER)};return this.gameManager.gameEngine.parseTemplate(e,t)}activateCreateButton(){let e=this.gameManager.gameDom.getElement(".clan-dialog-box .submit-clan-create");if(!e)return r.warning('Clan create button not found by ".clan-dialog-box .clan-create".'),!1;let t=this.gameManager.gameDom.getElement(".clan-dialog-box .clan-name-input");if(!t)return r.warning('Clan create button not found by ".clan-dialog-box .clan-name-input".'),!1;e.addEventListener("click",()=>{if(0===t.value.length)return!1;this.gameManager.gameDom.updateContent(".clan-dialog-box .box-content",this.uiScene.cache.html.get("uiLoading")),this.gameManager.activeRoomEvents.send({act:n.ACTIONS.CLAN_CREATE,[n.ACTIONS.CLAN_NAME]:t.value})})}updateClanBox(e){let t=o.get(this.message,"players",[]),a=Object.keys(t),i=0===a.length?this.gameManager.config.getWithoutLogs("client/clan/labels/noneConnected",n.LABELS.CLAN.NONE_CONNECTED):"";for(let e of a)i+=this.createClanPlayerBox(t[e]);let s=this.gameManager.playerData.id.toString()===this.message.ownerId.toString(),r=o.get(this.message,"members",[]),l="";for(let e of Object.keys(r))l+=this.createClanMemberBox(r[e],s);e.innerHTML=this.createClanContainer(i,l),this.activateClanPlayersActions(t),this.activateClanMembersActions(r),this.activateClanLeaveButtonAction()}addAndRemoveCaptureKeys(){let e=this.gameManager.getActiveScene(),t=e.availableControllersKeyCodes(),a=this.gameManager.gameDom.getElement(".clan-name-input");e.addAndRemoveCapture(t,a)}createClanContainer(e,t){let a=this.uiScene.cache.html.get("clanContainer");if(!a)return r.error('Missing template "clanContainer".'),"";let i=this.gameManager.playerData.id.toString()===this.message.ownerId.toString()?this.gameManager.config.getWithoutLogs("client/clan/labels/disbandLabel",n.LABELS.CLAN.DISBAND):this.gameManager.config.getWithoutLogs("client/clan/labels/leaveLabel",n.LABELS.CLAN.LEAVE),s={clanId:this.message.id,playerId:this.gameManager.playerData.id.toString(),leaveActionLabel:i,clanPlayersTitle:this.gameManager.config.getWithoutLogs("client/clan/labels/clanPlayersTitle",n.LABELS.CLAN.PLAYERS_TITLE),clanPlayers:e,clanMembersTitle:this.gameManager.config.getWithoutLogs("client/clan/labels/clanMembersTitle",n.LABELS.CLAN.MEMBERS_TITLE),clanMembers:t};return this.gameManager.gameEngine.parseTemplate(a,s)}activateClanLeaveButtonAction(){let e=this.gameManager.gameDom.getElement(".leave-"+this.message.id);e?.addEventListener("click",()=>{let e={act:n.ACTIONS.CLAN_LEAVE,id:this.message.id};this.gameManager.activeRoomEvents.send(e)})}createClanPlayerBox(e){let t=this.uiScene.cache.html.get("clanPlayerData");return t?this.gameManager.gameEngine.parseTemplate(t,{playerId:e.player_id,playerName:e.name,playerProperties:this.createSharedPropertiesContent(e.sharedProperties)}):(r.error('Missing template "clanPlayerData".'),"")}createClanMemberBox(e,t){let a=this.uiScene.cache.html.get("clanMemberData");if(!a)return r.error('Missing template "clanMemberData".'),"";let i=e.id.toString()!==this.message.ownerId.toString();return this.gameManager.gameEngine.parseTemplate(a,{playerId:e.id.toString(),playerName:e.name,clanRemove:t&&i?this.createDismissPlayerButton(e):""})}createDismissPlayerButton(e){let t=this.uiScene.cache.html.get("clanRemove");return t?this.gameManager.gameEngine.parseTemplate(t,{playerId:e.id.toString()}):(r.error('Missing template "clanRemove".'),"")}createSharedPropertiesContent(e){let t=this.uiScene.cache.html.get("teamsSharedProperty");if(!t)return r.error('Missing template "teamsSharedProperty".'),"";let a="";for(let i of Object.keys(e)){t=this.uiScene.cache.html.get("teamsSharedProperty");let s=e[i],r=o.get(s,"max","");""!==r&&(r=this.gameManager.config.getWithoutLogs("client/clan/labels/propertyMaxValue",n.LABELS.CLAN.PROPERTY_MAX_VALUE).replace("%propertyMaxValue",r)),a+=this.gameManager.gameEngine.parseTemplate(t,{key:i,label:s.label,value:s.value,max:r})}return a}activateClanPlayersActions(e){for(let t of Object.keys(e)){let a=e[t],i=".clan-player-"+t+" .player-name",s=".clan-player-"+t+" .properties-list-container",n=this.gameDom.getElement(i);n||r.notice("Player name element not found.",i),n?.addEventListener("click",()=>{this.gameManager.getCurrentPlayer().setTargetPlayerById(a.sessionId)});let o=this.gameDom.getElement(s);n||r.notice("Player properties element not found.",s),o?.addEventListener("click",()=>{this.gameManager.getCurrentPlayer().setTargetPlayerById(a.sessionId)})}}activateClanMembersActions(e){for(let t of Object.keys(e)){let a=e[t],i=".clan-member-"+a.id+" .clan-remove-button";this.gameDom.getElement(i)?.addEventListener("click",()=>{this.gameManager.activeRoomEvents.send({act:n.ACTIONS.CLAN_REMOVE,id:this.message.id,remove:a.id})})}}}},{"9d187b52307fde77":"e9cEC","341f5c6f882a14b2":"2XGvU",e2c8e2f4e3b71ead:"@reldens/utils"}],krVsJ:[function(e,t,a,i){let{ClanMessageHandler:s}=e("da134dc7ceb7b0e1"),{TeamMessageHandler:n}=e("5001168d3eb6bb8b"),{sc:r}=e("fbaf401da21f7609");t.exports.MessageProcessor=class{static processClanMessagesQueue(e,t){if(r.isArray(e.clanMessagesQueue)&&0!==e.clanMessagesQueue.length){for(let a of e.clanMessagesQueue)t.handleClanMessage(a,new s({roomEvents:e,message:a}));e.clanMessagesQueue=[]}}static processTeamMessagesQueue(e,t){if(r.isArray(e.teamMessagesQueue)&&0!==e.teamMessagesQueue.length){for(let a of e.teamMessagesQueue)t.handleTeamMessage(a,new n({roomEvents:e,message:a}));e.teamMessagesQueue=[]}}}},{da134dc7ceb7b0e1:"cH3B9","5001168d3eb6bb8b":"7oaOv",fbaf401da21f7609:"@reldens/utils"}],PcdGt:[function(e,t,a,i){let{TeamsConst:s}=e("58174eedacbcbef5");t.exports.TemplatesHandler=class{static preloadTemplates(e){let t="/assets/features/teams/templates/";e.load.html(s.KEY,t+"ui-teams.html"),e.load.html(s.CLAN_KEY,t+"ui-clan.html"),e.load.html("teamPlayerInvite",t+"team-invite.html"),e.load.html("teamPlayerAccept",t+"team-accept.html"),e.load.html("teamRemove",t+"team-remove.html"),e.load.html("teamContainer",t+"team-container.html"),e.load.html("teamPlayerData",t+"team-player-data.html"),e.load.html("clanCreate",t+"clan-create.html"),e.load.html("clanPlayerInvite",t+"clan-invite.html"),e.load.html("clanPlayerAccept",t+"clan-accept.html"),e.load.html("clanRemove",t+"clan-remove.html"),e.load.html("clanContainer",t+"clan-container.html"),e.load.html("clanPlayerData",t+"clan-player-data.html"),e.load.html("clanMemberData",t+"clan-member-data.html"),e.load.html("teamsSharedProperty",t+"shared-property.html")}}},{"58174eedacbcbef5":"2XGvU"}],dxWI2:[function(e,t,a,i){let{Translator:s}=e("e30167c0897ac135"),{SnippetsUi:n}=e("2d33d4d804e9951f"),{TemplatesHandler:r}=e("e956d7a83f618c7f"),{TranslationsMapper:o}=e("3dab08141eaf4d61"),l=e("18b73f134deeadaa"),{SnippetsConst:c}=e("356d0138dc841911"),{PluginInterface:d}=e("f78bfa8e0318b9ca"),{Logger:h,sc:m}=e("520563192e10fe30");t.exports.SnippetsPlugin=class extends d{setup(e){if(this.gameManager=m.get(e,"gameManager",!1),!this.gameManager)return h.error("Game Manager undefined in InventoryPlugin."),!1;this.events=m.get(e,"events",!1),this.events||h.error("EventsManager undefined in InventoryPlugin."),o.forConfig(this.gameManager.config.client,l),this.activeLocale=this.gameManager.initialGameData?.userLocale?.locale.locale||c.DEFAULT_LOCALE,this.gameManager.services.translator=new s({snippets:Object.assign({},this.gameManager.config.client.snippets),dataValues:Object.assign({},this.gameManager.config.client.snippetsDataValues),locale:c.DEFAULT_LOCALE,activeLocale:this.activeLocale}),this.listenEvents()}listenEvents(){if(!this.events)return!1;this.events.on("reldens.startEngineScene",async(e,t,a,i)=>{this.gameManager.services.translator.snippets=Object.assign(this.gameManager.services.translator.snippets,this.gameManager.config.client.snippets)}),this.events.on("reldens.preloadUiScene",e=>{r.preloadTemplates(e)}),this.events.on("reldens.createUiScene",e=>{this.uiManager=new n(e),this.uiManager.createUi()})}}},{e30167c0897ac135:"396lL","2d33d4d804e9951f":"9tlu9",e956d7a83f618c7f:"cdQOC","3dab08141eaf4d61":"bJxKc","18b73f134deeadaa":"kDrZa","356d0138dc841911":"glyi0",f78bfa8e0318b9ca:"bYb3U","520563192e10fe30":"@reldens/utils"}],"396lL":[function(e,t,a,i){let{SnippetsConst:s}=e("b71f11da09eccdde"),{sc:n}=e("62e09c29e13db7ae");t.exports.Translator=class{constructor(e){this.snippets=n.get(e,"snippets",{}),this.dataValues=n.get(e,"dataValues",{}),this.locale=n.get(e,"locale",s.DEFAULT_LOCALE),this.activeLocale=n.get(e,"activeLocale",s.DEFAULT_LOCALE)}translate(e,t={},a=!1){a||(a=this.activeLocale);let i=n.get(this.snippets[a],e,e);if(e===i)return e;if(!n.isObject(t))return i;let s=Object.keys(t);if(0===s.length)return i;let r=this.snippetNameSpace(e);for(let e of s){let a=t[e],s="%"+((this.dataValues[r]||{})[e]||e);for(;-1!==i.indexOf(s);)i=i.replace(s,a)}return i}snippetNameSpace(e){let t=e.split(".");return 1===t.length?s.DATA_VALUES_DEFAULT_NAMESPACE:t[0]}t(e,t={},a=!1){return this.translate(e,t,a)}}},{b71f11da09eccdde:"glyi0","62e09c29e13db7ae":"@reldens/utils"}],"9tlu9":[function(e,t,a,i){let{SnippetsConst:s}=e("aa7de636e8c53e52"),{Logger:n,sc:r}=e("5e6402edf9f7ac34");t.exports.SnippetsUi=class{constructor(e){this.uiScene=e,this.gameManager=this.uiScene.gameManager,this.translator=this.gameManager.services.translator,this.locales={}}createUi(){this.locales=r.get(this.gameManager.config.client,"locales",{});let e=Object.keys(this.locales);if(1>=e.length)return!1;let t=this.gameManager.gameEngine.parseTemplate(this.uiScene.cache.html.get(s.KEY),{snippetsTitle:this.translator.t("translator.title"),snippetsLabel:this.translator.t("translator.label"),snippetsNotification:this.translator.t("translator.notification")});if(!this.gameManager.gameDom.appendToElement("#settings-dynamic",t))return n.warning("Could not append snippets settings."),!1;let a=this.gameManager.gameDom.getElement(".snippets-setting");if(!a)return n.warning("Snippets settings container not available."),!1;for(let t of e){let e=this.locales[t],i=this.gameManager.gameDom.createElement("option");i.value=e.id,i.innerHTML=e.country_code,a.appendChild(i)}a.addEventListener("change",async()=>{this.gameManager.activeRoomEvents.send({act:s.ACTIONS.UPDATE,up:a.value})})}}},{aa7de636e8c53e52:"glyi0","5e6402edf9f7ac34":"@reldens/utils"}],cdQOC:[function(e,t,a,i){let{SnippetsConst:s}=e("e36cad96ed3e70cd");t.exports.TemplatesHandler=class{static preloadTemplates(e){e.load.html(s.KEY,"/assets/features/snippets/templates/ui-snippets.html")}}},{e36cad96ed3e70cd:"glyi0"}],kDrZa:[function(e,t,a,i){t.exports={translator:{title:"Languages Settings",label:"Choose your language:",notification:"Changes will take place after next login."}}},{}],hjWa4:[function(e,t,a,i){let{MessagesListener:s}=e("888d5cbc978fa0d6"),{SdkHandler:n}=e("c62ae531dc47df64"),{ProvidersList:r}=e("817954c8ae5bd30f"),o=e("3b2b9c9a21730037"),{TranslationsMapper:l}=e("8e1bd14e8842dbbb"),{AdsConst:c}=e("34045a03c82a6a52"),{PluginInterface:d}=e("b837e866da6d66e2"),{Logger:h,sc:m}=e("f840b20eea122e5a");t.exports.AdsPlugin=class extends d{setup(e){this.gameManager=m.get(e,"gameManager",!1),this.gameManager||h.error("Game Manager undefined in AdsPlugin."),this.events=m.get(e,"events",!1),this.events||h.error("EventsManager undefined in AdsPlugin."),this.config={},this.activeProviders={},this.playedAds=null,this.setConfig(),this.setSkdHandler(),this.fetchActiveProviders(),this.setTranslations(),this.listenEvents()}setConfig(){this.config=!!this.gameManager&&this.gameManager.config.get("client/ads/general",{})}setSkdHandler(){let e=this.gameManager?.gameDom;this.sdkHandler=!!e&&new n({gameDom:e,config:this.config})}fetchActiveProviders(){let e=m.get(this.config,"providers",{}),t=Object.keys(e);if(0===t.length)return!1;for(let a of t){let t=e[a];t.enabled&&(t.classDefinition=m.get(r,a,!1),this.activeProviders[a]=t)}}setTranslations(){if(!this.gameManager)return!1;l.forConfig(this.gameManager.config.client,o,c.MESSAGE.DATA_VALUES)}listenEvents(){if(!this.events||!this.gameManager||!this.sdkHandler)return h.error("Missing properties for AdsPlugin."),!1;this.events.on("reldens.beforeCreateEngine",async(e,t)=>{this.sdkHandler?await this.sdkHandler.setupProvidersSdk(this.activeProviders,t):h.info("Undefined SDK Handler.")}),this.events.on("reldens.joinedRoom",async e=>{await s.listenMessages(e,this)})}}},{"888d5cbc978fa0d6":"5HJBO",c62ae531dc47df64:"f4YQ2","817954c8ae5bd30f":"5Tjwm","3b2b9c9a21730037":"am5Fm","8e1bd14e8842dbbb":"bJxKc","34045a03c82a6a52":"1ixNn",b837e866da6d66e2:"bYb3U",f840b20eea122e5a:"@reldens/utils"}],"5HJBO":[function(e,t,a,i){let{AdsConst:s}=e("29cd206e54f27180"),{Logger:n}=e("444002dbc8b0c3f6");t.exports.MessagesListener=class{static async listenMessages(e,t){e.onMessage("*",e=>{if(s.ACTIONS.ADS_PLAYED!==e.act)return!1;if(t.playedAds={},!e.playedAdsModels)return n.info("None played ads.",e),!1;for(let a of e.playedAdsModels)t.playedAds[a.ads_id]=a;return!0})}}},{"29cd206e54f27180":"1ixNn","444002dbc8b0c3f6":"@reldens/utils"}],"1ixNn":[function(e,t,a,i){t.exports.AdsConst={ENVIRONMENTS:{DISABLED:"disabled"},ADS_TYPES:{EVENT_VIDEO:"eventVideo",BANNER:"banner"},ACTIONS:{ADS_PLAYED:"adsP",AD_STARTED:"adS",AD_ENDED:"adE"},MESSAGE:{DATA_VALUES:{NAMESPACE:"ads"}},AWAIT_ADS_TIME:1e3,VIDEOS_MINIMUM_DURATION:3e3}},{}],f4YQ2:[function(e,t,a,i){let{Logger:s,sc:n}=e("dff6c1e89c3e052a");t.exports.SdkHandler=class{constructor(e){this.gameDom=n.get(e,"gameDom",!1)}async setupProvidersSdk(e,t){if(!this.gameDom)return s.error("Undefined GameDOM on SdkHandler."),!1;if(!n.isObject(e))return!1;let a=Object.keys(e);if(0===a.length)return!1;for(let i of a){let a=e[i];await this.appendSdk(a),await this.activateSdkInstance(a,t),s.info("Activated Ads SDK: "+a.key,a)}}async appendSdk(e){let t=n.get(e,"sdkUrl","");if(""===t)return!1;let a=this.gameDom.getElement("body"),i=this.gameDom.createElement("script");return i.src=t,a.append(i),!0}async activateSdkInstance(e,t){e.classDefinition&&(e.service=new e.classDefinition(e,t,e.activeAds)),n.isFunction(e.service?.activate)&&await e.service.activate()}}},{dff6c1e89c3e052a:"@reldens/utils"}],"5Tjwm":[function(e,t,a,i){let{CrazyGames:s}=e("3f8ed3d61d7ffec6"),{GameMonetize:n}=e("8293bf532f21e603"),{GoogleAdSense:r}=e("ce031fd04ee80412");t.exports.ProvidersList={crazyGames:s,gameMonetize:n,googleAdSense:r}},{"3f8ed3d61d7ffec6":"4qJ6H","8293bf532f21e603":"8MZtw",ce031fd04ee80412:"anL97"}],"4qJ6H":[function(e,t,a,i){let{BannersHandler:s}=e("a9a3d844c8af144f"),{VideosHandler:n}=e("bde738a7c1ada691"),{AdsProvider:r}=e("226c5e70dbcf853"),{AdsConst:o}=e("f244e70172b4d33e"),{Logger:l}=e("676e545998789235");t.exports.CrazyGames=class{constructor(e,t){this.gameManager=t,this.gameDom=t?.gameDom,this.events=t?.events,this.window=t?.gameDom?.getWindow(),this.metaData=e,this.sdk=this.window?.CrazyGames?.SDK,this.retry=0,this.environment=o.ENVIRONMENTS.DISABLED,this.metaData.sdkRetryTime||(this.metaData.sdkRetryTime=500),this.metaData.sdkMaxRetries||(this.metaData.sdkMaxRetries=10),this.metaData.sdkBannerRefreshTime||(this.metaData.sdkBannerRefreshTime=6e4),this.activeAds=this.fetchActiveAds(e);let a={gameManager:t,metaData:e,sdk:this.sdk,hasAdblock:this.hasAdblock,isEnabled:this.isEnabled};this.bannersHandler=new s(a),this.videosHandler=new n(a)}fetchActiveAds(e){return this.gameManager?.config?r.fetchActiveAdsByProviderId(e.id,this.validAdsTypes(),this.gameManager.config.get("client/ads/collection",{})):{}}validAdsTypes(){return[o.ADS_TYPES.BANNER,o.ADS_TYPES.EVENT_VIDEO]}async activate(){return this.sdk?(this.environment=await this.sdk.getEnvironment(),this.bannersHandler.sdk=this.sdk,this.videosHandler.sdk=this.sdk,!await this.hasAdblock()&&void await this.activateAds()):(this.retry===this.metaData.sdkMaxRetries?l.critical("CrazyGames required object."):this.retry<this.metaData.sdkMaxRetries&&setTimeout(()=>{this.retry++,l.info("CrazyGames required object, retry #"+this.retry+"."),this.sdk=this.window?.CrazyGames?.SDK,this.sdk&&l.info("CrazyGames object found."),this.activate()},this.metaData.sdkRetryTime),!1)}async hasAdblock(){try{let e=await this.sdk.ad.hasAdblock();return e&&l.critical("Adblock detected, please disable."),e}catch(e){l.info("SDK detected error.",e)}return!1}async isEnabled(){return o.ENVIRONMENTS.DISABLED!==await this.sdk.getEnvironment()}async activateAds(){let e=Object.keys(this.activeAds);if(0===e.length)return!1;for(let t of e){let e=this.activeAds[t];o.ADS_TYPES.BANNER===e.type.key&&await this.bannersHandler.activateAdBanner(e),o.ADS_TYPES.EVENT_VIDEO===e.type.key&&await this.videosHandler.activateAdVideo(e)}}}},{a9a3d844c8af144f:"HlybS",bde738a7c1ada691:"bMBrg","226c5e70dbcf853":"6RTBS",f244e70172b4d33e:"1ixNn","676e545998789235":"@reldens/utils"}],HlybS:[function(e,t,a,i){let{Validator:s}=e("b20ca8ca1f25148d"),{Logger:n,sc:r}=e("96ec63b9db0e75b5");t.exports.BannersHandler=class{constructor(e){this.gameManager=r.get(e,"gameManager",!1),this.metaData=r.get(e,"metaData",{}),this.gameDom=this.gameManager?.gameDom,this.events=this.gameManager?.events,this.sdk=r.get(e,"sdk",!1),this.hasAdblock=r.get(e,"hasAdblock",!1),this.isEnabled=r.get(e,"isEnabled",!1),this.activeBanners={},this.validator=new s}availableBanners(){return["728x90","300x250","320x50","468x60","320x100"]}availableResponsiveBanners(){return["970x90","320x50","160x600","336x280","728x90","300x600","468x60","970x250","300x250","250x250","120x600"]}validBannerSize(e){return -1!==this.availableBanners().indexOf(e)}validResponsiveBannerSize(e){return -1!==this.availableResponsiveBanners().indexOf(e)}async activateAdBanner(e){if(!e)return n.info("Missing activate ad.",e),!1;if(!this.validator.validate(this))return n.info("Invalid banner."),!1;let t=e.bannerData;if(!t)return n.info("No banner data."),!1;let a=r.get(t,"fullTime",!1),i=r.get(t,"responsive",!1);if(a)return await this.handleBannerType(i,e);let s=r.get(t,"uiReferenceIds",[]);if(0===s.length)return n.warning("Missing banner reference ID."),!1;this.events.on("reldens.openUI",async t=>{if(-1!==s.indexOf("ANY")||-1!==s.indexOf(t.openButton.id)){let a=e.id+"-"+t.openButton.id,s=new Date().getTime(),n=r.get(this.activeBanners,a,!1);if(n&&s<n.createdAt+this.metaData.sdkBannerRefreshTime)return void n.banner.classList.remove("hidden");n&&n.banner.remove();let o=await this.handleBannerType(i,e,a);this.activeBanners[a]={createdAt:s,banner:o}}}),this.events.on("reldens.closeUI",async t=>{let a=e.id+"-"+t.openButton.id,i=r.get(this.activeBanners,a,!1);i&&i.banner.classList.add("hidden")})}async handleBannerType(e,t,a){return e?this.createResponsiveBanner(t,a):await this.createBanner(t,a)}async createBanner(e,t){if(!this.validator.validate(this)||!await this.validator.canBeActivated(this))return!1;if(!this.isEnabled())return n.info("SDK not enabled."),!1;try{let a=r.get(e.styles,"width","300"),i=r.get(e.styles,"height","250");if(!this.validBannerSize(a+"x"+i))return n.info("CrazyGames - Invalid Banner size."),!1;let s=t||e.id;if(!s)return n.info("CrazyGames - Missing container ID.",e,t),!1;let o=this.gameDom.createElement("div","banner-container-"+s);this.gameDom.getElement("body")?.append(o),await this.isEnabled()&&await this.sdk.banner.requestBanner({id:o.id,width:a,height:i});let l=this.mapStylesWithValues(Object.assign({width:a,height:i},e));return this.gameDom.setElementStyles(o,l),o.classList.add("ads-banner-container"),o}catch(e){return n.critical("CrazyGames - Error on banner request.",e),!1}}mapStylesWithValues(e){let t={"z-index":2e8,width:r.get(e,"width",300),height:r.get(e,"height",250),position:""===r.get(e.styles,"position","")?e.position:"absolute"},a=r.get(e.styles,"top",null);null!==a&&(t.top=a);let i=r.get(e.styles,"bottom",null);null!==i&&(t.bottom=i);let s=r.get(e.styles,"left",null);null!==s&&(t.left=s);let n=r.get(e.styles,"right",null);return null!==n&&(t.right=n),t}async createResponsiveBanner(e,t){if(!this.validator.validate(this)||!await this.validator.canBeActivated(this))return!1;if(!this.isEnabled())return n.info("SDK not enabled."),!1;try{let a=t||e.id;if(!a)return n.info("CrazyGames - Missing container ID.",e,t),!1;let i=this.gameDom.createElement("div","responsive-banner-container-"+a),s=this.mapStylesWithValues(e);return delete s.width,delete s.height,this.gameDom.setElementStyles(i,s),this.gameDom.getElement("body").append(i),await this.isEnabled()&&await this.sdk.banner.requestResponsiveBanner(i.id),i.classList.add("ads-banner-container"),i}catch(e){return n.critical("CrazyGames - Error on banner request.",e),!1}}}},{b20ca8ca1f25148d:"7wbJH","96ec63b9db0e75b5":"@reldens/utils"}],"7wbJH":[function(e,t,a,i){let{Logger:s,sc:n}=e("d1a1464fc2cd37e3");t.exports.Validator=class{validate(e){return e.gameManager?e.sdk?(e.hasAdblock&&n.isFunction(e.hasAdblock)||s.warning("Missing or invalid hasAdblock function on Validator.",e),!!e.isEnabled&&!!n.isFunction(e.isEnabled)||(s.error("Missing or invalid isEnabled function on Validator.",e),!1)):(s.error("Missing SDK on Validator.",e),!1):(s.error("Missing Game Manager on Validator.",e),!1)}async canBeActivated(e){return!(!n.isFunction(e.hasAdblock)||await e.hasAdblock())||(s.info("AdBlocker detected."),!1)}}},{d1a1464fc2cd37e3:"@reldens/utils"}],bMBrg:[function(e,t,a,i){let{Validator:s}=e("151dab08c009e34c"),{AdsConst:n}=e("8c1021ea6457f100"),{Logger:r,sc:o}=e("87d6b1e6e69bae6e");t.exports.VideosHandler=class{constructor(e){this.gameManager=o.get(e,"gameManager",!1),this.gameDom=this.gameManager?.gameDom,this.events=this.gameManager?.events,this.sdk=o.get(e,"sdk",!1),this.hasAdblock=o.get(e,"hasAdblock",!1),this.isEnabled=o.get(e,"isEnabled",!1),this.validator=new s,this.isPlayingAd=!1,this.setConfig()}setConfig(){this.videoMinimumDuration=this.gameManager?this.gameManager.config.getWithoutLogs("client/ads/general/providers/crazyGames/videoMinimumDuration",n.VIDEOS_MINIMUM_DURATION):n.VIDEOS_MINIMUM_DURATION,this.awaitAdsTime=this.gameManager?this.gameManager.config.getWithoutLogs("client/ads/general/providers/crazyGames/awaitAdsTime",n.AWAIT_ADS_TIME):n.AWAIT_ADS_TIME}async activateAdVideo(e){let t=o.get(e,"eventKey",!1);if(!t)return r.warning("Missing event key.",e),!1;this.events.on(t,async t=>this.isPlayingAd?(r.info("CrazyGames - Another ad is been played."),!1):this.validator.validate(this)&&await this.validator.canBeActivated(this)?this.isEnabled()?await this.tryRePlay(e):(r.info("CrazyGames - SDK not enabled."),!1):(r.error("CrazyGames - Ad can not be activated."),!1))}async tryRePlay(e){let t=this.gameManager.getFeature("ads");if(null===t.playedAds)return setTimeout(()=>{this.tryRePlay(e)},this.awaitAdsTime),!1;if(o.get(t?.playedAds,e.id,!1)&&!e.replay)return r.info("Ad already played",e),!1;let a=o.get(e,"adStartedCallback",()=>{this.isPlayingAd=!0,r.info("CrazyGames - Ad-started callback.",new Date().getTime()),this.send({act:n.ACTIONS.AD_STARTED,ads_id:e.id})}),i=o.get(e,"adFinishedCallback",async()=>{this.isPlayingAd=!1,r.info("CrazyGames - Ad-finished callback.",new Date().getTime()),this.send({act:n.ACTIONS.AD_ENDED,ads_id:e.id}),await this.gameManager.audioManager.changeMuteState(!1,!1)}),s=o.get(e,"adErrorCallback",async t=>{this.isPlayingAd=!1,r.info("CrazyGames - Ad-error callback.",t,new Date().getTime()),this.send({act:n.ACTIONS.AD_ENDED,ads_id:e.id,error:t}),await this.gameManager.audioManager.changeMuteState(!1,!1)}),l=o.get(e,"rewardItemKey",!1);await this.gameManager.audioManager.changeMuteState(!0,!0),await this.sdk.ad.requestAd(l?"rewarded":"midgame",{adStarted:a,adFinished:i,adError:s})}send(e){let t=this.gameManager?.activeRoomEvents;return t?t?.send(e):(r.warning("CrazyGames - RoomEvents undefined to send an Ad Video message."),!1)}}},{"151dab08c009e34c":"7wbJH","8c1021ea6457f100":"1ixNn","87d6b1e6e69bae6e":"@reldens/utils"}],"6RTBS":[function(e,t,a,i){let{Logger:s}=e("f6fb30bd19ef353e");t.exports.AdsProvider=class{static fetchActiveAdsByProviderId(e,t,a){if(!e)return{};let i=Object.keys(a);if(0===i.length)return{};let n={};for(let r of i){let i=a[r];if(e===i.provider.id){if(!i.enabled){s.info("Ad not enabled.",i);continue}if(-1===t.indexOf(i.type.key)){s.info("Invalid ad type.",i);continue}n[r]=i}}return s.info({providerId:e,activeProviderAds:n}),n}}},{f6fb30bd19ef353e:"@reldens/utils"}],"8MZtw":[function(e,t,a,i){let{AdsProvider:s}=e("c894c96a87401a74"),{AdsConst:n}=e("32be3a6a825a12db"),{Logger:r,sc:o}=e("7809fdefc811e104");t.exports.GameMonetize=class{constructor(e,t){this.gameManager=t,this.gameDom=t?.gameDom,this.events=t?.events,this.window=t?.gameDom?.getWindow(),this.metaData=e,this.setSdkOptions(),this.sdk=this.window?.sdk,this.retry=0,this.isPlayingAd=!1,this.environment=n.ENVIRONMENTS.DISABLED,this.metaData.sdkRetryTime||(this.metaData.sdkRetryTime=500),this.metaData.sdkMaxRetries||(this.metaData.sdkMaxRetries=10),this.activeAds=this.fetchActiveAds(e),this.activeAdBeenPlayed=!1,this.setConfig()}fetchActiveAds(e){return this.gameManager?.config?s.fetchActiveAdsByProviderId(e.id,this.validAdsTypes(),this.gameManager.config.get("client/ads/collection",{})):{}}eventKeys(){return{sdkAdStarted:"CONTENT_PAUSE_REQUESTED",sdkAdEnded:"SDK_GAME_START",sdkReady:"SDK_READY"}}setSdkOptions(){return!!this.gameDom&&(this.metaData.gameId?void(this.gameDom.getWindow().SDK_OPTIONS={gameId:this.metaData.gameId,onEvent:async e=>{switch(r.info("GameMonetize - SDK event fired: "+e.name),e.name){case this.eventKeys().sdkAdStarted:await this.adStartedCallback(e);break;case this.eventKeys().sdkAdEnded:await this.adEndedCallback(e);break;case this.eventKeys().sdkReady:await this.sdkReadyCallback(e)}}}):(r.error("GameMonetize - Game ID undefined."),!1))}setConfig(){this.videoMinimumDuration=this.gameManager?this.gameManager.config.getWithoutLogs("client/ads/general/providers/gameMonetize/videoMinimumDuration",n.VIDEOS_MINIMUM_DURATION):n.VIDEOS_MINIMUM_DURATION,this.awaitAdsTime=this.gameManager?this.gameManager.config.getWithoutLogs("client/ads/general/providers/gameMonetize/awaitAdsTime",n.AWAIT_ADS_TIME):n.AWAIT_ADS_TIME}validAdsTypes(){return[n.ADS_TYPES.EVENT_VIDEO]}async adStartedCallback(e){if(this.isPlayingAd=!0,await this.gameManager.audioManager.changeMuteState(!0,!0),!this.activeAdBeenPlayed)return r.info("AdStartedCallback undefined activeAd.",e,this.activeAdBeenPlayed),!1;r.info("GameMonetize - Ad-started callback.",new Date().getTime()),this.send({act:n.ACTIONS.AD_STARTED,ads_id:this.activeAdBeenPlayed.id})}async adEndedCallback(e){if(this.isPlayingAd=!1,await this.gameManager.audioManager.changeMuteState(!1,!1),!this.activeAdBeenPlayed)return r.info("AdEndedCallback undefined activeAd.",e,this.activeAdBeenPlayed),!1;r.info("GameMonetize - Ad-finished callback.",new Date().getTime()),this.send({act:n.ACTIONS.AD_ENDED,ads_id:this.activeAdBeenPlayed.id})}async sdkReadyCallback(e){this.sdk=this.window.sdk}async activate(){if(!this.sdk)return this.retry===this.metaData.sdkMaxRetries?r.critical("GameMonetize required object."):this.retry<this.metaData.sdkMaxRetries&&setTimeout(()=>{this.retry++,r.info("GameMonetize required object, retry #"+this.retry+"."),this.sdk=this.window?.sdk,this.sdk&&r.info("GameMonetize object found."),this.activate()},this.metaData.sdkRetryTime),!1;await this.activateAds()}async activateAds(){let e=Object.keys(this.activeAds);if(0===e.length)return r.info("None active ads."),!1;for(let t of e){let e=this.activeAds[t];if(n.ADS_TYPES.EVENT_VIDEO!==e.type.key)continue;let a=o.get(e,"eventKey",!1);if(!a)return r.warning("Missing event key.",e),!1;this.events.on(a,async t=>(r.info("GameMonetize - Video event fired, playing ad.",t,e),this.isPlayingAd)?(r.info("GameMonetize - Ad is been played."),!1):await this.tryRePlay(e))}}async tryRePlay(e){return null===this.gameManager.getFeature("ads").playedAds?(setTimeout(()=>{this.tryRePlay(e)},this.awaitAdsTime),!1):(this.activeAdBeenPlayed=e,o.isObjectFunction(this.sdk,"showBanner"))?void await this.sdk.showBanner():(r.critical("GameMonetize SDK not ready."),!1)}send(e){let t=this.gameManager?.activeRoomEvents;return t?t.send(e):(r.warning("GameMonetize - RoomEvents undefined to send an Ad Video message."),!1)}}},{c894c96a87401a74:"6RTBS","32be3a6a825a12db":"1ixNn","7809fdefc811e104":"@reldens/utils"}],anL97:[function(e,t,a,i){t.exports.GoogleAdSense=class{constructor(e,t){this.gameManager=t,this.gameDom=t?.gameDom,this.events=t?.events,this.window=t?.gameDom?.getWindow(),this.metaData=e}}},{}],am5Fm:[function(e,t,a,i){t.exports={ads:{}}},{}],eX6im:[function(e,t,a,i){let{DebugWorldCreator:s}=e("159f68d8a8780377"),{PluginInterface:n}=e("572e1f7ea3924a34"),{Logger:r,sc:o}=e("cb2ceff56813c995");t.exports.WorldPlugin=class extends n{setup(e){this.gameManager=o.get(e,"gameManager",!1),this.events=o.get(e,"events",!1),this.debugWorldCreator=!1,this.validateProperties()&&this.setupDebugMode()}validateProperties(){return this.gameManager?!!this.events||(r.error("EventsManager undefined in PredictionPlugin."),!1):(r.error("Game Manager undefined in PredictionPlugin."),!1)}setupDebugMode(){if(!this.gameManager.config.getWithoutLogs("client/world/debug/enabled",!1))return!1;this.debugWorldCreator=new s,this.events.on("reldens.createEngineSceneDone",async e=>{await this.debugWorldCreator.createSceneWorld(e.currentScene)})}}},{"159f68d8a8780377":"h0Dcg","572e1f7ea3924a34":"bYb3U",cb2ceff56813c995:"@reldens/utils"}],h0Dcg:[function(e,t,a,i){let{Renderer:s}=e("cbb9503570f9a4d4"),{P2world:n}=e("712e22e86c85722d"),{WorldTimer:r}=e("80454883498e516a"),{Logger:o}=e("27caf2d5a77ed4fe");t.exports.DebugWorldCreator=class{async createSceneWorld(e){let t=this.findValidLayers(e),a=this.cloneMapJson(e,t),i={sceneName:e.key,roomId:e.params.roomId,roomMap:e.params.roomName,mapJson:a,config:e.configManager,events:e.eventsManager,allowSimultaneous:e.configManager.get("client/general/controls/allowSimultaneousKeys",!0),worldConfig:e.gameManager.activeRoomEvents.roomData?.worldConfig||e.worldConfig};e.debugWorld=this.createWorldInstance(i),e.debugWorld.createLimits(),await e.debugWorld.createWorldContent({}),e.debugWorldTimer=new r({callbacks:[()=>{e.debugWorld?e.debugWorld.removeBodiesFromWorld():o.error("Scene World not longer exists.",e.roomWorld)}]}),e.debugWorldTimer.startWorldSteps(e.debugWorld),e.debugWorldRenderer=new s(e)}cloneMapJson(e,t){let a=e.tilesets[0];return a?Object.assign({},e.cache?.tilemap?.entries?.entries[a.name]?.data||{},{layers:t}):{}}findValidLayers(e){let t=[],a=e.tilesets[0];if(!a)return t;for(let i of e.cache.tilemap.entries.entries[a.name].data.layers)-1!==i.name.indexOf("collision")&&t.push(i);return t}createWorldInstance(e){return new n(e)}}},{cbb9503570f9a4d4:"aYSKT","712e22e86c85722d":"jP2Cx","80454883498e516a":"93HfN","27caf2d5a77ed4fe":"@reldens/utils"}],aYSKT:[function(e,t,a,i){let{Box:s}=e("fde0e3cf50e6ff47");t.exports.Renderer=class{constructor(e){this.scene=e,this.gameDom=e.gameManager.gameDom,this.world=e.debugWorld,this.canvasElement=!1,this.canvasContext=!1}fetchCanvasContext(){this.canvasContext=this.canvasElement.getContext("2d")}createCanvas(e,t){this.canvasElement=this.gameDom.createElement("canvas"),this.canvasElement.width=e,this.canvasElement.height=t,this.canvasElement.id="physicsCanvas",this.gameDom.getDocument().body.appendChild(this.canvasElement),this.fetchCanvasContext()}renderLoop(){this.canvasContext.clearRect(0,0,this.canvasElement.width,this.canvasElement.height),this.renderP2World(),this.gameDom.getWindow().requestAnimationFrame(this.renderLoop.bind(this))}renderP2World(){let e=this.canvasContext;for(let t=0;t<this.world.bodies.length;t++){let a=this.world.bodies[t];if(!a.isWall)continue;let i=a.shapes[0];if(e.fillStyle="#2f7dde",e.strokeStyle="#333333",i instanceof s){let t=a.position[0],s=a.position[1],n=i.width,r=i.height;e.save(),e.translate(t,s),e.rotate(a.angle),e.beginPath(),e.rect(-n/2,-r/2,n,r),e.closePath(),e.fill(),e.stroke(),e.restore()}e.closePath(),e.fill(),e.stroke()}for(let t=0;t<this.world.bodies.length;t++){let a=this.world.bodies[t];if(!a.isWall)continue;let i=a.shapes[0];if(i instanceof s){let t=a.firstTileIndex||0;e.fillStyle="#000000",e.font="9px Arial";let s=t.toString()+" / "+i.width+" / "+a.position[0],n=a.position[0],r=a.position[1],o=n-e.measureText(s).width/2;e.textAlign="left",e.textBaseline="middle",e.fillText(s,o,r)}}}debugWorld(){this.gameDom.getElement(".wrapper").style.display="none",this.createCanvas(this.scene.map.width*this.scene.map.tileWidth,this.scene.map.height*this.scene.map.tileHeight),this.renderP2World()}}},{fde0e3cf50e6ff47:"p2"}],"83Etb":[function(e,t,a,i){let{PreloaderHandler:s}=e("beb24ac2faa38dcf"),{ScoresMessageListener:n}=e("dee1b20915f8fc4b"),{MessageProcessor:r}=e("6d116519d34b9094"),{ScoresConst:o}=e("1ccd946bfeba00a0"),l=e("b91eaf643f56a617"),{TranslationsMapper:c}=e("3dfe0dee6d22ec47"),{PluginInterface:d}=e("1437aa517ee673e7"),{Logger:h,sc:m}=e("e7bcd0a5b428e237");t.exports.ScoresPlugin=class extends d{setup(e){this.gameManager=m.get(e,"gameManager",!1),this.events=m.get(e,"events",!1),this.preloaderHandler=new s,this.scoresMessageListener=new n,this.validateProperties()&&(this.setTranslations(),this.listenEvents(),this.listenMessages())}validateProperties(){return this.gameManager?!!this.events||(h.error("EventsManager undefined in ScoresPlugin."),!1):(h.error("Game Manager undefined in ScoresPlugin."),!1)}setTranslations(){if(!this.gameManager)return!1;c.forConfig(this.gameManager.config.client,l,o.MESSAGE.DATA_VALUES)}listenEvents(){this.events?(this.events.on("reldens.preloadUiScene",e=>{this.preloaderHandler.loadContents(e)}),this.events.on("reldens.createEngineSceneDone",e=>{let t=e?.roomEvents;if(!t)return h.critical("RoomEvents undefined for process Scores messages queue on ScoresPlugin.",e),!1;r.processScoresMessagesQueue(t,this.scoresMessageListener)})):h.error('EventsManager undefined in ScoresPlugin for "listenEvents".')}listenMessages(){this.gameManager&&this.events?this.gameManager.config.client.message.listeners[o.KEY]=this.scoresMessageListener:h.error('Game Manager or EventsManager undefined in ScoresPlugin for "listenMessages".')}}},{beb24ac2faa38dcf:"dTc3j",dee1b20915f8fc4b:"8hbyL","6d116519d34b9094":"9kFcK","1ccd946bfeba00a0":"3jA0O",b91eaf643f56a617:"ddaPk","3dfe0dee6d22ec47":"bJxKc","1437aa517ee673e7":"bYb3U",e7bcd0a5b428e237:"@reldens/utils"}],dTc3j:[function(e,t,a,i){let{ScoresConst:s}=e("d5020a58048d8cd6");t.exports.PreloaderHandler=class{loadContents(e){let t="/assets/features/scores/templates/";e.load.html(s.KEY,t+"ui-scores.html"),e.load.html(s.TEMPLATES.SCORES_TABLE,t+"ui-scores-table.html")}}},{d5020a58048d8cd6:"3jA0O"}],"3jA0O":[function(e,t,a,i){let s="scores.";t.exports.ScoresConst={KEY:"scores",PREFIX:"sco",ACTIONS:{UPDATE:"scoUp",TOP_SCORES_UPDATE:"scoTops"},TEMPLATES:{SCORES_TABLE:"scoresTable"},MESSAGE:{DATA_VALUES:{NAMESPACE:"scores"}},SNIPPETS:{PREFIX:s,TITLE:s+"scoresTitle",CONTENT:s+"scoresContent",MY_SCORE:s+"myScore"}}},{}],"8hbyL":[function(e,t,a,i){let{ScoresMessageHandler:s}=e("e7cd47cafdf969e"),{ScoresConst:n}=e("4fec0ba8d4e7853a"),{Logger:r,sc:o}=e("f6f863d8fe211644");t.exports.ScoresMessageListener=class{async executeClientMessageActions(e){let t=o.get(e,"message",!1);if(!t)return r.error("Missing message data on ScoresMessageListener.",e),!1;let a=o.get(e,"roomEvents",!1);if(!a)return r.error("Missing RoomEvents on ScoresMessageListener.",e),!1;let i=new s({roomEvents:a,message:t});return i.validate()?!!this.isScoresMessage(t)&&this.handleScoresMessage(t,i):this.isScoresMessage(t)?(a.scoresMessagesQueue||(a.scoresMessagesQueue=[]),a.scoresMessagesQueue.push(t),!0):(r.error("Invalid ScoresMessageHandler",i),!1)}handleScoresMessage(e,t){return n.ACTIONS.UPDATE===e.act?t.updatePlayerScore():n.ACTIONS.TOP_SCORES_UPDATE!==e.act||t.updateScoresBox()}isScoresMessage(e){return 0===e.act?.indexOf(n.PREFIX)}}},{e7cd47cafdf969e:"7g7VK","4fec0ba8d4e7853a":"3jA0O",f6f863d8fe211644:"@reldens/utils"}],"7g7VK":[function(e,t,a,i){let{UserInterface:s}=e("d13665ccdb08d785"),{ScoresConst:n}=e("3607b56eff987992"),{Logger:r,sc:o}=e("6e9ffa46628abd5f");t.exports.ScoresMessageHandler=class{constructor(e){this.roomEvents=o.get(e,"roomEvents",!1),this.message=o.get(e,"message",!1),this.gameManager=this.roomEvents?.gameManager,this.gameDom=this.gameManager?.gameDom,this.uiScene=this.gameManager?.gameEngine?.uiScene}validate(){return this.roomEvents?this.message?this.gameManager?this.uiScene:(r.info("Missing GameManager on ScoresMessageHandler."),!1):(r.info("Missing message on ScoresMessageHandler."),!1):(r.info("Missing RoomEvents on ScoresMessageHandler."),!1)}createScoresUi(){let e=o.get(this.uiScene.userInterfaces,n.KEY);if(e)return e;this.uiScene.userInterfaces||(this.uiScene.userInterfaces={});let t=new s(this.gameManager,{id:n.KEY,type:n.KEY,defaultOpen:!0,defaultClose:!0},"/assets/features/scores/templates/ui-scores.html",n.KEY);t.createUiElement(this.uiScene,n.KEY);let a=this.uiScene.elementsUi[n.KEY];if(!a)return r.error("Scores UI box not found.",{uiScores:t,uiBox:a}),!1;let i=this.gameManager.services.translator.t(this.gameManager.config.getWithoutLogs("client/scores/labels/title",n.SNIPPETS.TITLE)),l=this.gameManager.services.translator.t(this.gameManager.config.getWithoutLogs("client/scores/labels/content",n.SNIPPETS.CONTENT));return this.roomEvents.uiSetTitleAndContent(a,{title:i,content:l},this.uiScene),this.uiScene.userInterfaces[n.KEY]=t,this.uiScene.userInterfaces[n.KEY]}updatePlayerScore(){this.createScoresUi(n.KEY);let e=o.get(this.message,"newTotalScore",!1);e?(this.uiScene.currentPlayerScore=e,this.roomEvents.uiSetContent(this.uiScene.elementsUi[n.KEY],{content:this.createContentsUpdate()},this.uiScene)):r.debug("Missing new total score on update message.")}updateScoresBox(){this.createScoresUi(n.KEY);let e=o.get(this.message,"scores",!1);e?(this.uiScene.scores=e,this.roomEvents.uiSetContent(this.uiScene.elementsUi[n.KEY],{content:this.createContentsUpdate()},this.uiScene)):r.debug("Missing scores data on message.")}createContentsUpdate(){let e=this.uiScene.cache.html.get(n.TEMPLATES.SCORES_TABLE);if(!e)return r.error('Missing template "'+n.TEMPLATES.SCORES_TABLE+'".'),"";let t={scores:this.uiScene.scores,showCurrentPlayer:!0,currentPlayerScore:this.gameManager.services.translator.t(this.gameManager.config.getWithoutLogs("client/scores/labels/myScore",n.SNIPPETS.MY_SCORE),{myScore:this.uiScene.currentPlayerScore||"0"})};return this.gameManager.gameEngine.parseTemplate(e,t)}}},{d13665ccdb08d785:"e9cEC","3607b56eff987992":"3jA0O","6e9ffa46628abd5f":"@reldens/utils"}],"9kFcK":[function(e,t,a,i){let{ScoresMessageHandler:s}=e("2eeb57abc38b4be1"),{sc:n}=e("27775f7f913ec01a");t.exports.MessageProcessor=class{static processScoresMessagesQueue(e,t){if(n.isArray(e.scoresMessagesQueue)&&0!==e.scoresMessagesQueue.length){for(let a of e.scoresMessagesQueue)t.handleScoresMessage(a,new s({roomEvents:e,message:a}));e.scoresMessagesQueue=[]}}}},{"2eeb57abc38b4be1":"7g7VK","27775f7f913ec01a":"@reldens/utils"}],ddaPk:[function(e,t,a,i){t.exports={scores:{scoresTitle:"Top Players Scores",scoresContent:"No scores available.",myScore:"My score: %myScore"}}},{}],"4Fae6":[function(e,t,a,i){let{PreloaderHandler:s}=e("5758c6ee7bb9cc2a"),{MessageListener:n}=e("75bcbf886f6b5de8"),{MessageProcessor:r}=e("bc86930879fbb71b"),{RewardsConst:o}=e("64a9879ad20f16c"),l=e("14b75b28b4bb8047"),{TranslationsMapper:c}=e("e2a6585d36441da"),{PluginInterface:d}=e("385773ca42bfbe1"),{Logger:h,sc:m}=e("a334a81b6409a572");t.exports.RewardsPlugin=class extends d{setup(e){this.gameManager=m.get(e,"gameManager",!1),this.events=m.get(e,"events",!1),this.preloaderHandler=new s,this.messageListener=new n,this.validateProperties()&&(this.setTranslations(),this.listenEvents(),this.listenMessages(),h.debug("Plugin READY: Rewards"))}validateProperties(){return this.gameManager?!!this.events||(h.error("EventsManager undefined in RewardsPlugin."),!1):(h.error("Game Manager undefined in RewardsPlugin."),!1)}setTranslations(){if(!this.gameManager)return!1;c.forConfig(this.gameManager.config.client,l,o.MESSAGE.DATA_VALUES)}listenEvents(){this.events?(this.events.on("reldens.preloadUiScene",e=>{this.preloaderHandler.loadContents(e)}),this.events.on("reldens.createEngineSceneDone",e=>{r.processRewardsMessagesQueue(e,this)})):h.error('EventsManager undefined in RewardsPlugin for "listenEvents".')}listenMessages(){this.gameManager&&this.events?this.gameManager.config.client.message.listeners[o.KEY]=this.messageListener:h.error('Game Manager or EventsManager undefined in RewardsPlugin for "listenMessages".')}}},{"5758c6ee7bb9cc2a":"3rZRV","75bcbf886f6b5de8":"klrdT",bc86930879fbb71b:"5psmd","64a9879ad20f16c":"jtPtR","14b75b28b4bb8047":"19ZPF",e2a6585d36441da:"bJxKc","385773ca42bfbe1":"bYb3U",a334a81b6409a572:"@reldens/utils"}],"3rZRV":[function(e,t,a,i){let{RewardsConst:s}=e("c0baaedb21bffd44");t.exports.PreloaderHandler=class{loadContents(e){let t="/assets/features/rewards/templates/";e.load.html(s.KEY,t+"ui-rewards.html"),e.load.html(s.TEMPLATES.REWARDS_LIST,t+"ui-rewards-list.html")}}},{c0baaedb21bffd44:"jtPtR"}],jtPtR:[function(e,t,a,i){let s="rewards.";t.exports.RewardsConst={KEY:"rewards",PREFIX:"rwd",ACTIONS:{INITIALIZE:"rwdIni",UPDATE:"rwdUp",ACCEPT_REWARD:"rwdAcpt",ACCEPTED_REWARD:"rwdAcpted"},SPLIT_EXPERIENCE:{ALL:0,PROPORTIONAL_BY_LEVEL:1},SPLIT_MODIFIER:{ALL:0,RANDOM:1},SPLIT_ITEMS:{DROP_KEEPS:0,RANDOM:1},MESSAGE:{DATA:{LABEL:"rlbl",DESCRIPTION:"rdes",POSITION:"rpos",SHOW_REWARD_IMAGE:"srimg",REWARD_IMAGE:"rimg",REWARD_IMAGE_PATH:"rimgp",EVENT_DATA:"redt",STATE_DATA:"resd",ITEMS_DATA:"rmid",ITEM_KEY:"rikey",ITEM_LABEL:"rilbl",ITEM_DESCRIPTION:"rides",ITEM_QUANTITY:"riqty"},DATA_VALUES:{NAMESPACE:"rewards"}},TEMPLATES:{REWARDS_LIST:"rewardsList"},SNIPPETS:{PREFIX:s,TITLE:s+"title",ACCEPTED_REWARD:s+"acceptedReward"}}},{}],klrdT:[function(e,t,a,i){let{MessageHandler:s}=e("64a92a5204678fc9"),{RewardsConst:n}=e("364f1cdb78fb98e9"),{Logger:r,sc:o}=e("f9451ec69cdd0a47");t.exports.MessageListener=class{async executeClientMessageActions(e){let t=o.get(e,"message",!1);if(!t)return r.error("Missing message data on RewardsMessageListener.",e),!1;let a=o.get(e,"roomEvents",!1);if(!a)return r.error("Missing RoomEvents on RewardsMessageListener.",e),!1;if(!this.isRewardsMessage(t))return!1;let i=new s({roomEvents:a,message:t});return i.validate()?this.handleRewardsMessage(t,i):(a.rewardsMessagesQueue||(a.rewardsMessagesQueue=[]),a.rewardsMessagesQueue.push(t),!0)}handleRewardsMessage(e,t){return n.ACTIONS.UPDATE===e.act?t.updateRewardsBox():n.ACTIONS.ACCEPTED_REWARD!==e.act||t.showAcceptedReward()}isRewardsMessage(e){return 0===e.act?.indexOf(n.PREFIX)}}},{"64a92a5204678fc9":"6hmJt","364f1cdb78fb98e9":"jtPtR",f9451ec69cdd0a47:"@reldens/utils"}],"6hmJt":[function(e,t,a,i){let{UserInterface:s}=e("5bc785032b2d0856"),{RewardsConst:n}=e("1433e37d05c49b27"),{GameConst:r}=e("214c4839fe65344a"),{Logger:o,sc:l}=e("62758788d6e9eb13");t.exports.MessageHandler=class{constructor(e){this.roomEvents=l.get(e,"roomEvents",!1),this.message=l.get(e,"message",!1),this.gameManager=this.roomEvents?.gameManager,this.gameDom=this.gameManager?.gameDom,this.config=this.gameManager?.config,this.translator=this.gameManager?.services?.translator,this.uiScene=this.gameManager?.gameEngine?.uiScene}validate(){return this.roomEvents?this.message?this.gameManager?this.uiScene:(o.info("Missing GameManager on RewardsMessageHandler."),!1):(o.info("Missing message on RewardsMessageHandler."),!1):(o.info("Missing RoomEvents on RewardsMessageHandler."),!1)}createRewardsUi(e){let t=l.get(this.uiScene.userInterfaces,e);if(t)return t;this.uiScene.userInterfaces||(this.uiScene.userInterfaces={});let a=new s(this.gameManager,{id:e,type:e,defaultOpen:!0,defaultClose:!0},"/assets/features/rewards/templates/ui-rewards.html",e);a.createUiElement(this.uiScene,e),a.closeButton.addEventListener("click",()=>{this.gameDom.emptyElement(".accepted-reward")});let i=this.uiScene.elementsUi[e];if(!i)return o.error("Scores UI box not found.",{uiRewards:a,uiBox:i}),!1;let r=this.translator.t(this.config.getWithoutLogs("client/rewards/labels/title",n.SNIPPETS.TITLE));return this.roomEvents.uiSetTitleAndContent(i,{title:r},this.uiScene),this.uiScene.userInterfaces[e]=a,this.uiScene.userInterfaces[e]}updateRewardsBox(){this.createRewardsUi(n.KEY);let e=l.get(this.message,"rewards",!1);e?(this.enrichForDisplay(e),this.uiScene.rewards=e,this.roomEvents.uiSetContent(this.uiScene.elementsUi[n.KEY],{content:this.createUpdateContent()},this.uiScene),this.showRewardsNotificationBalloon(),this.activateRewardsAction()):o.debug("Missing rewards data on message.")}showAcceptedReward(){this.createRewardsUi(n.KEY);let e=l.get(this.message,"acceptedReward",!1);e?(this.enrichForDisplay([e]),this.uiScene.acceptedReward=e,this.roomEvents.uiSetContent(this.uiScene.elementsUi[n.KEY],{content:this.createUpdateContent()},this.uiScene)):o.debug("Missing rewards on update message.")}createUpdateContent(){let e=this.uiScene.cache.html.get(n.TEMPLATES.REWARDS_LIST);if(!e)return o.error('Missing template "'+n.TEMPLATES.REWARDS_LIST+'".'),"";let t=this.uiScene.acceptedReward,a=t?this.translator.t(this.config.getWithoutLogs("client/rewards/labels/acceptedReward",n.SNIPPETS.ACCEPTED_REWARD),{rewardLabel:t.translated.label}):"",i={rewards:this.uiScene.rewards,acceptedReward:t,acceptedRewardMessage:a};return this.gameManager.gameEngine.parseTemplate(e,i)}enrichForDisplay(e){for(let t of e){let e=this.translator.t(t[n.MESSAGE.DATA.DESCRIPTION]||"",{loginCount:t[n.MESSAGE.DATA.EVENT_DATA]?.days||""});this.config.getWithoutLogs("client/rewards/labels/includeItemsDescription",!0)&&(e+=this.mapItemsText(t));let a=this.translator.t(t[n.MESSAGE.DATA.LABEL]||"",{loginCount:t[n.MESSAGE.DATA.EVENT_DATA]?.days||""});t.translated={label:a,description:e};let i=t[n.MESSAGE.DATA.STATE_DATA];t.activeClass=i?.ready&&!i?.complete?"active":"inactive",t.showRewardImage=t[n.MESSAGE.DATA.SHOW_REWARD_IMAGE]||"",t.rewardImage=t[n.MESSAGE.DATA.REWARD_IMAGE]||"",t.rewardImagePath=t[n.MESSAGE.DATA.REWARD_IMAGE_PATH]||""}return e}mapItemsText(e){let t=this.config.getWithoutLogs("client/rewards/labels/itemsSeparator","<br/>"),a=this.config.getWithoutLogs("client/rewards/labels/itemsTemplate","%label (%quantity)");return t+e[n.MESSAGE.DATA.ITEMS_DATA]?.map(e=>a=(a=a.replace("%label",e[n.MESSAGE.DATA.ITEM_LABEL])).replace("%quantity",e[n.MESSAGE.DATA.ITEM_QUANTITY])).join(t)}showRewardsNotificationBalloon(){let e=this.gameDom.getElement("#rewards-notification-balloon"),t=this.gameDom.getElements(".reward-active");e&&t&&0<t.label?e.classList.remove("hidden"):e.classList.add("hidden")}activateRewardsAction(){for(let e of this.gameDom.getElements(".reward-active"))e.addEventListener("click",()=>{this.gameManager.activeRoomEvents.send({[r.ACTION_KEY]:n.ACTIONS.ACCEPT_REWARD,id:e.dataset.rewardId})})}}},{"5bc785032b2d0856":"e9cEC","1433e37d05c49b27":"jtPtR","214c4839fe65344a":"52yv8","62758788d6e9eb13":"@reldens/utils"}],"5psmd":[function(e,t,a,i){let{MessageHandler:s}=e("45635d97a9c1c345"),{Logger:n,sc:r}=e("5db63803d008826");t.exports.MessageProcessor=class{static processRewardsMessagesQueue(e,t){let a=e?.roomEvents;if(!a)return n.critical("RoomEvents undefined for process Rewards messages queue on RewardsPlugin.",e),!1;if(r.isArray(a.rewardsMessagesQueue)&&0!==a.rewardsMessagesQueue.length){for(let e of a.rewardsMessagesQueue)t.messageListener?.handleRewardsMessage(e,new s({roomEvents:a,message:e}));a.rewardsMessagesQueue=[]}}}},{"45635d97a9c1c345":"6hmJt","5db63803d008826":"@reldens/utils"}],"19ZPF":[function(e,t,a,i){t.exports={rewards:{title:"Rewards",dailyLogin:"Daily Login",dailyDescription:"Login every day and claim your reward",straightDaysLogin:"%loginCount Days Login",straightDaysDescription:"Login every day for %loginCount days and claim your reward",acceptedReward:'You accepted the "%rewardLabel" reward!'}}},{}],iWTai:[function(e,t,a,i){let s=e("e7d36bfbb0724f13").default,n=e("2ec809fd89cf35d5"),r=e("c0c0dbe4468962c4"),o=e("2b9362a186f219e2"),{ErrorsBlockHandler:l}=e("e880c9c922303a35"),{GameConst:c}=e("9ce09ab103654ea9"),{ErrorManager:d,Logger:h,sc:m}=e("7a4562850a98c1a");t.exports.FirebaseConnector=class{constructor(e){e||d.error("FirebaseConnector - Missing game manager."),this.gameManager=e,this.gameDom=this.gameManager.gameDom,this.analytics=n,this.app=s,this.firebaseAuth=r,this.ui=o,this.authUi=!1,this.isActive=!1,this.containerId="#firebaseui-auth-container",this.uiConfig={signInOptions:[{provider:this.firebaseAuth.GoogleAuthProvider.PROVIDER_ID},{provider:this.firebaseAuth.FacebookAuthProvider.PROVIDER_ID},{provider:this.firebaseAuth.GithubAuthProvider.PROVIDER_ID}],signInFlow:"popup"},this.gameManager.events.on("reldens.beforeJoinGame",e=>{"firebase-login"===e.formData.formId&&(e.gameManager.userData.isFirebaseLogin=!0)})}startFirebase(){let e=this.gameManager.appServerUrl+c.ROUTE_PATHS.FIREBASE;this.gameDom.getJSON(e,(e,t)=>{if(e)return h.error("FirebaseConnector - Failed to load firebase config.",e),!1;if(!t||!t.enabled)return!1;let a=t.firebaseConfig;this.initAuth(a,this.uiConfig),this.gameDom.getWindow().addEventListener("beforeunload",()=>{this.isActive&&this.app.auth().signOut()}),this.app.auth().onAuthStateChanged(e=>(e?this.setActiveUser(e):this.startAuthUi(),!1));let i=this.gameDom.getElement("#firebase-login");i&&this.activateLoginBehavior(i)})}activateLoginBehavior(e){e.addEventListener("submit",t=>{if(t.preventDefault(),!e.checkValidity())return!1;this.gameDom.getElement(".firebase-row-container").classList.remove("hidden")});let t=this.gameDom.getElement("#firebase-username");if(!t)return!1;this.gameDom.getElement(".firebase-row-container").classList.remove("hidden"),t.addEventListener("change",()=>{l.reset(e)}),t.addEventListener("focus",()=>{l.reset(e)})}startAuthUi(){this.isActive=!1,this.gameDom.getElement(this.containerId)&&(this.gameDom.getElement(this.containerId).innerHTML=""),this.authUi.start(this.containerId,this.uiConfig)}setActiveUser(e){this.isActive=!0;let t={formId:"firebase-login",email:e.email,username:this.gameDom.getElement("#firebase-username").value,password:e.uid};this.gameManager.startGame(t,!0)}initAuth(e,t){if(!e||!t)return h.error("Missing firebase configuration."),!1;this.firebaseConfig=e,this.uiConfig=t,this.app.initializeApp(this.firebaseConfig),m.hasOwn(this.firebaseConfig,"measurementId")&&this.app.analytics(),this.authUi=new this.ui.auth.AuthUI(this.app.auth()),m.hasOwn(this.uiConfig,"callbacks")||(this.uiConfig.callbacks={}),m.hasOwn(this.uiConfig.callbacks,"signInSuccessWithAuthResult")||(this.uiConfig.callbacks.signInSuccessWithAuthResult=()=>!1)}}},{e7d36bfbb0724f13:"firebase/compat/app","2ec809fd89cf35d5":"firebase/compat/analytics",c0c0dbe4468962c4:"firebase/auth","2b9362a186f219e2":"firebaseui",e880c9c922303a35:"idPEb","9ce09ab103654ea9":"52yv8","7a4562850a98c1a":"@reldens/utils"}],hfv3q:[function(e,t,a,i){let{ConfigProcessor:s}=e("5fbca4d95ccfdb58");t.exports.ConfigManager=class extends s{constructor(){super(),this.client={general:{users:{allowRegistration:!0,allowGuest:!0,allowGuestUserName:!0}},customClasses:{message:{listeners:{}}},message:{listeners:{}}}}}},{"5fbca4d95ccfdb58":"5UhnU"}],"5UhnU":[function(e,t,a,i){let{Logger:s,sc:n}=e("c5ed0c3af76d2f77");t.exports.ConfigProcessor=class{constructor(){this.avoidLog=!1}get(e,t){let a=void 0!==t&&t,i=e.split("/");if(2>i.length)return this.avoidLog||s.error("Path level is too low:",e),a;let r=this[i[0]]||{};for(let t=1;t<i.length;t++){if(!n.hasOwn(r,i[t])){this.avoidLog||s.error("Configuration level "+t+' > "'+i[t]+'" not defined: '+e),r=a;break}r=r[i[t]]}return r}getWithoutLogs(e,t=!1){this.avoidLog=!0;let a=this.get(e,t);return this.avoidLog=!1,a}}},{c5ed0c3af76d2f77:"@reldens/utils"}],wD4bz:[function(e,t,a,i){t.exports={game:{passwordConfirmationNotMatch:"Password and confirmation does not match.",pleaseReadTermsAndConditions:"Please read and accept the terms and conditions and continue.",sessionEnded:"Your session ended, please login again.",errors:{missingClasses:"None configured classes available.",missingPlayerData:"Missing player data.",joiningRoom:'There was an error while joining the room "%joinRoomName", please try again later.',joiningFeatureRoom:'There was an error while joining the feature room "%joinRoomName".',reconnectClient:"Reconnect Game Client error.",sessionEnded:"Your session ended, please login again.",connectionLost:"Connection lost, please login again.",serverDown:"Server is offline."},pleaseSelectScene:"Please select a Scene"}}},{}],kdE6H:[function(e,t,a,i){let{sc:s}=e("f53434bdd3518741");t.exports.GameDom=new class{constructor(){this.styleSuffix={width:"px",height:"px",top:"px",bottom:"px",left:"px",right:"px"}}getWindow(){return window}getDocument(){return window.document}getElement(e,t=!1){return(t||document).querySelector(e)}getElements(e,t){return(t||document).querySelectorAll(e)}emptyElement(e,t=!1){let a=this.getElement(e,t);a&&(a.innerHTML="")}appendToElement(e,t){let a=this.getElement(e);if(!a||!t)return!1;let i=document.createElement("template");i.innerHTML=t;for(let e=0;e<i.content.childNodes.length;e++)a.appendChild(i.content.childNodes[e]);return a}updateContent(e,t){let a=this.getElement(e);return!!a&&(a.innerHTML=t,a)}removeElement(e){this.getElement(e)?.remove()}createElement(e,t="",a){let i=document.createElement(e);if(""!==t&&(i.id=t),s.isArray(a))for(let e of a)i.classList.add(e);return i}setElementStyles(e,t){if(!e||!t)return!1;for(let a of Object.keys(t)){let i=t[a],n=s.get(this.styleSuffix,a,"");""!==n&&(i+=n),e.style[a]=i}}createElementWithStyles(e,t="",a={}){let i=this.createElement(e,t);return this.setElementStyles(i,a),i}activeElement(){return document.activeElement}insideInput(){return"input"===this.activeElement().tagName.toLowerCase()}getJSON(e,t){let a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="json",a.onload=()=>{let e=a.status;200===e?t(null,a.response):t(e)},a.send()}alertReload(e){return alert(e),this.getWindow().location.reload(),!1}}},{f53434bdd3518741:"@reldens/utils"}],"8V4ag":[function(e,t,a,i){t.exports=JSON.parse('{"name":"reldens","version":"4.0.0-beta.38.3","description":"Reldens - MMORPG Platform","author":"Damian A. Pastorini","license":"MIT","homepage":"https://www.reldens.com/","repository":{"type":"git","url":"https://github.com/damian-pastorini/reldens.git"},"keywords":["reldens","game","mmorpg","rpg","dwd","colyseus","phaser","parcel","nodejs","mmo","multiplayer","rol","platform","framework","javascript","js","script"],"bugs":{"url":"https://github.com/damian-pastorini/reldens/issues"},"engines":{"node":">=18.0.0","npm":">=8.0.0"},"bin":{"reldens":"bin/reldens-commands.js","reldens-generate":"bin/generate.js","reldens-import":"bin/import.js"},"dependencies":{"@colyseus/core":"0.15.55","@colyseus/monitor":"0.15.8","@colyseus/schema":"2.0.36","@colyseus/ws-transport":"0.15.3","@parcel/bundler-default":"2.13.3","@parcel/compressor-raw":"2.13.3","@parcel/core":"2.13.3","@parcel/namer-default":"2.13.3","@parcel/optimizer-css":"2.13.3","@parcel/optimizer-data-url":"2.13.3","@parcel/optimizer-htmlnano":"2.13.3","@parcel/optimizer-image":"2.13.3","@parcel/optimizer-swc":"2.13.3","@parcel/packager-css":"2.13.3","@parcel/packager-html":"2.13.3","@parcel/packager-js":"2.13.3","@parcel/packager-raw":"2.13.3","@parcel/packager-raw-url":"2.13.3","@parcel/packager-svg":"2.13.3","@parcel/packager-ts":"2.13.3","@parcel/packager-wasm":"2.13.3","@parcel/packager-xml":"2.13.3","@parcel/reporter-dev-server":"2.13.3","@parcel/resolver-default":"2.13.3","@parcel/runtime-browser-hmr":"2.13.3","@parcel/runtime-js":"2.13.3","@parcel/runtime-react-refresh":"2.13.3","@parcel/runtime-service-worker":"2.13.3","@parcel/transformer-babel":"2.13.3","@parcel/transformer-coffeescript":"2.13.3","@parcel/transformer-css":"2.13.3","@parcel/transformer-glsl":"2.13.3","@parcel/transformer-graphql":"2.13.3","@parcel/transformer-html":"2.13.3","@parcel/transformer-image":"2.13.3","@parcel/transformer-inline-string":"2.13.3","@parcel/transformer-js":"2.13.3","@parcel/transformer-json":"2.13.3","@parcel/transformer-jsonld":"2.13.3","@parcel/transformer-less":"2.13.3","@parcel/transformer-postcss":"2.13.3","@parcel/transformer-posthtml":"2.13.3","@parcel/transformer-pug":"2.13.3","@parcel/transformer-raw":"2.13.3","@parcel/transformer-react-refresh-wrap":"2.13.3","@parcel/transformer-sass":"2.13.3","@parcel/transformer-stylus":"2.13.3","@parcel/transformer-sugarss":"2.13.3","@parcel/transformer-svg":"2.13.3","@parcel/transformer-toml":"2.13.3","@parcel/transformer-typescript-types":"2.13.3","@parcel/transformer-vue":"2.13.3","@parcel/transformer-webmanifest":"2.13.3","@parcel/transformer-worklet":"2.13.3","@parcel/transformer-xml":"2.13.3","@parcel/transformer-yaml":"2.13.3","@reldens/game-data-generator":"^0.9.0","@reldens/items-system":"^0.34.0","@reldens/modifiers":"^0.26.0","@reldens/skills":"^0.34.0","@reldens/storage":"^0.31.0","@reldens/tile-map-generator":"^0.16.0","@reldens/utils":"^0.39.0","@sendgrid/mail":"8.1.4","bcrypt":"5.1.1","body-parser":"1.20.3","colyseus.js":"0.15.26","core-js":"3.39.0","cors":"2.8.5","crypto-browserify":"^3.12.1","dotenv":"16.4.5","ethers":"^6.15.0","events":"^3.3.0","express":"4.21.1","express-basic-auth":"1.2.1","express-formidable":"1.2.0","express-rate-limit":"7.4.1","express-session":"1.18.1","firebase":"10.14.1","firebaseui":"6.1.0","jimp":"1.6.0","mime-types":"2.1.35","multer":"^1.4.5-lts.1","mustache":"4.2.0","nodemailer":"6.9.16","p2":"0.7.1","pathfinding":"0.4.18","phaser":"3.87.0","react":"^18.3.1","react-dom":"^18.3.1","react-router-dom":"^6.26.2","regenerator-runtime":"0.14.1","stream-browserify":"^3.0.0","tslib":"2.8.1"},"alias":{"reldens":"./","crypto":"crypto-browserify","stream":"stream-browserify","events":"events","process":"process/browser","colyseus.js":"colyseus.js/dist/colyseus.js"},"devDependencies":{"@babel/preset-react":"^7.27.1","parcel":"2.13.3","process":"^0.11.10","svgo":"^3.3.2"},"scripts":{"start":"node index.js","build":"parcel build theme/default/index.html --dist-dir dist --public-url ./"}}')},{}],jS2AP:[function(e,t,a,i){let{PluginInterface:s}=e("5775474fb24972c6"),{Npc1:n}=e("66950fed6ab0bf91");t.exports.ClientPlugin=class extends s{setup(e){this.events=e.events,this.events.on("reldens.beforeJoinGame",e=>{this.defineCustomClasses(e)})}defineCustomClasses(e){let t=e.gameManager.config.client.customClasses;t.objects||(t.objects={}),t.objects.people_town_1=n}}},{"5775474fb24972c6":"bYb3U","66950fed6ab0bf91":"5kQ1j"}],"5kQ1j":[function(e,t,a,i){let{AnimationEngine:s}=e("61ae8608f1dd11e8");t.exports.Npc1=class extends s{constructor(e,t,a){super(e,t,a)}}},{"61ae8608f1dd11e8":"ho7cr"}]},["cGIPt"],"cGIPt","parcelRequire94c2");
//# sourceMappingURL=index.b9726b9f.js.map
